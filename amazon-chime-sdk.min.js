!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ChimeSDK=t()}(this,(function(){"use strict";function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){if(this instanceof e){var i=[null];return i.push.apply(i,arguments),new(Function.bind.apply(t,i))}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),i}var build$9={},AllHighestVideoBandwidthPolicy$1={},DefaultVideoStreamIdSet$1={};Object.defineProperty(DefaultVideoStreamIdSet$1,"__esModule",{value:!0});class DefaultVideoStreamIdSet{constructor(e){this.ids=new Set(e)}add(e){this.ids.add(e)}array(){return Array.from(this.ids.values()).sort(((e,t)=>e-t))}contain(e){return this.ids.has(e)}forEach(e){this.ids.forEach(e)}empty(){return 0===this.ids.size}size(){return this.ids.size}equal(e){if(!e)return 0===this.ids.size;const t=this.array(),i=e.array();if(t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0}clone(){return new DefaultVideoStreamIdSet(this.array())}remove(e){this.ids.delete(e)}toJSON(){return this.array()}truncate(e){const t=this.array();return new DefaultVideoStreamIdSet(t.splice(0,e))}}DefaultVideoStreamIdSet$1.default=DefaultVideoStreamIdSet;var __importDefault$1L=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(AllHighestVideoBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1$3=__importDefault$1L(DefaultVideoStreamIdSet$1);class AllHighestVideoBandwidthPolicy{constructor(e){this.selfAttendeeId=e,this.reset()}reset(){this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.videoSources=void 0}updateIndex(e){this.videoIndex=e,this.optimalReceiveSet=this.calculateOptimalReceiveSet(e)}updateMetrics(e){}wantsResubscribe(){return!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveSet.clone()}chooseRemoteVideoSources(e){this.videoSources=e,this.optimalReceiveSet=this.calculateOptimalReceiveSet(this.videoIndex).clone()}calculateOptimalReceiveSet(e){const t=new DefaultVideoStreamIdSet_1$3.default;if(!this.videoIndex||this.videoIndex.allStreams().empty())return t;const i=e.highestQualityStreamFromEachGroupExcludingSelf(this.selfAttendeeId),n=this.videoSources?this.videoSources:this.videoIndex.allVideoSendingSourcesExcludingSelf(this.selfAttendeeId),r=this.videoIndex.remoteStreamDescriptions(),o=new Map;for(const e of r)i.contain(e.streamId)&&o.set(e.attendeeId,e);let a=0;for(const e of n){const i=e.attendee.attendeeId;if(o.has(i)){const e=o.get(i);if(!(a+e.maxBitrateKbps<=AllHighestVideoBandwidthPolicy.maxReceiveBitrateKbps)){console.warn("total bitrate "+(a+e.maxBitrateKbps)+" exceeds maximum limit (15000). Use chooseRemoteVideoSources to select a subset of participants to avoid this.");break}t.add(e.streamId),a+=e.maxBitrateKbps}}return t}}AllHighestVideoBandwidthPolicy$1.default=AllHighestVideoBandwidthPolicy,AllHighestVideoBandwidthPolicy.maxReceiveBitrateKbps=15e3;var ApplicationMetadata$1={};Object.defineProperty(ApplicationMetadata$1,"__esModule",{value:!0});class ApplicationMetadata{constructor(e,t){this.appName=e,this.appVersion=t}static create(e,t){const i=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!e||e.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!i.test(e))throw new Error(`appName must satisfy ${i} regular expression`);if(!t||t.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm.test(t))throw new Error("appVersion must satisfy Semantic Versioning format");return new ApplicationMetadata(e,t)}}ApplicationMetadata$1.default=ApplicationMetadata;var AsyncScheduler$1={},TimeoutScheduler$1={};Object.defineProperty(TimeoutScheduler$1,"__esModule",{value:!0});class TimeoutScheduler{constructor(e){this.timeoutMs=e,this.timer=null}start(e){this.stop(),this.timer=setTimeout((()=>{clearTimeout(this.timer),e()}),this.timeoutMs)}stop(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}TimeoutScheduler$1.default=TimeoutScheduler;var __importDefault$1K=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(AsyncScheduler$1,"__esModule",{value:!0});const TimeoutScheduler_1$3=__importDefault$1K(TimeoutScheduler$1);class AsyncScheduler extends TimeoutScheduler_1$3.default{constructor(){super(0)}static nextTick(e){setTimeout(e,0)}}AsyncScheduler$1.default=AsyncScheduler;var AttachMediaInputTask$1={},VideoLogEvent={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.VideoLogEvent=void 0,function(e){e[e.InputAttached=0]="InputAttached",e[e.SendingFailed=1]="SendingFailed",e[e.SendingSuccess=2]="SendingSuccess"}(t=e.VideoLogEvent||(e.VideoLogEvent={})),e.default=t}(VideoLogEvent);var BaseTask$1={},OnceTask$1={},LogLevel={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.LogLevel=void 0,function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.OFF=4]="OFF"}(t=e.LogLevel||(e.LogLevel={})),e.default=t}(LogLevel);var __importDefault$1J=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(OnceTask$1,"__esModule",{value:!0});const LogLevel_1$8=__importDefault$1J(LogLevel),AsyncScheduler_1$8=__importDefault$1J(AsyncScheduler$1);class OnceTask{constructor(e,t,i){this.logger=e,this.task=t,this.dependencies=i,this.canceled=!1}name(){return`${this.task.name()} (once)`}cancel(){if(!this.canceled){if(this.dependencies)for(const e of this.dependencies)e.cancel();this.logger.info(`Canceling ${this.name()}`),AsyncScheduler_1$8.default.nextTick((()=>this.task.cancel())),this.canceled=!0,this.cancelPromise&&AsyncScheduler_1$8.default.nextTick((()=>this.cancelPromise(new Error(`canceling ${this.name()}`))))}}logDependencies(){if(this.logger.getLogLevel()>LogLevel_1$8.default.INFO)return;if(!this.dependencies)return;const e=this.dependencies.filter((e=>e)).map((e=>e.name())).join(", ");this.logger.info(`${this.task.name()} waiting for dependencies: ${e}`)}run(){if(this.promise)return this.promise;const e=this.dependencies?Promise.all(this.dependencies.map((e=>null==e?void 0:e.run()))):Promise.resolve();return this.logDependencies(),this.ongoing=e.then((()=>this.task.run())),this.promise=new Promise(((e,t)=>{this.cancelPromise=t,this.ongoing.then(e).catch(t)}))}setParent(e){this.task.setParent(e)}}OnceTask$1.default=OnceTask;var TaskStatus$1={},TaskStatus;Object.defineProperty(TaskStatus$1,"__esModule",{value:!0}),function(e){e.IDLE="IDLE",e.RUNNING="RUNNING",e.CANCELED="CANCELED",e.FINISHED="FINISHED"}(TaskStatus||(TaskStatus={})),TaskStatus$1.default=TaskStatus;var __awaiter$16=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1I=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BaseTask$1,"__esModule",{value:!0});const OnceTask_1=__importDefault$1I(OnceTask$1),TaskStatus_1$1=__importDefault$1I(TaskStatus$1);class BaseTask{constructor(e){this.logger=e,this.taskName="BaseTask",this.parentTask=null,this.status=TaskStatus_1$1.default.IDLE,this.run=this.baseRun.bind(this,this.run),this.cancel=this.baseCancel.bind(this,this.cancel)}once(...e){return new OnceTask_1.default(this.logger,this,e)}cancel(){}name(){return this.parentTask?`${this.parentTask.name()}/${this.taskName}`:this.taskName}setParent(e){this.parentTask=e}getStatus(){return this.status}logAndThrow(e){throw this.logger.info(e),new Error(e)}baseRun(e){return __awaiter$16(this,void 0,void 0,(function*(){try{const t=Date.now();switch(this.logger.info(`running task ${this.name()}`),this.status){case TaskStatus_1$1.default.RUNNING:this.logAndThrow(`${this.name()} is already running`);case TaskStatus_1$1.default.CANCELED:this.logAndThrow(`${this.name()} was canceled before running`);case TaskStatus_1$1.default.FINISHED:this.logAndThrow(`${this.name()} was already finished`)}this.status=TaskStatus_1$1.default.RUNNING,yield e.call(this),this.logger.info(`${this.name()} took ${Math.round(Date.now()-t)} ms`)}catch(e){throw e}finally{this.status!==TaskStatus_1$1.default.CANCELED&&(this.status=TaskStatus_1$1.default.FINISHED)}}))}baseCancel(e){this.status!==TaskStatus_1$1.default.CANCELED&&this.status!==TaskStatus_1$1.default.FINISHED?(this.logger.info(`canceling task ${this.name()}`),this.status=TaskStatus_1$1.default.CANCELED,e.call(this)):this.logger.info(`Not canceling ${this.name()}: state is ${this.status}`)}}BaseTask$1.default=BaseTask;var __awaiter$15=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1H=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(AttachMediaInputTask$1,"__esModule",{value:!0});const VideoLogEvent_1$1=__importDefault$1H(VideoLogEvent),BaseTask_1$p=__importDefault$1H(BaseTask$1);class AttachMediaInputTask extends BaseTask_1$p.default{constructor(e){super(e.logger),this.context=e,this.taskName="AttachMediaInputTask"}run(){return __awaiter$15(this,void 0,void 0,(function*(){const e=this.context.transceiverController;e.setPeer(this.context.peer);try{e.setupLocalTransceivers()}catch(e){throw e}const t=this.context.activeAudioInput;if(t){const i=t.getAudioTracks();this.context.logger.info("attaching audio track to peer connection"),yield e.setAudioInput(i.length?i[0]:null)}else yield e.setAudioInput(null),this.context.logger.info("no audio track");this.setAudioCodecPreferences();const i=this.context.activeVideoInput;if(i){const t=i.getVideoTracks(),n=t.length?t[0]:null;if(this.context.logger.info("attaching video track to peer connection"),yield e.setVideoInput(n),this.context.enableSimulcast&&this.context.videoUplinkBandwidthPolicy){const t=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();e.setEncodingParameters(t)}n&&this.context.statsCollector.logVideoEvent(VideoLogEvent_1$1.default.InputAttached,this.context.videoDeviceInformation)}else yield e.setVideoInput(null),this.context.logger.info("no video track");this.context.videoSubscriptions=e.updateVideoTransceivers(this.context.videoStreamIndex,this.context.videosToReceive)}))}setAudioCodecPreferences(){const e=window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype,t=this.context.audioProfile.hasRedundancyEnabled();if(!e)return void this.context.logger.warn("Setting codec preferences not supported");const i=this.context.transceiverController.localAudioTransceiver(),{codecs:n}=RTCRtpSender.getCapabilities("audio");this.context.logger.debug(`Available audio codecs ${JSON.stringify(n,null,4)}`);const r=n.findIndex((e=>"audio/red"===e.mimeType));if(i){if(r>=0){const e=n[r];return n.splice(r,1),t?(n.unshift(e),this.context.logger.info("audio/red set as preferred codec")):this.context.logger.info("audio/red removed from preferred codec"),void i.setCodecPreferences(n)}this.context.logger.info("audio/red codec not supported")}else this.context.logger.error("audio transceiver is null")}}AttachMediaInputTask$1.default=AttachMediaInputTask;var Attendee$1={};Object.defineProperty(Attendee$1,"__esModule",{value:!0});class Attendee{}Attendee$1.default=Attendee;var AudioLogEvent={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.AudioLogEvent=void 0,function(e){e[e.DeviceChanged=0]="DeviceChanged",e[e.MutedLocal=1]="MutedLocal",e[e.UnmutedLocal=2]="UnmutedLocal",e[e.Connected=3]="Connected",e[e.ConnectFailed=4]="ConnectFailed",e[e.RedmicStartLoss=5]="RedmicStartLoss",e[e.RedmicEndLoss=6]="RedmicEndLoss"}(t=e.AudioLogEvent||(e.AudioLogEvent={})),e.default=t}(AudioLogEvent);var AudioProfile$1={},DefaultBrowserBehavior$1={},__spreadArray=function(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},BrowserInfo=function(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"},NodeInfo=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},SearchBotDeviceInfo=function(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"},BotInfo=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ReactNativeInfo=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(e){return e?parseUserAgent(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ReactNativeInfo:"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(e){return""!==e&&userAgentRules.reduce((function(t,i){var n=i[0],r=i[1];if(t)return t;var o=r.exec(e);return!!o&&[n,o]}),!1)}function browserName(e){var t=matchUserAgent(e);return t?t[0]:null}function parseUserAgent(e){var t=matchUserAgent(e);if(!t)return null;var i=t[0],n=t[1];if("searchbot"===i)return new BotInfo;var r=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);r?r.length<REQUIRED_VERSION_PARTS&&(r=__spreadArray(__spreadArray([],r,!0),createVersionParts(REQUIRED_VERSION_PARTS-r.length),!0)):r=[];var o=r.join("."),a=detectOS(e),s=SEARCHBOT_OS_REGEX.exec(e);return s&&s[1]?new SearchBotDeviceInfo(i,o,a,s[1]):new BrowserInfo(i,o,a)}function detectOS(e){for(var t=0,i=operatingSystemRules.length;t<i;t++){var n=operatingSystemRules[t],r=n[0];if(n[1].exec(e))return r}return null}function getNodeVersion(){return"undefined"!=typeof process&&process.version?new NodeInfo(process.version.slice(1)):null}function createVersionParts(e){for(var t=[],i=0;i<e;i++)t.push("0");return t}var es=Object.freeze({__proto__:null,BotInfo:BotInfo,BrowserInfo:BrowserInfo,NodeInfo:NodeInfo,ReactNativeInfo:ReactNativeInfo,SearchBotDeviceInfo:SearchBotDeviceInfo,browserName:browserName,detect:detect,detectOS:detectOS,getNodeVersion:getNodeVersion,parseUserAgent:parseUserAgent}),require$$0$3=getAugmentedNamespace(es),uaParserExports={},uaParser={get exports(){return uaParserExports},set exports(e){uaParserExports=e}};!function(e,t){!function(i,n){var r="function",o="undefined",a="object",s="string",d="model",l="name",c="type",u="vendor",h="version",p="architecture",m="console",f="mobile",g="tablet",S="smarttv",v="wearable",b="embedded",_="Amazon",y="Apple",C="ASUS",w="BlackBerry",E="Browser",T="Chrome",k="Firefox",M="Google",R="Huawei",A="LG",P="Microsoft",I="Motorola",$="Opera",D="Samsung",x="Sharp",O="Sony",F="Xiaomi",B="Zebra",N="Facebook",L=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},V=function(e,t){return typeof e===s&&-1!==U(t).indexOf(U(e))},U=function(e){return e.toLowerCase()},j=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},z=function(e,t){for(var i,o,s,d,l,c,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(i=o=0;i<h.length&&!l;)if(l=h[i++].exec(e))for(s=0;s<p.length;s++)c=l[++o],typeof(d=p[s])===a&&d.length>0?2===d.length?typeof d[1]==r?this[d[0]]=d[1].call(this,c):this[d[0]]=d[1]:3===d.length?typeof d[1]!==r||d[1].exec&&d[1].test?this[d[0]]=c?c.replace(d[1],d[2]):n:this[d[0]]=c?d[1].call(this,c,d[2]):n:4===d.length&&(this[d[0]]=c?d[3].call(this,c.replace(d[1],d[2])):n):this[d]=c||n;u+=2}},H=function(e,t){for(var i in t)if(typeof t[i]===a&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(V(t[i][r],e))return"?"===i?n:i}else if(V(t[i],e))return"?"===i?n:i;return e},G={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},W={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,h],[/opios[\/ ]+([\w\.]+)/i],[h,[l,$+" Mini"]],[/\bopr\/([\w\.]+)/i],[h,[l,$]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,h],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[l,"UC"+E]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[h,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[h,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[h,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+E],h],[/\bfocus\/([\w\.]+)/i],[h,[l,k+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[l,$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[l,$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[l,"MIUI "+E]],[/fxios\/([-\w\.]+)/i],[h,[l,k]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+E]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+E],h],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,h],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,N],h],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[l,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,T+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[l,"Android "+E]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[h,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[l,k+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,h],[/(cobalt)\/([\w\.]+)/i],[l,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,U]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",U]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,U]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[u,D],[c,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[u,D],[c,f]],[/\((ip(?:hone|od)[\w ]*);/i],[d,[u,y],[c,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[u,y],[c,g]],[/(macintosh);/i],[d,[u,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[u,R],[c,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[u,R],[c,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[u,F],[c,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[u,F],[c,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[u,"OPPO"],[c,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[u,"Vivo"],[c,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[u,"Realme"],[c,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[u,I],[c,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[u,I],[c,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[u,A],[c,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[u,A],[c,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[u,"Lenovo"],[c,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[u,"Nokia"],[c,f]],[/(pixel c)\b/i],[d,[u,M],[c,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[u,M],[c,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[u,O],[c,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[u,O],[c,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[u,"OnePlus"],[c,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[u,_],[c,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[u,_],[c,f]],[/(playbook);[-\w\),; ]+(rim)/i],[d,u,[c,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[u,w],[c,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[u,C],[c,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[u,C],[c,f]],[/(nexus 9)/i],[d,[u,"HTC"],[c,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[d,/_/g," "],[c,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[u,"Acer"],[c,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[u,"Meizu"],[c,f]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[u,x],[c,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,d,[c,f]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,d,[c,g]],[/(surface duo)/i],[d,[u,P],[c,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[u,"Fairphone"],[c,f]],[/(u304aa)/i],[d,[u,"AT&T"],[c,f]],[/\bsie-(\w*)/i],[d,[u,"Siemens"],[c,f]],[/\b(rct\w+) b/i],[d,[u,"RCA"],[c,g]],[/\b(venue[\d ]{2,7}) b/i],[d,[u,"Dell"],[c,g]],[/\b(q(?:mv|ta)\w+) b/i],[d,[u,"Verizon"],[c,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[u,"Barnes & Noble"],[c,g]],[/\b(tm\d{3}\w+) b/i],[d,[u,"NuVision"],[c,g]],[/\b(k88) b/i],[d,[u,"ZTE"],[c,g]],[/\b(nx\d{3}j) b/i],[d,[u,"ZTE"],[c,f]],[/\b(gen\d{3}) b.+49h/i],[d,[u,"Swiss"],[c,f]],[/\b(zur\d{3}) b/i],[d,[u,"Swiss"],[c,g]],[/\b((zeki)?tb.*\b) b/i],[d,[u,"Zeki"],[c,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],d,[c,g]],[/\b(ns-?\w{0,9}) b/i],[d,[u,"Insignia"],[c,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[u,"NextBook"],[c,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],d,[c,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],d,[c,f]],[/\b(ph-1) /i],[d,[u,"Essential"],[c,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[u,"Envizen"],[c,g]],[/\b(trio[-\w\. ]+) b/i],[d,[u,"MachSpeed"],[c,g]],[/\btu_(1491) b/i],[d,[u,"Rotor"],[c,g]],[/(shield[\w ]+) b/i],[d,[u,"Nvidia"],[c,g]],[/(sprint) (\w+)/i],[u,d,[c,f]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[u,P],[c,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[u,B],[c,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[u,B],[c,f]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,d,[c,m]],[/droid.+; (shield) bui/i],[d,[u,"Nvidia"],[c,m]],[/(playstation [345portablevi]+)/i],[d,[u,O],[c,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[u,P],[c,m]],[/smart-tv.+(samsung)/i],[u,[c,S]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[u,D],[c,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,A],[c,S]],[/(apple) ?tv/i],[u,[d,y+" TV"],[c,S]],[/crkey/i],[[d,T+"cast"],[u,M],[c,S]],[/droid.+aft(\w)( bui|\))/i],[d,[u,_],[c,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[u,x],[c,S]],[/(bravia[\w ]+)( bui|\))/i],[d,[u,O],[c,S]],[/(mitv-\w{5}) bui/i],[d,[u,F],[c,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[u,j],[d,j],[c,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,S]],[/((pebble))app/i],[u,d,[c,v]],[/droid.+; (glass) \d/i],[d,[u,M],[c,v]],[/droid.+; (wt63?0{2,3})\)/i],[d,[u,B],[c,v]],[/(quest( 2)?)/i],[d,[u,N],[c,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[c,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[c,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[c,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[c,f]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[l,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,h],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[h,H,G]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[h,H,G]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,"Mac OS"],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,h],[/\(bb(10);/i],[h,[l,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[l,k+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[l,"webOS"]],[/crkey\/([\d\.]+)/i],[h,[l,T+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[l,"Chromium OS"],h],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,h],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[l,h]]},q=function(e,t){if(typeof e===a&&(t=e,e=n),!(this instanceof q))return new q(e,t).getResult();var r=e||(typeof i!==o&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),m=t?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(W,t):W;return this.getBrowser=function(){var e={};return e[l]=n,e[h]=n,z.call(e,r,m.browser),e.major=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:n}(e.version),e},this.getCPU=function(){var e={};return e[p]=n,z.call(e,r,m.cpu),e},this.getDevice=function(){var e={};return e[u]=n,e[d]=n,e[c]=n,z.call(e,r,m.device),e},this.getEngine=function(){var e={};return e[l]=n,e[h]=n,z.call(e,r,m.engine),e},this.getOS=function(){var e={};return e[l]=n,e[h]=n,z.call(e,r,m.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===s&&e.length>350?j(e,350):e,this},this.setUA(r),this};q.VERSION="1.0.33",q.BROWSER=L([l,h,"major"]),q.CPU=L([p]),q.DEVICE=L([d,u,c,m,f,S,g,v,b]),q.ENGINE=q.OS=L([l,h]),e.exports&&(t=e.exports=q),t.UAParser=q;var K=typeof i!==o&&(i.jQuery||i.Zepto);if(K&&!K.ua){var J=new q;K.ua=J.getResult(),K.ua.get=function(){return J.getUA()},K.ua.set=function(e){J.setUA(e);var t=J.getResult();for(var i in t)K.ua[i]=t[i]}}}("object"==typeof window?window:commonjsGlobal)}(uaParser,uaParserExports);var __awaiter$14=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(DefaultBrowserBehavior$1,"__esModule",{value:!0});const detect_browser_1=require$$0$3,ua_parser_js_1$2=uaParserExports;class DefaultBrowserBehavior{constructor(){this.FALLBACK_BROWSER={type:"browser",name:"unknown",version:"unknown",os:"unknown"},this.browser=detect_browser_1.detect()||this.FALLBACK_BROWSER,this.uaParserResult=navigator&&navigator.userAgent?new ua_parser_js_1$2.UAParser(navigator.userAgent).getResult():null,this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview","edge-ios"]}version(){return this.browser.version}majorVersion(){return null!==this.version()?parseInt(this.version().split(".")[0]):-1}osMajorVersion(){return parseInt(this.uaParserResult.os.version.split(".")[0])}engine(){return this.uaParserResult.engine.name}engineMajorVersion(){return parseInt(this.uaParserResult.engine.version.split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(const e of this.chromeLike)if(e===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(const e of this.webkitBrowsers)if(e===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}requiresPlaybackLatencyHintForAudioContext(){return-1!==navigator.userAgent.indexOf("Windows")}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()&&!this.isIOSEdge()||this.isIOSSafari()&&this.majorVersion()>=DefaultBrowserBehavior.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK||this.majorVersion()>=DefaultBrowserBehavior.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK}supportsBackgroundFilter(){return("safari"!==this.name()||15!==this.majorVersion())&&!!this.supportsCanvasCapturedStreamPlayback()}supportsVideoLayersAllocationRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsDependencyDescriptorRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsScalableVideoCoding(){return this.hasChromiumWebRTC()&&"Blink"===this.engine()&&this.engineMajorVersion()>=111}requiresResolutionAlignment(e,t){return this.isAndroid()&&this.isPixel3()?[64*Math.ceil(e/64),64*Math.ceil(t/64)]:[e,t]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return"chromium-webview"===this.browser.name}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name])&&("firefox"!==this.browser.name||!this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;const e=[];for(const t in this.browserSupport)e.push(`${this.browserName[t]} ${this.browserSupport[t]}+`);return e.join(", ")}supportedVideoCodecs(){return __awaiter$14(this,void 0,void 0,(function*(){const e=new RTCPeerConnection;return e.addTransceiver("video",{direction:"inactive",streams:[]}),(yield e.createOffer({offerToReceiveVideo:!0})).sdp.split("\r\n").filter((e=>e.includes("a=rtpmap:"))).map((e=>e.replace(/.* /,"").replace(/\/.*/,""))).filter(((e,t,i)=>i.indexOf(e)===t)).filter((e=>"rtx"!==e&&"red"!==e&&"ulpfec"!==e))}))}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return(this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox())&&("15.1.0"===this.version()||/( OS 15_1)/i.test(navigator.userAgent))}requiresVideoPlayWorkaround(){return this.isSafari()}isVideoFxSupportedBrowser(){return this.supportsBackgroundFilter()}isIOSSafari(){return"ios"===this.browser.name||"ios-webview"===this.browser.name||"safari"===this.browser.name&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isSafari(){return"safari"===this.browser.name||this.isIOSSafari()}isFirefox(){return"firefox"===this.browser.name}isIOSFirefox(){return"fxios"===this.browser.name}isIOSChrome(){return"crios"===this.browser.name}isChrome(){return"chrome"===this.browser.name}isEdge(){return"edge-chromium"===this.browser.name}isIOSEdge(){return"edge-ios"===this.browser.name}isSamsungInternet(){return"samsung"===this.browser.name}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}}DefaultBrowserBehavior$1.default=DefaultBrowserBehavior,DefaultBrowserBehavior.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK=16,DefaultBrowserBehavior.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK=106;var __importDefault$1G=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(AudioProfile$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$c=__importDefault$1G(DefaultBrowserBehavior$1);class AudioProfile{constructor(e=null,t=!0){this.audioBitrateBps=e,this.enableAudioRedundancy=!(new DefaultBrowserBehavior_1$c.default).hasFirefoxWebRTC()&&t}static fullbandSpeechMono(e=!0){return new AudioProfile(4e4,e)}static fullbandMusicMono(e=!0){return new AudioProfile(64e3,e)}static fullbandMusicStereo(e=!0){return new AudioProfile(128e3,e)}isStereo(){return 128e3===this.audioBitrateBps}hasRedundancyEnabled(){return this.enableAudioRedundancy}}AudioProfile$1.default=AudioProfile;var AudioVideoControllerState={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=void 0,e.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=25;e.default=class{constructor(){this.logger=null,this.browserBehavior=null,this.meetingSessionConfiguration=null,this.signalingClient=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.activeAudioInput=void 0,this.activeVideoInput=void 0,this.audioMixController=null,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptionLimit=e.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videoSendCodecPreferences=[],this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.enableSVC=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null}resetConnectionSpecificState(){this.peer&&this.peer.close(),this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,void 0!==this.transceiverController&&this.transceiverController.reset(),this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.videoDownlinkBandwidthPolicy.reset(),this.videoUplinkBandwidthPolicy.reset&&this.videoUplinkBandwidthPolicy.reset(),this.lastVideosToReceive=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptions=null,this.videoSubscriptionLimit=e.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.videoDuplexMode=null}}}(AudioVideoControllerState);var BackgroundBlurStrength={};Object.defineProperty(BackgroundBlurStrength,"__esModule",{value:!0}),BackgroundBlurStrength.BlurStrengthMapper=void 0;const BlurStrength={LOW:7,MEDIUM:15,HIGH:30};class BlurStrengthMapper{static getBlurAmount(e,t){if(e<=0)throw new Error(`invalid value for blur strength: ${e}`);return Math.round(e*t.height/this.BLUR_STRENGTH_DIVISOR)}}BackgroundBlurStrength.BlurStrengthMapper=BlurStrengthMapper,BlurStrengthMapper.BLUR_STRENGTH_DIVISOR=540,BackgroundBlurStrength.default=BlurStrength;var BackgroundBlurVideoFrameProcessor$1={},BackgroundFilterVideoFrameProcessor$1={},loader={},fetch$1={};function fetchWithBehavior(e,t,i){if(!i)return fetch(e,t);const n=withQueryString(e,i),r=withRequestHeaders(t,i);return fetch(n,r)}function withRequestHeaders(e,t){return(null==t?void 0:t.headers)?e?Object.assign(Object.assign({},e),{headers:Object.assign(Object.assign({},e.headers||{}),t.headers)}):{headers:t.headers}:e}function withQueryString(e,t){if(!(null==t?void 0:t.escapedQueryString))return e;const i=-1!==e.lastIndexOf("?");return`${e}${i?"&":"?"}${t.escapedQueryString}`}function addQueryParams(e,t){const i=Object.keys(t);if(!i.length)return e;const n=new URLSearchParams(null==e?void 0:e.escapedQueryString);for(const e of i)n.append(e,t[e]);return Object.assign(Object.assign({},e),{escapedQueryString:n.toString()})}Object.defineProperty(fetch$1,"__esModule",{value:!0}),fetch$1.isValidRevisionID=fetch$1.isValidAssetGroup=fetch$1.resolveURL=fetch$1.addQueryParams=fetch$1.withQueryString=fetch$1.withRequestHeaders=fetch$1.fetchWithBehavior=void 0,fetch$1.fetchWithBehavior=fetchWithBehavior,fetch$1.withRequestHeaders=withRequestHeaders,fetch$1.withQueryString=withQueryString,fetch$1.addQueryParams=addQueryParams;const HEAD_OPTIONS={method:"HEAD",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"origin"};function resolveURL(e,t){return fetchWithBehavior(e,HEAD_OPTIONS,t).then((t=>t.redirected?t.url:e))}function isValidAssetGroup(e){return!!e&&/^[-.a-zA-Z0-9]+$/.test(e)}function isValidRevisionID(e){return!!e&&/^[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{22}$/.test(e)}fetch$1.resolveURL=resolveURL,fetch$1.isValidAssetGroup=isValidAssetGroup,fetch$1.isValidRevisionID=isValidRevisionID,Object.defineProperty(loader,"__esModule",{value:!0}),loader.loadWorker=void 0;const fetch_js_1$1=fetch$1,WORKER_FETCH_OPTIONS={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"},loadWorker=(e,t,i,n)=>{null==n||n.debug(`Loading ${t} worker from ${e}.`);let r=!1;try{r=self.origin===new URL(e).origin}catch(e){null==n||n.error("Could not compare origins.",e)}if(r){const n=fetch_js_1$1.withQueryString(e,i);return Promise.resolve(new Worker(n,{name:t}))}return fetch_js_1$1.fetchWithBehavior(e,WORKER_FETCH_OPTIONS,i).then((e=>{if(e.ok)return e.blob().then((e=>new Worker(window.URL.createObjectURL(e))));throw new Error("Fetch failed.")}))};loader.loadWorker=loadWorker;var support={};!function(e){var t=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.isOldChrome=e.supportsWASMStreaming=e.supportsSharedArrayBuffer=e.supportsWASM=e.supportsAudioWorklet=e.supportsWorker=e.supportsVoiceFocusWorker=e.supportsWASMPostMessage=e.isSafari=void 0;const i=loader;e.isSafari=(e=globalThis)=>{const t=e.navigator.userAgent,i=t.match(/Safari\//),n=t.match(/Chrom(?:e|ium)\//);return!(!i||n)};e.supportsWASMPostMessage=(t=globalThis)=>{if(e.isSafari(t))return!1;if(((e=globalThis)=>!!e.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/))(t)){return(n(t)||0)<95}return!0};e.supportsVoiceFocusWorker=(n=globalThis,r,o)=>t(void 0,void 0,void 0,(function*(){if(!e.supportsWorker(n,o))return!1;const t=`${r.paths.workers}worker-v1.js`;try{const e=yield i.loadWorker(t,"VoiceFocusTestWorker",r,o);try{e.terminate()}catch(e){null==o||o.debug("Failed to terminate worker.",e)}return!0}catch(e){return null==o||o.info("Failed to fetch and instantiate test worker",e),!1}}));e.supportsWorker=(e=globalThis,t)=>{try{return!!e.Worker}catch(e){return null==t||t.info("Does not support Worker",e),!1}};e.supportsAudioWorklet=(e=globalThis,t)=>{try{return!!e.AudioWorklet&&!!e.AudioWorkletNode}catch(e){return null==t||t.info("Does not support Audio Worklet",e),!1}};e.supportsWASM=(e=globalThis,t)=>{try{return!(!e.WebAssembly||!e.WebAssembly.compile&&!e.WebAssembly.compileStreaming)}catch(e){return null==t||t.info("Does not support WASM",e),!1}};e.supportsSharedArrayBuffer=(e=globalThis,t=globalThis,i)=>{try{return!(!e.SharedArrayBuffer||!t.chrome&&!e.crossOriginIsolated)}catch(e){return null==i||i.info("Does not support SharedArrayBuffer."),!1}};e.supportsWASMStreaming=(e=globalThis,t)=>{var i;try{return!!(null===(i=e.WebAssembly)||void 0===i?void 0:i.compileStreaming)}catch(e){return null==t||t.info("Does not support WASM streaming compilation",e),!1}};const n=(e=globalThis)=>{try{if(!e.chrome)return}catch(e){}const t=e.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/);if(t)return parseInt(t[1],10)};e.isOldChrome=(e=globalThis,t)=>{const i=n(e);return!!i&&(i<90&&(null==t||t.debug(`Chrome ${i} has incomplete SIMD support.`),!0))}}(support);var ModelSpecBuilder$1={};Object.defineProperty(ModelSpecBuilder$1,"__esModule",{value:!0});class ModelSpecBuilder{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new ModelSpecBuilder}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){return this.path="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite",this.input={height:144,width:256,range:[0,1],channels:3},this.output={height:144,width:256,range:[0,1],channels:1},this}withPath(e){return this.path=e,this}withInput(e){return this.input=e,this}withOutput(e){return this.output=e,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}}ModelSpecBuilder$1.default=ModelSpecBuilder;var Versioning$1={},version$2={};Object.defineProperty(version$2,"__esModule",{value:!0}),version$2.default={hash:"7b41b42",raw:"v3.19.0",semverString:"3.19.0"};var __importDefault$1F=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Versioning$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$b=__importDefault$1F(DefaultBrowserBehavior$1),version_1=__importDefault$1F(version$2);class Versioning{static get sdkName(){return"amazon-chime-sdk-js"}static get sdkVersion(){return version_1.default.semverString}static get sdkVersionSemVer(){var e,t,i,n;const r=version_1.default.semverString.match(/^(?<major>[0-9]+)\.(?<minor>[0-9]+)((?:\.(?<patch>[0-9]+))(?:-(?<preRelease>[a-zA-Z]+(\.[0-9])*))?)?/);return{major:null===(e=null==r?void 0:r.groups)||void 0===e?void 0:e.major,minor:null===(t=null==r?void 0:r.groups)||void 0===t?void 0:t.minor,patch:null===(i=null==r?void 0:r.groups)||void 0===i?void 0:i.patch,preRelease:null===(n=null==r?void 0:r.groups)||void 0===n?void 0:n.preRelease}}static get buildSHA(){return version_1.default.hash.substr(1)}static get sdkUserAgentLowResolution(){const e=new DefaultBrowserBehavior_1$b.default;return`${e.name()}-${e.majorVersion()}`}static urlWithVersion(e){const t=new URL(e);return t.searchParams.append(Versioning.X_AMZN_VERSION,Versioning.sdkVersion),t.searchParams.append(Versioning.X_AMZN_USER_AGENT,Versioning.sdkUserAgentLowResolution),t.toString()}}Versioning$1.default=Versioning,Versioning.X_AMZN_VERSION="X-Amzn-Version",Versioning.X_AMZN_USER_AGENT="X-Amzn-User-Agent";var __awaiter$13=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1E=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundFilterVideoFrameProcessor$1,"__esModule",{value:!0});const loader_1$2=loader,support_1$1=support,ModelSpecBuilder_1=__importDefault$1E(ModelSpecBuilder$1),DefaultBrowserBehavior_1$a=__importDefault$1E(DefaultBrowserBehavior$1),Versioning_1$9=__importDefault$1E(Versioning$1),CREATE_DEFAULT_MODEL_SPEC=()=>ModelSpecBuilder_1.default.builder().withSelfieSegmentationDefaults().build(),DEFAULT_CDN$1="https://static.sdkassets.chime.aws",DEFAULT_PATHS$1={worker:`${DEFAULT_CDN$1}/bgblur/workers/worker.js`,wasm:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm-simd.wasm`};class BackgroundFilterVideoFrameProcessor{static defaultAssetSpec(){const e=Versioning_1$9.default.sdkVersionSemVer;return{assetGroup:`sdk-${e.major}.${e.minor}`}}static createUrlWithParams(e,t){const i=new URL(e),n=Object.keys(t);for(const e of n)void 0!==t[e]&&i.searchParams.set(e,t[e]);return i.toString()}static resolveSpec(e){const{paths:t=DEFAULT_PATHS$1,model:i=CREATE_DEFAULT_MODEL_SPEC(),assetGroup:n=this.defaultAssetSpec().assetGroup,revisionID:r=this.defaultAssetSpec().revisionID}=e||{},o={assetGroup:n,revisionID:r,sdk:encodeURIComponent(Versioning_1$9.default.sdkVersion),ua:encodeURIComponent(Versioning_1$9.default.sdkUserAgentLowResolution)};return t.worker=this.createUrlWithParams(t.worker,o),t.wasm=this.createUrlWithParams(t.wasm,o),t.simd=this.createUrlWithParams(t.simd,o),i.path=this.createUrlWithParams(i.path,o),{paths:t,model:i,assetGroup:n,revisionID:r}}static resolveOptions(e){e.reportingPeriodMillis||(e.reportingPeriodMillis=1e3);return e.filterCPUUtilization?(e.filterCPUUtilization<0||e.filterCPUUtilization>100)&&(e.logger.warn("filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of 30 percent"),e.filterCPUUtilization=30):e.filterCPUUtilization=30,e}static isSupported(e,t){const{logger:i}=t;if("undefined"==typeof globalThis)return i.info("Browser does not have globalThis."),Promise.resolve(!1);return(new DefaultBrowserBehavior_1$a.default).supportsBackgroundFilter()?support_1$1.supportsWASM(globalThis,i)?this.supportsBackgroundFilter(globalThis,e,i):(i.info("Browser does not support WASM."),Promise.resolve(!1)):(i.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter(e=globalThis,t,i){return __awaiter$13(this,void 0,void 0,(function*(){if(!support_1$1.supportsWorker(e,i))return i.info("Browser does not support web workers."),!1;const n=t.paths.worker;try{const e=yield loader_1$2.loadWorker(n,"BackgroundFilterWorker",{},null);try{e.terminate()}catch(e){i.info(`Failed to terminate worker. ${e.message}`)}return!0}catch(e){return i.info(`Failed to fetch and instantiate test worker ${e.message}`),!1}}))}}BackgroundFilterVideoFrameProcessor$1.default=BackgroundFilterVideoFrameProcessor;var ConsoleLogger$1={},__importDefault$1D=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ConsoleLogger$1,"__esModule",{value:!0});const LogLevel_1$7=__importDefault$1D(LogLevel);class ConsoleLogger{constructor(e,t=LogLevel_1$7.default.WARN){this.name=e,this.level=t}info(e){this.log(LogLevel_1$7.default.INFO,e)}warn(e){this.log(LogLevel_1$7.default.WARN,e)}error(e){this.log(LogLevel_1$7.default.ERROR,e)}debug(e){LogLevel_1$7.default.DEBUG<this.level||("string"==typeof e?this.log(LogLevel_1$7.default.DEBUG,e):e?this.log(LogLevel_1$7.default.DEBUG,e()):this.log(LogLevel_1$7.default.DEBUG,""+e))}setLogLevel(e){this.level=e}getLogLevel(){return this.level}log(e,t){if(e<this.level)return;const i=`${(new Date).toISOString()} [${LogLevel_1$7.default[e]}] ${this.name} - ${t}`;switch(e){case LogLevel_1$7.default.ERROR:console.error(i);break;case LogLevel_1$7.default.WARN:console.warn(i);break;case LogLevel_1$7.default.DEBUG:console.debug(i.replace(/\\r\\n/g,"\n"));break;case LogLevel_1$7.default.INFO:console.info(i)}}}ConsoleLogger$1.default=ConsoleLogger;var NoOpVideoFrameProcessor$1={},__awaiter$12=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(NoOpVideoFrameProcessor$1,"__esModule",{value:!0});class NoOpVideoFrameProcessor{process(e){return __awaiter$12(this,void 0,void 0,(function*(){return e}))}destroy(){return __awaiter$12(this,void 0,void 0,(function*(){}))}}NoOpVideoFrameProcessor$1.default=NoOpVideoFrameProcessor;var BackgroundBlurProcessorBuiltIn$1={},BackgroundBlurProcessorProvided$1={},BackgroundFilterProcessor$1={},CanvasVideoFrameBuffer$1={},__awaiter$11=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(CanvasVideoFrameBuffer$1,"__esModule",{value:!0});class CanvasVideoFrameBuffer{constructor(e){this.canvas=e,this.destroyed=!1}destroy(){this.canvas=null,this.destroyed=!0}asCanvasImageSource(){return __awaiter$11(this,void 0,void 0,(function*(){return this.destroyed?Promise.reject("canvas buffer is destroyed"):Promise.resolve(this.canvas)}))}asCanvasElement(){return this.canvas}}CanvasVideoFrameBuffer$1.default=CanvasVideoFrameBuffer;var BackgroundFilterFrameCounter$1={};Object.defineProperty(BackgroundFilterFrameCounter$1,"__esModule",{value:!0});const FILTER_DURATION_FACTOR=.8;class BackgroundFilterFrameCounter{constructor(e,t,i,n){this.delegate=e,this.reportingPeriodMillis=t,this.filterCPUUtilization=i,this.logger=n,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent(e){const t=e-this.lastReportedEventTimestamp;if(t>=this.reportingPeriodMillis){const i=this.filterCount,n=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=e,0===this.framerate||0===i)return;const r=Math.round(n/i),o=Math.round(this.framerate*(t/1e3))-i,a=Math.round(100*n/t);r>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:o,avgFilterDurationMillis:r,framerate:this.framerate,periodMillis:t}),a>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:a,filterMillis:n,periodMillis:t})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*FILTER_DURATION_FACTOR)}frameReceived(e){e!==this.framerate&&(this.framerate=e,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());const t=Date.now();this.reportEvent(t)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}}BackgroundFilterFrameCounter$1.default=BackgroundFilterFrameCounter;var __awaiter$10=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1C=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundFilterProcessor$1,"__esModule",{value:!0}),BackgroundFilterProcessor$1.BackgroundFilterMonitor=void 0;const loader_1$1=loader,CanvasVideoFrameBuffer_1$2=__importDefault$1C(CanvasVideoFrameBuffer$1),BackgroundFilterFrameCounter_1=__importDefault$1C(BackgroundFilterFrameCounter$1);class DeferredObservable{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise((e=>this.resolve=e))),this.promise}next(e){this.value=e,this.resolve(e),delete this.promise}}class BackgroundFilterProcessor{constructor(e,t,i,n,r){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new CanvasVideoFrameBuffer_1$2.default(this.targetCanvas),this.mask$=new DeferredObservable,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=BackgroundFilterProcessor.createWorkerPromise(),this.loadModelPromise=BackgroundFilterProcessor.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=e,this.validateSpec(t),this.validateOptions(i),this.spec=t,this.logger=i.logger,this.delegate=n,this.initCPUMonitor(i),this.eventController=r}static createWorkerPromise(){const e={resolve:null,reject:null,promise:null};return e.promise=new Promise(((t,i)=>{e.resolve=t,e.reject=i})),e}validateSpec(e){if(!e)throw new Error("processor has null spec");if(!e.model)throw new Error("processor spec has null model");if(!e.paths)throw new Error("processor spec has null paths")}validateOptions(e){if(!e)throw new Error("processor has null options");if(!e.logger)throw new Error("processor has null options - logger");if(!e.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!e.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor(e){this.videoFramesPerFilterUpdate=1,this.frameCounter=new BackgroundFilterFrameCounter_1.default(this.delegate,e.reportingPeriodMillis,e.filterCPUUtilization,this.logger),this.cpuMonitor=new BackgroundFilterMonitor(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify(e){return JSON.stringify(e,null,2)}handleInitialize(e){if(this.logger.info(`received initialize message: ${this.stringify(e)}`),!e.payload)return this.logger.error("failed to initialize module"),void this.initWorkerPromise.reject(new Error("failed to initialize the module"));const t=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:t.path,inputHeight:t.input.height,inputWidth:t.input.width,inputChannels:4,modelRangeMin:t.input.range[0],modelRangeMax:t.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel(e){if(this.logger.info(`received load model message: ${this.stringify(e)}`),2!==e.payload)return this.logger.error("failed to load model! status: "+e.payload),void this.loadModelPromise.reject(new Error("failed to load model! status: "+e.payload));this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict(e){this.mask$.next(e.payload.output)}handleWorkerEvent(e){const t=e.data;switch(t.msg){case"initialize":this.handleInitialize(t);break;case"loadModel":this.handleLoadModel(t);break;case"predict":this.handlePredict(t);break;default:this.logger.info(`unexpected event msg: ${this.stringify(t)}`)}}loadAssets(){return __awaiter$10(this,void 0,void 0,(function*(){this.logger.info("start initializing the processor");try{this.worker=yield loader_1$1.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",(e=>this.handleWorkerEvent(e))),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch(e){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${e.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)}))}process(e){return __awaiter$10(this,void 0,void 0,(function*(){if(this.destroyed)return e;this.frameCounter.frameReceived(e[0].framerate),this.cpuMonitor.frameReceived();const t=e[0].asCanvasElement();if(!t)return e;if(!this.modelInitialized)return e[0]=this.canvasVideoFrameBuffer,e;const i=t.width,n=t.height;if(0===i||0===n)return e;0===this.sourceWidth&&(this.sourceWidth=i,this.sourceHeight=n,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),this.sourceWidth===i&&this.sourceHeight===n||(this.sourceWidth=i,this.sourceHeight=n,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let e=this.mask$.value;const i=this.spec.model.input.width/t.width,n=this.spec.model.input.height/t.height;void 0===this.scaledCanvas&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);const r=this.scaledCanvas.getContext("2d");r.save(),r.scale(i,n),r.drawImage(t,0,0),r.restore();const o=r.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate==0){const t=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:o},[o.data.buffer]),e=yield t}this.destroyed||this.drawImageWithMask(t,e)}catch(t){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${t}`),e}finally{this.frameCounter.filterComplete(),this.frameNumber++}return e[0]=this.canvasVideoFrameBuffer,e}))}updateVideoFramesPerFilterUpdate(e){e!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=e,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var e,t,i,n;return __awaiter$10(this,void 0,void 0,(function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),null===(e=this.worker)||void 0===e||e.postMessage({msg:"destroy"}),null===(t=this.worker)||void 0===t||t.postMessage({msg:"stop"}),null===(i=this.targetCanvas)||void 0===i||i.remove(),this.targetCanvas=void 0,null===(n=this.scaledCanvas)||void 0===n||n.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)}))}}BackgroundFilterProcessor$1.default=BackgroundFilterProcessor;class BackgroundFilterMonitor{constructor(e,t){this.monitoringPeriodMillis=e,this.observer=t,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){const e=Date.now();e-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=e,this.observer.reduceCPUUtilization())}frameReceived(){const e=Date.now();e-this.lastCPUChangeTimestamp>=2*this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=e,this.observer.increaseCPUUtilization())}}BackgroundFilterProcessor$1.BackgroundFilterMonitor=BackgroundFilterMonitor;var BackgroundBlurVideoFrameProcessorDelegate$1={},BackgroundFilterVideoFrameProcessorDelegate$1={};Object.defineProperty(BackgroundFilterVideoFrameProcessorDelegate$1,"__esModule",{value:!0});class BackgroundFilterVideoFrameProcessorDelegate{constructor(){this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}filterFrameDurationHigh(e){var t;for(const i of this.observers)null===(t=i.filterFrameDurationHigh)||void 0===t||t.call(i,e)}filterCPUUtilizationHigh(e){var t;for(const i of this.observers)null===(t=i.filterCPUUtilizationHigh)||void 0===t||t.call(i,e)}}BackgroundFilterVideoFrameProcessorDelegate$1.default=BackgroundFilterVideoFrameProcessorDelegate;var __importDefault$1B=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundBlurVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1$1=__importDefault$1B(BackgroundFilterVideoFrameProcessorDelegate$1);class BackgroundBlurVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1$1.default{}BackgroundBlurVideoFrameProcessorDelegate$1.default=BackgroundBlurVideoFrameProcessorDelegate;var __awaiter$$=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1A=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundBlurProcessorProvided$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1$1=__importDefault$1A(BackgroundFilterProcessor$1),BackgroundBlurStrength_1$2=BackgroundBlurStrength,BackgroundBlurVideoFrameProcessorDelegate_1=__importDefault$1A(BackgroundBlurVideoFrameProcessorDelegate$1);class BackgroundBlurProcessorProvided extends BackgroundFilterProcessor_1$1.default{constructor(e,t){super("background blur",e,t,new BackgroundBlurVideoFrameProcessorDelegate_1.default),this.blurAmount=0,this.setBlurStrength(t.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: ${this.stringify(t)}`)}validateOptions(e){if(super.validateOptions(e),!e.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask(e,t){t||(t=new ImageData(this.spec.model.input.width,this.spec.model.input.height));this.scaledCanvas.getContext("2d").putImageData(t,0,0);const{canvasCtx:i,targetCanvas:n}=this,{width:r,height:o}=n;i.save(),i.clearRect(0,0,r,o),i.drawImage(this.scaledCanvas,0,0,r,o),i.globalCompositeOperation="source-in",i.drawImage(e,0,0,r,o),i.globalCompositeOperation="destination-over",i.filter=`blur(${this.blurAmount}px)`,i.drawImage(e,0,0,n.width,n.height),i.restore()}setBlurStrength(e){this._blurStrength=e,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$2.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver(e){this.delegate.addObserver(e)}removeObserver(e){this.delegate.removeObserver(e)}static isSupported(){return __awaiter$$(this,void 0,void 0,(function*(){const e=document.createElement("canvas"),t=void 0!==e.getContext("2d").filter;return e.remove(),t}))}setEventController(e){this.eventController?this.eventController=e:(this.eventController=e,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){const e={backgroundBlurEnabled:"true",backgroundBlurStrength:this._blurStrength,backgroundReplacementEnabled:"false",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",e)}}BackgroundBlurProcessorProvided$1.default=BackgroundBlurProcessorProvided;var __awaiter$_=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1z=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundBlurProcessorBuiltIn$1,"__esModule",{value:!0});const BackgroundBlurProcessorProvided_1$1=__importDefault$1z(BackgroundBlurProcessorProvided$1),BackgroundBlurStrength_1$1=BackgroundBlurStrength;class BackgroundBlurProcessorBuiltIn extends BackgroundBlurProcessorProvided_1$1.default{constructor(e,t){super(e,t),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask(e,t){const i=this.blurredImage,{canvasCtx:n,targetCanvas:r}=this,{width:o,height:a}=r;if(!t||!i)return void n.clearRect(0,0,o,a);this.scaledCanvas.getContext("2d").putImageData(t,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),n.save(),n.clearRect(0,0,o,a),n.drawImage(this.scaledCanvas,0,0,o,a),n.globalCompositeOperation="source-in",n.drawImage(e,0,0,o,a),n.globalCompositeOperation="destination-over",n.drawImage(this.blurCanvas,0,0,o,a),n.restore()}setBlurStrength(e){if(super.setBlurStrength(e),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});const e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$1.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize(e){if(this.logger.info(`received initialize message: ${this.stringify(e)}`),!e.payload)return this.logger.error("failed to initialize module"),void this.initWorkerPromise.reject(new Error("failed to initialize the module"));const t=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:t.path,inputHeight:t.input.height,inputWidth:t.input.width,inputChannels:4,modelRangeMin:t.input.range[0],modelRangeMax:t.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict(e){this.blurredImage=e.payload.blurOutput,super.handlePredict(e)}destroy(){const e=Object.create(null,{destroy:{get:()=>super.destroy}});var t;return __awaiter$_(this,void 0,void 0,(function*(){e.destroy.call(this),null===(t=this.blurCanvas)||void 0===t||t.remove(),this.blurCanvas=void 0}))}}BackgroundBlurProcessorBuiltIn$1.default=BackgroundBlurProcessorBuiltIn;var __awaiter$Z=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1y=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundBlurVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1$1=__importDefault$1y(BackgroundFilterVideoFrameProcessor$1),ConsoleLogger_1$1=__importDefault$1y(ConsoleLogger$1),LogLevel_1$6=__importDefault$1y(LogLevel),NoOpVideoFrameProcessor_1$1=__importDefault$1y(NoOpVideoFrameProcessor$1),BackgroundBlurProcessorBuiltIn_1=__importDefault$1y(BackgroundBlurProcessorBuiltIn$1),BackgroundBlurProcessorProvided_1=__importDefault$1y(BackgroundBlurProcessorProvided$1),BackgroundBlurStrength_1=__importDefault$1y(BackgroundBlurStrength);class NoOpBackgroundBlurProcessor extends NoOpVideoFrameProcessor_1$1.default{setBlurStrength(){}loadAssets(){return __awaiter$Z(this,void 0,void 0,(function*(){}))}addObserver(){}removeObserver(){}}class BackgroundBlurVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1$1.default{static create(e,t){return __awaiter$Z(this,void 0,void 0,(function*(){e=BackgroundBlurVideoFrameProcessor.resolveSpec(e),t=BackgroundBlurVideoFrameProcessor.resolveOptions(t);const{logger:i}=t,n=yield BackgroundBlurVideoFrameProcessor.isSupported(e,t);if(i.info(`processor is ${n?"":"not"} supported`),!n)return i.warn("Using no-op processor because background blur is not supported"),new NoOpBackgroundBlurProcessor;let r;return(yield BackgroundBlurProcessorProvided_1.default.isSupported())?(i.info("Using browser-provided background blur"),r=new BackgroundBlurProcessorProvided_1.default(e,t)):(i.info("Using built-in background blur"),r=new BackgroundBlurProcessorBuiltIn_1.default(e,t)),yield r.loadAssets(),r}))}static resolveOptions(e={}){let t=Object.assign({},e);return t.blurStrength||(t.blurStrength=BackgroundBlurStrength_1.default.MEDIUM),t.logger||(t.logger=new ConsoleLogger_1$1.default("BackgroundBlurProcessor",LogLevel_1$6.default.INFO)),t=super.resolveOptions(t),t}static isSupported(e,t){return e=BackgroundBlurVideoFrameProcessor.resolveSpec(e),t=BackgroundBlurVideoFrameProcessor.resolveOptions(t),super.isSupported(e,t)}}BackgroundBlurVideoFrameProcessor$1.default=BackgroundBlurVideoFrameProcessor;var BackgroundReplacementVideoFrameProcessor$1={},BackgroundReplacementFilter$1={},BackgroundReplacementVideoFrameProcessorDelegate$1={},__importDefault$1x=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundReplacementVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1=__importDefault$1x(BackgroundFilterVideoFrameProcessorDelegate$1);class BackgroundReplacementVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1.default{}BackgroundReplacementVideoFrameProcessorDelegate$1.default=BackgroundReplacementVideoFrameProcessorDelegate;var __awaiter$Y=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1w=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundReplacementFilter$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1=__importDefault$1w(BackgroundFilterProcessor$1),BackgroundReplacementVideoFrameProcessorDelegate_1=__importDefault$1w(BackgroundReplacementVideoFrameProcessorDelegate$1);class BackgroundReplacementFilter extends BackgroundFilterProcessor_1.default{constructor(e,t){super("background replacement",e,t,new BackgroundReplacementVideoFrameProcessorDelegate_1.default),this.replacementBlob=t.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: ${this.stringify(t)}`)}setImageBlob(e){return __awaiter$Y(this,void 0,void 0,(function*(){this.replacementBlob=e,this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl())}))}initOnFirstExecution(){}drawImageWithMask(e,t){t||(t=new ImageData(this.spec.model.input.width,this.spec.model.input.height));this.scaledCanvas.getContext("2d").putImageData(t,0,0);const{canvasCtx:i,targetCanvas:n}=this,{width:r,height:o}=n;i.save(),i.clearRect(0,0,r,o),i.drawImage(this.scaledCanvas,0,0,r,o),i.globalCompositeOperation="source-in",i.drawImage(e,0,0,r,o),i.globalCompositeOperation="destination-over",i.drawImage(this.replacementImage,0,0,n.width,n.height),i.restore()}static loadImageExecutor(e,t,i){const n=new Image;n.crossOrigin="Anonymous",n.addEventListener("load",(()=>{e(n)}),!1),n.addEventListener("error",(e=>{t(new Error(`Could not load replacement image ${n.src}: ${e.message}`))}),!1),n.src=i}static loadImage(e){return __awaiter$Y(this,void 0,void 0,(function*(){return new Promise(((t,i)=>this.loadImageExecutor(t,i,e)))}))}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){const e=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return __awaiter$Y(this,void 0,void 0,(function*(){this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl()),e.loadAssets.call(this)}))}addObserver(e){this.delegate.addObserver(e)}removeObserver(e){this.delegate.removeObserver(e)}destroy(){const e=Object.create(null,{destroy:{get:()=>super.destroy}});return __awaiter$Y(this,void 0,void 0,(function*(){e.destroy.call(this),this.revokeReplacementObjectUrl()}))}setEventController(e){this.eventController?this.eventController=e:(this.eventController=e,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){this.eventController.publishEvent("backgroundFilterConfigSelected",{backgroundBlurEnabled:"false",backgroundBlurStrength:"low",backgroundReplacementEnabled:"true",backgroundFilterVersion:1})}}BackgroundReplacementFilter$1.default=BackgroundReplacementFilter;var __awaiter$X=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1v=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BackgroundReplacementVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1=__importDefault$1v(BackgroundFilterVideoFrameProcessor$1),ConsoleLogger_1=__importDefault$1v(ConsoleLogger$1),LogLevel_1$5=__importDefault$1v(LogLevel),NoOpVideoFrameProcessor_1=__importDefault$1v(NoOpVideoFrameProcessor$1),BackgroundReplacementFilter_1=__importDefault$1v(BackgroundReplacementFilter$1);class NoOpBackgroundReplacementProcessor extends NoOpVideoFrameProcessor_1.default{loadAssets(){return __awaiter$X(this,void 0,void 0,(function*(){}))}addObserver(){}removeObserver(){}setImageBlob(){return __awaiter$X(this,void 0,void 0,(function*(){}))}}class BackgroundReplacementVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1.default{static create(e,t){return __awaiter$X(this,void 0,void 0,(function*(){e=this.resolveSpec(e),t=this.resolveOptions(t),yield this.resolveOptionsAsync(t);const{logger:i}=t;if(!(yield BackgroundReplacementVideoFrameProcessor.isSupported(e,t)))return i.warn("Using no-op processor because background replacement is not supported"),new NoOpBackgroundReplacementProcessor;i.info("Using background replacement filter");const n=new BackgroundReplacementFilter_1.default(e,t);return yield n.loadAssets(),n}))}static resolveOptions(e={}){const t=Object.assign({},e);return t.logger||(t.logger=new ConsoleLogger_1.default("BackgroundReplacementProcessor",LogLevel_1$5.default.INFO)),super.resolveOptions(t)}static resolveOptionsAsync(e){return __awaiter$X(this,void 0,void 0,(function*(){if(!e.imageBlob){const t=document.createElement("canvas");t.width=100,t.height=100;const i=t.getContext("2d");i.fillStyle="blue",i.fillRect(0,0,100,100);const n=yield new Promise((e=>{t.toBlob(e)}));e.imageBlob=n}}))}static isSupported(e,t){const i=Object.create(null,{isSupported:{get:()=>super.isSupported}});return __awaiter$X(this,void 0,void 0,(function*(){e=this.resolveSpec(e),t=this.resolveOptions(t),yield this.resolveOptionsAsync(t);const n=t.imageBlob,r=URL.createObjectURL(n);try{yield BackgroundReplacementFilter_1.default.loadImage(r)}catch(e){return t.logger.info(`Failed to fetch load replacement image ${e.message}`),!1}finally{URL.revokeObjectURL(r)}return i.isSupported.call(this,e,t)}))}}BackgroundReplacementVideoFrameProcessor$1.default=BackgroundReplacementVideoFrameProcessor;var BaseConnectionHealthPolicy$1={};Object.defineProperty(BaseConnectionHealthPolicy$1,"__esModule",{value:!0});class BaseConnectionHealthPolicy{constructor(e,t,i){this.minHealth=e.minHealth,this.maxHealth=e.maxHealth,this.currentHealth=e.initialHealth,this.currentData=t.clone(),this.name=i}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update(e){this.currentData=e}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){const e=this.health();return e!==this.currentHealth?(this.currentHealth=e,e):null}}BaseConnectionHealthPolicy$1.default=BaseConnectionHealthPolicy;var BitrateParameters$1={};Object.defineProperty(BitrateParameters$1,"__esModule",{value:!0});class BitrateParameters{}BitrateParameters$1.default=BitrateParameters;var CSPMonitor$1={};Object.defineProperty(CSPMonitor$1,"__esModule",{value:!0});class CSPMonitor{static register(){"document"in commonjsGlobal&&document.addEventListener&&CSPMonitor.shouldRegisterCSPMonitor&&(CSPMonitor.added||(document.addEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.added=!0))}static unregister(){"document"in commonjsGlobal&&document.removeEventListener&&(document.removeEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.loggers=new Set,CSPMonitor.added=!1)}static disable(){CSPMonitor.shouldRegisterCSPMonitor=!1,CSPMonitor.unregister()}static addLogger(e){e&&CSPMonitor.loggers.add(e)}static removeLogger(e){e&&CSPMonitor.loggers.delete(e)}}CSPMonitor$1.default=CSPMonitor,CSPMonitor.loggers=new Set,CSPMonitor.shouldRegisterCSPMonitor=!0,CSPMonitor.added=!1,CSPMonitor.listener=e=>{const t=`Security Policy Violation\nBlocked URI: ${e.blockedURI}\nViolated Directive: ${e.violatedDirective}\nOriginal Policy: ${e.originalPolicy}\nDocument URI: ${e.documentURI}\nSource File: ${e.sourceFile}\nLine No.: ${e.lineNumber}\n`;for(const e of CSPMonitor.loggers)e.error(t);0===CSPMonitor.loggers.size&&console.error(t)};var CheckAudioConnectivityFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckAudioConnectivityFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.AudioInputRequestFailed=1]="AudioInputRequestFailed",e[e.AudioInputPermissionDenied=2]="AudioInputPermissionDenied",e[e.ConnectionFailed=3]="ConnectionFailed",e[e.AudioNotReceived=4]="AudioNotReceived"}(t=e.CheckAudioConnectivityFeedback||(e.CheckAudioConnectivityFeedback={})),e.default=t}(CheckAudioConnectivityFeedback);var CheckAudioInputFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckAudioInputFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied"}(t=e.CheckAudioInputFeedback||(e.CheckAudioInputFeedback={})),e.default=t}(CheckAudioInputFeedback);var CheckAudioOutputFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckAudioOutputFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed"}(t=e.CheckAudioOutputFeedback||(e.CheckAudioOutputFeedback={})),e.default=t}(CheckAudioOutputFeedback);var CheckCameraResolutionFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckCameraResolutionFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.ResolutionNotSupported=2]="ResolutionNotSupported",e[e.PermissionDenied=3]="PermissionDenied"}(t=e.CheckCameraResolutionFeedback||(e.CheckCameraResolutionFeedback={})),e.default=t}(CheckCameraResolutionFeedback);var CheckContentShareConnectivityFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckContentShareConnectivityFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied",e[e.TimedOut=3]="TimedOut",e[e.ConnectionFailed=4]="ConnectionFailed"}(t=e.CheckContentShareConnectivityFeedback||(e.CheckContentShareConnectivityFeedback={})),e.default=t}(CheckContentShareConnectivityFeedback);var CheckNetworkTCPConnectivityFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckNetworkTCPConnectivityFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",e[e.ConnectionFailed=2]="ConnectionFailed",e[e.ICENegotiationFailed=3]="ICENegotiationFailed"}(t=e.CheckNetworkTCPConnectivityFeedback||(e.CheckNetworkTCPConnectivityFeedback={})),e.default=t}(CheckNetworkTCPConnectivityFeedback);var CheckNetworkUDPConnectivityFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckNetworkUDPConnectivityFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",e[e.ConnectionFailed=2]="ConnectionFailed",e[e.ICENegotiationFailed=3]="ICENegotiationFailed"}(t=e.CheckNetworkUDPConnectivityFeedback||(e.CheckNetworkUDPConnectivityFeedback={})),e.default=t}(CheckNetworkUDPConnectivityFeedback);var CheckVideoConnectivityFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckVideoConnectivityFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.VideoInputRequestFailed=1]="VideoInputRequestFailed",e[e.VideoInputPermissionDenied=2]="VideoInputPermissionDenied",e[e.ConnectionFailed=3]="ConnectionFailed",e[e.VideoNotSent=4]="VideoNotSent"}(t=e.CheckVideoConnectivityFeedback||(e.CheckVideoConnectivityFeedback={})),e.default=t}(CheckVideoConnectivityFeedback);var CheckVideoInputFeedback={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.CheckVideoInputFeedback=void 0,function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied"}(t=e.CheckVideoInputFeedback||(e.CheckVideoInputFeedback={})),e.default=t}(CheckVideoInputFeedback);var CleanRestartedSessionTask$1={},__awaiter$W=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1u=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CleanRestartedSessionTask$1,"__esModule",{value:!0});const BaseTask_1$o=__importDefault$1u(BaseTask$1);class CleanRestartedSessionTask extends BaseTask_1$o.default{constructor(e){super(e.logger),this.context=e,this.taskName="CleanRestartedSessionTask"}run(){return __awaiter$W(this,void 0,void 0,(function*(){this.context.resetConnectionSpecificState()}))}}CleanRestartedSessionTask$1.default=CleanRestartedSessionTask;var CleanStoppedSessionTask$1={},SignalingClientEventType={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SignalingClientEventType=void 0,function(e){e[e.WebSocketConnecting=0]="WebSocketConnecting",e[e.WebSocketOpen=1]="WebSocketOpen",e[e.WebSocketError=2]="WebSocketError",e[e.WebSocketClosing=3]="WebSocketClosing",e[e.WebSocketClosed=4]="WebSocketClosed",e[e.WebSocketFailed=5]="WebSocketFailed",e[e.WebSocketMessage=6]="WebSocketMessage",e[e.WebSocketSendMessageFailure=7]="WebSocketSendMessageFailure",e[e.WebSocketSentMessage=8]="WebSocketSentMessage",e[e.ProtocolDecodeFailure=9]="ProtocolDecodeFailure",e[e.ReceivedSignalFrame=10]="ReceivedSignalFrame",e[e.WebSocketSkippedMessage=11]="WebSocketSkippedMessage"}(t=e.SignalingClientEventType||(e.SignalingClientEventType={})),e.default=t}(SignalingClientEventType);var __awaiter$V=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CleanStoppedSessionTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$c=__importDefault$1t(SignalingClientEventType),BaseTask_1$n=__importDefault$1t(BaseTask$1);class CleanStoppedSessionTask extends BaseTask_1$n.default{constructor(e){super(e.logger),this.context=e,this.taskName="CleanStoppedSessionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$V(this,void 0,void 0,(function*(){try{this.context.signalingClient.ready()&&(this.context.signalingClient.closeConnection(),yield this.receiveWebSocketClosedEvent())}catch(e){throw e}finally{for(const e of this.context.removableObservers)e.removeObserver();this.context.resetConnectionSpecificState(),this.context.statsCollector.stop(),this.context.statsCollector=null,this.context.connectionMonitor.stop(),this.context.connectionMonitor=null,this.context.videoUplinkBandwidthPolicy.setTransceiverController&&this.context.videoUplinkBandwidthPolicy.setTransceiverController(void 0),this.context.videoDownlinkBandwidthPolicy.bindToTileController&&this.context.videoDownlinkBandwidthPolicy.bindToTileController(void 0);const e=this.context.videoTileController.getLocalVideoTile();e&&e.bindVideoStream("",!0,null,null,null,null),this.context.videoTileController.removeAllVideoTiles()}}))}receiveWebSocketClosedEvent(){return new Promise(((e,t)=>{const i=new class{constructor(e){this.signalingClient=e}cancel(){this.signalingClient.removeObserver(this),t(new Error("CleanStoppedSessionTask got canceled while waiting for the WebSocket closed event"))}handleSignalingClientEvent(t){t.type===SignalingClientEventType_1$c.default.WebSocketClosed&&(this.signalingClient.removeObserver(this),e())}}(this.context.signalingClient);this.taskCanceler=i,this.context.signalingClient.registerObserver(i)}))}}CleanStoppedSessionTask$1.default=CleanStoppedSessionTask;var ClientMetricReport$1={},minimalExports={},minimal$1={get exports(){return minimalExports},set exports(e){minimalExports=e}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;return hasRequiredAspromise=1,aspromise=function(e,t){var i=new Array(arguments.length-1),n=0,r=2,o=!0;for(;r<arguments.length;)i[n++]=arguments[r++];return new Promise((function(r,a){i[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),i=0;i<t.length;)t[i++]=arguments[i];r.apply(null,t)}};try{e.apply(t||null,i)}catch(e){o&&(o=!1,a(e))}}))},aspromise}var base64$1={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&"="===e.charAt(t);)++i;return Math.ceil(3*e.length)/4-i};for(var i=new Array(64),n=new Array(123),r=0;r<64;)n[i[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,n){for(var r,o=null,a=[],s=0,d=0;t<n;){var l=e[t++];switch(d){case 0:a[s++]=i[l>>2],r=(3&l)<<4,d=1;break;case 1:a[s++]=i[r|l>>4],r=(15&l)<<2,d=2;break;case 2:a[s++]=i[r|l>>6],a[s++]=i[63&l],d=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return d&&(a[s++]=i[r],a[s++]=61,1===d&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var o="invalid encoding";t.decode=function(e,t,i){for(var r,a=i,s=0,d=0;d<e.length;){var l=e.charCodeAt(d++);if(61===l&&s>1)break;if(void 0===(l=n[l]))throw Error(o);switch(s){case 0:r=l,s=1;break;case 1:t[i++]=r<<2|(48&l)>>4,r=l,s=2;break;case 2:t[i++]=(15&r)<<4|(60&l)>>2,r=l,s=3;break;case 3:t[i++]=(3&r)<<6|l,s=0}}if(1===s)throw Error(o);return i-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64$1)),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),i=new Uint8Array(t.buffer),n=128===i[3];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3]}function o(e,n,r){t[0]=e,n[r]=i[3],n[r+1]=i[2],n[r+2]=i[1],n[r+3]=i[0]}function a(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],t[0]}function s(e,n){return i[3]=e[n],i[2]=e[n+1],i[1]=e[n+2],i[0]=e[n+3],t[0]}e.writeFloatLE=n?r:o,e.writeFloatBE=n?o:r,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function o(e,t,i,n){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,i,n);else if(isNaN(t))e(2143289344,i,n);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,i,n);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,i,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((r<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,i,n)}}function a(e,t,i){var n=e(t,i),r=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:r*(1/0):0===o?1401298464324817e-60*r*a:r*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=o.bind(null,t),e.writeFloatBE=o.bind(null,i),e.readFloatLE=a.bind(null,n),e.readFloatBE=a.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),i=new Uint8Array(t.buffer),n=128===i[7];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3],n[r+4]=i[4],n[r+5]=i[5],n[r+6]=i[6],n[r+7]=i[7]}function o(e,n,r){t[0]=e,n[r]=i[7],n[r+1]=i[6],n[r+2]=i[5],n[r+3]=i[4],n[r+4]=i[3],n[r+5]=i[2],n[r+6]=i[1],n[r+7]=i[0]}function a(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],i[4]=e[n+4],i[5]=e[n+5],i[6]=e[n+6],i[7]=e[n+7],t[0]}function s(e,n){return i[7]=e[n],i[6]=e[n+1],i[5]=e[n+2],i[4]=e[n+3],i[3]=e[n+4],i[2]=e[n+5],i[1]=e[n+6],i[0]=e[n+7],t[0]}e.writeDoubleLE=n?r:o,e.writeDoubleBE=n?o:r,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function o(e,t,i,n,r,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,r,o+t),e(1/n>0?0:2147483648,r,o+i);else if(isNaN(n))e(0,r,o+t),e(2146959360,r,o+i);else if(n>17976931348623157e292)e(0,r,o+t),e((a<<31|2146435072)>>>0,r,o+i);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,r,o+t),e((a<<31|s/4294967296)>>>0,r,o+i);else{var d=Math.floor(Math.log(n)/Math.LN2);1024===d&&(d=1023),e(4503599627370496*(s=n*Math.pow(2,-d))>>>0,r,o+t),e((a<<31|d+1023<<20|1048576*s&1048575)>>>0,r,o+i)}}}function a(e,t,i,n,r){var o=e(n,r+t),a=e(n,r+i),s=2*(a>>31)+1,d=a>>>20&2047,l=4294967296*(1048575&a)+o;return 2047===d?l?NaN:s*(1/0):0===d?5e-324*s*l:s*Math.pow(2,d-1075)*(l+4503599627370496)}e.writeDoubleLE=o.bind(null,t,0,4),e.writeDoubleBE=o.bind(null,i,4,0),e.readDoubleLE=a.bind(null,n,0,4),e.readDoubleBE=a.bind(null,r,4,0)}(),e}function t(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}function i(e,t,i){t[i]=e>>>24,t[i+1]=e>>>16&255,t[i+2]=e>>>8&255,t[i+3]=255&e}function n(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function r(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}return hasRequiredInquire=1,inquire_1=inquire,inquire_1}var utf8$2={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)(i=e.charCodeAt(n))<128?t+=1:i<2048?t+=2:55296==(64512&i)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,i){if(i-t<1)return"";for(var n,r=null,o=[],a=0;t<i;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,i){for(var n,r,o=i,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[i++]=n:n<2048?(t[i++]=n>>6|192,t[i++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&r),++a,t[i++]=n>>18|240,t[i++]=n>>12&63|128,t[i++]=n>>6&63|128,t[i++]=63&n|128):(t[i++]=n>>12|224,t[i++]=n>>6&63|128,t[i++]=63&n|128);return i-o}}(utf8$2)),utf8$2}function requirePool(){if(hasRequiredPool)return pool_1;return hasRequiredPool=1,pool_1=function(e,t,i){var n=i||8192,r=n>>>1,o=null,a=n;return function(i){if(i<1||i>r)return e(i);a+i>n&&(o=e(n),a=0);var s=t.call(o,a,a+=i);return 7&a&&(a=1+(7|a)),s}}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=t.zero=new t(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return i;var n=e<0;n&&(e=-e);var r=e>>>0,o=(e-r)/4294967296>>>0;return n&&(o=~o>>>0,r=~r>>>0,++r>4294967295&&(r=0,++o>4294967295&&(o=0))),new t(r,o)},t.from=function(n){if("number"==typeof n)return t.fromNumber(n);if(e.isString(n)){if(!e.Long)return t.fromNumber(parseInt(n,10));n=e.Long.fromString(n)}return n.low||n.high?new t(n.low>>>0,n.high>>>0):i},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+4294967296*i)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var r=String.prototype.charCodeAt;return t.fromHash=function(e){return e===n?i:new t((r.call(e,0)|r.call(e,1)<<8|r.call(e,2)<<16|r.call(e,3)<<24)>>>0,(r.call(e,4)|r.call(e,5)<<8|r.call(e,6)<<16|r.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;function i(e,t,i){for(var n=Object.keys(t),r=0;r<n.length;++r)void 0!==e[n[r]]&&i||(e[n[r]]=t[n[r]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var i=e[t];return!(null==i||!e.hasOwnProperty(t))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,i){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,i):n.toNumber(Boolean(i))},t.merge=i,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var e=Object.keys(this),i=e.length-1;i>-1;--i)if(1===t[e[i]]&&void 0!==this[e[i]]&&null!==this[e[i]])return e[i]}},t.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,i){return new e(t,i)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,i){this.fn=e,this.len=t,this.next=void 0,this.val=i}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,i){t[i]=255&e}function writeVarint32(e,t,i){for(;e>127;)t[i++]=127&e|128,e>>>=7;t[i]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,i){for(;e.hi;)t[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[i++]=127&e.lo|128,e.lo=e.lo>>>7;t[i++]=e.lo}function writeFixed32(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Op(e,t,i),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var i=Writer$1.alloc(t=base64.length(e));base64.decode(e,i,0),e=i}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,i){e.length<40?util$3.utf8.write(e,t,i):t.utf8Write?t.utf8Write(e,i):t.write(e,i)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var n=util$2.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();function Service(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,i,n,r,o){if(!r)throw TypeError("request must be specified");var a=this;if(!o)return util.asPromise(e,a,t,i,n,r);if(a.rpcImpl)try{return a.rpcImpl(t,i[a.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(e,i){if(e)return a.emit("error",e,t),o(e);if(null!==i){if(!(i instanceof n))try{i=n[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",i,t),o(null,i)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=service}(rpc);var roots={};!function(e){var t=e;function i(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=i,i()}(indexMinimal),function(e){e.exports=indexMinimal}(minimal$1);var $protobuf=minimalExports,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={}),valuesById,values;$root.SdkSignalFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}var t,i;return e.prototype.timestampMs=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.type=1,e.prototype.error=null,e.prototype.join=null,e.prototype.joinack=null,e.prototype.sub=null,e.prototype.suback=null,e.prototype.index=null,e.prototype.pause=null,e.prototype.leave=null,e.prototype.leaveAck=null,e.prototype.bitrates=null,e.prototype.audioControl=null,e.prototype.audioMetadata=null,e.prototype.audioStreamIdInfo=null,e.prototype.pingPong=null,e.prototype.audioStatus=null,e.prototype.clientMetric=null,e.prototype.dataMessage=null,e.prototype.remoteVideoUpdate=null,e.prototype.primaryMeetingJoin=null,e.prototype.primaryMeetingJoinAck=null,e.prototype.primaryMeetingLeave=null,e.prototype.notification=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t.uint32(8).uint64(e.timestampMs),t.uint32(16).int32(e.type),null!=e.error&&Object.hasOwnProperty.call(e,"error")&&$root.SdkErrorFrame.encode(e.error,t.uint32(26).fork()).ldelim(),null!=e.join&&Object.hasOwnProperty.call(e,"join")&&$root.SdkJoinFrame.encode(e.join,t.uint32(34).fork()).ldelim(),null!=e.joinack&&Object.hasOwnProperty.call(e,"joinack")&&$root.SdkJoinAckFrame.encode(e.joinack,t.uint32(42).fork()).ldelim(),null!=e.sub&&Object.hasOwnProperty.call(e,"sub")&&$root.SdkSubscribeFrame.encode(e.sub,t.uint32(50).fork()).ldelim(),null!=e.suback&&Object.hasOwnProperty.call(e,"suback")&&$root.SdkSubscribeAckFrame.encode(e.suback,t.uint32(58).fork()).ldelim(),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&$root.SdkIndexFrame.encode(e.index,t.uint32(66).fork()).ldelim(),null!=e.pause&&Object.hasOwnProperty.call(e,"pause")&&$root.SdkPauseResumeFrame.encode(e.pause,t.uint32(82).fork()).ldelim(),null!=e.leave&&Object.hasOwnProperty.call(e,"leave")&&$root.SdkLeaveFrame.encode(e.leave,t.uint32(90).fork()).ldelim(),null!=e.leaveAck&&Object.hasOwnProperty.call(e,"leaveAck")&&$root.SdkLeaveAckFrame.encode(e.leaveAck,t.uint32(98).fork()).ldelim(),null!=e.bitrates&&Object.hasOwnProperty.call(e,"bitrates")&&$root.SdkBitrateFrame.encode(e.bitrates,t.uint32(114).fork()).ldelim(),null!=e.audioControl&&Object.hasOwnProperty.call(e,"audioControl")&&$root.SdkAudioControlFrame.encode(e.audioControl,t.uint32(138).fork()).ldelim(),null!=e.audioMetadata&&Object.hasOwnProperty.call(e,"audioMetadata")&&$root.SdkAudioMetadataFrame.encode(e.audioMetadata,t.uint32(146).fork()).ldelim(),null!=e.audioStreamIdInfo&&Object.hasOwnProperty.call(e,"audioStreamIdInfo")&&$root.SdkAudioStreamIdInfoFrame.encode(e.audioStreamIdInfo,t.uint32(154).fork()).ldelim(),null!=e.pingPong&&Object.hasOwnProperty.call(e,"pingPong")&&$root.SdkPingPongFrame.encode(e.pingPong,t.uint32(162).fork()).ldelim(),null!=e.audioStatus&&Object.hasOwnProperty.call(e,"audioStatus")&&$root.SdkAudioStatusFrame.encode(e.audioStatus,t.uint32(170).fork()).ldelim(),null!=e.clientMetric&&Object.hasOwnProperty.call(e,"clientMetric")&&$root.SdkClientMetricFrame.encode(e.clientMetric,t.uint32(178).fork()).ldelim(),null!=e.dataMessage&&Object.hasOwnProperty.call(e,"dataMessage")&&$root.SdkDataMessageFrame.encode(e.dataMessage,t.uint32(186).fork()).ldelim(),null!=e.remoteVideoUpdate&&Object.hasOwnProperty.call(e,"remoteVideoUpdate")&&$root.SdkRemoteVideoUpdateFrame.encode(e.remoteVideoUpdate,t.uint32(202).fork()).ldelim(),null!=e.primaryMeetingJoin&&Object.hasOwnProperty.call(e,"primaryMeetingJoin")&&$root.SdkPrimaryMeetingJoinFrame.encode(e.primaryMeetingJoin,t.uint32(210).fork()).ldelim(),null!=e.primaryMeetingJoinAck&&Object.hasOwnProperty.call(e,"primaryMeetingJoinAck")&&$root.SdkPrimaryMeetingJoinAckFrame.encode(e.primaryMeetingJoinAck,t.uint32(218).fork()).ldelim(),null!=e.primaryMeetingLeave&&Object.hasOwnProperty.call(e,"primaryMeetingLeave")&&$root.SdkPrimaryMeetingLeaveFrame.encode(e.primaryMeetingLeave,t.uint32(226).fork()).ldelim(),null!=e.notification&&Object.hasOwnProperty.call(e,"notification")&&$root.SdkNotificationFrame.encode(e.notification,t.uint32(282).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkSignalFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.timestampMs=e.uint64();break;case 2:n.type=e.int32();break;case 3:n.error=$root.SdkErrorFrame.decode(e,e.uint32());break;case 4:n.join=$root.SdkJoinFrame.decode(e,e.uint32());break;case 5:n.joinack=$root.SdkJoinAckFrame.decode(e,e.uint32());break;case 6:n.sub=$root.SdkSubscribeFrame.decode(e,e.uint32());break;case 7:n.suback=$root.SdkSubscribeAckFrame.decode(e,e.uint32());break;case 8:n.index=$root.SdkIndexFrame.decode(e,e.uint32());break;case 10:n.pause=$root.SdkPauseResumeFrame.decode(e,e.uint32());break;case 11:n.leave=$root.SdkLeaveFrame.decode(e,e.uint32());break;case 12:n.leaveAck=$root.SdkLeaveAckFrame.decode(e,e.uint32());break;case 14:n.bitrates=$root.SdkBitrateFrame.decode(e,e.uint32());break;case 17:n.audioControl=$root.SdkAudioControlFrame.decode(e,e.uint32());break;case 18:n.audioMetadata=$root.SdkAudioMetadataFrame.decode(e,e.uint32());break;case 19:n.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.decode(e,e.uint32());break;case 20:n.pingPong=$root.SdkPingPongFrame.decode(e,e.uint32());break;case 21:n.audioStatus=$root.SdkAudioStatusFrame.decode(e,e.uint32());break;case 22:n.clientMetric=$root.SdkClientMetricFrame.decode(e,e.uint32());break;case 23:n.dataMessage=$root.SdkDataMessageFrame.decode(e,e.uint32());break;case 25:n.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.decode(e,e.uint32());break;case 26:n.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.decode(e,e.uint32());break;case 27:n.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.decode(e,e.uint32());break;case 28:n.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.decode(e,e.uint32());break;case 35:n.notification=$root.SdkNotificationFrame.decode(e,e.uint32());break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("timestampMs"))throw $util.ProtocolError("missing required 'timestampMs'",{instance:n});if(!n.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!($util.isInteger(e.timestampMs)||e.timestampMs&&$util.isInteger(e.timestampMs.low)&&$util.isInteger(e.timestampMs.high)))return"timestampMs: integer|Long expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 13:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:case 34:}var t;if(null!=e.error&&e.hasOwnProperty("error")&&(t=$root.SdkErrorFrame.verify(e.error)))return"error."+t;if(null!=e.join&&e.hasOwnProperty("join")&&(t=$root.SdkJoinFrame.verify(e.join)))return"join."+t;if(null!=e.joinack&&e.hasOwnProperty("joinack")&&(t=$root.SdkJoinAckFrame.verify(e.joinack)))return"joinack."+t;if(null!=e.sub&&e.hasOwnProperty("sub")&&(t=$root.SdkSubscribeFrame.verify(e.sub)))return"sub."+t;if(null!=e.suback&&e.hasOwnProperty("suback")&&(t=$root.SdkSubscribeAckFrame.verify(e.suback)))return"suback."+t;if(null!=e.index&&e.hasOwnProperty("index")&&(t=$root.SdkIndexFrame.verify(e.index)))return"index."+t;if(null!=e.pause&&e.hasOwnProperty("pause")&&(t=$root.SdkPauseResumeFrame.verify(e.pause)))return"pause."+t;if(null!=e.leave&&e.hasOwnProperty("leave")&&(t=$root.SdkLeaveFrame.verify(e.leave)))return"leave."+t;if(null!=e.leaveAck&&e.hasOwnProperty("leaveAck")&&(t=$root.SdkLeaveAckFrame.verify(e.leaveAck)))return"leaveAck."+t;if(null!=e.bitrates&&e.hasOwnProperty("bitrates")&&(t=$root.SdkBitrateFrame.verify(e.bitrates)))return"bitrates."+t;if(null!=e.audioControl&&e.hasOwnProperty("audioControl")&&(t=$root.SdkAudioControlFrame.verify(e.audioControl)))return"audioControl."+t;if(null!=e.audioMetadata&&e.hasOwnProperty("audioMetadata")&&(t=$root.SdkAudioMetadataFrame.verify(e.audioMetadata)))return"audioMetadata."+t;if(null!=e.audioStreamIdInfo&&e.hasOwnProperty("audioStreamIdInfo")&&(t=$root.SdkAudioStreamIdInfoFrame.verify(e.audioStreamIdInfo)))return"audioStreamIdInfo."+t;if(null!=e.pingPong&&e.hasOwnProperty("pingPong")&&(t=$root.SdkPingPongFrame.verify(e.pingPong)))return"pingPong."+t;if(null!=e.audioStatus&&e.hasOwnProperty("audioStatus")&&(t=$root.SdkAudioStatusFrame.verify(e.audioStatus)))return"audioStatus."+t;if(null!=e.clientMetric&&e.hasOwnProperty("clientMetric")&&(t=$root.SdkClientMetricFrame.verify(e.clientMetric)))return"clientMetric."+t;if(null!=e.dataMessage&&e.hasOwnProperty("dataMessage")&&(t=$root.SdkDataMessageFrame.verify(e.dataMessage)))return"dataMessage."+t;if(null!=e.remoteVideoUpdate&&e.hasOwnProperty("remoteVideoUpdate")&&(t=$root.SdkRemoteVideoUpdateFrame.verify(e.remoteVideoUpdate)))return"remoteVideoUpdate."+t;if(null!=e.primaryMeetingJoin&&e.hasOwnProperty("primaryMeetingJoin")&&(t=$root.SdkPrimaryMeetingJoinFrame.verify(e.primaryMeetingJoin)))return"primaryMeetingJoin."+t;if(null!=e.primaryMeetingJoinAck&&e.hasOwnProperty("primaryMeetingJoinAck")&&(t=$root.SdkPrimaryMeetingJoinAckFrame.verify(e.primaryMeetingJoinAck)))return"primaryMeetingJoinAck."+t;if(null!=e.primaryMeetingLeave&&e.hasOwnProperty("primaryMeetingLeave")&&(t=$root.SdkPrimaryMeetingLeaveFrame.verify(e.primaryMeetingLeave)))return"primaryMeetingLeave."+t;if(null!=e.notification&&e.hasOwnProperty("notification")&&(t=$root.SdkNotificationFrame.verify(e.notification)))return"notification."+t;return null},e.fromObject=function(e){if(e instanceof $root.SdkSignalFrame)return e;var t=new $root.SdkSignalFrame;switch(null!=e.timestampMs&&($util.Long?(t.timestampMs=$util.Long.fromValue(e.timestampMs)).unsigned=!0:"string"==typeof e.timestampMs?t.timestampMs=parseInt(e.timestampMs,10):"number"==typeof e.timestampMs?t.timestampMs=e.timestampMs:"object"==typeof e.timestampMs&&(t.timestampMs=new $util.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0))),e.type){case"JOIN":case 1:t.type=1;break;case"JOIN_ACK":case 2:t.type=2;break;case"SUBSCRIBE":case 3:t.type=3;break;case"SUBSCRIBE_ACK":case 4:t.type=4;break;case"INDEX":case 5:t.type=5;break;case"PAUSE":case 7:t.type=7;break;case"RESUME":case 8:t.type=8;break;case"LEAVE":case 9:t.type=9;break;case"LEAVE_ACK":case 10:t.type=10;break;case"BITRATES":case 13:t.type=13;break;case"AUDIO_CONTROL":case 16:t.type=16;break;case"AUDIO_METADATA":case 17:t.type=17;break;case"AUDIO_STREAM_ID_INFO":case 18:t.type=18;break;case"PING_PONG":case 19:t.type=19;break;case"AUDIO_STATUS":case 20:t.type=20;break;case"CLIENT_METRIC":case 21:t.type=21;break;case"DATA_MESSAGE":case 22:t.type=22;break;case"REMOTE_VIDEO_UPDATE":case 24:t.type=24;break;case"PRIMARY_MEETING_JOIN":case 25:t.type=25;break;case"PRIMARY_MEETING_JOIN_ACK":case 26:t.type=26;break;case"PRIMARY_MEETING_LEAVE":case 27:t.type=27;break;case"NOTIFICATION":case 34:t.type=34}if(null!=e.error){if("object"!=typeof e.error)throw TypeError(".SdkSignalFrame.error: object expected");t.error=$root.SdkErrorFrame.fromObject(e.error)}if(null!=e.join){if("object"!=typeof e.join)throw TypeError(".SdkSignalFrame.join: object expected");t.join=$root.SdkJoinFrame.fromObject(e.join)}if(null!=e.joinack){if("object"!=typeof e.joinack)throw TypeError(".SdkSignalFrame.joinack: object expected");t.joinack=$root.SdkJoinAckFrame.fromObject(e.joinack)}if(null!=e.sub){if("object"!=typeof e.sub)throw TypeError(".SdkSignalFrame.sub: object expected");t.sub=$root.SdkSubscribeFrame.fromObject(e.sub)}if(null!=e.suback){if("object"!=typeof e.suback)throw TypeError(".SdkSignalFrame.suback: object expected");t.suback=$root.SdkSubscribeAckFrame.fromObject(e.suback)}if(null!=e.index){if("object"!=typeof e.index)throw TypeError(".SdkSignalFrame.index: object expected");t.index=$root.SdkIndexFrame.fromObject(e.index)}if(null!=e.pause){if("object"!=typeof e.pause)throw TypeError(".SdkSignalFrame.pause: object expected");t.pause=$root.SdkPauseResumeFrame.fromObject(e.pause)}if(null!=e.leave){if("object"!=typeof e.leave)throw TypeError(".SdkSignalFrame.leave: object expected");t.leave=$root.SdkLeaveFrame.fromObject(e.leave)}if(null!=e.leaveAck){if("object"!=typeof e.leaveAck)throw TypeError(".SdkSignalFrame.leaveAck: object expected");t.leaveAck=$root.SdkLeaveAckFrame.fromObject(e.leaveAck)}if(null!=e.bitrates){if("object"!=typeof e.bitrates)throw TypeError(".SdkSignalFrame.bitrates: object expected");t.bitrates=$root.SdkBitrateFrame.fromObject(e.bitrates)}if(null!=e.audioControl){if("object"!=typeof e.audioControl)throw TypeError(".SdkSignalFrame.audioControl: object expected");t.audioControl=$root.SdkAudioControlFrame.fromObject(e.audioControl)}if(null!=e.audioMetadata){if("object"!=typeof e.audioMetadata)throw TypeError(".SdkSignalFrame.audioMetadata: object expected");t.audioMetadata=$root.SdkAudioMetadataFrame.fromObject(e.audioMetadata)}if(null!=e.audioStreamIdInfo){if("object"!=typeof e.audioStreamIdInfo)throw TypeError(".SdkSignalFrame.audioStreamIdInfo: object expected");t.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.fromObject(e.audioStreamIdInfo)}if(null!=e.pingPong){if("object"!=typeof e.pingPong)throw TypeError(".SdkSignalFrame.pingPong: object expected");t.pingPong=$root.SdkPingPongFrame.fromObject(e.pingPong)}if(null!=e.audioStatus){if("object"!=typeof e.audioStatus)throw TypeError(".SdkSignalFrame.audioStatus: object expected");t.audioStatus=$root.SdkAudioStatusFrame.fromObject(e.audioStatus)}if(null!=e.clientMetric){if("object"!=typeof e.clientMetric)throw TypeError(".SdkSignalFrame.clientMetric: object expected");t.clientMetric=$root.SdkClientMetricFrame.fromObject(e.clientMetric)}if(null!=e.dataMessage){if("object"!=typeof e.dataMessage)throw TypeError(".SdkSignalFrame.dataMessage: object expected");t.dataMessage=$root.SdkDataMessageFrame.fromObject(e.dataMessage)}if(null!=e.remoteVideoUpdate){if("object"!=typeof e.remoteVideoUpdate)throw TypeError(".SdkSignalFrame.remoteVideoUpdate: object expected");t.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.fromObject(e.remoteVideoUpdate)}if(null!=e.primaryMeetingJoin){if("object"!=typeof e.primaryMeetingJoin)throw TypeError(".SdkSignalFrame.primaryMeetingJoin: object expected");t.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.fromObject(e.primaryMeetingJoin)}if(null!=e.primaryMeetingJoinAck){if("object"!=typeof e.primaryMeetingJoinAck)throw TypeError(".SdkSignalFrame.primaryMeetingJoinAck: object expected");t.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.fromObject(e.primaryMeetingJoinAck)}if(null!=e.primaryMeetingLeave){if("object"!=typeof e.primaryMeetingLeave)throw TypeError(".SdkSignalFrame.primaryMeetingLeave: object expected");t.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.fromObject(e.primaryMeetingLeave)}if(null!=e.notification){if("object"!=typeof e.notification)throw TypeError(".SdkSignalFrame.notification: object expected");t.notification=$root.SdkNotificationFrame.fromObject(e.notification)}return t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if($util.Long){var n=new $util.Long(0,0,!0);i.timestampMs=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.timestampMs=t.longs===String?"0":0;i.type=t.enums===String?"JOIN":1,i.error=null,i.join=null,i.joinack=null,i.sub=null,i.suback=null,i.index=null,i.pause=null,i.leave=null,i.leaveAck=null,i.bitrates=null,i.audioControl=null,i.audioMetadata=null,i.audioStreamIdInfo=null,i.pingPong=null,i.audioStatus=null,i.clientMetric=null,i.dataMessage=null,i.remoteVideoUpdate=null,i.primaryMeetingJoin=null,i.primaryMeetingJoinAck=null,i.primaryMeetingLeave=null,i.notification=null}return null!=e.timestampMs&&e.hasOwnProperty("timestampMs")&&("number"==typeof e.timestampMs?i.timestampMs=t.longs===String?String(e.timestampMs):e.timestampMs:i.timestampMs=t.longs===String?$util.Long.prototype.toString.call(e.timestampMs):t.longs===Number?new $util.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0):e.timestampMs),null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkSignalFrame.Type[e.type]:e.type),null!=e.error&&e.hasOwnProperty("error")&&(i.error=$root.SdkErrorFrame.toObject(e.error,t)),null!=e.join&&e.hasOwnProperty("join")&&(i.join=$root.SdkJoinFrame.toObject(e.join,t)),null!=e.joinack&&e.hasOwnProperty("joinack")&&(i.joinack=$root.SdkJoinAckFrame.toObject(e.joinack,t)),null!=e.sub&&e.hasOwnProperty("sub")&&(i.sub=$root.SdkSubscribeFrame.toObject(e.sub,t)),null!=e.suback&&e.hasOwnProperty("suback")&&(i.suback=$root.SdkSubscribeAckFrame.toObject(e.suback,t)),null!=e.index&&e.hasOwnProperty("index")&&(i.index=$root.SdkIndexFrame.toObject(e.index,t)),null!=e.pause&&e.hasOwnProperty("pause")&&(i.pause=$root.SdkPauseResumeFrame.toObject(e.pause,t)),null!=e.leave&&e.hasOwnProperty("leave")&&(i.leave=$root.SdkLeaveFrame.toObject(e.leave,t)),null!=e.leaveAck&&e.hasOwnProperty("leaveAck")&&(i.leaveAck=$root.SdkLeaveAckFrame.toObject(e.leaveAck,t)),null!=e.bitrates&&e.hasOwnProperty("bitrates")&&(i.bitrates=$root.SdkBitrateFrame.toObject(e.bitrates,t)),null!=e.audioControl&&e.hasOwnProperty("audioControl")&&(i.audioControl=$root.SdkAudioControlFrame.toObject(e.audioControl,t)),null!=e.audioMetadata&&e.hasOwnProperty("audioMetadata")&&(i.audioMetadata=$root.SdkAudioMetadataFrame.toObject(e.audioMetadata,t)),null!=e.audioStreamIdInfo&&e.hasOwnProperty("audioStreamIdInfo")&&(i.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.toObject(e.audioStreamIdInfo,t)),null!=e.pingPong&&e.hasOwnProperty("pingPong")&&(i.pingPong=$root.SdkPingPongFrame.toObject(e.pingPong,t)),null!=e.audioStatus&&e.hasOwnProperty("audioStatus")&&(i.audioStatus=$root.SdkAudioStatusFrame.toObject(e.audioStatus,t)),null!=e.clientMetric&&e.hasOwnProperty("clientMetric")&&(i.clientMetric=$root.SdkClientMetricFrame.toObject(e.clientMetric,t)),null!=e.dataMessage&&e.hasOwnProperty("dataMessage")&&(i.dataMessage=$root.SdkDataMessageFrame.toObject(e.dataMessage,t)),null!=e.remoteVideoUpdate&&e.hasOwnProperty("remoteVideoUpdate")&&(i.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.toObject(e.remoteVideoUpdate,t)),null!=e.primaryMeetingJoin&&e.hasOwnProperty("primaryMeetingJoin")&&(i.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.toObject(e.primaryMeetingJoin,t)),null!=e.primaryMeetingJoinAck&&e.hasOwnProperty("primaryMeetingJoinAck")&&(i.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.toObject(e.primaryMeetingJoinAck,t)),null!=e.primaryMeetingLeave&&e.hasOwnProperty("primaryMeetingLeave")&&(i.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.toObject(e.primaryMeetingLeave,t)),null!=e.notification&&e.hasOwnProperty("notification")&&(i.notification=$root.SdkNotificationFrame.toObject(e.notification,t)),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.Type=(t={},(i=Object.create(t))[t[1]="JOIN"]=1,i[t[2]="JOIN_ACK"]=2,i[t[3]="SUBSCRIBE"]=3,i[t[4]="SUBSCRIBE_ACK"]=4,i[t[5]="INDEX"]=5,i[t[7]="PAUSE"]=7,i[t[8]="RESUME"]=8,i[t[9]="LEAVE"]=9,i[t[10]="LEAVE_ACK"]=10,i[t[13]="BITRATES"]=13,i[t[16]="AUDIO_CONTROL"]=16,i[t[17]="AUDIO_METADATA"]=17,i[t[18]="AUDIO_STREAM_ID_INFO"]=18,i[t[19]="PING_PONG"]=19,i[t[20]="AUDIO_STATUS"]=20,i[t[21]="CLIENT_METRIC"]=21,i[t[22]="DATA_MESSAGE"]=22,i[t[24]="REMOTE_VIDEO_UPDATE"]=24,i[t[25]="PRIMARY_MEETING_JOIN"]=25,i[t[26]="PRIMARY_MEETING_JOIN_ACK"]=26,i[t[27]="PRIMARY_MEETING_LEAVE"]=27,i[t[34]="NOTIFICATION"]=34,i),e}(),$root.SdkErrorFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.status=0,e.prototype.description="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.status&&Object.hasOwnProperty.call(e,"status")&&t.uint32(8).uint32(e.status),null!=e.description&&Object.hasOwnProperty.call(e,"description")&&t.uint32(18).string(e.description),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkErrorFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.status=e.uint32();break;case 2:n.description=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.status&&e.hasOwnProperty("status")&&!$util.isInteger(e.status)?"status: integer expected":null!=e.description&&e.hasOwnProperty("description")&&!$util.isString(e.description)?"description: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkErrorFrame)return e;var t=new $root.SdkErrorFrame;return null!=e.status&&(t.status=e.status>>>0),null!=e.description&&(t.description=String(e.description)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.status=0,i.description=""),null!=e.status&&e.hasOwnProperty("status")&&(i.status=e.status),null!=e.description&&e.hasOwnProperty("description")&&(i.description=e.description),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkJoinFlags=(valuesById={},values=Object.create(valuesById),values[valuesById[2]="HAS_STREAM_UPDATE"]=2,values[valuesById[16]="COMPLETE_VIDEO_SOURCES_LIST"]=16,values[valuesById[32]="EXCLUDE_SELF_CONTENT_IN_INDEX"]=32,values),$root.SdkClientDetails=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.appName="",e.prototype.appVersion="",e.prototype.deviceModel="",e.prototype.deviceMake="",e.prototype.platformName="",e.prototype.platformVersion="",e.prototype.clientSource="",e.prototype.chimeSdkVersion="",e.prototype.clientUtcOffset="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.appName&&Object.hasOwnProperty.call(e,"appName")&&t.uint32(10).string(e.appName),null!=e.appVersion&&Object.hasOwnProperty.call(e,"appVersion")&&t.uint32(18).string(e.appVersion),null!=e.deviceModel&&Object.hasOwnProperty.call(e,"deviceModel")&&t.uint32(26).string(e.deviceModel),null!=e.deviceMake&&Object.hasOwnProperty.call(e,"deviceMake")&&t.uint32(34).string(e.deviceMake),null!=e.platformName&&Object.hasOwnProperty.call(e,"platformName")&&t.uint32(42).string(e.platformName),null!=e.platformVersion&&Object.hasOwnProperty.call(e,"platformVersion")&&t.uint32(50).string(e.platformVersion),null!=e.clientSource&&Object.hasOwnProperty.call(e,"clientSource")&&t.uint32(58).string(e.clientSource),null!=e.chimeSdkVersion&&Object.hasOwnProperty.call(e,"chimeSdkVersion")&&t.uint32(66).string(e.chimeSdkVersion),null!=e.clientUtcOffset&&Object.hasOwnProperty.call(e,"clientUtcOffset")&&t.uint32(74).string(e.clientUtcOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkClientDetails;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.appName=e.string();break;case 2:n.appVersion=e.string();break;case 3:n.deviceModel=e.string();break;case 4:n.deviceMake=e.string();break;case 5:n.platformName=e.string();break;case 6:n.platformVersion=e.string();break;case 7:n.clientSource=e.string();break;case 8:n.chimeSdkVersion=e.string();break;case 9:n.clientUtcOffset=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.appName&&e.hasOwnProperty("appName")&&!$util.isString(e.appName)?"appName: string expected":null!=e.appVersion&&e.hasOwnProperty("appVersion")&&!$util.isString(e.appVersion)?"appVersion: string expected":null!=e.deviceModel&&e.hasOwnProperty("deviceModel")&&!$util.isString(e.deviceModel)?"deviceModel: string expected":null!=e.deviceMake&&e.hasOwnProperty("deviceMake")&&!$util.isString(e.deviceMake)?"deviceMake: string expected":null!=e.platformName&&e.hasOwnProperty("platformName")&&!$util.isString(e.platformName)?"platformName: string expected":null!=e.platformVersion&&e.hasOwnProperty("platformVersion")&&!$util.isString(e.platformVersion)?"platformVersion: string expected":null!=e.clientSource&&e.hasOwnProperty("clientSource")&&!$util.isString(e.clientSource)?"clientSource: string expected":null!=e.chimeSdkVersion&&e.hasOwnProperty("chimeSdkVersion")&&!$util.isString(e.chimeSdkVersion)?"chimeSdkVersion: string expected":null!=e.clientUtcOffset&&e.hasOwnProperty("clientUtcOffset")&&!$util.isString(e.clientUtcOffset)?"clientUtcOffset: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkClientDetails)return e;var t=new $root.SdkClientDetails;return null!=e.appName&&(t.appName=String(e.appName)),null!=e.appVersion&&(t.appVersion=String(e.appVersion)),null!=e.deviceModel&&(t.deviceModel=String(e.deviceModel)),null!=e.deviceMake&&(t.deviceMake=String(e.deviceMake)),null!=e.platformName&&(t.platformName=String(e.platformName)),null!=e.platformVersion&&(t.platformVersion=String(e.platformVersion)),null!=e.clientSource&&(t.clientSource=String(e.clientSource)),null!=e.chimeSdkVersion&&(t.chimeSdkVersion=String(e.chimeSdkVersion)),null!=e.clientUtcOffset&&(t.clientUtcOffset=String(e.clientUtcOffset)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.appName="",i.appVersion="",i.deviceModel="",i.deviceMake="",i.platformName="",i.platformVersion="",i.clientSource="",i.chimeSdkVersion="",i.clientUtcOffset=""),null!=e.appName&&e.hasOwnProperty("appName")&&(i.appName=e.appName),null!=e.appVersion&&e.hasOwnProperty("appVersion")&&(i.appVersion=e.appVersion),null!=e.deviceModel&&e.hasOwnProperty("deviceModel")&&(i.deviceModel=e.deviceModel),null!=e.deviceMake&&e.hasOwnProperty("deviceMake")&&(i.deviceMake=e.deviceMake),null!=e.platformName&&e.hasOwnProperty("platformName")&&(i.platformName=e.platformName),null!=e.platformVersion&&e.hasOwnProperty("platformVersion")&&(i.platformVersion=e.platformVersion),null!=e.clientSource&&e.hasOwnProperty("clientSource")&&(i.clientSource=e.clientSource),null!=e.chimeSdkVersion&&e.hasOwnProperty("chimeSdkVersion")&&(i.chimeSdkVersion=e.chimeSdkVersion),null!=e.clientUtcOffset&&e.hasOwnProperty("clientUtcOffset")&&(i.clientUtcOffset=e.clientUtcOffset),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkServerSideNetworkAdaption=function(){var e={},t=Object.create(e);return t[e[1]="DEFAULT"]=1,t[e[2]="NONE"]=2,t[e[3]="BANDWIDTH_PROBING"]=3,t[e[4]="BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION"]=4,t}(),$root.SdkJoinFrame=function(){function e(e){if(this.supportedServerSideNetworkAdaptions=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.protocolVersion=2,e.prototype.maxNumOfVideos=0,e.prototype.flags=0,e.prototype.clientDetails=null,e.prototype.audioSessionId=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.wantsCompressedSdp=!1,e.prototype.serverSideNetworkAdaption=1,e.prototype.supportedServerSideNetworkAdaptions=$util.emptyArray,e.prototype.wantsAllTemporalLayersInIndex=!1,e.prototype.disablePeriodicKeyframeRequestOnContentSender=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.protocolVersion&&Object.hasOwnProperty.call(e,"protocolVersion")&&t.uint32(8).uint32(e.protocolVersion),null!=e.maxNumOfVideos&&Object.hasOwnProperty.call(e,"maxNumOfVideos")&&t.uint32(16).uint32(e.maxNumOfVideos),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(24).uint32(e.flags),null!=e.clientDetails&&Object.hasOwnProperty.call(e,"clientDetails")&&$root.SdkClientDetails.encode(e.clientDetails,t.uint32(34).fork()).ldelim(),null!=e.audioSessionId&&Object.hasOwnProperty.call(e,"audioSessionId")&&t.uint32(48).uint64(e.audioSessionId),null!=e.wantsCompressedSdp&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&t.uint32(56).bool(e.wantsCompressedSdp),null!=e.serverSideNetworkAdaption&&Object.hasOwnProperty.call(e,"serverSideNetworkAdaption")&&t.uint32(80).int32(e.serverSideNetworkAdaption),null!=e.supportedServerSideNetworkAdaptions&&e.supportedServerSideNetworkAdaptions.length)for(var i=0;i<e.supportedServerSideNetworkAdaptions.length;++i)t.uint32(88).int32(e.supportedServerSideNetworkAdaptions[i]);return null!=e.wantsAllTemporalLayersInIndex&&Object.hasOwnProperty.call(e,"wantsAllTemporalLayersInIndex")&&t.uint32(96).bool(e.wantsAllTemporalLayersInIndex),null!=e.disablePeriodicKeyframeRequestOnContentSender&&Object.hasOwnProperty.call(e,"disablePeriodicKeyframeRequestOnContentSender")&&t.uint32(104).bool(e.disablePeriodicKeyframeRequestOnContentSender),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkJoinFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.protocolVersion=e.uint32();break;case 2:n.maxNumOfVideos=e.uint32();break;case 3:n.flags=e.uint32();break;case 4:n.clientDetails=$root.SdkClientDetails.decode(e,e.uint32());break;case 6:n.audioSessionId=e.uint64();break;case 7:n.wantsCompressedSdp=e.bool();break;case 10:n.serverSideNetworkAdaption=e.int32();break;case 11:if(n.supportedServerSideNetworkAdaptions&&n.supportedServerSideNetworkAdaptions.length||(n.supportedServerSideNetworkAdaptions=[]),2==(7&r))for(var o=e.uint32()+e.pos;e.pos<o;)n.supportedServerSideNetworkAdaptions.push(e.int32());else n.supportedServerSideNetworkAdaptions.push(e.int32());break;case 12:n.wantsAllTemporalLayersInIndex=e.bool();break;case 13:n.disablePeriodicKeyframeRequestOnContentSender=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.protocolVersion&&e.hasOwnProperty("protocolVersion")&&!$util.isInteger(e.protocolVersion))return"protocolVersion: integer expected";if(null!=e.maxNumOfVideos&&e.hasOwnProperty("maxNumOfVideos")&&!$util.isInteger(e.maxNumOfVideos))return"maxNumOfVideos: integer expected";if(null!=e.flags&&e.hasOwnProperty("flags")&&!$util.isInteger(e.flags))return"flags: integer expected";if(null!=e.clientDetails&&e.hasOwnProperty("clientDetails")){var t=$root.SdkClientDetails.verify(e.clientDetails);if(t)return"clientDetails."+t}if(null!=e.audioSessionId&&e.hasOwnProperty("audioSessionId")&&!($util.isInteger(e.audioSessionId)||e.audioSessionId&&$util.isInteger(e.audioSessionId.low)&&$util.isInteger(e.audioSessionId.high)))return"audioSessionId: integer|Long expected";if(null!=e.wantsCompressedSdp&&e.hasOwnProperty("wantsCompressedSdp")&&"boolean"!=typeof e.wantsCompressedSdp)return"wantsCompressedSdp: boolean expected";if(null!=e.serverSideNetworkAdaption&&e.hasOwnProperty("serverSideNetworkAdaption"))switch(e.serverSideNetworkAdaption){default:return"serverSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:}if(null!=e.wantsAllTemporalLayersInIndex&&e.hasOwnProperty("wantsAllTemporalLayersInIndex")&&"boolean"!=typeof e.wantsAllTemporalLayersInIndex)return"wantsAllTemporalLayersInIndex: boolean expected";if(null!=e.supportedServerSideNetworkAdaptions&&e.hasOwnProperty("supportedServerSideNetworkAdaptions")){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))return"supportedServerSideNetworkAdaptions: array expected";for(var i=0;i<e.supportedServerSideNetworkAdaptions.length;++i)switch(e.supportedServerSideNetworkAdaptions[i]){default:return"supportedServerSideNetworkAdaptions: enum value[] expected";case 1:case 2:case 3:case 4:}}return null!=e.disablePeriodicKeyframeRequestOnContentSender&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&"boolean"!=typeof e.disablePeriodicKeyframeRequestOnContentSender?"disablePeriodicKeyframeRequestOnContentSender: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.SdkJoinFrame)return e;var t=new $root.SdkJoinFrame;if(null!=e.protocolVersion&&(t.protocolVersion=e.protocolVersion>>>0),null!=e.maxNumOfVideos&&(t.maxNumOfVideos=e.maxNumOfVideos>>>0),null!=e.flags&&(t.flags=e.flags>>>0),null!=e.clientDetails){if("object"!=typeof e.clientDetails)throw TypeError(".SdkJoinFrame.clientDetails: object expected");t.clientDetails=$root.SdkClientDetails.fromObject(e.clientDetails)}switch(null!=e.audioSessionId&&($util.Long?(t.audioSessionId=$util.Long.fromValue(e.audioSessionId)).unsigned=!0:"string"==typeof e.audioSessionId?t.audioSessionId=parseInt(e.audioSessionId,10):"number"==typeof e.audioSessionId?t.audioSessionId=e.audioSessionId:"object"==typeof e.audioSessionId&&(t.audioSessionId=new $util.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0))),null!=e.wantsCompressedSdp&&(t.wantsCompressedSdp=Boolean(e.wantsCompressedSdp)),e.serverSideNetworkAdaption){case"DEFAULT":case 1:t.serverSideNetworkAdaption=1;break;case"NONE":case 2:t.serverSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:t.serverSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:t.serverSideNetworkAdaption=4}if(e.supportedServerSideNetworkAdaptions){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))throw TypeError(".SdkJoinFrame.supportedServerSideNetworkAdaptions: array expected");t.supportedServerSideNetworkAdaptions=[];for(var i=0;i<e.supportedServerSideNetworkAdaptions.length;++i)switch(e.supportedServerSideNetworkAdaptions[i]){default:case"DEFAULT":case 1:t.supportedServerSideNetworkAdaptions[i]=1;break;case"NONE":case 2:t.supportedServerSideNetworkAdaptions[i]=2;break;case"BANDWIDTH_PROBING":case 3:t.supportedServerSideNetworkAdaptions[i]=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:t.supportedServerSideNetworkAdaptions[i]=4}}return null!=e.wantsAllTemporalLayersInIndex&&(t.wantsAllTemporalLayersInIndex=Boolean(e.wantsAllTemporalLayersInIndex)),null!=e.disablePeriodicKeyframeRequestOnContentSender&&(t.disablePeriodicKeyframeRequestOnContentSender=Boolean(e.disablePeriodicKeyframeRequestOnContentSender)),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.supportedServerSideNetworkAdaptions=[]),t.defaults){if(i.protocolVersion=2,i.maxNumOfVideos=0,i.flags=0,i.clientDetails=null,$util.Long){var n=new $util.Long(0,0,!0);i.audioSessionId=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.audioSessionId=t.longs===String?"0":0;i.wantsCompressedSdp=!1,i.serverSideNetworkAdaption=t.enums===String?"DEFAULT":1,i.disablePeriodicKeyframeRequestOnContentSender=!1}if(null!=e.protocolVersion&&e.hasOwnProperty("protocolVersion")&&(i.protocolVersion=e.protocolVersion),null!=e.maxNumOfVideos&&e.hasOwnProperty("maxNumOfVideos")&&(i.maxNumOfVideos=e.maxNumOfVideos),null!=e.flags&&e.hasOwnProperty("flags")&&(i.flags=e.flags),null!=e.clientDetails&&e.hasOwnProperty("clientDetails")&&(i.clientDetails=$root.SdkClientDetails.toObject(e.clientDetails,t)),null!=e.audioSessionId&&e.hasOwnProperty("audioSessionId")&&("number"==typeof e.audioSessionId?i.audioSessionId=t.longs===String?String(e.audioSessionId):e.audioSessionId:i.audioSessionId=t.longs===String?$util.Long.prototype.toString.call(e.audioSessionId):t.longs===Number?new $util.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0):e.audioSessionId),null!=e.wantsCompressedSdp&&e.hasOwnProperty("wantsCompressedSdp")&&(i.wantsCompressedSdp=e.wantsCompressedSdp),null!=e.serverSideNetworkAdaption&&e.hasOwnProperty("serverSideNetworkAdaption")&&(i.serverSideNetworkAdaption=t.enums===String?$root.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]:e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions&&e.supportedServerSideNetworkAdaptions.length){i.supportedServerSideNetworkAdaptions=[];for(var r=0;r<e.supportedServerSideNetworkAdaptions.length;++r)i.supportedServerSideNetworkAdaptions[r]=t.enums===String?$root.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[r]]:e.supportedServerSideNetworkAdaptions[r]}return null!=e.disablePeriodicKeyframeRequestOnContentSender&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&(i.disablePeriodicKeyframeRequestOnContentSender=e.disablePeriodicKeyframeRequestOnContentSender),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkJoinAckFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.turnCredentials=null,e.prototype.videoSubscriptionLimit=0,e.prototype.wantsCompressedSdp=!1,e.prototype.defaultServerSideNetworkAdaption=1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.turnCredentials&&Object.hasOwnProperty.call(e,"turnCredentials")&&$root.SdkTurnCredentials.encode(e.turnCredentials,t.uint32(10).fork()).ldelim(),null!=e.videoSubscriptionLimit&&Object.hasOwnProperty.call(e,"videoSubscriptionLimit")&&t.uint32(16).uint32(e.videoSubscriptionLimit),null!=e.wantsCompressedSdp&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&t.uint32(24).bool(e.wantsCompressedSdp),null!=e.defaultServerSideNetworkAdaption&&Object.hasOwnProperty.call(e,"defaultServerSideNetworkAdaption")&&t.uint32(32).int32(e.defaultServerSideNetworkAdaption),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkJoinAckFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.turnCredentials=$root.SdkTurnCredentials.decode(e,e.uint32());break;case 2:n.videoSubscriptionLimit=e.uint32();break;case 3:n.wantsCompressedSdp=e.bool();break;case 4:n.defaultServerSideNetworkAdaption=e.int32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.turnCredentials&&e.hasOwnProperty("turnCredentials")){var t=$root.SdkTurnCredentials.verify(e.turnCredentials);if(t)return"turnCredentials."+t}if(null!=e.videoSubscriptionLimit&&e.hasOwnProperty("videoSubscriptionLimit")&&!$util.isInteger(e.videoSubscriptionLimit))return"videoSubscriptionLimit: integer expected";if(null!=e.wantsCompressedSdp&&e.hasOwnProperty("wantsCompressedSdp")&&"boolean"!=typeof e.wantsCompressedSdp)return"wantsCompressedSdp: boolean expected";if(null!=e.defaultServerSideNetworkAdaption&&e.hasOwnProperty("defaultServerSideNetworkAdaption"))switch(e.defaultServerSideNetworkAdaption){default:return"defaultServerSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:}return null},e.fromObject=function(e){if(e instanceof $root.SdkJoinAckFrame)return e;var t=new $root.SdkJoinAckFrame;if(null!=e.turnCredentials){if("object"!=typeof e.turnCredentials)throw TypeError(".SdkJoinAckFrame.turnCredentials: object expected");t.turnCredentials=$root.SdkTurnCredentials.fromObject(e.turnCredentials)}switch(null!=e.videoSubscriptionLimit&&(t.videoSubscriptionLimit=e.videoSubscriptionLimit>>>0),null!=e.wantsCompressedSdp&&(t.wantsCompressedSdp=Boolean(e.wantsCompressedSdp)),e.defaultServerSideNetworkAdaption){case"DEFAULT":case 1:t.defaultServerSideNetworkAdaption=1;break;case"NONE":case 2:t.defaultServerSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:t.defaultServerSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:t.defaultServerSideNetworkAdaption=4}return t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.turnCredentials=null,i.videoSubscriptionLimit=0,i.wantsCompressedSdp=!1,i.defaultServerSideNetworkAdaption=t.enums===String?"DEFAULT":1),null!=e.turnCredentials&&e.hasOwnProperty("turnCredentials")&&(i.turnCredentials=$root.SdkTurnCredentials.toObject(e.turnCredentials,t)),null!=e.videoSubscriptionLimit&&e.hasOwnProperty("videoSubscriptionLimit")&&(i.videoSubscriptionLimit=e.videoSubscriptionLimit),null!=e.wantsCompressedSdp&&e.hasOwnProperty("wantsCompressedSdp")&&(i.wantsCompressedSdp=e.wantsCompressedSdp),null!=e.defaultServerSideNetworkAdaption&&e.hasOwnProperty("defaultServerSideNetworkAdaption")&&(i.defaultServerSideNetworkAdaption=t.enums===String?$root.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]:e.defaultServerSideNetworkAdaption),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkLeaveFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkLeaveFrame;e.pos<i;){var r=e.uint32();e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},e.fromObject=function(e){return e instanceof $root.SdkLeaveFrame?e:new $root.SdkLeaveFrame},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkLeaveAckFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkLeaveAckFrame;e.pos<i;){var r=e.uint32();e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},e.fromObject=function(e){return e instanceof $root.SdkLeaveAckFrame?e:new $root.SdkLeaveAckFrame},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkStreamServiceType=function(){var e={},t=Object.create(e);return t[e[1]="RX"]=1,t[e[2]="TX"]=2,t[e[3]="DUPLEX"]=3,t}(),$root.SdkStreamMediaType=function(){var e={},t=Object.create(e);return t[e[1]="AUDIO"]=1,t[e[2]="VIDEO"]=2,t}(),$root.SdkSubscribeFrame=function(){function e(e){if(this.sendStreams=[],this.receiveStreamIds=[],this.videoSubscriptionConfiguration=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.duplex=1,e.prototype.sendStreams=$util.emptyArray,e.prototype.receiveStreamIds=$util.emptyArray,e.prototype.sdpOffer="",e.prototype.audioHost="",e.prototype.audioCheckin=!1,e.prototype.audioMuted=!1,e.prototype.compressedSdpOffer=$util.newBuffer([]),e.prototype.videoSubscriptionConfiguration=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.duplex&&Object.hasOwnProperty.call(e,"duplex")&&t.uint32(8).int32(e.duplex),null!=e.sendStreams&&e.sendStreams.length)for(var i=0;i<e.sendStreams.length;++i)$root.SdkStreamDescriptor.encode(e.sendStreams[i],t.uint32(18).fork()).ldelim();if(null!=e.receiveStreamIds&&e.receiveStreamIds.length)for(i=0;i<e.receiveStreamIds.length;++i)t.uint32(24).uint32(e.receiveStreamIds[i]);if(null!=e.sdpOffer&&Object.hasOwnProperty.call(e,"sdpOffer")&&t.uint32(34).string(e.sdpOffer),null!=e.audioHost&&Object.hasOwnProperty.call(e,"audioHost")&&t.uint32(42).string(e.audioHost),null!=e.audioCheckin&&Object.hasOwnProperty.call(e,"audioCheckin")&&t.uint32(48).bool(e.audioCheckin),null!=e.audioMuted&&Object.hasOwnProperty.call(e,"audioMuted")&&t.uint32(56).bool(e.audioMuted),null!=e.compressedSdpOffer&&Object.hasOwnProperty.call(e,"compressedSdpOffer")&&t.uint32(66).bytes(e.compressedSdpOffer),null!=e.videoSubscriptionConfiguration&&e.videoSubscriptionConfiguration.length)for(i=0;i<e.videoSubscriptionConfiguration.length;++i)$root.SdkVideoSubscriptionConfiguration.encode(e.videoSubscriptionConfiguration[i],t.uint32(74).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkSubscribeFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.duplex=e.int32();break;case 2:n.sendStreams&&n.sendStreams.length||(n.sendStreams=[]),n.sendStreams.push($root.SdkStreamDescriptor.decode(e,e.uint32()));break;case 3:if(n.receiveStreamIds&&n.receiveStreamIds.length||(n.receiveStreamIds=[]),2==(7&r))for(var o=e.uint32()+e.pos;e.pos<o;)n.receiveStreamIds.push(e.uint32());else n.receiveStreamIds.push(e.uint32());break;case 4:n.sdpOffer=e.string();break;case 5:n.audioHost=e.string();break;case 6:n.audioCheckin=e.bool();break;case 7:n.audioMuted=e.bool();break;case 8:n.compressedSdpOffer=e.bytes();break;case 9:n.videoSubscriptionConfiguration&&n.videoSubscriptionConfiguration.length||(n.videoSubscriptionConfiguration=[]),n.videoSubscriptionConfiguration.push($root.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.duplex&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:}if(null!=e.sendStreams&&e.hasOwnProperty("sendStreams")){if(!Array.isArray(e.sendStreams))return"sendStreams: array expected";for(var t=0;t<e.sendStreams.length;++t){if(i=$root.SdkStreamDescriptor.verify(e.sendStreams[t]))return"sendStreams."+i}}if(null!=e.receiveStreamIds&&e.hasOwnProperty("receiveStreamIds")){if(!Array.isArray(e.receiveStreamIds))return"receiveStreamIds: array expected";for(t=0;t<e.receiveStreamIds.length;++t)if(!$util.isInteger(e.receiveStreamIds[t]))return"receiveStreamIds: integer[] expected"}if(null!=e.sdpOffer&&e.hasOwnProperty("sdpOffer")&&!$util.isString(e.sdpOffer))return"sdpOffer: string expected";if(null!=e.audioHost&&e.hasOwnProperty("audioHost")&&!$util.isString(e.audioHost))return"audioHost: string expected";if(null!=e.audioCheckin&&e.hasOwnProperty("audioCheckin")&&"boolean"!=typeof e.audioCheckin)return"audioCheckin: boolean expected";if(null!=e.audioMuted&&e.hasOwnProperty("audioMuted")&&"boolean"!=typeof e.audioMuted)return"audioMuted: boolean expected";if(null!=e.compressedSdpOffer&&e.hasOwnProperty("compressedSdpOffer")&&!(e.compressedSdpOffer&&"number"==typeof e.compressedSdpOffer.length||$util.isString(e.compressedSdpOffer)))return"compressedSdpOffer: buffer expected";if(null!=e.videoSubscriptionConfiguration&&e.hasOwnProperty("videoSubscriptionConfiguration")){if(!Array.isArray(e.videoSubscriptionConfiguration))return"videoSubscriptionConfiguration: array expected";for(t=0;t<e.videoSubscriptionConfiguration.length;++t){var i;if(i=$root.SdkVideoSubscriptionConfiguration.verify(e.videoSubscriptionConfiguration[t]))return"videoSubscriptionConfiguration."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkSubscribeFrame)return e;var t=new $root.SdkSubscribeFrame;switch(e.duplex){case"RX":case 1:t.duplex=1;break;case"TX":case 2:t.duplex=2;break;case"DUPLEX":case 3:t.duplex=3}if(e.sendStreams){if(!Array.isArray(e.sendStreams))throw TypeError(".SdkSubscribeFrame.sendStreams: array expected");t.sendStreams=[];for(var i=0;i<e.sendStreams.length;++i){if("object"!=typeof e.sendStreams[i])throw TypeError(".SdkSubscribeFrame.sendStreams: object expected");t.sendStreams[i]=$root.SdkStreamDescriptor.fromObject(e.sendStreams[i])}}if(e.receiveStreamIds){if(!Array.isArray(e.receiveStreamIds))throw TypeError(".SdkSubscribeFrame.receiveStreamIds: array expected");t.receiveStreamIds=[];for(i=0;i<e.receiveStreamIds.length;++i)t.receiveStreamIds[i]=e.receiveStreamIds[i]>>>0}if(null!=e.sdpOffer&&(t.sdpOffer=String(e.sdpOffer)),null!=e.audioHost&&(t.audioHost=String(e.audioHost)),null!=e.audioCheckin&&(t.audioCheckin=Boolean(e.audioCheckin)),null!=e.audioMuted&&(t.audioMuted=Boolean(e.audioMuted)),null!=e.compressedSdpOffer&&("string"==typeof e.compressedSdpOffer?$util.base64.decode(e.compressedSdpOffer,t.compressedSdpOffer=$util.newBuffer($util.base64.length(e.compressedSdpOffer)),0):e.compressedSdpOffer.length&&(t.compressedSdpOffer=e.compressedSdpOffer)),e.videoSubscriptionConfiguration){if(!Array.isArray(e.videoSubscriptionConfiguration))throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: array expected");t.videoSubscriptionConfiguration=[];for(i=0;i<e.videoSubscriptionConfiguration.length;++i){if("object"!=typeof e.videoSubscriptionConfiguration[i])throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: object expected");t.videoSubscriptionConfiguration[i]=$root.SdkVideoSubscriptionConfiguration.fromObject(e.videoSubscriptionConfiguration[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.sendStreams=[],i.receiveStreamIds=[],i.videoSubscriptionConfiguration=[]),t.defaults&&(i.duplex=t.enums===String?"RX":1,i.sdpOffer="",i.audioHost="",i.audioCheckin=!1,i.audioMuted=!1,t.bytes===String?i.compressedSdpOffer="":(i.compressedSdpOffer=[],t.bytes!==Array&&(i.compressedSdpOffer=$util.newBuffer(i.compressedSdpOffer)))),null!=e.duplex&&e.hasOwnProperty("duplex")&&(i.duplex=t.enums===String?$root.SdkStreamServiceType[e.duplex]:e.duplex),e.sendStreams&&e.sendStreams.length){i.sendStreams=[];for(var n=0;n<e.sendStreams.length;++n)i.sendStreams[n]=$root.SdkStreamDescriptor.toObject(e.sendStreams[n],t)}if(e.receiveStreamIds&&e.receiveStreamIds.length){i.receiveStreamIds=[];for(n=0;n<e.receiveStreamIds.length;++n)i.receiveStreamIds[n]=e.receiveStreamIds[n]}if(null!=e.sdpOffer&&e.hasOwnProperty("sdpOffer")&&(i.sdpOffer=e.sdpOffer),null!=e.audioHost&&e.hasOwnProperty("audioHost")&&(i.audioHost=e.audioHost),null!=e.audioCheckin&&e.hasOwnProperty("audioCheckin")&&(i.audioCheckin=e.audioCheckin),null!=e.audioMuted&&e.hasOwnProperty("audioMuted")&&(i.audioMuted=e.audioMuted),null!=e.compressedSdpOffer&&e.hasOwnProperty("compressedSdpOffer")&&(i.compressedSdpOffer=t.bytes===String?$util.base64.encode(e.compressedSdpOffer,0,e.compressedSdpOffer.length):t.bytes===Array?Array.prototype.slice.call(e.compressedSdpOffer):e.compressedSdpOffer),e.videoSubscriptionConfiguration&&e.videoSubscriptionConfiguration.length){i.videoSubscriptionConfiguration=[];for(n=0;n<e.videoSubscriptionConfiguration.length;++n)i.videoSubscriptionConfiguration[n]=$root.SdkVideoSubscriptionConfiguration.toObject(e.videoSubscriptionConfiguration[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkSubscribeAckFrame=function(){function e(e){if(this.allocations=[],this.tracks=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.duplex=1,e.prototype.allocations=$util.emptyArray,e.prototype.sdpAnswer="",e.prototype.tracks=$util.emptyArray,e.prototype.compressedSdpAnswer=$util.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.duplex&&Object.hasOwnProperty.call(e,"duplex")&&t.uint32(8).int32(e.duplex),null!=e.allocations&&e.allocations.length)for(var i=0;i<e.allocations.length;++i)$root.SdkStreamAllocation.encode(e.allocations[i],t.uint32(18).fork()).ldelim();if(null!=e.sdpAnswer&&Object.hasOwnProperty.call(e,"sdpAnswer")&&t.uint32(26).string(e.sdpAnswer),null!=e.tracks&&e.tracks.length)for(i=0;i<e.tracks.length;++i)$root.SdkTrackMapping.encode(e.tracks[i],t.uint32(34).fork()).ldelim();return null!=e.compressedSdpAnswer&&Object.hasOwnProperty.call(e,"compressedSdpAnswer")&&t.uint32(42).bytes(e.compressedSdpAnswer),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkSubscribeAckFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.duplex=e.int32();break;case 2:n.allocations&&n.allocations.length||(n.allocations=[]),n.allocations.push($root.SdkStreamAllocation.decode(e,e.uint32()));break;case 3:n.sdpAnswer=e.string();break;case 4:n.tracks&&n.tracks.length||(n.tracks=[]),n.tracks.push($root.SdkTrackMapping.decode(e,e.uint32()));break;case 5:n.compressedSdpAnswer=e.bytes();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.duplex&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:}if(null!=e.allocations&&e.hasOwnProperty("allocations")){if(!Array.isArray(e.allocations))return"allocations: array expected";for(var t=0;t<e.allocations.length;++t){if(i=$root.SdkStreamAllocation.verify(e.allocations[t]))return"allocations."+i}}if(null!=e.sdpAnswer&&e.hasOwnProperty("sdpAnswer")&&!$util.isString(e.sdpAnswer))return"sdpAnswer: string expected";if(null!=e.tracks&&e.hasOwnProperty("tracks")){if(!Array.isArray(e.tracks))return"tracks: array expected";for(t=0;t<e.tracks.length;++t){var i;if(i=$root.SdkTrackMapping.verify(e.tracks[t]))return"tracks."+i}}return null!=e.compressedSdpAnswer&&e.hasOwnProperty("compressedSdpAnswer")&&!(e.compressedSdpAnswer&&"number"==typeof e.compressedSdpAnswer.length||$util.isString(e.compressedSdpAnswer))?"compressedSdpAnswer: buffer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkSubscribeAckFrame)return e;var t=new $root.SdkSubscribeAckFrame;switch(e.duplex){case"RX":case 1:t.duplex=1;break;case"TX":case 2:t.duplex=2;break;case"DUPLEX":case 3:t.duplex=3}if(e.allocations){if(!Array.isArray(e.allocations))throw TypeError(".SdkSubscribeAckFrame.allocations: array expected");t.allocations=[];for(var i=0;i<e.allocations.length;++i){if("object"!=typeof e.allocations[i])throw TypeError(".SdkSubscribeAckFrame.allocations: object expected");t.allocations[i]=$root.SdkStreamAllocation.fromObject(e.allocations[i])}}if(null!=e.sdpAnswer&&(t.sdpAnswer=String(e.sdpAnswer)),e.tracks){if(!Array.isArray(e.tracks))throw TypeError(".SdkSubscribeAckFrame.tracks: array expected");t.tracks=[];for(i=0;i<e.tracks.length;++i){if("object"!=typeof e.tracks[i])throw TypeError(".SdkSubscribeAckFrame.tracks: object expected");t.tracks[i]=$root.SdkTrackMapping.fromObject(e.tracks[i])}}return null!=e.compressedSdpAnswer&&("string"==typeof e.compressedSdpAnswer?$util.base64.decode(e.compressedSdpAnswer,t.compressedSdpAnswer=$util.newBuffer($util.base64.length(e.compressedSdpAnswer)),0):e.compressedSdpAnswer.length&&(t.compressedSdpAnswer=e.compressedSdpAnswer)),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.allocations=[],i.tracks=[]),t.defaults&&(i.duplex=t.enums===String?"RX":1,i.sdpAnswer="",t.bytes===String?i.compressedSdpAnswer="":(i.compressedSdpAnswer=[],t.bytes!==Array&&(i.compressedSdpAnswer=$util.newBuffer(i.compressedSdpAnswer)))),null!=e.duplex&&e.hasOwnProperty("duplex")&&(i.duplex=t.enums===String?$root.SdkStreamServiceType[e.duplex]:e.duplex),e.allocations&&e.allocations.length){i.allocations=[];for(var n=0;n<e.allocations.length;++n)i.allocations[n]=$root.SdkStreamAllocation.toObject(e.allocations[n],t)}if(null!=e.sdpAnswer&&e.hasOwnProperty("sdpAnswer")&&(i.sdpAnswer=e.sdpAnswer),e.tracks&&e.tracks.length){i.tracks=[];for(n=0;n<e.tracks.length;++n)i.tracks[n]=$root.SdkTrackMapping.toObject(e.tracks[n],t)}return null!=e.compressedSdpAnswer&&e.hasOwnProperty("compressedSdpAnswer")&&(i.compressedSdpAnswer=t.bytes===String?$util.base64.encode(e.compressedSdpAnswer,0,e.compressedSdpAnswer.length):t.bytes===Array?Array.prototype.slice.call(e.compressedSdpAnswer):e.compressedSdpAnswer),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkIndexFrame=function(){function e(e){if(this.sources=[],this.pausedAtSourceIds=[],this.supportedReceiveCodecIntersection=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.atCapacity=!1,e.prototype.sources=$util.emptyArray,e.prototype.pausedAtSourceIds=$util.emptyArray,e.prototype.numParticipants=0,e.prototype.supportedReceiveCodecIntersection=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.atCapacity&&Object.hasOwnProperty.call(e,"atCapacity")&&t.uint32(8).bool(e.atCapacity),null!=e.sources&&e.sources.length)for(var i=0;i<e.sources.length;++i)$root.SdkStreamDescriptor.encode(e.sources[i],t.uint32(18).fork()).ldelim();if(null!=e.pausedAtSourceIds&&e.pausedAtSourceIds.length)for(i=0;i<e.pausedAtSourceIds.length;++i)t.uint32(24).uint32(e.pausedAtSourceIds[i]);if(null!=e.numParticipants&&Object.hasOwnProperty.call(e,"numParticipants")&&t.uint32(32).uint32(e.numParticipants),null!=e.supportedReceiveCodecIntersection&&e.supportedReceiveCodecIntersection.length)for(i=0;i<e.supportedReceiveCodecIntersection.length;++i)t.uint32(40).int32(e.supportedReceiveCodecIntersection[i]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkIndexFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.atCapacity=e.bool();break;case 2:n.sources&&n.sources.length||(n.sources=[]),n.sources.push($root.SdkStreamDescriptor.decode(e,e.uint32()));break;case 3:if(n.pausedAtSourceIds&&n.pausedAtSourceIds.length||(n.pausedAtSourceIds=[]),2==(7&r))for(var o=e.uint32()+e.pos;e.pos<o;)n.pausedAtSourceIds.push(e.uint32());else n.pausedAtSourceIds.push(e.uint32());break;case 4:n.numParticipants=e.uint32();break;case 5:if(n.supportedReceiveCodecIntersection&&n.supportedReceiveCodecIntersection.length||(n.supportedReceiveCodecIntersection=[]),2==(7&r))for(o=e.uint32()+e.pos;e.pos<o;)n.supportedReceiveCodecIntersection.push(e.int32());else n.supportedReceiveCodecIntersection.push(e.int32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.atCapacity&&e.hasOwnProperty("atCapacity")&&"boolean"!=typeof e.atCapacity)return"atCapacity: boolean expected";if(null!=e.sources&&e.hasOwnProperty("sources")){if(!Array.isArray(e.sources))return"sources: array expected";for(var t=0;t<e.sources.length;++t){var i=$root.SdkStreamDescriptor.verify(e.sources[t]);if(i)return"sources."+i}}if(null!=e.pausedAtSourceIds&&e.hasOwnProperty("pausedAtSourceIds")){if(!Array.isArray(e.pausedAtSourceIds))return"pausedAtSourceIds: array expected";for(t=0;t<e.pausedAtSourceIds.length;++t)if(!$util.isInteger(e.pausedAtSourceIds[t]))return"pausedAtSourceIds: integer[] expected"}if(null!=e.numParticipants&&e.hasOwnProperty("numParticipants")&&!$util.isInteger(e.numParticipants))return"numParticipants: integer expected";if(null!=e.supportedReceiveCodecIntersection&&e.hasOwnProperty("supportedReceiveCodecIntersection")){if(!Array.isArray(e.supportedReceiveCodecIntersection))return"supportedReceiveCodecIntersection: array expected";for(t=0;t<e.supportedReceiveCodecIntersection.length;++t)switch(e.supportedReceiveCodecIntersection[t]){default:return"supportedReceiveCodecIntersection: enum value[] expected";case 1:case 3:}}return null},e.fromObject=function(e){if(e instanceof $root.SdkIndexFrame)return e;var t=new $root.SdkIndexFrame;if(null!=e.atCapacity&&(t.atCapacity=Boolean(e.atCapacity)),e.sources){if(!Array.isArray(e.sources))throw TypeError(".SdkIndexFrame.sources: array expected");t.sources=[];for(var i=0;i<e.sources.length;++i){if("object"!=typeof e.sources[i])throw TypeError(".SdkIndexFrame.sources: object expected");t.sources[i]=$root.SdkStreamDescriptor.fromObject(e.sources[i])}}if(e.pausedAtSourceIds){if(!Array.isArray(e.pausedAtSourceIds))throw TypeError(".SdkIndexFrame.pausedAtSourceIds: array expected");t.pausedAtSourceIds=[];for(i=0;i<e.pausedAtSourceIds.length;++i)t.pausedAtSourceIds[i]=e.pausedAtSourceIds[i]>>>0}if(null!=e.numParticipants&&(t.numParticipants=e.numParticipants>>>0),e.supportedReceiveCodecIntersection){if(!Array.isArray(e.supportedReceiveCodecIntersection))throw TypeError(".SdkIndexFrame.supportedReceiveCodecIntersection: array expected");t.supportedReceiveCodecIntersection=[];for(i=0;i<e.supportedReceiveCodecIntersection.length;++i)switch(e.supportedReceiveCodecIntersection[i]){default:case"VP8":case 1:t.supportedReceiveCodecIntersection[i]=1;break;case"H264_CONSTRAINED_BASELINE_PROFILE":case 3:t.supportedReceiveCodecIntersection[i]=3;break;case"VP9_PROFILE_0":case 8:t.supportedReceiveCodecIntersection[i]=8;break;case"AV1_MAIN":case 11:t.supportedReceiveCodecIntersection[i]=11}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.sources=[],i.pausedAtSourceIds=[],i.supportedReceiveCodecIntersection=[]),t.defaults&&(i.atCapacity=!1,i.numParticipants=0),null!=e.atCapacity&&e.hasOwnProperty("atCapacity")&&(i.atCapacity=e.atCapacity),e.sources&&e.sources.length){i.sources=[];for(var n=0;n<e.sources.length;++n)i.sources[n]=$root.SdkStreamDescriptor.toObject(e.sources[n],t)}if(e.pausedAtSourceIds&&e.pausedAtSourceIds.length){i.pausedAtSourceIds=[];for(n=0;n<e.pausedAtSourceIds.length;++n)i.pausedAtSourceIds[n]=e.pausedAtSourceIds[n]}if(null!=e.numParticipants&&e.hasOwnProperty("numParticipants")&&(i.numParticipants=e.numParticipants),e.supportedReceiveCodecIntersection&&e.supportedReceiveCodecIntersection.length){i.supportedReceiveCodecIntersection=[];for(n=0;n<e.supportedReceiveCodecIntersection.length;++n)i.supportedReceiveCodecIntersection[n]=t.enums===String?$root.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[n]]:e.supportedReceiveCodecIntersection[n]}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkPauseResumeFrame=function(){function e(e){if(this.streamIds=[],this.groupIds=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.streamIds=$util.emptyArray,e.prototype.groupIds=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.streamIds&&e.streamIds.length)for(var i=0;i<e.streamIds.length;++i)t.uint32(8).uint32(e.streamIds[i]);if(null!=e.groupIds&&e.groupIds.length)for(i=0;i<e.groupIds.length;++i)t.uint32(16).uint32(e.groupIds[i]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkPauseResumeFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:if(n.streamIds&&n.streamIds.length||(n.streamIds=[]),2==(7&r))for(var o=e.uint32()+e.pos;e.pos<o;)n.streamIds.push(e.uint32());else n.streamIds.push(e.uint32());break;case 2:if(n.groupIds&&n.groupIds.length||(n.groupIds=[]),2==(7&r))for(o=e.uint32()+e.pos;e.pos<o;)n.groupIds.push(e.uint32());else n.groupIds.push(e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.streamIds&&e.hasOwnProperty("streamIds")){if(!Array.isArray(e.streamIds))return"streamIds: array expected";for(var t=0;t<e.streamIds.length;++t)if(!$util.isInteger(e.streamIds[t]))return"streamIds: integer[] expected"}if(null!=e.groupIds&&e.hasOwnProperty("groupIds")){if(!Array.isArray(e.groupIds))return"groupIds: array expected";for(t=0;t<e.groupIds.length;++t)if(!$util.isInteger(e.groupIds[t]))return"groupIds: integer[] expected"}return null},e.fromObject=function(e){if(e instanceof $root.SdkPauseResumeFrame)return e;var t=new $root.SdkPauseResumeFrame;if(e.streamIds){if(!Array.isArray(e.streamIds))throw TypeError(".SdkPauseResumeFrame.streamIds: array expected");t.streamIds=[];for(var i=0;i<e.streamIds.length;++i)t.streamIds[i]=e.streamIds[i]>>>0}if(e.groupIds){if(!Array.isArray(e.groupIds))throw TypeError(".SdkPauseResumeFrame.groupIds: array expected");t.groupIds=[];for(i=0;i<e.groupIds.length;++i)t.groupIds[i]=e.groupIds[i]>>>0}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.streamIds=[],i.groupIds=[]),e.streamIds&&e.streamIds.length){i.streamIds=[];for(var n=0;n<e.streamIds.length;++n)i.streamIds[n]=e.streamIds[n]}if(e.groupIds&&e.groupIds.length){i.groupIds=[];for(n=0;n<e.groupIds.length;++n)i.groupIds[n]=e.groupIds[n]}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkBitrateFrame=function(){function e(e){if(this.bitrates=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.bitrates=$util.emptyArray,e.prototype.serverAvailableOutgoingBitrate=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.bitrates&&e.bitrates.length)for(var i=0;i<e.bitrates.length;++i)$root.SdkBitrate.encode(e.bitrates[i],t.uint32(10).fork()).ldelim();return null!=e.serverAvailableOutgoingBitrate&&Object.hasOwnProperty.call(e,"serverAvailableOutgoingBitrate")&&t.uint32(16).uint32(e.serverAvailableOutgoingBitrate),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkBitrateFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.bitrates&&n.bitrates.length||(n.bitrates=[]),n.bitrates.push($root.SdkBitrate.decode(e,e.uint32()));break;case 2:n.serverAvailableOutgoingBitrate=e.uint32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.bitrates&&e.hasOwnProperty("bitrates")){if(!Array.isArray(e.bitrates))return"bitrates: array expected";for(var t=0;t<e.bitrates.length;++t){var i=$root.SdkBitrate.verify(e.bitrates[t]);if(i)return"bitrates."+i}}return null!=e.serverAvailableOutgoingBitrate&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&!$util.isInteger(e.serverAvailableOutgoingBitrate)?"serverAvailableOutgoingBitrate: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkBitrateFrame)return e;var t=new $root.SdkBitrateFrame;if(e.bitrates){if(!Array.isArray(e.bitrates))throw TypeError(".SdkBitrateFrame.bitrates: array expected");t.bitrates=[];for(var i=0;i<e.bitrates.length;++i){if("object"!=typeof e.bitrates[i])throw TypeError(".SdkBitrateFrame.bitrates: object expected");t.bitrates[i]=$root.SdkBitrate.fromObject(e.bitrates[i])}}return null!=e.serverAvailableOutgoingBitrate&&(t.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate>>>0),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.bitrates=[]),t.defaults&&(i.serverAvailableOutgoingBitrate=0),e.bitrates&&e.bitrates.length){i.bitrates=[];for(var n=0;n<e.bitrates.length;++n)i.bitrates[n]=$root.SdkBitrate.toObject(e.bitrates[n],t)}return null!=e.serverAvailableOutgoingBitrate&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&(i.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkStreamDescriptor=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.streamId=0,e.prototype.framerate=0,e.prototype.maxBitrateKbps=0,e.prototype.trackLabel="",e.prototype.groupId=0,e.prototype.avgBitrateBps=0,e.prototype.attendeeId="",e.prototype.mediaType=1,e.prototype.externalUserId="",e.prototype.width=0,e.prototype.height=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.streamId&&Object.hasOwnProperty.call(e,"streamId")&&t.uint32(8).uint32(e.streamId),null!=e.framerate&&Object.hasOwnProperty.call(e,"framerate")&&t.uint32(16).uint32(e.framerate),null!=e.maxBitrateKbps&&Object.hasOwnProperty.call(e,"maxBitrateKbps")&&t.uint32(24).uint32(e.maxBitrateKbps),null!=e.trackLabel&&Object.hasOwnProperty.call(e,"trackLabel")&&t.uint32(34).string(e.trackLabel),null!=e.groupId&&Object.hasOwnProperty.call(e,"groupId")&&t.uint32(48).uint32(e.groupId),null!=e.avgBitrateBps&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&t.uint32(56).uint32(e.avgBitrateBps),null!=e.attendeeId&&Object.hasOwnProperty.call(e,"attendeeId")&&t.uint32(66).string(e.attendeeId),null!=e.mediaType&&Object.hasOwnProperty.call(e,"mediaType")&&t.uint32(72).int32(e.mediaType),null!=e.externalUserId&&Object.hasOwnProperty.call(e,"externalUserId")&&t.uint32(82).string(e.externalUserId),null!=e.width&&Object.hasOwnProperty.call(e,"width")&&t.uint32(88).uint32(e.width),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&t.uint32(96).uint32(e.height),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkStreamDescriptor;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.streamId=e.uint32();break;case 2:n.framerate=e.uint32();break;case 3:n.maxBitrateKbps=e.uint32();break;case 4:n.trackLabel=e.string();break;case 6:n.groupId=e.uint32();break;case 7:n.avgBitrateBps=e.uint32();break;case 8:n.attendeeId=e.string();break;case 9:n.mediaType=e.int32();break;case 10:n.externalUserId=e.string();break;case 11:n.width=e.uint32();break;case 12:n.height=e.uint32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.streamId&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId))return"streamId: integer expected";if(null!=e.framerate&&e.hasOwnProperty("framerate")&&!$util.isInteger(e.framerate))return"framerate: integer expected";if(null!=e.maxBitrateKbps&&e.hasOwnProperty("maxBitrateKbps")&&!$util.isInteger(e.maxBitrateKbps))return"maxBitrateKbps: integer expected";if(null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel))return"trackLabel: string expected";if(null!=e.groupId&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId))return"groupId: integer expected";if(null!=e.avgBitrateBps&&e.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(e.avgBitrateBps))return"avgBitrateBps: integer expected";if(null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId))return"attendeeId: string expected";if(null!=e.mediaType&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:}return null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":null!=e.width&&e.hasOwnProperty("width")&&!$util.isInteger(e.width)?"width: integer expected":null!=e.height&&e.hasOwnProperty("height")&&!$util.isInteger(e.height)?"height: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkStreamDescriptor)return e;var t=new $root.SdkStreamDescriptor;switch(null!=e.streamId&&(t.streamId=e.streamId>>>0),null!=e.framerate&&(t.framerate=e.framerate>>>0),null!=e.maxBitrateKbps&&(t.maxBitrateKbps=e.maxBitrateKbps>>>0),null!=e.trackLabel&&(t.trackLabel=String(e.trackLabel)),null!=e.groupId&&(t.groupId=e.groupId>>>0),null!=e.avgBitrateBps&&(t.avgBitrateBps=e.avgBitrateBps>>>0),null!=e.attendeeId&&(t.attendeeId=String(e.attendeeId)),e.mediaType){case"AUDIO":case 1:t.mediaType=1;break;case"VIDEO":case 2:t.mediaType=2}return null!=e.externalUserId&&(t.externalUserId=String(e.externalUserId)),null!=e.width&&(t.width=e.width>>>0),null!=e.height&&(t.height=e.height>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.streamId=0,i.framerate=0,i.maxBitrateKbps=0,i.trackLabel="",i.groupId=0,i.avgBitrateBps=0,i.attendeeId="",i.mediaType=t.enums===String?"AUDIO":1,i.externalUserId="",i.width=0,i.height=0),null!=e.streamId&&e.hasOwnProperty("streamId")&&(i.streamId=e.streamId),null!=e.framerate&&e.hasOwnProperty("framerate")&&(i.framerate=e.framerate),null!=e.maxBitrateKbps&&e.hasOwnProperty("maxBitrateKbps")&&(i.maxBitrateKbps=e.maxBitrateKbps),null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&(i.trackLabel=e.trackLabel),null!=e.groupId&&e.hasOwnProperty("groupId")&&(i.groupId=e.groupId),null!=e.avgBitrateBps&&e.hasOwnProperty("avgBitrateBps")&&(i.avgBitrateBps=e.avgBitrateBps),null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&(i.attendeeId=e.attendeeId),null!=e.mediaType&&e.hasOwnProperty("mediaType")&&(i.mediaType=t.enums===String?$root.SdkStreamMediaType[e.mediaType]:e.mediaType),null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&(i.externalUserId=e.externalUserId),null!=e.width&&e.hasOwnProperty("width")&&(i.width=e.width),null!=e.height&&e.hasOwnProperty("height")&&(i.height=e.height),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkStreamAllocation=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.trackLabel="",e.prototype.streamId=0,e.prototype.groupId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.trackLabel&&Object.hasOwnProperty.call(e,"trackLabel")&&t.uint32(10).string(e.trackLabel),null!=e.streamId&&Object.hasOwnProperty.call(e,"streamId")&&t.uint32(16).uint32(e.streamId),null!=e.groupId&&Object.hasOwnProperty.call(e,"groupId")&&t.uint32(24).uint32(e.groupId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkStreamAllocation;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.trackLabel=e.string();break;case 2:n.streamId=e.uint32();break;case 3:n.groupId=e.uint32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel)?"trackLabel: string expected":null!=e.streamId&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId)?"streamId: integer expected":null!=e.groupId&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId)?"groupId: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkStreamAllocation)return e;var t=new $root.SdkStreamAllocation;return null!=e.trackLabel&&(t.trackLabel=String(e.trackLabel)),null!=e.streamId&&(t.streamId=e.streamId>>>0),null!=e.groupId&&(t.groupId=e.groupId>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.trackLabel="",i.streamId=0,i.groupId=0),null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&(i.trackLabel=e.trackLabel),null!=e.streamId&&e.hasOwnProperty("streamId")&&(i.streamId=e.streamId),null!=e.groupId&&e.hasOwnProperty("groupId")&&(i.groupId=e.groupId),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTrackMapping=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.streamId=0,e.prototype.ssrc=0,e.prototype.trackLabel="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.streamId&&Object.hasOwnProperty.call(e,"streamId")&&t.uint32(8).uint32(e.streamId),null!=e.ssrc&&Object.hasOwnProperty.call(e,"ssrc")&&t.uint32(16).uint32(e.ssrc),null!=e.trackLabel&&Object.hasOwnProperty.call(e,"trackLabel")&&t.uint32(26).string(e.trackLabel),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTrackMapping;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.streamId=e.uint32();break;case 2:n.ssrc=e.uint32();break;case 3:n.trackLabel=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.streamId&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId)?"streamId: integer expected":null!=e.ssrc&&e.hasOwnProperty("ssrc")&&!$util.isInteger(e.ssrc)?"ssrc: integer expected":null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel)?"trackLabel: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkTrackMapping)return e;var t=new $root.SdkTrackMapping;return null!=e.streamId&&(t.streamId=e.streamId>>>0),null!=e.ssrc&&(t.ssrc=e.ssrc>>>0),null!=e.trackLabel&&(t.trackLabel=String(e.trackLabel)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.streamId=0,i.ssrc=0,i.trackLabel=""),null!=e.streamId&&e.hasOwnProperty("streamId")&&(i.streamId=e.streamId),null!=e.ssrc&&e.hasOwnProperty("ssrc")&&(i.ssrc=e.ssrc),null!=e.trackLabel&&e.hasOwnProperty("trackLabel")&&(i.trackLabel=e.trackLabel),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkBitrate=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.sourceStreamId=0,e.prototype.avgBitrateBps=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.sourceStreamId&&Object.hasOwnProperty.call(e,"sourceStreamId")&&t.uint32(8).uint32(e.sourceStreamId),null!=e.avgBitrateBps&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&t.uint32(16).uint32(e.avgBitrateBps),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkBitrate;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.sourceStreamId=e.uint32();break;case 2:n.avgBitrateBps=e.uint32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sourceStreamId&&e.hasOwnProperty("sourceStreamId")&&!$util.isInteger(e.sourceStreamId)?"sourceStreamId: integer expected":null!=e.avgBitrateBps&&e.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(e.avgBitrateBps)?"avgBitrateBps: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkBitrate)return e;var t=new $root.SdkBitrate;return null!=e.sourceStreamId&&(t.sourceStreamId=e.sourceStreamId>>>0),null!=e.avgBitrateBps&&(t.avgBitrateBps=e.avgBitrateBps>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.sourceStreamId=0,i.avgBitrateBps=0),null!=e.sourceStreamId&&e.hasOwnProperty("sourceStreamId")&&(i.sourceStreamId=e.sourceStreamId),null!=e.avgBitrateBps&&e.hasOwnProperty("avgBitrateBps")&&(i.avgBitrateBps=e.avgBitrateBps),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioControlFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.muted=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.muted&&Object.hasOwnProperty.call(e,"muted")&&t.uint32(8).bool(e.muted),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioControlFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.muted=e.bool();else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.muted&&e.hasOwnProperty("muted")&&"boolean"!=typeof e.muted?"muted: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.SdkAudioControlFrame)return e;var t=new $root.SdkAudioControlFrame;return null!=e.muted&&(t.muted=Boolean(e.muted)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.muted=!1),null!=e.muted&&e.hasOwnProperty("muted")&&(i.muted=e.muted),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioMetadataFrame=function(){function e(e){if(this.attendeeStates=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.attendeeStates=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.attendeeStates&&e.attendeeStates.length)for(var i=0;i<e.attendeeStates.length;++i)$root.SdkAudioAttendeeState.encode(e.attendeeStates[i],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioMetadataFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.attendeeStates&&n.attendeeStates.length||(n.attendeeStates=[]),n.attendeeStates.push($root.SdkAudioAttendeeState.decode(e,e.uint32()));else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.attendeeStates&&e.hasOwnProperty("attendeeStates")){if(!Array.isArray(e.attendeeStates))return"attendeeStates: array expected";for(var t=0;t<e.attendeeStates.length;++t){var i=$root.SdkAudioAttendeeState.verify(e.attendeeStates[t]);if(i)return"attendeeStates."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkAudioMetadataFrame)return e;var t=new $root.SdkAudioMetadataFrame;if(e.attendeeStates){if(!Array.isArray(e.attendeeStates))throw TypeError(".SdkAudioMetadataFrame.attendeeStates: array expected");t.attendeeStates=[];for(var i=0;i<e.attendeeStates.length;++i){if("object"!=typeof e.attendeeStates[i])throw TypeError(".SdkAudioMetadataFrame.attendeeStates: object expected");t.attendeeStates[i]=$root.SdkAudioAttendeeState.fromObject(e.attendeeStates[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.attendeeStates=[]),e.attendeeStates&&e.attendeeStates.length){i.attendeeStates=[];for(var n=0;n<e.attendeeStates.length;++n)i.attendeeStates[n]=$root.SdkAudioAttendeeState.toObject(e.attendeeStates[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioAttendeeState=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.audioStreamId=0,e.prototype.volume=0,e.prototype.muted=!1,e.prototype.signalStrength=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.audioStreamId&&Object.hasOwnProperty.call(e,"audioStreamId")&&t.uint32(8).uint32(e.audioStreamId),null!=e.volume&&Object.hasOwnProperty.call(e,"volume")&&t.uint32(16).uint32(e.volume),null!=e.muted&&Object.hasOwnProperty.call(e,"muted")&&t.uint32(24).bool(e.muted),null!=e.signalStrength&&Object.hasOwnProperty.call(e,"signalStrength")&&t.uint32(32).uint32(e.signalStrength),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioAttendeeState;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.audioStreamId=e.uint32();break;case 2:n.volume=e.uint32();break;case 3:n.muted=e.bool();break;case 4:n.signalStrength=e.uint32();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.audioStreamId&&e.hasOwnProperty("audioStreamId")&&!$util.isInteger(e.audioStreamId)?"audioStreamId: integer expected":null!=e.volume&&e.hasOwnProperty("volume")&&!$util.isInteger(e.volume)?"volume: integer expected":null!=e.muted&&e.hasOwnProperty("muted")&&"boolean"!=typeof e.muted?"muted: boolean expected":null!=e.signalStrength&&e.hasOwnProperty("signalStrength")&&!$util.isInteger(e.signalStrength)?"signalStrength: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkAudioAttendeeState)return e;var t=new $root.SdkAudioAttendeeState;return null!=e.audioStreamId&&(t.audioStreamId=e.audioStreamId>>>0),null!=e.volume&&(t.volume=e.volume>>>0),null!=e.muted&&(t.muted=Boolean(e.muted)),null!=e.signalStrength&&(t.signalStrength=e.signalStrength>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.audioStreamId=0,i.volume=0,i.muted=!1,i.signalStrength=0),null!=e.audioStreamId&&e.hasOwnProperty("audioStreamId")&&(i.audioStreamId=e.audioStreamId),null!=e.volume&&e.hasOwnProperty("volume")&&(i.volume=e.volume),null!=e.muted&&e.hasOwnProperty("muted")&&(i.muted=e.muted),null!=e.signalStrength&&e.hasOwnProperty("signalStrength")&&(i.signalStrength=e.signalStrength),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioStreamIdInfoFrame=function(){function e(e){if(this.streams=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.streams=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.streams&&e.streams.length)for(var i=0;i<e.streams.length;++i)$root.SdkAudioStreamIdInfo.encode(e.streams[i],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioStreamIdInfoFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.streams&&n.streams.length||(n.streams=[]),n.streams.push($root.SdkAudioStreamIdInfo.decode(e,e.uint32()));else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.streams&&e.hasOwnProperty("streams")){if(!Array.isArray(e.streams))return"streams: array expected";for(var t=0;t<e.streams.length;++t){var i=$root.SdkAudioStreamIdInfo.verify(e.streams[t]);if(i)return"streams."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkAudioStreamIdInfoFrame)return e;var t=new $root.SdkAudioStreamIdInfoFrame;if(e.streams){if(!Array.isArray(e.streams))throw TypeError(".SdkAudioStreamIdInfoFrame.streams: array expected");t.streams=[];for(var i=0;i<e.streams.length;++i){if("object"!=typeof e.streams[i])throw TypeError(".SdkAudioStreamIdInfoFrame.streams: object expected");t.streams[i]=$root.SdkAudioStreamIdInfo.fromObject(e.streams[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.streams=[]),e.streams&&e.streams.length){i.streams=[];for(var n=0;n<e.streams.length;++n)i.streams[n]=$root.SdkAudioStreamIdInfo.toObject(e.streams[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioStreamIdInfo=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.audioStreamId=0,e.prototype.attendeeId="",e.prototype.muted=!1,e.prototype.externalUserId="",e.prototype.dropped=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.audioStreamId&&Object.hasOwnProperty.call(e,"audioStreamId")&&t.uint32(8).uint32(e.audioStreamId),null!=e.attendeeId&&Object.hasOwnProperty.call(e,"attendeeId")&&t.uint32(18).string(e.attendeeId),null!=e.muted&&Object.hasOwnProperty.call(e,"muted")&&t.uint32(24).bool(e.muted),null!=e.externalUserId&&Object.hasOwnProperty.call(e,"externalUserId")&&t.uint32(34).string(e.externalUserId),null!=e.dropped&&Object.hasOwnProperty.call(e,"dropped")&&t.uint32(40).bool(e.dropped),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioStreamIdInfo;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.audioStreamId=e.uint32();break;case 2:n.attendeeId=e.string();break;case 3:n.muted=e.bool();break;case 4:n.externalUserId=e.string();break;case 5:n.dropped=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.audioStreamId&&e.hasOwnProperty("audioStreamId")&&!$util.isInteger(e.audioStreamId)?"audioStreamId: integer expected":null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId)?"attendeeId: string expected":null!=e.muted&&e.hasOwnProperty("muted")&&"boolean"!=typeof e.muted?"muted: boolean expected":null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":null!=e.dropped&&e.hasOwnProperty("dropped")&&"boolean"!=typeof e.dropped?"dropped: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.SdkAudioStreamIdInfo)return e;var t=new $root.SdkAudioStreamIdInfo;return null!=e.audioStreamId&&(t.audioStreamId=e.audioStreamId>>>0),null!=e.attendeeId&&(t.attendeeId=String(e.attendeeId)),null!=e.muted&&(t.muted=Boolean(e.muted)),null!=e.externalUserId&&(t.externalUserId=String(e.externalUserId)),null!=e.dropped&&(t.dropped=Boolean(e.dropped)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.audioStreamId=0,i.attendeeId="",i.muted=!1,i.externalUserId="",i.dropped=!1),null!=e.audioStreamId&&e.hasOwnProperty("audioStreamId")&&(i.audioStreamId=e.audioStreamId),null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&(i.attendeeId=e.attendeeId),null!=e.muted&&e.hasOwnProperty("muted")&&(i.muted=e.muted),null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&(i.externalUserId=e.externalUserId),null!=e.dropped&&e.hasOwnProperty("dropped")&&(i.dropped=e.dropped),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkPingPongType=function(){var e={},t=Object.create(e);return t[e[1]="PING"]=1,t[e[2]="PONG"]=2,t}(),$root.SdkPingPongFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.type=1,e.prototype.pingId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t.uint32(8).int32(e.type),t.uint32(16).uint32(e.pingId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkPingPongFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.type=e.int32();break;case 2:n.pingId=e.uint32();break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:n});if(!n.hasOwnProperty("pingId"))throw $util.ProtocolError("missing required 'pingId'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:}return $util.isInteger(e.pingId)?null:"pingId: integer expected"},e.fromObject=function(e){if(e instanceof $root.SdkPingPongFrame)return e;var t=new $root.SdkPingPongFrame;switch(e.type){case"PING":case 1:t.type=1;break;case"PONG":case 2:t.type=2}return null!=e.pingId&&(t.pingId=e.pingId>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=t.enums===String?"PING":1,i.pingId=0),null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkPingPongType[e.type]:e.type),null!=e.pingId&&e.hasOwnProperty("pingId")&&(i.pingId=e.pingId),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkAudioStatusFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.audioStatus=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.audioStatus&&Object.hasOwnProperty.call(e,"audioStatus")&&t.uint32(8).uint32(e.audioStatus),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkAudioStatusFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.audioStatus=e.uint32();else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.audioStatus&&e.hasOwnProperty("audioStatus")&&!$util.isInteger(e.audioStatus)?"audioStatus: integer expected":null},e.fromObject=function(e){if(e instanceof $root.SdkAudioStatusFrame)return e;var t=new $root.SdkAudioStatusFrame;return null!=e.audioStatus&&(t.audioStatus=e.audioStatus>>>0),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.audioStatus=0),null!=e.audioStatus&&e.hasOwnProperty("audioStatus")&&(i.audioStatus=e.audioStatus),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkMetric=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.type=1,e.prototype.value=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(8).int32(e.type),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(17).double(e.value),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkMetric;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.type=e.int32();break;case 2:n.value=e.double();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.type&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 64:case 66:case 69:case 72:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:}return null!=e.value&&e.hasOwnProperty("value")&&"number"!=typeof e.value?"value: number expected":null},e.fromObject=function(e){if(e instanceof $root.SdkMetric)return e;var t=new $root.SdkMetric;switch(e.type){case"VIDEO_ACTUAL_ENCODER_BITRATE":case 1:t.type=1;break;case"VIDEO_AVAILABLE_SEND_BANDWIDTH":case 2:t.type=2;break;case"VIDEO_RETRANSMIT_BITRATE":case 3:t.type=3;break;case"VIDEO_AVAILABLE_RECEIVE_BANDWIDTH":case 4:t.type=4;break;case"VIDEO_TARGET_ENCODER_BITRATE":case 5:t.type=5;break;case"VIDEO_BUCKET_DELAY_MS":case 6:t.type=6;break;case"STUN_RTT_MS":case 7:t.type=7;break;case"SOCKET_DISCARDED_PPS":case 8:t.type=8;break;case"RTC_MIC_JITTER_MS":case 9:t.type=9;break;case"RTC_MIC_PPS":case 10:t.type=10;break;case"RTC_MIC_FRACTION_PACKET_LOST_PERCENT":case 11:t.type=11;break;case"RTC_MIC_BITRATE":case 12:t.type=12;break;case"RTC_MIC_RTT_MS":case 13:t.type=13;break;case"RTC_SPK_PPS":case 14:t.type=14;break;case"RTC_SPK_FRACTION_PACKET_LOST_PERCENT":case 15:t.type=15;break;case"RTC_SPK_JITTER_MS":case 16:t.type=16;break;case"RTC_SPK_FRACTION_DECODER_LOSS_PERCENT":case 17:t.type=17;break;case"RTC_SPK_BITRATE":case 18:t.type=18;break;case"RTC_SPK_CURRENT_DELAY_MS":case 19:t.type=19;break;case"RTC_SPK_JITTER_BUFFER_MS":case 20:t.type=20;break;case"VIDEO_SENT_RTT_MS":case 21:t.type=21;break;case"VIDEO_ENCODE_USAGE_PERCENT":case 22:t.type=22;break;case"VIDEO_NACKS_RECEIVED":case 23:t.type=23;break;case"VIDEO_PLIS_RECEIVED":case 24:t.type=24;break;case"VIDEO_ENCODE_MS":case 25:t.type=25;break;case"VIDEO_INPUT_FPS":case 26:t.type=26;break;case"VIDEO_ENCODE_FPS":case 27:t.type=27;break;case"VIDEO_SENT_FPS":case 28:t.type=28;break;case"VIDEO_FIRS_RECEIVED":case 29:t.type=29;break;case"VIDEO_SENT_PPS":case 30:t.type=30;break;case"VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT":case 31:t.type=31;break;case"VIDEO_SENT_BITRATE":case 32:t.type=32;break;case"VIDEO_DROPPED_FPS":case 33:t.type=33;break;case"VIDEO_TARGET_DELAY_MS":case 34:t.type=34;break;case"VIDEO_DECODE_MS":case 35:t.type=35;break;case"VIDEO_OUTPUT_FPS":case 36:t.type=36;break;case"VIDEO_RECEIVED_PPS":case 37:t.type=37;break;case"VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT":case 38:t.type=38;break;case"VIDEO_RENDER_DELAY_MS":case 39:t.type=39;break;case"VIDEO_RECEIVED_FPS":case 40:t.type=40;break;case"VIDEO_DECODE_FPS":case 41:t.type=41;break;case"VIDEO_NACKS_SENT":case 42:t.type=42;break;case"VIDEO_FIRS_SENT":case 43:t.type=43;break;case"VIDEO_RECEIVED_BITRATE":case 44:t.type=44;break;case"VIDEO_CURRENT_DELAY_MS":case 45:t.type=45;break;case"VIDEO_JITTER_BUFFER_MS":case 46:t.type=46;break;case"VIDEO_DISCARDED_PPS":case 47:t.type=47;break;case"VIDEO_PLIS_SENT":case 48:t.type=48;break;case"VIDEO_RECEIVED_JITTER_MS":case 49:t.type=49;break;case"VIDEO_ENCODE_HEIGHT":case 64:t.type=64;break;case"VIDEO_SENT_QP_SUM":case 66:t.type=66;break;case"VIDEO_DECODE_HEIGHT":case 69:t.type=69;break;case"VIDEO_RECEIVED_QP_SUM":case 72:t.type=72;break;case"VIDEO_ENCODE_WIDTH":case 86:t.type=86;break;case"VIDEO_DECODE_WIDTH":case 87:t.type=87;break;case"VIDEO_ENCODER_IS_HARDWARE":case 88:t.type=88;break;case"VIDEO_DECODER_IS_HARDWARE":case 89:t.type=89;break;case"VIDEO_FREEZE_DURATION":case 91:t.type=91;break;case"VIDEO_PAUSE_COUNT":case 92:t.type=92;break;case"VIDEO_PAUSE_DURATION":case 93:t.type=93;break;case"VIDEO_QUALITY_REASON":case 94:t.type=94;break;case"VIDEO_PROCESSING_TIME":case 95:t.type=95;break;case"RTC_SPK_AUDIO_LEVEL":case 96:t.type=96;break;case"RTC_MIC_AUDIO_LEVEL":case 97:t.type=97;case"RTC_SPK_TOTAL_LOST":case 98:t.type=98;break;case"RTC_SPK_TOTAL_EXPECTED":case 99:t.type=99;break;case"RTC_SPK_TOTAL_RECOVERED_RED":case 100:t.type=100;break;case"RTC_SPK_TOTAL_RECOVERED_FEC":case 101:t.type=101;break;case"RTC_SPK_TOTAL_LOST":case 98:t.type=98;break;case"RTC_SPK_TOTAL_EXPECTED":case 99:t.type=99;break;case"RTC_SPK_TOTAL_RECOVERED_RED":case 100:t.type=100;break;case"RTC_SPK_TOTAL_RECOVERED_FEC":case 101:t.type=101;break;case"VIDEO_QUALITY_LIMITATION_DURATION_CPU":case 102:t.type=102}return null!=e.value&&(t.value=Number(e.value)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=t.enums===String?"VIDEO_ACTUAL_ENCODER_BITRATE":1,i.value=0),null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkMetric.Type[e.type]:e.type),null!=e.value&&e.hasOwnProperty("value")&&(i.value=t.json&&!isFinite(e.value)?String(e.value):e.value),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.Type=function(){var e={},t=Object.create(e);return t[e[1]="VIDEO_ACTUAL_ENCODER_BITRATE"]=1,t[e[2]="VIDEO_AVAILABLE_SEND_BANDWIDTH"]=2,t[e[3]="VIDEO_RETRANSMIT_BITRATE"]=3,t[e[4]="VIDEO_AVAILABLE_RECEIVE_BANDWIDTH"]=4,t[e[5]="VIDEO_TARGET_ENCODER_BITRATE"]=5,t[e[6]="VIDEO_BUCKET_DELAY_MS"]=6,t[e[7]="STUN_RTT_MS"]=7,t[e[8]="SOCKET_DISCARDED_PPS"]=8,t[e[9]="RTC_MIC_JITTER_MS"]=9,t[e[10]="RTC_MIC_PPS"]=10,t[e[11]="RTC_MIC_FRACTION_PACKET_LOST_PERCENT"]=11,t[e[12]="RTC_MIC_BITRATE"]=12,t[e[13]="RTC_MIC_RTT_MS"]=13,t[e[14]="RTC_SPK_PPS"]=14,t[e[15]="RTC_SPK_FRACTION_PACKET_LOST_PERCENT"]=15,t[e[16]="RTC_SPK_JITTER_MS"]=16,t[e[17]="RTC_SPK_FRACTION_DECODER_LOSS_PERCENT"]=17,t[e[18]="RTC_SPK_BITRATE"]=18,t[e[19]="RTC_SPK_CURRENT_DELAY_MS"]=19,t[e[20]="RTC_SPK_JITTER_BUFFER_MS"]=20,t[e[21]="VIDEO_SENT_RTT_MS"]=21,t[e[22]="VIDEO_ENCODE_USAGE_PERCENT"]=22,t[e[23]="VIDEO_NACKS_RECEIVED"]=23,t[e[24]="VIDEO_PLIS_RECEIVED"]=24,t[e[25]="VIDEO_ENCODE_MS"]=25,t[e[26]="VIDEO_INPUT_FPS"]=26,t[e[27]="VIDEO_ENCODE_FPS"]=27,t[e[28]="VIDEO_SENT_FPS"]=28,t[e[29]="VIDEO_FIRS_RECEIVED"]=29,t[e[30]="VIDEO_SENT_PPS"]=30,t[e[31]="VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT"]=31,t[e[32]="VIDEO_SENT_BITRATE"]=32,t[e[33]="VIDEO_DROPPED_FPS"]=33,t[e[34]="VIDEO_TARGET_DELAY_MS"]=34,t[e[35]="VIDEO_DECODE_MS"]=35,t[e[36]="VIDEO_OUTPUT_FPS"]=36,t[e[37]="VIDEO_RECEIVED_PPS"]=37,t[e[38]="VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT"]=38,t[e[39]="VIDEO_RENDER_DELAY_MS"]=39,t[e[40]="VIDEO_RECEIVED_FPS"]=40,t[e[41]="VIDEO_DECODE_FPS"]=41,t[e[42]="VIDEO_NACKS_SENT"]=42,t[e[43]="VIDEO_FIRS_SENT"]=43,t[e[44]="VIDEO_RECEIVED_BITRATE"]=44,t[e[45]="VIDEO_CURRENT_DELAY_MS"]=45,t[e[46]="VIDEO_JITTER_BUFFER_MS"]=46,t[e[47]="VIDEO_DISCARDED_PPS"]=47,t[e[48]="VIDEO_PLIS_SENT"]=48,t[e[49]="VIDEO_RECEIVED_JITTER_MS"]=49,t[e[64]="VIDEO_ENCODE_HEIGHT"]=64,t[e[66]="VIDEO_SENT_QP_SUM"]=66,t[e[69]="VIDEO_DECODE_HEIGHT"]=69,t[e[72]="VIDEO_RECEIVED_QP_SUM"]=72,t[e[86]="VIDEO_ENCODE_WIDTH"]=86,t[e[87]="VIDEO_DECODE_WIDTH"]=87,t[e[88]="VIDEO_ENCODER_IS_HARDWARE"]=88,t[e[89]="VIDEO_DECODER_IS_HARDWARE"]=89,t[e[90]="VIDEO_FREEZE_COUNT"]=90,t[e[91]="VIDEO_FREEZE_DURATION"]=91,t[e[92]="VIDEO_PAUSE_COUNT"]=92,t[e[93]="VIDEO_PAUSE_DURATION"]=93,t[e[94]="VIDEO_QUALITY_REASON"]=94,t[e[95]="VIDEO_PROCESSING_TIME"]=95,t[e[96]="RTC_SPK_AUDIO_LEVEL"]=96,t[e[97]="RTC_MIC_AUDIO_LEVEL"]=97,t[e[98]="RTC_SPK_TOTAL_LOST"]=98,t[e[99]="RTC_SPK_TOTAL_EXPECTED"]=99,t[e[100]="RTC_SPK_TOTAL_RECOVERED_RED"]=100,t[e[101]="RTC_SPK_TOTAL_RECOVERED_FEC"]=101,t[e[102]="VIDEO_QUALITY_LIMITATION_DURATION_CPU"]=102,t}(),e}(),$root.SdkStreamMetricFrame=function(){function e(e){if(this.metrics=[],this.dimensions=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.streamId=0,e.prototype.groupId=0,e.prototype.metrics=$util.emptyArray,e.prototype.dimensions=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.streamId&&Object.hasOwnProperty.call(e,"streamId")&&t.uint32(24).uint32(e.streamId),null!=e.groupId&&Object.hasOwnProperty.call(e,"groupId")&&t.uint32(32).uint32(e.groupId),null!=e.metrics&&e.metrics.length)for(var i=0;i<e.metrics.length;++i)$root.SdkMetric.encode(e.metrics[i],t.uint32(42).fork()).ldelim();if(null!=e.dimensions&&e.dimensions.length)for(i=0;i<e.dimensions.length;++i)$root.SdkStreamDimension.encode(e.dimensions[i],t.uint32(50).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkStreamMetricFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 3:n.streamId=e.uint32();break;case 4:n.groupId=e.uint32();break;case 5:n.metrics&&n.metrics.length||(n.metrics=[]),n.metrics.push($root.SdkMetric.decode(e,e.uint32()));break;case 6:n.dimensions&&n.dimensions.length||(n.dimensions=[]),n.dimensions.push($root.SdkStreamDimension.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.streamId&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId))return"streamId: integer expected";if(null!=e.groupId&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId))return"groupId: integer expected";if(null!=e.metrics&&e.hasOwnProperty("metrics")){if(!Array.isArray(e.metrics))return"metrics: array expected";for(var t=0;t<e.metrics.length;++t){if(i=$root.SdkMetric.verify(e.metrics[t]))return"metrics."+i}}if(null!=e.dimensions&&e.hasOwnProperty("dimensions")){if(!Array.isArray(e.dimensions))return"dimensions: array expected";for(t=0;t<e.dimensions.length;++t){var i;if(i=$root.SdkStreamDimension.verify(e.dimensions[t]))return"dimensions."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkStreamMetricFrame)return e;var t=new $root.SdkStreamMetricFrame;if(null!=e.streamId&&(t.streamId=e.streamId>>>0),null!=e.groupId&&(t.groupId=e.groupId>>>0),e.metrics){if(!Array.isArray(e.metrics))throw TypeError(".SdkStreamMetricFrame.metrics: array expected");t.metrics=[];for(var i=0;i<e.metrics.length;++i){if("object"!=typeof e.metrics[i])throw TypeError(".SdkStreamMetricFrame.metrics: object expected");t.metrics[i]=$root.SdkMetric.fromObject(e.metrics[i])}}if(e.dimensions){if(!Array.isArray(e.dimensions))throw TypeError(".SdkStreamMetricFrame.dimensions: array expected");t.dimensions=[];for(i=0;i<e.dimensions.length;++i){if("object"!=typeof e.dimensions[i])throw TypeError(".SdkStreamMetricFrame.dimensions: object expected");t.dimensions[i]=$root.SdkStreamDimension.fromObject(e.dimensions[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.metrics=[],i.dimensions=[]),t.defaults&&(i.streamId=0,i.groupId=0),null!=e.streamId&&e.hasOwnProperty("streamId")&&(i.streamId=e.streamId),null!=e.groupId&&e.hasOwnProperty("groupId")&&(i.groupId=e.groupId),e.metrics&&e.metrics.length){i.metrics=[];for(var n=0;n<e.metrics.length;++n)i.metrics[n]=$root.SdkMetric.toObject(e.metrics[n],t)}if(e.dimensions&&e.dimensions.length){i.dimensions=[];for(n=0;n<e.dimensions.length;++n)i.dimensions[n]=$root.SdkStreamDimension.toObject(e.dimensions[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkClientMetricFrame=function(){function e(e){if(this.globalMetrics=[],this.streamMetricFrames=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.globalMetrics=$util.emptyArray,e.prototype.streamMetricFrames=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.globalMetrics&&e.globalMetrics.length)for(var i=0;i<e.globalMetrics.length;++i)$root.SdkMetric.encode(e.globalMetrics[i],t.uint32(10).fork()).ldelim();if(null!=e.streamMetricFrames&&e.streamMetricFrames.length)for(i=0;i<e.streamMetricFrames.length;++i)$root.SdkStreamMetricFrame.encode(e.streamMetricFrames[i],t.uint32(18).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkClientMetricFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.globalMetrics&&n.globalMetrics.length||(n.globalMetrics=[]),n.globalMetrics.push($root.SdkMetric.decode(e,e.uint32()));break;case 2:n.streamMetricFrames&&n.streamMetricFrames.length||(n.streamMetricFrames=[]),n.streamMetricFrames.push($root.SdkStreamMetricFrame.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.globalMetrics&&e.hasOwnProperty("globalMetrics")){if(!Array.isArray(e.globalMetrics))return"globalMetrics: array expected";for(var t=0;t<e.globalMetrics.length;++t){if(i=$root.SdkMetric.verify(e.globalMetrics[t]))return"globalMetrics."+i}}if(null!=e.streamMetricFrames&&e.hasOwnProperty("streamMetricFrames")){if(!Array.isArray(e.streamMetricFrames))return"streamMetricFrames: array expected";for(t=0;t<e.streamMetricFrames.length;++t){var i;if(i=$root.SdkStreamMetricFrame.verify(e.streamMetricFrames[t]))return"streamMetricFrames."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkClientMetricFrame)return e;var t=new $root.SdkClientMetricFrame;if(e.globalMetrics){if(!Array.isArray(e.globalMetrics))throw TypeError(".SdkClientMetricFrame.globalMetrics: array expected");t.globalMetrics=[];for(var i=0;i<e.globalMetrics.length;++i){if("object"!=typeof e.globalMetrics[i])throw TypeError(".SdkClientMetricFrame.globalMetrics: object expected");t.globalMetrics[i]=$root.SdkMetric.fromObject(e.globalMetrics[i])}}if(e.streamMetricFrames){if(!Array.isArray(e.streamMetricFrames))throw TypeError(".SdkClientMetricFrame.streamMetricFrames: array expected");t.streamMetricFrames=[];for(i=0;i<e.streamMetricFrames.length;++i){if("object"!=typeof e.streamMetricFrames[i])throw TypeError(".SdkClientMetricFrame.streamMetricFrames: object expected");t.streamMetricFrames[i]=$root.SdkStreamMetricFrame.fromObject(e.streamMetricFrames[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.globalMetrics=[],i.streamMetricFrames=[]),e.globalMetrics&&e.globalMetrics.length){i.globalMetrics=[];for(var n=0;n<e.globalMetrics.length;++n)i.globalMetrics[n]=$root.SdkMetric.toObject(e.globalMetrics[n],t)}if(e.streamMetricFrames&&e.streamMetricFrames.length){i.streamMetricFrames=[];for(n=0;n<e.streamMetricFrames.length;++n)i.streamMetricFrames[n]=$root.SdkStreamMetricFrame.toObject(e.streamMetricFrames[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkStreamDimension=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.type=1,e.prototype.value=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(8).int32(e.type),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&$root.SdkDimensionValue.encode(e.value,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkStreamDimension;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.type=e.int32();break;case 2:n.value=$root.SdkDimensionValue.decode(e,e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.type&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:}if(null!=e.value&&e.hasOwnProperty("value")){var t=$root.SdkDimensionValue.verify(e.value);if(t)return"value."+t}return null},e.fromObject=function(e){if(e instanceof $root.SdkStreamDimension)return e;var t=new $root.SdkStreamDimension;switch(e.type){case"VIDEO_ENCODER_NAME":case 1:t.type=1;break;case"VIDEO_DECODER_NAME":case 2:t.type=2}if(null!=e.value){if("object"!=typeof e.value)throw TypeError(".SdkStreamDimension.value: object expected");t.value=$root.SdkDimensionValue.fromObject(e.value)}return t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=t.enums===String?"VIDEO_ENCODER_NAME":1,i.value=null),null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkStreamDimension.Type[e.type]:e.type),null!=e.value&&e.hasOwnProperty("value")&&(i.value=$root.SdkDimensionValue.toObject(e.value,t)),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.Type=function(){var e={},t=Object.create(e);return t[e[1]="VIDEO_ENCODER_NAME"]=1,t[e[2]="VIDEO_DECODER_NAME"]=2,t}(),e}(),$root.SdkDimensionValue=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.stringValue="",e.prototype.boolValue=!1,e.prototype.uintValue=$util.Long?$util.Long.fromBits(0,0,!0):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.stringValue&&Object.hasOwnProperty.call(e,"stringValue")&&t.uint32(10).string(e.stringValue),null!=e.boolValue&&Object.hasOwnProperty.call(e,"boolValue")&&t.uint32(16).bool(e.boolValue),null!=e.uintValue&&Object.hasOwnProperty.call(e,"uintValue")&&t.uint32(24).uint64(e.uintValue),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkDimensionValue;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.stringValue=e.string();break;case 2:n.boolValue=e.bool();break;case 3:n.uintValue=e.uint64();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.stringValue&&e.hasOwnProperty("stringValue")&&!$util.isString(e.stringValue)?"stringValue: string expected":null!=e.boolValue&&e.hasOwnProperty("boolValue")&&"boolean"!=typeof e.boolValue?"boolValue: boolean expected":null!=e.uintValue&&e.hasOwnProperty("uintValue")&&!($util.isInteger(e.uintValue)||e.uintValue&&$util.isInteger(e.uintValue.low)&&$util.isInteger(e.uintValue.high))?"uintValue: integer|Long expected":null},e.fromObject=function(e){if(e instanceof $root.SdkDimensionValue)return e;var t=new $root.SdkDimensionValue;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),null!=e.uintValue&&($util.Long?(t.uintValue=$util.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new $util.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults)if(i.stringValue="",i.boolValue=!1,$util.Long){var n=new $util.Long(0,0,!0);i.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.uintValue=t.longs===String?"0":0;return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(i.stringValue=e.stringValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(i.boolValue=e.boolValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?i.uintValue=t.longs===String?String(e.uintValue):e.uintValue:i.uintValue=t.longs===String?$util.Long.prototype.toString.call(e.uintValue):t.longs===Number?new $util.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkDataMessageFrame=function(){function e(e){if(this.messages=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.messages=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.messages&&e.messages.length)for(var i=0;i<e.messages.length;++i)$root.SdkDataMessagePayload.encode(e.messages[i],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkDataMessageFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.messages&&n.messages.length||(n.messages=[]),n.messages.push($root.SdkDataMessagePayload.decode(e,e.uint32()));else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.messages&&e.hasOwnProperty("messages")){if(!Array.isArray(e.messages))return"messages: array expected";for(var t=0;t<e.messages.length;++t){var i=$root.SdkDataMessagePayload.verify(e.messages[t]);if(i)return"messages."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkDataMessageFrame)return e;var t=new $root.SdkDataMessageFrame;if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".SdkDataMessageFrame.messages: array expected");t.messages=[];for(var i=0;i<e.messages.length;++i){if("object"!=typeof e.messages[i])throw TypeError(".SdkDataMessageFrame.messages: object expected");t.messages[i]=$root.SdkDataMessagePayload.fromObject(e.messages[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.messages=[]),e.messages&&e.messages.length){i.messages=[];for(var n=0;n<e.messages.length;++n)i.messages[n]=$root.SdkDataMessagePayload.toObject(e.messages[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkDataMessagePayload=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.topic="",e.prototype.data=$util.newBuffer([]),e.prototype.lifetimeMs=0,e.prototype.senderAttendeeId="",e.prototype.ingestTimeNs=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.senderExternalUserId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(10).string(e.topic),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.lifetimeMs&&Object.hasOwnProperty.call(e,"lifetimeMs")&&t.uint32(24).uint32(e.lifetimeMs),null!=e.senderAttendeeId&&Object.hasOwnProperty.call(e,"senderAttendeeId")&&t.uint32(34).string(e.senderAttendeeId),null!=e.ingestTimeNs&&Object.hasOwnProperty.call(e,"ingestTimeNs")&&t.uint32(40).int64(e.ingestTimeNs),null!=e.senderExternalUserId&&Object.hasOwnProperty.call(e,"senderExternalUserId")&&t.uint32(50).string(e.senderExternalUserId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkDataMessagePayload;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.topic=e.string();break;case 2:n.data=e.bytes();break;case 3:n.lifetimeMs=e.uint32();break;case 4:n.senderAttendeeId=e.string();break;case 5:n.ingestTimeNs=e.int64();break;case 6:n.senderExternalUserId=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.topic&&e.hasOwnProperty("topic")&&!$util.isString(e.topic)?"topic: string expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||$util.isString(e.data))?"data: buffer expected":null!=e.lifetimeMs&&e.hasOwnProperty("lifetimeMs")&&!$util.isInteger(e.lifetimeMs)?"lifetimeMs: integer expected":null!=e.senderAttendeeId&&e.hasOwnProperty("senderAttendeeId")&&!$util.isString(e.senderAttendeeId)?"senderAttendeeId: string expected":null!=e.ingestTimeNs&&e.hasOwnProperty("ingestTimeNs")&&!($util.isInteger(e.ingestTimeNs)||e.ingestTimeNs&&$util.isInteger(e.ingestTimeNs.low)&&$util.isInteger(e.ingestTimeNs.high))?"ingestTimeNs: integer|Long expected":null!=e.senderExternalUserId&&e.hasOwnProperty("senderExternalUserId")&&!$util.isString(e.senderExternalUserId)?"senderExternalUserId: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkDataMessagePayload)return e;var t=new $root.SdkDataMessagePayload;return null!=e.topic&&(t.topic=String(e.topic)),null!=e.data&&("string"==typeof e.data?$util.base64.decode(e.data,t.data=$util.newBuffer($util.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.lifetimeMs&&(t.lifetimeMs=e.lifetimeMs>>>0),null!=e.senderAttendeeId&&(t.senderAttendeeId=String(e.senderAttendeeId)),null!=e.ingestTimeNs&&($util.Long?(t.ingestTimeNs=$util.Long.fromValue(e.ingestTimeNs)).unsigned=!1:"string"==typeof e.ingestTimeNs?t.ingestTimeNs=parseInt(e.ingestTimeNs,10):"number"==typeof e.ingestTimeNs?t.ingestTimeNs=e.ingestTimeNs:"object"==typeof e.ingestTimeNs&&(t.ingestTimeNs=new $util.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber())),null!=e.senderExternalUserId&&(t.senderExternalUserId=String(e.senderExternalUserId)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.topic="",t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=$util.newBuffer(i.data))),i.lifetimeMs=0,i.senderAttendeeId="",$util.Long){var n=new $util.Long(0,0,!1);i.ingestTimeNs=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.ingestTimeNs=t.longs===String?"0":0;i.senderExternalUserId=""}return null!=e.topic&&e.hasOwnProperty("topic")&&(i.topic=e.topic),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?$util.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.lifetimeMs&&e.hasOwnProperty("lifetimeMs")&&(i.lifetimeMs=e.lifetimeMs),null!=e.senderAttendeeId&&e.hasOwnProperty("senderAttendeeId")&&(i.senderAttendeeId=e.senderAttendeeId),null!=e.ingestTimeNs&&e.hasOwnProperty("ingestTimeNs")&&("number"==typeof e.ingestTimeNs?i.ingestTimeNs=t.longs===String?String(e.ingestTimeNs):e.ingestTimeNs:i.ingestTimeNs=t.longs===String?$util.Long.prototype.toString.call(e.ingestTimeNs):t.longs===Number?new $util.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber():e.ingestTimeNs),null!=e.senderExternalUserId&&e.hasOwnProperty("senderExternalUserId")&&(i.senderExternalUserId=e.senderExternalUserId),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTurnCredentials=function(){function e(e){if(this.uris=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.username="",e.prototype.password="",e.prototype.ttl=0,e.prototype.uris=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.username&&Object.hasOwnProperty.call(e,"username")&&t.uint32(10).string(e.username),null!=e.password&&Object.hasOwnProperty.call(e,"password")&&t.uint32(18).string(e.password),null!=e.ttl&&Object.hasOwnProperty.call(e,"ttl")&&t.uint32(24).uint32(e.ttl),null!=e.uris&&e.uris.length)for(var i=0;i<e.uris.length;++i)t.uint32(34).string(e.uris[i]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTurnCredentials;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.username=e.string();break;case 2:n.password=e.string();break;case 3:n.ttl=e.uint32();break;case 4:n.uris&&n.uris.length||(n.uris=[]),n.uris.push(e.string());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.username&&e.hasOwnProperty("username")&&!$util.isString(e.username))return"username: string expected";if(null!=e.password&&e.hasOwnProperty("password")&&!$util.isString(e.password))return"password: string expected";if(null!=e.ttl&&e.hasOwnProperty("ttl")&&!$util.isInteger(e.ttl))return"ttl: integer expected";if(null!=e.uris&&e.hasOwnProperty("uris")){if(!Array.isArray(e.uris))return"uris: array expected";for(var t=0;t<e.uris.length;++t)if(!$util.isString(e.uris[t]))return"uris: string[] expected"}return null},e.fromObject=function(e){if(e instanceof $root.SdkTurnCredentials)return e;var t=new $root.SdkTurnCredentials;if(null!=e.username&&(t.username=String(e.username)),null!=e.password&&(t.password=String(e.password)),null!=e.ttl&&(t.ttl=e.ttl>>>0),e.uris){if(!Array.isArray(e.uris))throw TypeError(".SdkTurnCredentials.uris: array expected");t.uris=[];for(var i=0;i<e.uris.length;++i)t.uris[i]=String(e.uris[i])}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.uris=[]),t.defaults&&(i.username="",i.password="",i.ttl=0),null!=e.username&&e.hasOwnProperty("username")&&(i.username=e.username),null!=e.password&&e.hasOwnProperty("password")&&(i.password=e.password),null!=e.ttl&&e.hasOwnProperty("ttl")&&(i.ttl=e.ttl),e.uris&&e.uris.length){i.uris=[];for(var n=0;n<e.uris.length;++n)i.uris[n]=e.uris[n]}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptItem=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.content="",e.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.speakerAttendeeId="",e.prototype.speakerExternalUserId="",e.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.type=1,e.prototype.vocabularyFilterMatch=!1,e.prototype.confidence=0,e.prototype.stable=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&t.uint32(10).string(e.content),null!=e.endTime&&Object.hasOwnProperty.call(e,"endTime")&&t.uint32(16).int64(e.endTime),null!=e.speakerAttendeeId&&Object.hasOwnProperty.call(e,"speakerAttendeeId")&&t.uint32(26).string(e.speakerAttendeeId),null!=e.speakerExternalUserId&&Object.hasOwnProperty.call(e,"speakerExternalUserId")&&t.uint32(34).string(e.speakerExternalUserId),null!=e.startTime&&Object.hasOwnProperty.call(e,"startTime")&&t.uint32(40).int64(e.startTime),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(48).int32(e.type),null!=e.vocabularyFilterMatch&&Object.hasOwnProperty.call(e,"vocabularyFilterMatch")&&t.uint32(56).bool(e.vocabularyFilterMatch),null!=e.confidence&&Object.hasOwnProperty.call(e,"confidence")&&t.uint32(65).double(e.confidence),null!=e.stable&&Object.hasOwnProperty.call(e,"stable")&&t.uint32(72).bool(e.stable),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptItem;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.content=e.string();break;case 2:n.endTime=e.int64();break;case 3:n.speakerAttendeeId=e.string();break;case 4:n.speakerExternalUserId=e.string();break;case 5:n.startTime=e.int64();break;case 6:n.type=e.int32();break;case 7:n.vocabularyFilterMatch=e.bool();break;case 8:n.confidence=e.double();break;case 9:n.stable=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.content&&e.hasOwnProperty("content")&&!$util.isString(e.content))return"content: string expected";if(null!=e.endTime&&e.hasOwnProperty("endTime")&&!($util.isInteger(e.endTime)||e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(null!=e.speakerAttendeeId&&e.hasOwnProperty("speakerAttendeeId")&&!$util.isString(e.speakerAttendeeId))return"speakerAttendeeId: string expected";if(null!=e.speakerExternalUserId&&e.hasOwnProperty("speakerExternalUserId")&&!$util.isString(e.speakerExternalUserId))return"speakerExternalUserId: string expected";if(null!=e.startTime&&e.hasOwnProperty("startTime")&&!($util.isInteger(e.startTime)||e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(null!=e.type&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:}return null!=e.vocabularyFilterMatch&&e.hasOwnProperty("vocabularyFilterMatch")&&"boolean"!=typeof e.vocabularyFilterMatch?"vocabularyFilterMatch: boolean expected":null!=e.confidence&&e.hasOwnProperty("confidence")&&"number"!=typeof e.confidence?"confidence: number expected":null!=e.stable&&e.hasOwnProperty("stable")&&"boolean"!=typeof e.stable?"stable: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptItem)return e;var t=new $root.SdkTranscriptItem;switch(null!=e.content&&(t.content=String(e.content)),null!=e.endTime&&($util.Long?(t.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:"string"==typeof e.endTime?t.endTime=parseInt(e.endTime,10):"number"==typeof e.endTime?t.endTime=e.endTime:"object"==typeof e.endTime&&(t.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),null!=e.speakerAttendeeId&&(t.speakerAttendeeId=String(e.speakerAttendeeId)),null!=e.speakerExternalUserId&&(t.speakerExternalUserId=String(e.speakerExternalUserId)),null!=e.startTime&&($util.Long?(t.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:"string"==typeof e.startTime?t.startTime=parseInt(e.startTime,10):"number"==typeof e.startTime?t.startTime=e.startTime:"object"==typeof e.startTime&&(t.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type){case"PRONUNCIATION":case 1:t.type=1;break;case"PUNCTUATION":case 2:t.type=2}return null!=e.vocabularyFilterMatch&&(t.vocabularyFilterMatch=Boolean(e.vocabularyFilterMatch)),null!=e.confidence&&(t.confidence=Number(e.confidence)),null!=e.stable&&(t.stable=Boolean(e.stable)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.content="",$util.Long){var n=new $util.Long(0,0,!1);i.endTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.endTime=t.longs===String?"0":0;if(i.speakerAttendeeId="",i.speakerExternalUserId="",$util.Long){n=new $util.Long(0,0,!1);i.startTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.startTime=t.longs===String?"0":0;i.type=t.enums===String?"PRONUNCIATION":1,i.vocabularyFilterMatch=!1,i.confidence=0,i.stable=!1}return null!=e.content&&e.hasOwnProperty("content")&&(i.content=e.content),null!=e.endTime&&e.hasOwnProperty("endTime")&&("number"==typeof e.endTime?i.endTime=t.longs===String?String(e.endTime):e.endTime:i.endTime=t.longs===String?$util.Long.prototype.toString.call(e.endTime):t.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),null!=e.speakerAttendeeId&&e.hasOwnProperty("speakerAttendeeId")&&(i.speakerAttendeeId=e.speakerAttendeeId),null!=e.speakerExternalUserId&&e.hasOwnProperty("speakerExternalUserId")&&(i.speakerExternalUserId=e.speakerExternalUserId),null!=e.startTime&&e.hasOwnProperty("startTime")&&("number"==typeof e.startTime?i.startTime=t.longs===String?String(e.startTime):e.startTime:i.startTime=t.longs===String?$util.Long.prototype.toString.call(e.startTime):t.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkTranscriptItem.Type[e.type]:e.type),null!=e.vocabularyFilterMatch&&e.hasOwnProperty("vocabularyFilterMatch")&&(i.vocabularyFilterMatch=e.vocabularyFilterMatch),null!=e.confidence&&e.hasOwnProperty("confidence")&&(i.confidence=t.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),null!=e.stable&&e.hasOwnProperty("stable")&&(i.stable=e.stable),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.Type=function(){var e={},t=Object.create(e);return t[e[1]="PRONUNCIATION"]=1,t[e[2]="PUNCTUATION"]=2,t}(),e}(),$root.SdkTranscriptEntity=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.category="",e.prototype.confidence=0,e.prototype.content="",e.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.type="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.category&&Object.hasOwnProperty.call(e,"category")&&t.uint32(10).string(e.category),null!=e.confidence&&Object.hasOwnProperty.call(e,"confidence")&&t.uint32(17).double(e.confidence),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&t.uint32(26).string(e.content),null!=e.endTime&&Object.hasOwnProperty.call(e,"endTime")&&t.uint32(32).int64(e.endTime),null!=e.startTime&&Object.hasOwnProperty.call(e,"startTime")&&t.uint32(40).int64(e.startTime),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(50).string(e.type),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptEntity;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.category=e.string();break;case 2:n.confidence=e.double();break;case 3:n.content=e.string();break;case 4:n.endTime=e.int64();break;case 5:n.startTime=e.int64();break;case 6:n.type=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.category&&e.hasOwnProperty("category")&&!$util.isString(e.category)?"category: string expected":null!=e.confidence&&e.hasOwnProperty("confidence")&&"number"!=typeof e.confidence?"confidence: number expected":null!=e.content&&e.hasOwnProperty("content")&&!$util.isString(e.content)?"content: string expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&!($util.isInteger(e.endTime)||e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high))?"endTime: integer|Long expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&!($util.isInteger(e.startTime)||e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high))?"startTime: integer|Long expected":null!=e.type&&e.hasOwnProperty("type")&&!$util.isString(e.type)?"type: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptEntity)return e;var t=new $root.SdkTranscriptEntity;return null!=e.category&&(t.category=String(e.category)),null!=e.confidence&&(t.confidence=Number(e.confidence)),null!=e.content&&(t.content=String(e.content)),null!=e.endTime&&($util.Long?(t.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:"string"==typeof e.endTime?t.endTime=parseInt(e.endTime,10):"number"==typeof e.endTime?t.endTime=e.endTime:"object"==typeof e.endTime&&(t.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),null!=e.startTime&&($util.Long?(t.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:"string"==typeof e.startTime?t.startTime=parseInt(e.startTime,10):"number"==typeof e.startTime?t.startTime=e.startTime:"object"==typeof e.startTime&&(t.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),null!=e.type&&(t.type=String(e.type)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.category="",i.confidence=0,i.content="",$util.Long){var n=new $util.Long(0,0,!1);i.endTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.endTime=t.longs===String?"0":0;if($util.Long){n=new $util.Long(0,0,!1);i.startTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.startTime=t.longs===String?"0":0;i.type=""}return null!=e.category&&e.hasOwnProperty("category")&&(i.category=e.category),null!=e.confidence&&e.hasOwnProperty("confidence")&&(i.confidence=t.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),null!=e.content&&e.hasOwnProperty("content")&&(i.content=e.content),null!=e.endTime&&e.hasOwnProperty("endTime")&&("number"==typeof e.endTime?i.endTime=t.longs===String?String(e.endTime):e.endTime:i.endTime=t.longs===String?$util.Long.prototype.toString.call(e.endTime):t.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),null!=e.startTime&&e.hasOwnProperty("startTime")&&("number"==typeof e.startTime?i.startTime=t.longs===String?String(e.startTime):e.startTime:i.startTime=t.longs===String?$util.Long.prototype.toString.call(e.startTime):t.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),null!=e.type&&e.hasOwnProperty("type")&&(i.type=e.type),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptAlternative=function(){function e(e){if(this.items=[],this.entities=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.items=$util.emptyArray,e.prototype.transcript="",e.prototype.entities=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.items&&e.items.length)for(var i=0;i<e.items.length;++i)$root.SdkTranscriptItem.encode(e.items[i],t.uint32(10).fork()).ldelim();if(null!=e.transcript&&Object.hasOwnProperty.call(e,"transcript")&&t.uint32(18).string(e.transcript),null!=e.entities&&e.entities.length)for(i=0;i<e.entities.length;++i)$root.SdkTranscriptEntity.encode(e.entities[i],t.uint32(26).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptAlternative;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.items&&n.items.length||(n.items=[]),n.items.push($root.SdkTranscriptItem.decode(e,e.uint32()));break;case 2:n.transcript=e.string();break;case 3:n.entities&&n.entities.length||(n.entities=[]),n.entities.push($root.SdkTranscriptEntity.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.items&&e.hasOwnProperty("items")){if(!Array.isArray(e.items))return"items: array expected";for(var t=0;t<e.items.length;++t){if(i=$root.SdkTranscriptItem.verify(e.items[t]))return"items."+i}}if(null!=e.transcript&&e.hasOwnProperty("transcript")&&!$util.isString(e.transcript))return"transcript: string expected";if(null!=e.entities&&e.hasOwnProperty("entities")){if(!Array.isArray(e.entities))return"entities: array expected";for(t=0;t<e.entities.length;++t){var i;if(i=$root.SdkTranscriptEntity.verify(e.entities[t]))return"entities."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptAlternative)return e;var t=new $root.SdkTranscriptAlternative;if(e.items){if(!Array.isArray(e.items))throw TypeError(".SdkTranscriptAlternative.items: array expected");t.items=[];for(var i=0;i<e.items.length;++i){if("object"!=typeof e.items[i])throw TypeError(".SdkTranscriptAlternative.items: object expected");t.items[i]=$root.SdkTranscriptItem.fromObject(e.items[i])}}if(null!=e.transcript&&(t.transcript=String(e.transcript)),e.entities){if(!Array.isArray(e.entities))throw TypeError(".SdkTranscriptAlternative.entities: array expected");t.entities=[];for(i=0;i<e.entities.length;++i){if("object"!=typeof e.entities[i])throw TypeError(".SdkTranscriptAlternative.entities: object expected");t.entities[i]=$root.SdkTranscriptEntity.fromObject(e.entities[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.items=[],i.entities=[]),t.defaults&&(i.transcript=""),e.items&&e.items.length){i.items=[];for(var n=0;n<e.items.length;++n)i.items[n]=$root.SdkTranscriptItem.toObject(e.items[n],t)}if(null!=e.transcript&&e.hasOwnProperty("transcript")&&(i.transcript=e.transcript),e.entities&&e.entities.length){i.entities=[];for(n=0;n<e.entities.length;++n)i.entities[n]=$root.SdkTranscriptEntity.toObject(e.entities[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptLanguageWithScore=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.languageCode="",e.prototype.score=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.languageCode&&Object.hasOwnProperty.call(e,"languageCode")&&t.uint32(10).string(e.languageCode),null!=e.score&&Object.hasOwnProperty.call(e,"score")&&t.uint32(17).double(e.score),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptLanguageWithScore;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.languageCode=e.string();break;case 2:n.score=e.double();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.languageCode&&e.hasOwnProperty("languageCode")&&!$util.isString(e.languageCode)?"languageCode: string expected":null!=e.score&&e.hasOwnProperty("score")&&"number"!=typeof e.score?"score: number expected":null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptLanguageWithScore)return e;var t=new $root.SdkTranscriptLanguageWithScore;return null!=e.languageCode&&(t.languageCode=String(e.languageCode)),null!=e.score&&(t.score=Number(e.score)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.languageCode="",i.score=0),null!=e.languageCode&&e.hasOwnProperty("languageCode")&&(i.languageCode=e.languageCode),null!=e.score&&e.hasOwnProperty("score")&&(i.score=t.json&&!isFinite(e.score)?String(e.score):e.score),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptResult=function(){function e(e){if(this.alternatives=[],this.languageIdentification=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.alternatives=$util.emptyArray,e.prototype.channelId="",e.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.isPartial=!1,e.prototype.resultId="",e.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.languageCode="",e.prototype.languageIdentification=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.alternatives&&e.alternatives.length)for(var i=0;i<e.alternatives.length;++i)$root.SdkTranscriptAlternative.encode(e.alternatives[i],t.uint32(10).fork()).ldelim();if(null!=e.channelId&&Object.hasOwnProperty.call(e,"channelId")&&t.uint32(18).string(e.channelId),null!=e.endTime&&Object.hasOwnProperty.call(e,"endTime")&&t.uint32(24).int64(e.endTime),null!=e.isPartial&&Object.hasOwnProperty.call(e,"isPartial")&&t.uint32(32).bool(e.isPartial),null!=e.resultId&&Object.hasOwnProperty.call(e,"resultId")&&t.uint32(42).string(e.resultId),null!=e.startTime&&Object.hasOwnProperty.call(e,"startTime")&&t.uint32(48).int64(e.startTime),null!=e.languageCode&&Object.hasOwnProperty.call(e,"languageCode")&&t.uint32(58).string(e.languageCode),null!=e.languageIdentification&&e.languageIdentification.length)for(i=0;i<e.languageIdentification.length;++i)$root.SdkTranscriptLanguageWithScore.encode(e.languageIdentification[i],t.uint32(66).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptResult;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.alternatives&&n.alternatives.length||(n.alternatives=[]),n.alternatives.push($root.SdkTranscriptAlternative.decode(e,e.uint32()));break;case 2:n.channelId=e.string();break;case 3:n.endTime=e.int64();break;case 4:n.isPartial=e.bool();break;case 5:n.resultId=e.string();break;case 6:n.startTime=e.int64();break;case 7:n.languageCode=e.string();break;case 8:n.languageIdentification&&n.languageIdentification.length||(n.languageIdentification=[]),n.languageIdentification.push($root.SdkTranscriptLanguageWithScore.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.alternatives&&e.hasOwnProperty("alternatives")){if(!Array.isArray(e.alternatives))return"alternatives: array expected";for(var t=0;t<e.alternatives.length;++t){if(i=$root.SdkTranscriptAlternative.verify(e.alternatives[t]))return"alternatives."+i}}if(null!=e.channelId&&e.hasOwnProperty("channelId")&&!$util.isString(e.channelId))return"channelId: string expected";if(null!=e.endTime&&e.hasOwnProperty("endTime")&&!($util.isInteger(e.endTime)||e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(null!=e.isPartial&&e.hasOwnProperty("isPartial")&&"boolean"!=typeof e.isPartial)return"isPartial: boolean expected";if(null!=e.resultId&&e.hasOwnProperty("resultId")&&!$util.isString(e.resultId))return"resultId: string expected";if(null!=e.startTime&&e.hasOwnProperty("startTime")&&!($util.isInteger(e.startTime)||e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(null!=e.languageCode&&e.hasOwnProperty("languageCode")&&!$util.isString(e.languageCode))return"languageCode: string expected";if(null!=e.languageIdentification&&e.hasOwnProperty("languageIdentification")){if(!Array.isArray(e.languageIdentification))return"languageIdentification: array expected";for(t=0;t<e.languageIdentification.length;++t){var i;if(i=$root.SdkTranscriptLanguageWithScore.verify(e.languageIdentification[t]))return"languageIdentification."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptResult)return e;var t=new $root.SdkTranscriptResult;if(e.alternatives){if(!Array.isArray(e.alternatives))throw TypeError(".SdkTranscriptResult.alternatives: array expected");t.alternatives=[];for(var i=0;i<e.alternatives.length;++i){if("object"!=typeof e.alternatives[i])throw TypeError(".SdkTranscriptResult.alternatives: object expected");t.alternatives[i]=$root.SdkTranscriptAlternative.fromObject(e.alternatives[i])}}if(null!=e.channelId&&(t.channelId=String(e.channelId)),null!=e.endTime&&($util.Long?(t.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:"string"==typeof e.endTime?t.endTime=parseInt(e.endTime,10):"number"==typeof e.endTime?t.endTime=e.endTime:"object"==typeof e.endTime&&(t.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),null!=e.isPartial&&(t.isPartial=Boolean(e.isPartial)),null!=e.resultId&&(t.resultId=String(e.resultId)),null!=e.startTime&&($util.Long?(t.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:"string"==typeof e.startTime?t.startTime=parseInt(e.startTime,10):"number"==typeof e.startTime?t.startTime=e.startTime:"object"==typeof e.startTime&&(t.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),null!=e.languageCode&&(t.languageCode=String(e.languageCode)),e.languageIdentification){if(!Array.isArray(e.languageIdentification))throw TypeError(".SdkTranscriptResult.languageIdentification: array expected");t.languageIdentification=[];for(i=0;i<e.languageIdentification.length;++i){if("object"!=typeof e.languageIdentification[i])throw TypeError(".SdkTranscriptResult.languageIdentification: object expected");t.languageIdentification[i]=$root.SdkTranscriptLanguageWithScore.fromObject(e.languageIdentification[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.alternatives=[],i.languageIdentification=[]),t.defaults){if(i.channelId="",$util.Long){var n=new $util.Long(0,0,!1);i.endTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.endTime=t.longs===String?"0":0;if(i.isPartial=!1,i.resultId="",$util.Long){n=new $util.Long(0,0,!1);i.startTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.startTime=t.longs===String?"0":0;i.languageCode=""}if(e.alternatives&&e.alternatives.length){i.alternatives=[];for(var r=0;r<e.alternatives.length;++r)i.alternatives[r]=$root.SdkTranscriptAlternative.toObject(e.alternatives[r],t)}if(null!=e.channelId&&e.hasOwnProperty("channelId")&&(i.channelId=e.channelId),null!=e.endTime&&e.hasOwnProperty("endTime")&&("number"==typeof e.endTime?i.endTime=t.longs===String?String(e.endTime):e.endTime:i.endTime=t.longs===String?$util.Long.prototype.toString.call(e.endTime):t.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),null!=e.isPartial&&e.hasOwnProperty("isPartial")&&(i.isPartial=e.isPartial),null!=e.resultId&&e.hasOwnProperty("resultId")&&(i.resultId=e.resultId),null!=e.startTime&&e.hasOwnProperty("startTime")&&("number"==typeof e.startTime?i.startTime=t.longs===String?String(e.startTime):e.startTime:i.startTime=t.longs===String?$util.Long.prototype.toString.call(e.startTime):t.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),null!=e.languageCode&&e.hasOwnProperty("languageCode")&&(i.languageCode=e.languageCode),e.languageIdentification&&e.languageIdentification.length){i.languageIdentification=[];for(r=0;r<e.languageIdentification.length;++r)i.languageIdentification[r]=$root.SdkTranscriptLanguageWithScore.toObject(e.languageIdentification[r],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscript=function(){function e(e){if(this.results=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.results=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.results&&e.results.length)for(var i=0;i<e.results.length;++i)$root.SdkTranscriptResult.encode(e.results[i],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscript;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.results&&n.results.length||(n.results=[]),n.results.push($root.SdkTranscriptResult.decode(e,e.uint32()));else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.results&&e.hasOwnProperty("results")){if(!Array.isArray(e.results))return"results: array expected";for(var t=0;t<e.results.length;++t){var i=$root.SdkTranscriptResult.verify(e.results[t]);if(i)return"results."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkTranscript)return e;var t=new $root.SdkTranscript;if(e.results){if(!Array.isArray(e.results))throw TypeError(".SdkTranscript.results: array expected");t.results=[];for(var i=0;i<e.results.length;++i){if("object"!=typeof e.results[i])throw TypeError(".SdkTranscript.results: object expected");t.results[i]=$root.SdkTranscriptResult.fromObject(e.results[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.results=[]),e.results&&e.results.length){i.results=[];for(var n=0;n<e.results.length;++n)i.results[n]=$root.SdkTranscriptResult.toObject(e.results[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptionStatus=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.type=1,e.prototype.eventTime=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.transcriptionRegion="",e.prototype.transcriptionConfiguration="",e.prototype.message="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(8).int32(e.type),null!=e.eventTime&&Object.hasOwnProperty.call(e,"eventTime")&&t.uint32(16).int64(e.eventTime),null!=e.transcriptionRegion&&Object.hasOwnProperty.call(e,"transcriptionRegion")&&t.uint32(26).string(e.transcriptionRegion),null!=e.transcriptionConfiguration&&Object.hasOwnProperty.call(e,"transcriptionConfiguration")&&t.uint32(34).string(e.transcriptionConfiguration),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(42).string(e.message),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptionStatus;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.type=e.int32();break;case 2:n.eventTime=e.int64();break;case 3:n.transcriptionRegion=e.string();break;case 4:n.transcriptionConfiguration=e.string();break;case 5:n.message=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.type&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:}return null!=e.eventTime&&e.hasOwnProperty("eventTime")&&!($util.isInteger(e.eventTime)||e.eventTime&&$util.isInteger(e.eventTime.low)&&$util.isInteger(e.eventTime.high))?"eventTime: integer|Long expected":null!=e.transcriptionRegion&&e.hasOwnProperty("transcriptionRegion")&&!$util.isString(e.transcriptionRegion)?"transcriptionRegion: string expected":null!=e.transcriptionConfiguration&&e.hasOwnProperty("transcriptionConfiguration")&&!$util.isString(e.transcriptionConfiguration)?"transcriptionConfiguration: string expected":null!=e.message&&e.hasOwnProperty("message")&&!$util.isString(e.message)?"message: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptionStatus)return e;var t=new $root.SdkTranscriptionStatus;switch(e.type){case"STARTED":case 1:t.type=1;break;case"INTERRUPTED":case 2:t.type=2;break;case"RESUMED":case 3:t.type=3;break;case"STOPPED":case 4:t.type=4;break;case"FAILED":case 5:t.type=5}return null!=e.eventTime&&($util.Long?(t.eventTime=$util.Long.fromValue(e.eventTime)).unsigned=!1:"string"==typeof e.eventTime?t.eventTime=parseInt(e.eventTime,10):"number"==typeof e.eventTime?t.eventTime=e.eventTime:"object"==typeof e.eventTime&&(t.eventTime=new $util.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber())),null!=e.transcriptionRegion&&(t.transcriptionRegion=String(e.transcriptionRegion)),null!=e.transcriptionConfiguration&&(t.transcriptionConfiguration=String(e.transcriptionConfiguration)),null!=e.message&&(t.message=String(e.message)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.type=t.enums===String?"STARTED":1,$util.Long){var n=new $util.Long(0,0,!1);i.eventTime=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.eventTime=t.longs===String?"0":0;i.transcriptionRegion="",i.transcriptionConfiguration="",i.message=""}return null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?$root.SdkTranscriptionStatus.Type[e.type]:e.type),null!=e.eventTime&&e.hasOwnProperty("eventTime")&&("number"==typeof e.eventTime?i.eventTime=t.longs===String?String(e.eventTime):e.eventTime:i.eventTime=t.longs===String?$util.Long.prototype.toString.call(e.eventTime):t.longs===Number?new $util.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber():e.eventTime),null!=e.transcriptionRegion&&e.hasOwnProperty("transcriptionRegion")&&(i.transcriptionRegion=e.transcriptionRegion),null!=e.transcriptionConfiguration&&e.hasOwnProperty("transcriptionConfiguration")&&(i.transcriptionConfiguration=e.transcriptionConfiguration),null!=e.message&&e.hasOwnProperty("message")&&(i.message=e.message),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.Type=function(){var e={},t=Object.create(e);return t[e[1]="STARTED"]=1,t[e[2]="INTERRUPTED"]=2,t[e[3]="RESUMED"]=3,t[e[4]="STOPPED"]=4,t[e[5]="FAILED"]=5,t}(),e}(),$root.SdkTranscriptEvent=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}var t;return e.prototype.status=null,e.prototype.transcript=null,Object.defineProperty(e.prototype,"Event",{get:$util.oneOfGetter(t=["status","transcript"]),set:$util.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.status&&Object.hasOwnProperty.call(e,"status")&&$root.SdkTranscriptionStatus.encode(e.status,t.uint32(10).fork()).ldelim(),null!=e.transcript&&Object.hasOwnProperty.call(e,"transcript")&&$root.SdkTranscript.encode(e.transcript,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptEvent;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.status=$root.SdkTranscriptionStatus.decode(e,e.uint32());break;case 2:n.transcript=$root.SdkTranscript.decode(e,e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.status&&e.hasOwnProperty("status")&&(t.Event=1,i=$root.SdkTranscriptionStatus.verify(e.status)))return"status."+i;if(null!=e.transcript&&e.hasOwnProperty("transcript")){if(1===t.Event)return"Event: multiple values";var i;if(t.Event=1,i=$root.SdkTranscript.verify(e.transcript))return"transcript."+i}return null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptEvent)return e;var t=new $root.SdkTranscriptEvent;if(null!=e.status){if("object"!=typeof e.status)throw TypeError(".SdkTranscriptEvent.status: object expected");t.status=$root.SdkTranscriptionStatus.fromObject(e.status)}if(null!=e.transcript){if("object"!=typeof e.transcript)throw TypeError(".SdkTranscriptEvent.transcript: object expected");t.transcript=$root.SdkTranscript.fromObject(e.transcript)}return t},e.toObject=function(e,t){t||(t={});var i={};return null!=e.status&&e.hasOwnProperty("status")&&(i.status=$root.SdkTranscriptionStatus.toObject(e.status,t),t.oneofs&&(i.Event="status")),null!=e.transcript&&e.hasOwnProperty("transcript")&&(i.transcript=$root.SdkTranscript.toObject(e.transcript,t),t.oneofs&&(i.Event="transcript")),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkTranscriptFrame=function(){function e(e){if(this.events=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.events=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.events&&e.events.length)for(var i=0;i<e.events.length;++i)$root.SdkTranscriptEvent.encode(e.events[i],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkTranscriptFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.events&&n.events.length||(n.events=[]),n.events.push($root.SdkTranscriptEvent.decode(e,e.uint32()));else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.events&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(var t=0;t<e.events.length;++t){var i=$root.SdkTranscriptEvent.verify(e.events[t]);if(i)return"events."+i}}return null},e.fromObject=function(e){if(e instanceof $root.SdkTranscriptFrame)return e;var t=new $root.SdkTranscriptFrame;if(e.events){if(!Array.isArray(e.events))throw TypeError(".SdkTranscriptFrame.events: array expected");t.events=[];for(var i=0;i<e.events.length;++i){if("object"!=typeof e.events[i])throw TypeError(".SdkTranscriptFrame.events: object expected");t.events[i]=$root.SdkTranscriptEvent.fromObject(e.events[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.events=[]),e.events&&e.events.length){i.events=[];for(var n=0;n<e.events.length;++n)i.events[n]=$root.SdkTranscriptEvent.toObject(e.events[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkRemoteVideoUpdateFrame=function(){function e(e){if(this.addedOrUpdatedVideoSubscriptions=[],this.removedVideoSubscriptionMids=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.addedOrUpdatedVideoSubscriptions=$util.emptyArray,e.prototype.removedVideoSubscriptionMids=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.addedOrUpdatedVideoSubscriptions&&e.addedOrUpdatedVideoSubscriptions.length)for(var i=0;i<e.addedOrUpdatedVideoSubscriptions.length;++i)$root.SdkVideoSubscriptionConfiguration.encode(e.addedOrUpdatedVideoSubscriptions[i],t.uint32(10).fork()).ldelim();if(null!=e.removedVideoSubscriptionMids&&e.removedVideoSubscriptionMids.length)for(i=0;i<e.removedVideoSubscriptionMids.length;++i)t.uint32(18).string(e.removedVideoSubscriptionMids[i]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkRemoteVideoUpdateFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.addedOrUpdatedVideoSubscriptions&&n.addedOrUpdatedVideoSubscriptions.length||(n.addedOrUpdatedVideoSubscriptions=[]),n.addedOrUpdatedVideoSubscriptions.push($root.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break;case 2:n.removedVideoSubscriptionMids&&n.removedVideoSubscriptionMids.length||(n.removedVideoSubscriptionMids=[]),n.removedVideoSubscriptionMids.push(e.string());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.addedOrUpdatedVideoSubscriptions&&e.hasOwnProperty("addedOrUpdatedVideoSubscriptions")){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))return"addedOrUpdatedVideoSubscriptions: array expected";for(var t=0;t<e.addedOrUpdatedVideoSubscriptions.length;++t){var i=$root.SdkVideoSubscriptionConfiguration.verify(e.addedOrUpdatedVideoSubscriptions[t]);if(i)return"addedOrUpdatedVideoSubscriptions."+i}}if(null!=e.removedVideoSubscriptionMids&&e.hasOwnProperty("removedVideoSubscriptionMids")){if(!Array.isArray(e.removedVideoSubscriptionMids))return"removedVideoSubscriptionMids: array expected";for(t=0;t<e.removedVideoSubscriptionMids.length;++t)if(!$util.isString(e.removedVideoSubscriptionMids[t]))return"removedVideoSubscriptionMids: string[] expected"}return null},e.fromObject=function(e){if(e instanceof $root.SdkRemoteVideoUpdateFrame)return e;var t=new $root.SdkRemoteVideoUpdateFrame;if(e.addedOrUpdatedVideoSubscriptions){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: array expected");t.addedOrUpdatedVideoSubscriptions=[];for(var i=0;i<e.addedOrUpdatedVideoSubscriptions.length;++i){if("object"!=typeof e.addedOrUpdatedVideoSubscriptions[i])throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: object expected");t.addedOrUpdatedVideoSubscriptions[i]=$root.SdkVideoSubscriptionConfiguration.fromObject(e.addedOrUpdatedVideoSubscriptions[i])}}if(e.removedVideoSubscriptionMids){if(!Array.isArray(e.removedVideoSubscriptionMids))throw TypeError(".SdkRemoteVideoUpdateFrame.removedVideoSubscriptionMids: array expected");t.removedVideoSubscriptionMids=[];for(i=0;i<e.removedVideoSubscriptionMids.length;++i)t.removedVideoSubscriptionMids[i]=String(e.removedVideoSubscriptionMids[i])}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.addedOrUpdatedVideoSubscriptions=[],i.removedVideoSubscriptionMids=[]),e.addedOrUpdatedVideoSubscriptions&&e.addedOrUpdatedVideoSubscriptions.length){i.addedOrUpdatedVideoSubscriptions=[];for(var n=0;n<e.addedOrUpdatedVideoSubscriptions.length;++n)i.addedOrUpdatedVideoSubscriptions[n]=$root.SdkVideoSubscriptionConfiguration.toObject(e.addedOrUpdatedVideoSubscriptions[n],t)}if(e.removedVideoSubscriptionMids&&e.removedVideoSubscriptionMids.length){i.removedVideoSubscriptionMids=[];for(n=0;n<e.removedVideoSubscriptionMids.length;++n)i.removedVideoSubscriptionMids[n]=e.removedVideoSubscriptionMids[n]}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkVideoQualityAdaptationPreference=function(){var e={},t=Object.create(e);return t[e[1]="BALANCED"]=1,t[e[2]="MAINTAIN_FRAMERATE"]=2,t[e[3]="MAINTAIN_RESOLUTION"]=3,t}(),$root.SdkVideoSubscriptionConfiguration=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.mid="",e.prototype.attendeeId="",e.prototype.streamId=0,e.prototype.priority=0,e.prototype.targetBitrateKbps=0,e.prototype.groupId=0,e.prototype.qualityAdaptationPreference=1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t.uint32(10).string(e.mid),null!=e.attendeeId&&Object.hasOwnProperty.call(e,"attendeeId")&&t.uint32(18).string(e.attendeeId),null!=e.streamId&&Object.hasOwnProperty.call(e,"streamId")&&t.uint32(24).uint32(e.streamId),null!=e.priority&&Object.hasOwnProperty.call(e,"priority")&&t.uint32(32).uint32(e.priority),null!=e.targetBitrateKbps&&Object.hasOwnProperty.call(e,"targetBitrateKbps")&&t.uint32(40).uint32(e.targetBitrateKbps),null!=e.groupId&&Object.hasOwnProperty.call(e,"groupId")&&t.uint32(48).uint32(e.groupId),null!=e.qualityAdaptationPreference&&Object.hasOwnProperty.call(e,"qualityAdaptationPreference")&&t.uint32(56).int32(e.qualityAdaptationPreference),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkVideoSubscriptionConfiguration;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.mid=e.string();break;case 2:n.attendeeId=e.string();break;case 3:n.streamId=e.uint32();break;case 4:n.priority=e.uint32();break;case 5:n.targetBitrateKbps=e.uint32();break;case 6:n.groupId=e.uint32();break;case 7:n.qualityAdaptationPreference=e.int32();break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("mid"))throw $util.ProtocolError("missing required 'mid'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!$util.isString(e.mid))return"mid: string expected";if(null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId))return"attendeeId: string expected";if(null!=e.streamId&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId))return"streamId: integer expected";if(null!=e.priority&&e.hasOwnProperty("priority")&&!$util.isInteger(e.priority))return"priority: integer expected";if(null!=e.targetBitrateKbps&&e.hasOwnProperty("targetBitrateKbps")&&!$util.isInteger(e.targetBitrateKbps))return"targetBitrateKbps: integer expected";if(null!=e.groupId&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId))return"groupId: integer expected";if(null!=e.qualityAdaptationPreference&&e.hasOwnProperty("qualityAdaptationPreference"))switch(e.qualityAdaptationPreference){default:return"qualityAdaptationPreference: enum value expected";case 1:case 2:case 3:}return null},e.fromObject=function(e){if(e instanceof $root.SdkVideoSubscriptionConfiguration)return e;var t=new $root.SdkVideoSubscriptionConfiguration;switch(null!=e.mid&&(t.mid=String(e.mid)),null!=e.attendeeId&&(t.attendeeId=String(e.attendeeId)),null!=e.streamId&&(t.streamId=e.streamId>>>0),null!=e.priority&&(t.priority=e.priority>>>0),null!=e.targetBitrateKbps&&(t.targetBitrateKbps=e.targetBitrateKbps>>>0),null!=e.groupId&&(t.groupId=e.groupId>>>0),e.qualityAdaptationPreference){case"BALANCED":case 1:t.qualityAdaptationPreference=1;break;case"MAINTAIN_FRAMERATE":case 2:t.qualityAdaptationPreference=2;break;case"MAINTAIN_RESOLUTION":case 3:t.qualityAdaptationPreference=3}return t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.mid="",i.attendeeId="",i.streamId=0,i.priority=0,i.targetBitrateKbps=0,i.groupId=0,i.qualityAdaptationPreference=t.enums===String?"BALANCED":1),null!=e.mid&&e.hasOwnProperty("mid")&&(i.mid=e.mid),null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&(i.attendeeId=e.attendeeId),null!=e.streamId&&e.hasOwnProperty("streamId")&&(i.streamId=e.streamId),null!=e.priority&&e.hasOwnProperty("priority")&&(i.priority=e.priority),null!=e.targetBitrateKbps&&e.hasOwnProperty("targetBitrateKbps")&&(i.targetBitrateKbps=e.targetBitrateKbps),null!=e.groupId&&e.hasOwnProperty("groupId")&&(i.groupId=e.groupId),null!=e.qualityAdaptationPreference&&e.hasOwnProperty("qualityAdaptationPreference")&&(i.qualityAdaptationPreference=t.enums===String?$root.SdkVideoQualityAdaptationPreference[e.qualityAdaptationPreference]:e.qualityAdaptationPreference),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkNotificationFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.level=3,e.prototype.message="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(8).int32(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(18).string(e.message),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkNotificationFrame;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.level=e.int32();break;case 2:n.message=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.level&&e.hasOwnProperty("level"))switch(e.level){default:return"level: enum value expected";case 1:case 2:case 3:}return null!=e.message&&e.hasOwnProperty("message")&&!$util.isString(e.message)?"message: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkNotificationFrame)return e;var t=new $root.SdkNotificationFrame;switch(e.level){case"INFO":case 1:t.level=1;break;case"WARNING":case 2:t.level=2;break;case"ERROR":case 3:t.level=3}return null!=e.message&&(t.message=String(e.message)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.level=t.enums===String?"ERROR":3,i.message=""),null!=e.level&&e.hasOwnProperty("level")&&(i.level=t.enums===String?$root.SdkNotificationFrame.NotificationLevel[e.level]:e.level),null!=e.message&&e.hasOwnProperty("message")&&(i.message=e.message),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.NotificationLevel=function(){var e={},t=Object.create(e);return t[e[1]="INFO"]=1,t[e[2]="WARNING"]=2,t[e[3]="ERROR"]=3,t}(),e}(),$root.SdkPrimaryMeetingJoinFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.credentials=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.credentials&&Object.hasOwnProperty.call(e,"credentials")&&$root.SdkMeetingSessionCredentials.encode(e.credentials,t.uint32(10).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkPrimaryMeetingJoinFrame;e.pos<i;){var r=e.uint32();if(r>>>3==1)n.credentials=$root.SdkMeetingSessionCredentials.decode(e,e.uint32());else e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.credentials&&e.hasOwnProperty("credentials")){var t=$root.SdkMeetingSessionCredentials.verify(e.credentials);if(t)return"credentials."+t}return null},e.fromObject=function(e){if(e instanceof $root.SdkPrimaryMeetingJoinFrame)return e;var t=new $root.SdkPrimaryMeetingJoinFrame;if(null!=e.credentials){if("object"!=typeof e.credentials)throw TypeError(".SdkPrimaryMeetingJoinFrame.credentials: object expected");t.credentials=$root.SdkMeetingSessionCredentials.fromObject(e.credentials)}return t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.credentials=null),null!=e.credentials&&e.hasOwnProperty("credentials")&&(i.credentials=$root.SdkMeetingSessionCredentials.toObject(e.credentials,t)),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkPrimaryMeetingJoinAckFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkPrimaryMeetingJoinAckFrame;e.pos<i;){var r=e.uint32();e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},e.fromObject=function(e){return e instanceof $root.SdkPrimaryMeetingJoinAckFrame?e:new $root.SdkPrimaryMeetingJoinAckFrame},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkPrimaryMeetingLeaveFrame=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkPrimaryMeetingLeaveFrame;e.pos<i;){var r=e.uint32();e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},e.fromObject=function(e){return e instanceof $root.SdkPrimaryMeetingLeaveFrame?e:new $root.SdkPrimaryMeetingLeaveFrame},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkMeetingSessionCredentials=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.attendeeId="",e.prototype.externalUserId="",e.prototype.joinToken="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.attendeeId&&Object.hasOwnProperty.call(e,"attendeeId")&&t.uint32(10).string(e.attendeeId),null!=e.externalUserId&&Object.hasOwnProperty.call(e,"externalUserId")&&t.uint32(18).string(e.externalUserId),null!=e.joinToken&&Object.hasOwnProperty.call(e,"joinToken")&&t.uint32(26).string(e.joinToken),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new $root.SdkMeetingSessionCredentials;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.attendeeId=e.string();break;case 2:n.externalUserId=e.string();break;case 3:n.joinToken=e.string();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId)?"attendeeId: string expected":null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":null!=e.joinToken&&e.hasOwnProperty("joinToken")&&!$util.isString(e.joinToken)?"joinToken: string expected":null},e.fromObject=function(e){if(e instanceof $root.SdkMeetingSessionCredentials)return e;var t=new $root.SdkMeetingSessionCredentials;return null!=e.attendeeId&&(t.attendeeId=String(e.attendeeId)),null!=e.externalUserId&&(t.externalUserId=String(e.externalUserId)),null!=e.joinToken&&(t.joinToken=String(e.joinToken)),t},e.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.attendeeId="",i.externalUserId="",i.joinToken=""),null!=e.attendeeId&&e.hasOwnProperty("attendeeId")&&(i.attendeeId=e.attendeeId),null!=e.externalUserId&&e.hasOwnProperty("externalUserId")&&(i.externalUserId=e.externalUserId),null!=e.joinToken&&e.hasOwnProperty("joinToken")&&(i.joinToken=e.joinToken),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SdkVideoCodecCapability=function(){var e={},t=Object.create(e);return t[e[1]="VP8"]=1,t[e[3]="H264_CONSTRAINED_BASELINE_PROFILE"]=3,t[e[8]="VP9_PROFILE_0"]=8,t[e[11]="AV1_MAIN"]=11,t}();var SignalingProtocol=$root;$util.Long=void 0,$protobuf.configure();var ClientMetricReportDirection={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ClientMetricReportDirection=void 0,function(e){e[e.UPSTREAM=0]="UPSTREAM",e[e.DOWNSTREAM=1]="DOWNSTREAM"}(t=e.ClientMetricReportDirection||(e.ClientMetricReportDirection={})),e.default=t}(ClientMetricReportDirection);var ClientMetricReportMediaType={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ClientMetricReportMediaType=void 0,function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(t=e.ClientMetricReportMediaType||(e.ClientMetricReportMediaType={})),e.default=t}(ClientMetricReportMediaType);var GlobalMetricReport$1={};Object.defineProperty(GlobalMetricReport$1,"__esModule",{value:!0});class GlobalMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}}GlobalMetricReport$1.default=GlobalMetricReport;var __importDefault$1s=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ClientMetricReport$1,"__esModule",{value:!0});const SignalingProtocol_js_1$f=SignalingProtocol,ClientMetricReportDirection_1$3=__importDefault$1s(ClientMetricReportDirection),ClientMetricReportMediaType_1$3=__importDefault$1s(ClientMetricReportMediaType),GlobalMetricReport_1=__importDefault$1s(GlobalMetricReport$1);class ClientMetricReport{constructor(e,t,i){this.logger=e,this.videoStreamIndex=t,this.selfAttendeeId=i,this.globalMetricReport=new GlobalMetricReport_1.default,this.streamMetricReports={},this.rtcStatsReport={},this.customStatsReports=[],this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.overriddenObservableMetrics=new Map,this.identityValue=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;return Number(i.currentMetrics[e])},this.decoderLossPercent=(e,t)=>{const i=this.streamMetricReports[t],n=i.currentMetrics.concealedSamples-(i.previousMetrics.concealedSamples||0),r=i.currentMetrics.totalSamplesReceived-(i.previousMetrics.totalSamplesReceived||0);if(r<=0)return 0;return r-n<=0?0:n/r*100},this.packetLossPercent=(e,t)=>{const i=this.streamMetricReports[t],n=i.currentMetrics[e]-(i.previousMetrics[e]||0),r=i.currentMetrics.packetsLost-(i.previousMetrics.packetsLost||0),o=n+r;return o<=0||r<=0?0:100*r/o},this.jitterBufferMs=(e,t)=>{const i=this.streamMetricReports[t],n=i.currentMetrics.jitterBufferDelay-(i.previousMetrics.jitterBufferDelay||0),r=i.currentMetrics.jitterBufferEmittedCount-(i.previousMetrics.jitterBufferEmittedCount||0);return n<=0||r<=0?0:n/r*1e3},this.countPerSecond=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;let n=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(n<=0)return 0;this.previousTimestampMs<=0&&(n=1);const r=i.currentMetrics[e]-(i.previousMetrics[e]||0);return r<=0?0:Math.trunc(r/n)},this.bitsPerSecond=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;let n=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(n<=0)return 0;this.previousTimestampMs<=0&&(n=1);const r=8*(i.currentMetrics[e]-(i.previousMetrics[e]||0));return r<=0?0:Math.trunc(r/n)},this.secondsToMilliseconds=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;return Number(1e3*i.currentMetrics[e])},this.averageTimeSpentPerSecondInMilliseconds=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;let n=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(n<=0)return 0;this.previousTimestampMs<=0&&(n=1);const r=i.currentMetrics[e]-(i.previousMetrics[e]||0);return r<=0?0:1e3*r/n},this.averageCpuQualityLimitationDurationPerSecondInMilliseconds=(e,t)=>{const i=this.streamMetricReports[t];let n=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(n<=0)return 0;this.previousTimestampMs<=0&&(n=1);let r=0,o=0;for(const[t,n]of Object.entries(i.previousObjectMetrics[e]))"cpu"===t&&(r=n);for(const[t,n]of Object.entries(i.currentObjectMetrics[e]))"cpu"===t&&(o=n);const a=o-r;return a<=0?0:1e3*a/n},this.isHardwareImplementation=(e,t)=>{const i=this.streamMetricReports[t],n=String(i.currentStringMetrics[e]),r=n.includes("ExternalDecoder")||n.includes("ExternalEncoder")||n.includes("EncodeAccelerator")||n.includes("DecodeAccelerator"),o=n.includes("fallback from");return r&&!o?1:0},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.STUN_RTT_MS},audioLevel:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_AUDIO_LEVEL,source:"audioLevel"}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_BITRATE},audioLevel:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_AUDIO_LEVEL},totalAudioPacketsLost:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_LOST},totalAudioPacketsExpected:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_EXPECTED},totalAudioPacketsRecoveredRed:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_RED},totalAudioPacketsRecoveredFec:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_FEC}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_WIDTH},jitter:{transform:this.secondsToMilliseconds},totalEncodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_MS},encoderImplementation:{transform:this.isHardwareImplementation,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODER_IS_HARDWARE},qualityLimitationDurations:{transform:this.averageCpuQualityLimitationDurationPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_QUALITY_LIMITATION_DURATION_CPU}},this.videoDownstreamMetricMap={packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_WIDTH},totalDecodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_MS},decoderImplementation:{transform:this.isHardwareImplementation,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODER_IS_HARDWARE},totalFreezesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FREEZE_DURATION},freezeCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FREEZE_COUNT},totalPausesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PAUSE_DURATION},pauseCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PAUSE_COUNT},framesDropped:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DROPPED_FPS}},this.streamDimensionMap={encoderImplementation:SignalingProtocol_js_1$f.SdkStreamDimension.Type.VIDEO_ENCODER_NAME,decoderImplementation:SignalingProtocol_js_1$f.SdkStreamDimension.Type.VIDEO_DECODER_NAME},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},nackCountReceivedPerSecond:{source:"nackCount",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},currentRoundTripTimeMs:{source:"currentRoundTripTime"},audioDownstreamLevel:{source:"audioLevel",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioUpstreamLevel:{source:"audioLevel"}}}getMetricMap(e,t){switch(e){case ClientMetricReportMediaType_1$3.default.AUDIO:switch(t){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.audioUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case ClientMetricReportMediaType_1$3.default.VIDEO:switch(t){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.videoUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getStreamDimensionMap(){return this.streamDimensionMap}getObservableMetricValue(e){if(this.overriddenObservableMetrics.has(e))return this.overriddenObservableMetrics.get(e);const t=this.observableMetricSpec[e],i=this.getMetricMap(t.media,t.dir)[t.source],{transform:n,source:r}=i;if(!t.hasOwnProperty("media"))return n(r||t.source);for(const e in this.streamMetricReports){const i=this.streamMetricReports[e];if(i.direction===t.dir&&i.mediaType===t.media)return n(r||t.source,Number(e))}return 0}getObservableVideoMetricValue(e,t){const i=this.observableVideoMetricSpec[e],n=this.getMetricMap(i.media,i.dir)[i.source],{transform:r,source:o}=n;return r(o||i.source,t)}getObservableMetrics(){const e={};for(const t in this.observableMetricSpec)e[t]=this.getObservableMetricValue(t);return e}getObservableVideoMetrics(){const e={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),e;for(const t in this.streamMetricReports)if(this.streamMetricReports[t].mediaType===ClientMetricReportMediaType_1$3.default.VIDEO){const i={};for(const e in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[e].dir===this.streamMetricReports[t].direction){const n=this.getObservableVideoMetricValue(e,Number(t));isNaN(n)||(i[e]=n)}const n=this.streamMetricReports[t].groupId,r=this.streamMetricReports[t].streamId;let o="";o=void 0!==this.videoStreamIndex.attendeeIdForGroupId?n?this.videoStreamIndex.attendeeIdForGroupId(n):this.selfAttendeeId:r?this.videoStreamIndex.attendeeIdForStreamId(r):this.selfAttendeeId,e[o]=e[o]?e[o]:{},e[o][t]=i}return e}getRTCStatsReport(){return this.rtcStatsReport}clone(){const e=new ClientMetricReport(this.logger,this.videoStreamIndex,this.selfAttendeeId);return e.globalMetricReport=this.globalMetricReport,e.streamMetricReports=this.streamMetricReports,e.rtcStatsReport=this.rtcStatsReport,e.customStatsReports=this.customStatsReports,e.currentTimestampMs=this.currentTimestampMs,e.previousTimestampMs=this.previousTimestampMs,e.overriddenObservableMetrics=this.overriddenObservableMetrics,e}print(){const e={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug((()=>`Client Metric Report: ${JSON.stringify(e)}`))}removeDestroyedSsrcs(){for(const e in this.streamMetricReports)this.currentSsrcs[e]||delete this.streamMetricReports[e]}overrideObservableMetric(e,t){this.overriddenObservableMetrics.set(e,t)}}ClientMetricReport$1.default=ClientMetricReport;var ClientVideoStreamReceivingReport$1={};Object.defineProperty(ClientVideoStreamReceivingReport$1,"__esModule",{value:!0});class ClientVideoStreamReceivingReport{}ClientVideoStreamReceivingReport$1.default=ClientVideoStreamReceivingReport;var ConnectionHealthData$1={};Object.defineProperty(ConnectionHealthData$1,"__esModule",{value:!0});class ConnectionHealthData{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent(e,t){return Date.now()<e+t}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}isConnectionStartRecent(e){return ConnectionHealthData.isTimestampRecent(this.connectionStartTimestampMs,e)}isLastPacketLossRecent(e){return ConnectionHealthData.isTimestampRecent(this.lastPacketLossInboundTimestampMs,e)}isGoodSignalRecent(e){return ConnectionHealthData.isTimestampRecent(this.lastGoodSignalTimestampMs,e)}isWeakSignalRecent(e){return ConnectionHealthData.isTimestampRecent(this.lastWeakSignalTimestampMs,e)}isNoSignalRecent(e){return ConnectionHealthData.isTimestampRecent(this.lastNoSignalTimestampMs,e)}clone(){const e=new ConnectionHealthData;return e.connectionStartTimestampMs=this.connectionStartTimestampMs,e.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,e.consecutiveStatsWithNoAudioPacketsSent=this.consecutiveStatsWithNoAudioPacketsSent,e.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,e.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,e.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,e.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,e.consecutiveMissedPongs=this.consecutiveMissedPongs,e.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),e.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),e.audioSpeakerDelayMs=this.audioSpeakerDelayMs,e}setConsecutiveMissedPongs(e){this.consecutiveMissedPongs=e}setConsecutiveStatsWithNoPackets(e){this.consecutiveStatsWithNoPackets=e}setConsecutiveStatsWithNoAudioPacketsSent(e){this.consecutiveStatsWithNoAudioPacketsSent=e}setLastPacketLossInboundTimestampMs(e){this.lastPacketLossInboundTimestampMs=e}setLastNoSignalTimestampMs(e){this.lastNoSignalTimestampMs=e}setLastWeakSignalTimestampMs(e){this.lastWeakSignalTimestampMs=e}setLastGoodSignalTimestampMs(e){this.lastGoodSignalTimestampMs=e}setAudioSpeakerDelayMs(e){this.audioSpeakerDelayMs=e}}ConnectionHealthData$1.default=ConnectionHealthData;var ConnectionHealthPolicyConfiguration$1={};Object.defineProperty(ConnectionHealthPolicyConfiguration$1,"__esModule",{value:!0});class ConnectionHealthPolicyConfiguration{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10,this.sendingAudioFailureSamplesToConsider=2,this.sendingAudioFailureInitialWaitTimeMs=3e3}}ConnectionHealthPolicyConfiguration$1.default=ConnectionHealthPolicyConfiguration;var ContentShareConstants$1={},ContentShareConstants;Object.defineProperty(ContentShareConstants$1,"__esModule",{value:!0}),function(e){e.Modality="#content"}(ContentShareConstants||(ContentShareConstants={})),ContentShareConstants$1.default=ContentShareConstants;var ContentShareMediaStreamBroker$1={},DefaultDeviceController$1={},DefaultMediaDeviceFactory$1={},MediaDeviceProxyHandler$1={},IntervalScheduler$1={};Object.defineProperty(IntervalScheduler$1,"__esModule",{value:!0});class IntervalScheduler{constructor(e){this.intervalMs=e}start(e){this.stop(),this.timer=setInterval(e,this.intervalMs)}stop(){void 0!==this.timer&&(clearInterval(this.timer),this.timer=void 0)}running(){return void 0!==this.timer}}IntervalScheduler$1.default=IntervalScheduler;var __awaiter$U=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MediaDeviceProxyHandler$1,"__esModule",{value:!0});const AsyncScheduler_1$7=__importDefault$1r(AsyncScheduler$1),IntervalScheduler_1$5=__importDefault$1r(IntervalScheduler$1);class MediaDeviceProxyHandler{constructor(){this.scheduler=null,this.devices=null,this.deviceChangeListeners=new Set,this.get=(e,t,i)=>{if(!Reflect.has(e,t))return;if(!("ondevicechange"in navigator.mediaDevices)){if("addEventListener"===t)return this.patchAddEventListener(e,t,i);if("removeEventListener"===t)return this.patchRemoveEventListener(e,t,i)}const n=Reflect.get(e,t,i);return"function"==typeof n?n.bind(e):n},this.patchAddEventListener=(e,t,i)=>{const n=Reflect.get(e,t,i);return(t,i,r)=>{if("devicechange"!==t)return Reflect.apply(n,e,[t,i,r]);this.deviceChangeListeners.add(i),this.scheduler||(this.scheduler=new IntervalScheduler_1$5.default(MediaDeviceProxyHandler.INTERVAL_MS),this.scheduler.start(this.pollDeviceLists))}},this.patchRemoveEventListener=(e,t,i)=>{const n=Reflect.get(e,t,i);return(t,i,r)=>{if("devicechange"!==t)return Reflect.apply(n,e,[t,i,r]);this.deviceChangeListeners.delete(i),0===this.deviceChangeListeners.size&&this.scheduler&&(this.scheduler.stop(),this.scheduler=null)}},this.pollDeviceLists=()=>__awaiter$U(this,void 0,void 0,(function*(){const e=yield this.sortedDeviceList();if(this.devices){const t=e.length!==this.devices.length||e.some(((e,t)=>e.deviceId!==this.devices[t].deviceId));t&&this.handleDeviceChangeEvent()}this.devices=e}))}sortedDeviceList(){return __awaiter$U(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).sort(((e,t)=>e.deviceId<t.deviceId?1:e.deviceId>t.deviceId?-1:0))}))}handleDeviceChangeEvent(){for(const e of this.deviceChangeListeners)AsyncScheduler_1$7.default.nextTick((()=>{if(this.deviceChangeListeners.has(e)){const t=new Event("devicechange");"function"==typeof e?e(t):e.handleEvent(t)}}))}}MediaDeviceProxyHandler$1.default=MediaDeviceProxyHandler,MediaDeviceProxyHandler.INTERVAL_MS=1e3;var __importDefault$1q=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultMediaDeviceFactory$1,"__esModule",{value:!0});const MediaDeviceProxyHandler_1=__importDefault$1q(MediaDeviceProxyHandler$1);class DefaultMediaDeviceFactory{constructor(){this.isMediaDevicesSupported="undefined"!=typeof navigator&&!!navigator.mediaDevices}create(){if(this.isMediaDevicesSupported)return new Proxy(navigator.mediaDevices,new MediaDeviceProxyHandler_1.default);throw new Error("navigator.mediaDevices is not supported")}}DefaultMediaDeviceFactory$1.default=DefaultMediaDeviceFactory;var PromiseQueue$1={};Object.defineProperty(PromiseQueue$1,"__esModule",{value:!0});class PromiseQueue{constructor(){this.queue=Promise.resolve()}add(e){return new Promise(((t,i)=>{this.queue=this.queue.then(e).then(t).catch(i)}))}}PromiseQueue$1.default=PromiseQueue;var Types={};Object.defineProperty(Types,"__esModule",{value:!0}),Types.None=Types.Some=Types.Maybe=void 0;class Maybe{static of(e){return null==e?None.of():Some.of(e)}}Types.Maybe=Maybe;class Some{constructor(e){this.value=e,this.isSome=!0,this.isNone=!1}map(e){return Maybe.of(e(this.value))}flatMap(e){return e(this.value)}get(){return this.value}getOrElse(e){return this.value}defaulting(e){return Maybe.of(this.getOrElse(e))}static of(e){if(null==e)throw new Error("value is ${value}");return new Some(e)}}Types.Some=Some;class None{constructor(){this.isSome=!1,this.isNone=!0}get(){throw new Error("value is null")}getOrElse(e){return e}map(e){return new None}flatMap(e){return new None}defaulting(e){return Maybe.of(this.getOrElse(e))}static of(){return new None}}Types.None=None;var DefaultVideoTransformDevice$1={},DefaultVideoFrameProcessorPipeline$1={},DefaultVideoFrameProcessorTimer$1={},__awaiter$T=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(DefaultVideoFrameProcessorTimer$1,"__esModule",{value:!0});class DefaultVideoFrameProcessorTimer{constructor(){this.workerTimer=void 0,this.callback=void 0,this.workerTimer=this.createWorkerTimer()}createWorkerTimer(){try{const e=new Blob(["self.onmessage = async function(e){ \n            var timerID = null;\n            const awaitTimeout = delay => new Promise( resolve => {\n              timerID = setTimeout(resolve, delay);\n            })\n            await awaitTimeout(e.data);\n            postMessage(timerID);\n          }"],{type:"application/javascript"});return new Worker(window.URL.createObjectURL(e))}catch(e){}}start(e,t){return __awaiter$T(this,void 0,void 0,(function*(){this.callback=t,this.workerTimer?(this.workerTimer.onmessage=e=>{this.lastTimeout=e.data,this.callback()},this.workerTimer.postMessage(e)):this.lastTimeout=setTimeout((()=>{this.callback()}),e)}))}destroy(){return __awaiter$T(this,void 0,void 0,(function*(){this.callback=void 0,this.lastTimeout&&(clearTimeout(this.lastTimeout),this.lastTimeout=void 0),this.workerTimer&&(this.workerTimer.terminate(),this.workerTimer=void 0)}))}}DefaultVideoFrameProcessorTimer$1.default=DefaultVideoFrameProcessorTimer;var __awaiter$S=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1p=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoFrameProcessorPipeline$1,"__esModule",{value:!0});const CanvasVideoFrameBuffer_1$1=__importDefault$1p(CanvasVideoFrameBuffer$1),DefaultVideoFrameProcessorTimer_1=__importDefault$1p(DefaultVideoFrameProcessorTimer$1),DEFAULT_FRAMERATE=15;class DefaultVideoFrameProcessorPipeline{constructor(e,t,i=new DefaultVideoFrameProcessorTimer_1.default){this.logger=e,this.stages=t,this.fr=DEFAULT_FRAMERATE,this.outputMediaStream=new MediaStream,this.videoInput=document.createElement("video"),this.canvasOutput=document.createElement("canvas"),this.outputCtx=this.canvasOutput.getContext("2d"),this.canvasInput=document.createElement("canvas"),this.inputCtx=this.canvasInput.getContext("2d"),this.inputVideoStream=null,this.sourceBuffers=[],this.destBuffers=[],this.observers=new Set,this.hasStarted=!1,this.process=e=>__awaiter$S(this,void 0,void 0,(function*(){if(!this.inputVideoStream)return;const e=performance.now();this.videoInput.videoWidth&&(this.canvasInput.width!==this.videoInput.videoWidth&&(this.canvasInput.width=this.videoInput.videoWidth,this.canvasInput.height=this.videoInput.videoHeight,this.sourceBuffers[0].height=this.canvasInput.height,this.sourceBuffers[0].width=this.canvasInput.width,this.sourceBuffers[0].framerate=this.framerate),this.inputCtx.drawImage(this.videoInput,0,0));let t,i=[];i.push(this.sourceBuffers[0]);try{for(const e of this.processors)i=yield e.process(i)}catch(e){return void this.forEachObserver((e=>{e.processingDidFailToStart&&e.processingDidFailToStart()}))}this.destBuffers=i;try{t=yield this.destBuffers[0].asCanvasImageSource()}catch(e){return void(this.inputVideoStream&&(this.logger.info("buffers are destroyed and pipeline could not start"),this.forEachObserver((e=>{e.processingDidFailToStart&&e.processingDidFailToStart()}))))}const n=t.width,r=t.height;0!==n&&0!==r&&(this.canvasOutput.width!==n&&this.canvasOutput.height!==r&&(this.canvasOutput.width=n,this.canvasOutput.height=r),this.outputCtx.drawImage(t,0,0,n,r,0,0,n,r),this.hasStarted||(this.hasStarted=!0,this.forEachObserver((e=>{e.processingDidStart&&e.processingDidStart()}))));const o=performance.now()-e,a=2e3/this.framerate-o,s=Math.max(0,1e3/this.framerate-o);a<=0&&this.forEachObserver((e=>{e.processingLatencyTooHigh&&e.processingLatencyTooHigh(o)})),yield this.timer.start(s,this.process.bind(this))})),this.timer=i}destroy(){if(this.stop(),this.stages)for(const e of this.stages)e.destroy();this.timer.destroy()}get framerate(){return this.fr}set framerate(e){this.fr=e<0?DEFAULT_FRAMERATE:e}stop(){if(this.videoInput.removeEventListener("loadedmetadata",this.process),this.videoInput.srcObject=null,this.destroyInputMediaStreamAndBuffers(),this.outputMediaStream)for(const e of this.outputMediaStream.getVideoTracks())e.stop();this.hasStarted&&(this.hasStarted=!1,this.forEachObserver((e=>{e.processingDidStop&&e.processingDidStop()})))}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}getInputMediaStream(){return __awaiter$S(this,void 0,void 0,(function*(){return this.inputVideoStream}))}getActiveOutputMediaStream(){return this.isOutputMediaStreamActive()||(this.outputMediaStream=this.canvasOutput.captureStream(this.framerate),this.cloneInputAudioTracksToOutput()),this.outputMediaStream}setInputMediaStream(e){return __awaiter$S(this,void 0,void 0,(function*(){if(!e)return void this.stop();if(0===e.getVideoTracks().length)return void this.logger.error("No video tracks in input media stream, ignoring");this.inputVideoStream=e;const t=this.inputVideoStream.getVideoTracks()[0].getSettings();this.logger.info(`processing pipeline input stream settings ${JSON.stringify(t)}`),this.canvasOutput.width=t.width,this.canvasOutput.height=t.height,this.videoInput.addEventListener("loadedmetadata",this.process),this.videoInput.srcObject=this.inputVideoStream,this.videoInput.setAttribute("playsinline","true");const i=new CanvasVideoFrameBuffer_1$1.default(this.canvasInput);this.sourceBuffers.push(i),this.videoInput.load();try{yield this.videoInput.play()}catch(e){this.logger.warn("Video element play() overrided by another load().")}this.cloneInputAudioTracksToOutput()}))}cloneInputAudioTracksToOutput(){if(this.isOutputMediaStreamActive()&&null!==this.inputVideoStream){for(const e of this.outputMediaStream.getAudioTracks())this.logger.info(`Removing audio track ${e.id} from output stream`),this.outputMediaStream.removeTrack(e);for(const e of this.inputVideoStream.getAudioTracks())this.logger.info(`Adding audio track ${e.id} to output stream`),this.outputMediaStream.addTrack(e)}else this.logger.info("Not cloning input audio tracks to output, do not have media streams ready")}isOutputMediaStreamActive(){return this.outputMediaStream&&this.outputMediaStream.active}set processors(e){this.stages=e}get processors(){return this.stages}forEachObserver(e){for(const t of this.observers)setTimeout((()=>{e(t)}),0)}destroyInputMediaStreamAndBuffers(){if(this.inputVideoStream)for(const e of this.inputVideoStream.getTracks())e.stop();this.inputVideoStream=null;for(const e of this.sourceBuffers)e.destroy();this.sourceBuffers=[]}}DefaultVideoFrameProcessorPipeline$1.default=DefaultVideoFrameProcessorPipeline;var __awaiter$R=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1o=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$9=__importDefault$1o(DefaultBrowserBehavior$1),DefaultVideoFrameProcessorPipeline_1=__importDefault$1o(DefaultVideoFrameProcessorPipeline$1);class DefaultVideoTransformDevice{constructor(e,t,i,n=new DefaultBrowserBehavior_1$9.default){this.logger=e,this.device=t,this.processors=i,this.browserBehavior=n,this.observers=new Set,this.pipe=new DefaultVideoFrameProcessorPipeline_1.default(this.logger,this.processors),this.pipe.addObserver(this)}get outputMediaStream(){return this.pipe.outputMediaStream}passEventControllerToProcessors(e){if(this.pipe.processors)for(const t of this.pipe.processors)"function"==typeof t.setEventController&&t.setEventController(e)}chooseNewInnerDevice(e){const t=new DefaultVideoTransformDevice(this.logger,e,this.processors,this.browserBehavior);return t.pipe=this.pipe,t}getInnerDevice(){return this.device}intrinsicDevice(){return __awaiter$R(this,void 0,void 0,(function*(){return this.device}))}transformStream(e){return __awaiter$R(this,void 0,void 0,(function*(){return yield this.pipe.setInputMediaStream(e),this.inputMediaStream=e,this.pipe.getActiveOutputMediaStream()}))}onOutputStreamDisconnect(){this.logger.info("DefaultVideoTransformDevice: detach stopping input media stream");const e=this.device&&this.device.id;if(this.pipe.stop(),!e&&this.inputMediaStream)for(const e of this.inputMediaStream.getVideoTracks())e.stop()}stop(){return __awaiter$R(this,void 0,void 0,(function*(){if(this.inputMediaStream)for(const e of this.inputMediaStream.getVideoTracks())e.stop();this.pipe.destroy(),this.inputMediaStream=null}))}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}processingDidStart(){this.logger.info("video transform device processing started"),this.forEachObserver((e=>{e.processingDidStart&&e.processingDidStart()}))}processingLatencyTooHigh(e){this.forEachObserver((t=>{t.processingLatencyTooHigh&&t.processingLatencyTooHigh(e)}))}processingDidFailToStart(){this.logger.info("video transform device processing failed to start"),this.forEachObserver((e=>{e.processingDidFailToStart&&e.processingDidFailToStart()}))}processingDidStop(){this.logger.info("video transform device processing stopped"),this.forEachObserver((e=>{e.processingDidStop&&e.processingDidStop()}))}forEachObserver(e){for(const t of this.observers)setTimeout((()=>{e(t)}),0)}}DefaultVideoTransformDevice$1.default=DefaultVideoTransformDevice;var DefaultVideoTile$1={},DefaultModality$1={},__importDefault$1n=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultModality$1,"__esModule",{value:!0});const ContentShareConstants_1$3=__importDefault$1n(ContentShareConstants$1);class DefaultModality{constructor(e){this._id=e}id(){return this._id}base(){return this._id?this._id.split(DefaultModality.MODALITY_SEPARATOR)[0]:""}modality(){if(!this._id)return"";const e=this._id.split(DefaultModality.MODALITY_SEPARATOR);return 2===e.length?e[1]:""}hasModality(e){return""!==e&&this.modality()===e}withModality(e){const t=new DefaultModality(this.base()+DefaultModality.MODALITY_SEPARATOR+e);return""===e||""===this.base()||new DefaultModality(t._id).modality()!==e?new DefaultModality(this.base()):t}}DefaultModality$1.default=DefaultModality,DefaultModality.MODALITY_SEPARATOR=ContentShareConstants_1$3.default.Modality[0],DefaultModality.MODALITY_CONTENT=ContentShareConstants_1$3.default.Modality.substr(1);var VideoTileState$1={};Object.defineProperty(VideoTileState$1,"__esModule",{value:!0});class VideoTileState{constructor(){this.tileId=null,this.localTile=!1,this.localTileStarted=!1,this.isContent=!1,this.active=!1,this.paused=!1,this.poorConnection=!1,this.boundAttendeeId=null,this.boundExternalUserId=null,this.boundVideoStream=null,this.boundVideoElement=null,this.nameplate=null,this.videoStreamContentWidth=null,this.videoStreamContentHeight=null,this.videoElementCSSWidthPixels=null,this.videoElementCSSHeightPixels=null,this.devicePixelRatio=0,this.videoElementPhysicalWidthPixels=null,this.videoElementPhysicalHeightPixels=null,this.streamId=null}clone(){const e=new VideoTileState;return e.tileId=this.tileId,e.localTile=this.localTile,e.isContent=this.isContent,e.active=this.active,e.paused=this.paused,e.poorConnection=this.poorConnection,e.boundAttendeeId=this.boundAttendeeId,e.boundExternalUserId=this.boundExternalUserId,e.boundVideoStream=this.boundVideoStream,e.boundVideoElement=this.boundVideoElement,e.nameplate=this.nameplate,e.videoStreamContentWidth=this.videoStreamContentWidth,e.videoStreamContentHeight=this.videoStreamContentHeight,e.videoElementCSSWidthPixels=this.videoElementCSSWidthPixels,e.videoElementCSSHeightPixels=this.videoElementCSSHeightPixels,e.devicePixelRatio=this.devicePixelRatio,e.videoElementPhysicalWidthPixels=this.videoElementPhysicalWidthPixels,e.videoElementPhysicalHeightPixels=this.videoElementPhysicalHeightPixels,e.streamId=this.streamId,e}}VideoTileState$1.default=VideoTileState;var __importDefault$1m=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoTile$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$8=__importDefault$1m(DefaultBrowserBehavior$1),DefaultModality_1$6=__importDefault$1m(DefaultModality$1),VideoTileState_1=__importDefault$1m(VideoTileState$1);class DefaultVideoTile{constructor(e,t,i,n){this.tileController=i,this.devicePixelRatioMonitor=n,this.tileState=new VideoTileState_1.default,this.tileState.tileId=e,this.tileState.localTile=t,this.devicePixelRatioMonitor.registerObserver(this)}static connectVideoStreamToVideoElement(e,t,i){const n=i&&"environment"!==e.getVideoTracks()[0].getSettings().facingMode?"rotateY(180deg)":"";if(DefaultVideoTile.setVideoElementFlag(t,"disablePictureInPicture",i),DefaultVideoTile.setVideoElementFlag(t,"disableRemotePlayback",i),t.style.transform!==n&&(t.style.transform=n),t.hasAttribute("controls")&&t.removeAttribute("controls"),t.hasAttribute("autoplay")||t.setAttribute("autoplay","true"),t.hasAttribute("playsinline")||t.setAttribute("playsinline","true"),t.hasAttribute("muted")||(t.setAttribute("muted","true"),t.muted=!0),t.srcObject!==e&&(t.srcObject=e,(new DefaultBrowserBehavior_1$8.default).requiresVideoPlayWorkaround()&&t.paused)){const e=t.play();void 0!==e&&e.catch((e=>{console.warn("Error playing video in Safari",e)})).then((()=>{console.debug("Video played successfully in Safari")}))}}static disconnectVideoStreamFromVideoElement(e,t,i=!1){if(e)if(t)i||(e.srcObject=null,e.style.transform="");else{if(!e.srcObject)return;e.pause(),e.style.transform="",DefaultVideoTile.setVideoElementFlag(e,"disablePictureInPicture",!1),DefaultVideoTile.setVideoElementFlag(e,"disableRemotePlayback",!1),e.srcObject=null}}destroy(){this.devicePixelRatioMonitor.removeObserver(this),this.tileState.boundVideoElement&&this.tileState.boundVideoElement.srcObject===this.tileState.boundVideoStream&&DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,!1),this.tileState=new VideoTileState_1.default}devicePixelRatioChanged(e){this.tileState.devicePixelRatio=e,this.sendTileStateUpdate()}id(){return this.tileState.tileId}state(){return this.tileState.clone()}stateRef(){return this.tileState}bindVideoStream(e,t,i,n,r,o,a){let s=!1;this.tileState.boundAttendeeId!==e&&(this.tileState.boundAttendeeId=e,new DefaultModality_1$6.default(e).hasModality(DefaultModality_1$6.default.MODALITY_CONTENT)&&(this.tileState.isContent=!0),s=!0),this.tileState.boundExternalUserId!==a&&(this.tileState.boundExternalUserId=a,s=!0),this.tileState.localTile!==t&&(this.tileState.localTile=t,s=!0),this.tileState.boundVideoStream!==i&&(this.tileState.boundVideoStream=i,s=!0),this.tileState.videoStreamContentWidth!==n&&(this.tileState.videoStreamContentWidth=n,s=!0),this.tileState.videoStreamContentHeight!==r&&(this.tileState.videoStreamContentHeight=r,s=!0),this.tileState.streamId!==o&&(this.tileState.streamId=o,s=!0),s&&this.sendTileStateUpdate()}bindVideoElement(e){let t=!1;this.tileState.boundVideoElement!==e&&(this.tileState.boundVideoElement=e,t=!0),null!==this.tileState.boundVideoElement?(this.tileState.videoElementCSSWidthPixels!==e.clientWidth&&(this.tileState.videoElementCSSWidthPixels=e.clientWidth,t=!0),this.tileState.videoElementCSSHeightPixels!==e.clientHeight&&(this.tileState.videoElementCSSHeightPixels=e.clientHeight,t=!0)):(this.tileState.videoElementCSSWidthPixels=null,this.tileState.videoElementCSSHeightPixels=null),t&&this.sendTileStateUpdate()}pause(){this.tileState.paused||(this.tileState.paused=!0,this.sendTileStateUpdate())}unpause(){this.tileState.paused&&(this.tileState.paused=!1,this.sendTileStateUpdate())}markPoorConnection(){return!this.tileState.poorConnection&&(this.tileState.poorConnection=!0,this.sendTileStateUpdate(),!0)}unmarkPoorConnection(){return!!this.tileState.poorConnection&&(this.tileState.poorConnection=!1,this.sendTileStateUpdate(),!0)}capture(){if(!this.tileState.active)return null;const e=document.createElement("canvas"),t=this.tileState.boundVideoElement;e.width=t.videoWidth||t.width,e.height=t.videoHeight||t.height;const i=e.getContext("2d");return i.drawImage(t,0,0,e.width,e.height),i.getImageData(0,0,e.width,e.height)}setStreamId(e){this.tileState.streamId=e,this.tileController.sendTileStateUpdate(this.state())}sendTileStateUpdate(){this.updateActiveState(),this.updateVideoStreamOnVideoElement(),this.updateVideoElementPhysicalPixels(),this.tileController.sendTileStateUpdate(this.state())}updateActiveState(){this.tileState.active=!(this.tileState.paused||this.tileState.poorConnection||!this.tileState.boundAttendeeId||!this.tileState.boundVideoElement||!this.tileState.boundVideoStream)}updateVideoElementPhysicalPixels(){"number"==typeof this.tileState.videoElementCSSWidthPixels&&"number"==typeof this.tileState.videoElementCSSHeightPixels?(this.tileState.videoElementPhysicalWidthPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSWidthPixels,this.tileState.videoElementPhysicalHeightPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSHeightPixels):(this.tileState.videoElementPhysicalWidthPixels=null,this.tileState.videoElementPhysicalHeightPixels=null)}updateVideoStreamOnVideoElement(){this.tileState.active?DefaultVideoTile.connectVideoStreamToVideoElement(this.tileState.boundVideoStream,this.tileState.boundVideoElement,this.tileState.localTile):DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,this.tileState.paused,this.tileController.keepLastFrameWhenPaused)}static setVideoElementFlag(e,t,i){t in e&&(e[t]=i)}}DefaultVideoTile$1.default=DefaultVideoTile;var AudioTransformDevice={};function isAudioTransformDevice(e){return!!e&&"object"==typeof e&&"mute"in e&&"stop"in e&&"intrinsicDevice"in e}Object.defineProperty(AudioTransformDevice,"__esModule",{value:!0}),AudioTransformDevice.isAudioTransformDevice=void 0,AudioTransformDevice.isAudioTransformDevice=isAudioTransformDevice;var DeviceSelection$1={};Object.defineProperty(DeviceSelection$1,"__esModule",{value:!0});class DeviceSelection{constructor(){this.groupId=""}matchesConstraints(e){return JSON.stringify(this.constraints)===JSON.stringify(e)}}DeviceSelection$1.default=DeviceSelection;var GetUserMediaError$1={};Object.defineProperty(GetUserMediaError$1,"__esModule",{value:!0});class GetUserMediaError extends Error{constructor(e,t){super(t||"Error fetching device."),this.cause=e,this.name="GetUserMediaError"}}GetUserMediaError$1.default=GetUserMediaError;var NotFoundError$1={},__importDefault$1l=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NotFoundError$1,"__esModule",{value:!0});const GetUserMediaError_1$5=__importDefault$1l(GetUserMediaError$1);class NotFoundError extends GetUserMediaError_1$5.default{constructor(e){super(e),this.name="NotFoundError"}}NotFoundError$1.default=NotFoundError;var NotReadableError$1={},__importDefault$1k=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NotReadableError$1,"__esModule",{value:!0});const GetUserMediaError_1$4=__importDefault$1k(GetUserMediaError$1);class NotReadableError extends GetUserMediaError_1$4.default{constructor(e){super(e),this.name="NotReadableError"}}NotReadableError$1.default=NotReadableError;var OverconstrainedError$1={},__importDefault$1j=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(OverconstrainedError$1,"__esModule",{value:!0});const GetUserMediaError_1$3=__importDefault$1j(GetUserMediaError$1);class OverconstrainedError extends GetUserMediaError_1$3.default{constructor(e,t){super(e),this.constraint=t,this.name="OverconstrainedError"}}OverconstrainedError$1.default=OverconstrainedError;var PermissionDeniedError$1={},__importDefault$1i=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PermissionDeniedError$1,"__esModule",{value:!0});const GetUserMediaError_1$2=__importDefault$1i(GetUserMediaError$1);class PermissionDeniedError extends GetUserMediaError_1$2.default{constructor(e,t){super(e,t),this.name="PermissionDeniedError"}}PermissionDeniedError$1.default=PermissionDeniedError;var _TypeError={},__importDefault$1h=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_TypeError,"__esModule",{value:!0});const GetUserMediaError_1$1=__importDefault$1h(GetUserMediaError$1);let TypeError$1=class extends GetUserMediaError_1$1.default{constructor(e){super(e),this.name="TypeError"}};_TypeError.default=TypeError$1;var VideoQualitySettings$1={};Object.defineProperty(VideoQualitySettings$1,"__esModule",{value:!0});class VideoQualitySettings{constructor(e,t,i){this.videoWidth=e,this.videoHeight=t,this.videoFrameRate=i}equals(e){return this.videoWidth===e.videoWidth&&this.videoHeight===e.videoHeight&&this.videoFrameRate===e.videoFrameRate}}VideoQualitySettings$1.default=VideoQualitySettings,VideoQualitySettings.VideoDisabled=new VideoQualitySettings(0,0,0),VideoQualitySettings.VideoResolutionHD=new VideoQualitySettings(1280,720,30),VideoQualitySettings.VideoResolutionFHD=new VideoQualitySettings(1920,1080,30),VideoQualitySettings.VideoResolutionUHD=new VideoQualitySettings(3840,2160,30);var VideoTransformDevice={};function isVideoTransformDevice(e){return!!e&&"object"==typeof e&&"transformStream"in e&&"stop"in e&&"intrinsicDevice"in e}Object.defineProperty(VideoTransformDevice,"__esModule",{value:!0}),VideoTransformDevice.isVideoTransformDevice=void 0,VideoTransformDevice.isVideoTransformDevice=isVideoTransformDevice;var __awaiter$Q=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1g=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultDeviceController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$7=__importDefault$1g(DefaultBrowserBehavior$1),DefaultMediaDeviceFactory_1=__importDefault$1g(DefaultMediaDeviceFactory$1),AsyncScheduler_1$6=__importDefault$1g(AsyncScheduler$1),PromiseQueue_1=__importDefault$1g(PromiseQueue$1),Types_1$8=Types,DefaultVideoTransformDevice_1=__importDefault$1g(DefaultVideoTransformDevice$1),DefaultVideoTile_1$2=__importDefault$1g(DefaultVideoTile$1),AudioTransformDevice_1=AudioTransformDevice,DeviceSelection_1=__importDefault$1g(DeviceSelection$1),GetUserMediaError_1=__importDefault$1g(GetUserMediaError$1),NotFoundError_1=__importDefault$1g(NotFoundError$1),NotReadableError_1=__importDefault$1g(NotReadableError$1),OverconstrainedError_1=__importDefault$1g(OverconstrainedError$1),PermissionDeniedError_1$1=__importDefault$1g(PermissionDeniedError$1),TypeError_1=__importDefault$1g(_TypeError),VideoQualitySettings_1$5=__importDefault$1g(VideoQualitySettings$1),VideoTransformDevice_1$1=VideoTransformDevice;class DefaultDeviceController{constructor(e,t,i=new DefaultBrowserBehavior_1$7.default,n){this.logger=e,this.browserBehavior=i,this.eventController=n,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=void 0,this.deviceChangeObservers=new Set,this.mediaStreamBrokerObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.useMediaConstraintsFallback=!0,this.audioInputTaskQueue=new PromiseQueue_1.default,this.videoInputTaskQueue=new PromiseQueue_1.default,this.muted=!1,this.mediaStreamMuteObserver=(e,t)=>{for(const i of this.deviceChangeObservers)AsyncScheduler_1$6.default.nextTick((()=>{this.deviceChangeObservers.has(i)&&i.audioInputMuteStateChanged&&i.audioInputMuteStateChanged(e,t)}))},this.alreadyHandlingDeviceChange=!1;const{enableWebAudio:r=!1,useMediaConstraintsFallback:o=!0}=t||{};this.useWebAudio=r,this.useMediaConstraintsFallback=o,this.videoInputQualitySettings=new VideoQualitySettings_1$5.default(DefaultDeviceController.defaultVideoWidth,DefaultDeviceController.defaultVideoHeight,DefaultDeviceController.defaultVideoFrameRate);const a=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=a[0],this.videoInputQualitySettings.videoHeight=a[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=(new DefaultMediaDeviceFactory_1.default).create();const e=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(e)}`)}catch(t){e.error(t.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var e;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},null===(e=this.mediaDeviceWrapper)||void 0===e||e.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var e;this.isWatchingForDeviceChanges()&&(this.logger.info("Stopping devicechange listener."),null===(e=this.mediaDeviceWrapper)||void 0===e||e.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){if(this.deviceChangeObservers.size)return!0;return this.activeDevices.audio&&null!==this.activeDevices.audio.constraints||this.activeDevices.video&&null!==this.activeDevices.video.constraints||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){return __awaiter$Q(this,void 0,void 0,(function*(){this.stopWatchingDeviceChanges(),yield this.stopAudioInput(),yield this.stopVideoInput()}))}listAudioInputDevices(e=!1){return __awaiter$Q(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("audioinput",e);return this.trace("listAudioInputDevices",e,t),t}))}listVideoInputDevices(e=!1){return __awaiter$Q(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("videoinput",e);return this.trace("listVideoInputDevices",e,t),t}))}listAudioOutputDevices(e=!1){return __awaiter$Q(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("audiooutput",e);return this.trace("listAudioOutputDevices",e,t),t}))}pushAudioMeetingStateForPermissions(e){var t;null===(t=this.eventController)||void 0===t||t.publishEvent(void 0===e?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions(e){var t;null===(t=this.eventController)||void 0===t||t.publishEvent(void 0===e?"videoInputUnselected":"videoInputSelected")}startAudioInput(e){return __awaiter$Q(this,void 0,void 0,(function*(){return yield this.audioInputTaskQueue.add((()=>this.startAudioInputTask(e)))}))}startAudioInputTask(e){var t;return __awaiter$Q(this,void 0,void 0,(function*(){if(void 0!==e)try{return AudioTransformDevice_1.isAudioTransformDevice(e)?(this.logger.info(`Choosing transform input device ${e}`),yield this.chooseAudioTransformInputDevice(e)):(this.logger.info(`Choosing intrinsic audio input device ${e}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",e)),this.trace("startAudioInputDevice",e,"success"),this.useWebAudio?(this.attachAudioInputStreamToAudioContext(this.activeDevices.audio.stream),this.pushAudioMeetingStateForPermissions(this.getMediaStreamDestinationNode().stream),yield null===(t=this.transform)||void 0===t?void 0:t.device.mute(this.muted),this.getMediaStreamDestinationNode().stream):(this.publishAudioInputDidChangeEvent(this.activeDevices.audio.stream),this.activeDevices.audio.stream)}catch(e){throw e}else this.logger.error("Audio input device cannot be undefined")}))}stopAudioInput(){return __awaiter$Q(this,void 0,void 0,(function*(){return this.audioInputTaskQueue.add((()=>this.stopAudioInputTask()))}))}stopAudioInputTask(){return __awaiter$Q(this,void 0,void 0,(function*(){try{if(this.useWebAudio)return void this.releaseAudioTransformStream();this.stopTracksAndRemoveCallbacks("audio")}finally{this.watchForDeviceChangesIfNecessary(),this.publishAudioInputDidChangeEvent(void 0)}}))}chooseAudioTransformInputDevice(e){var t;return __awaiter$Q(this,void 0,void 0,(function*(){if((null===(t=this.transform)||void 0===t?void 0:t.device)===e)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");const i=DefaultDeviceController.getAudioContext();if(i instanceof OfflineAudioContext);else switch(i.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield i.resume()}let n;try{n=yield e.createAudioNode(i)}catch(e){throw this.logger.error(`Unable to create transform device node: ${e}.`),e}const r=yield e.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",r),this.logger.debug(`Got inner stream: ${r}.`),this.setTransform(e,n)}))}chooseVideoTransformInputDevice(e){var t;return __awaiter$Q(this,void 0,void 0,(function*(){if(this.eventController&&e instanceof DefaultVideoTransformDevice_1.default&&e.passEventControllerToProcessors(this.eventController),e===this.chosenVideoTransformDevice)return void this.logger.info("Reselecting same VideoTransformDevice");const i=this.chosenVideoTransformDevice;i&&this.logger.info("Switched from previous VideoTransformDevice");const n=!!i,r=yield e.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId(null===(t=this.activeDevices.video)||void 0===t?void 0:t.stream,r))return this.logger.info("video transform device needs new intrinsic device"),n&&i.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=e,this.activeDevices.video=null,yield this.chooseInputIntrinsicDevice("video",r),this.logger.info("apply processors to transform"),void(yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream));this.chosenVideoTransformDevice=e,this.logger.info("video transform device uses previous stream"),this.logger.info("apply processors to transform"),yield e.transformStream(this.activeDevices.video.stream)}))}startVideoInput(e){return __awaiter$Q(this,void 0,void 0,(function*(){return yield this.videoInputTaskQueue.add((()=>this.startVideoInputTask(e)))}))}startVideoInputTask(e){return __awaiter$Q(this,void 0,void 0,(function*(){if(e)try{return VideoTransformDevice_1$1.isVideoTransformDevice(e)?(this.logger.info(`Choosing video transform device ${e}`),yield this.chooseVideoTransformInputDevice(e),this.publishVideoInputDidChangeEvent(this.chosenVideoTransformDevice.outputMediaStream),this.chosenVideoTransformDevice.outputMediaStream):(this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",e),this.trace("startVideoInputDevice",e),this.publishVideoInputDidChangeEvent(this.activeDevices.video.stream),this.activeDevices.video.stream)}catch(e){throw e}else this.logger.error("Invalid video input device")}))}stopVideoInput(){return __awaiter$Q(this,void 0,void 0,(function*(){return this.videoInputTaskQueue.add((()=>this.stopVideoInputTask()))}))}stopVideoInputTask(){return __awaiter$Q(this,void 0,void 0,(function*(){try{if(this.chosenVideoInputIsTransformDevice())return void this.releaseVideoTransformStream();this.stopTracksAndRemoveCallbacks("video")}finally{this.watchForDeviceChangesIfNecessary(),this.publishVideoInputDidChangeEvent(void 0)}}))}chooseAudioOutput(e){return __awaiter$Q(this,void 0,void 0,(function*(){this.audioOutputDeviceId=e,this.watchForDeviceChangesIfNecessary();const t=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);this.publishAudioOutputDidChangeEvent(t),this.trace("chooseAudioOutput",e,null)}))}addDeviceChangeObserver(e){this.logger.info("adding device change observer"),this.deviceChangeObservers.add(e),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(e){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete(e),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var e,t;if(!this.activeDevices.audio)return null;const i=null===(t=null===(e=this.transform)||void 0===e?void 0:e.nodes)||void 0===t?void 0:t.end;if(i){const e=i.context.createAnalyser();return e.removeOriginalInputs=()=>{try{i.disconnect(e)}catch(e){}},i.connect(e),e}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream(e){const t=DefaultDeviceController.getAudioContext(),i=t.createAnalyser(),n=t.createMediaStreamSource(e);return n.connect(i),this.trace("createAnalyserNodeForAudioInput"),i.removeOriginalInputs=()=>{try{n.disconnect(i)}catch(e){}},i}startVideoPreviewForVideoInput(e){if(!this.activeDevices.video)return this.logger.warn("cannot bind video preview since video input device has not been chosen"),void this.trace("startVideoPreviewForVideoInput",e.id);DefaultVideoTile_1$2.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream,e,!0),this.trace("startVideoPreviewForVideoInput",e.id)}stopVideoPreviewForVideoInput(e){DefaultVideoTile_1$2.default.disconnectVideoStreamFromVideoElement(e,!1),this.trace("stopVideoPreviewForVideoInput",e.id)}setDeviceLabelTrigger(e){if(this.deviceInfoCache)for(const e of this.deviceInfoCache)if(!e.label){this.deviceInfoCache=null;break}this.deviceLabelTrigger=e,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(e){let t=null;return this.useWebAudio?(t=DefaultDeviceController.getAudioContext().createMediaStreamSource(e),t.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",e.id),t}chooseVideoInputQuality(e,t,i){const n=this.browserBehavior.requiresResolutionAlignment(e,t);this.videoInputQualitySettings=new VideoQualitySettings_1$5.default(n[0],n[1],i)}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return __awaiter$Q(this,void 0,void 0,(function*(){if(this.activeDevices.audio||(this.logger.info("No audio device chosen, creating empty audio device"),yield this.startAudioInput(null)),this.useWebAudio){return this.getMediaStreamDestinationNode().stream}return this.activeDevices.audio.stream}))}acquireVideoInputStream(){return __awaiter$Q(this,void 0,void 0,(function*(){if(!this.activeDevices.video)throw new Error("No video device chosen");return this.chosenVideoInputIsTransformDevice()?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream}))}acquireDisplayInputStream(e){return __awaiter$Q(this,void 0,void 0,(function*(){throw new Error("unsupported")}))}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks(e){const t=this.activeDevices[e];if(!t)return;const i=t.endedCallback,n=t.trackMuteCallback,r=t.trackUnmuteCallback;for(const o of t.stream.getTracks())o.stop(),i&&o.removeEventListener("ended",i),n&&o.removeEventListener("mute",n),r&&o.removeEventListener("unmute",r),delete t.endedCallback,delete t.trackMuteCallback,delete t.trackUnmuteCallback,delete this.activeDevices[e]}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}muteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!1)}unmuteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!0)}toggleLocalAudioInputStream(e){var t;let i=this.activeDevices.audio;if(this.useWebAudio&&(i=this.getMediaStreamDestinationNode()),i){for(const t of i.stream.getTracks())t.enabled!==e&&(t.enabled=e);this.muted!==!e&&(this.muted=!e,null===(t=this.transform)||void 0===t||t.device.mute(this.muted))}}static getIntrinsicDeviceId(e){if(!e)return;if("string"==typeof e)return e;if(e.id)return e.id;const t=e.deviceId;if(!t)return;if("string"==typeof t||Array.isArray(t))return t;const i=t;return"string"==typeof i.exact||Array.isArray(i.exact)?i.exact:void 0}static createEmptyAudioDevice(){return DefaultDeviceController.synthesizeAudioDevice(0)}static synthesizeAudioDevice(e){const t=DefaultDeviceController.getAudioContext(),i=t.createMediaStreamDestination();if(e){const n=t.createGain();n.gain.value=.1,n.connect(i);const r=t.createOscillator();r.frequency.value=e,r.connect(n),r.start()}else{const e=t.createBufferSource();try{e.buffer=t.createBuffer(1,5*t.sampleRate,t.sampleRate)}catch(i){if(!i||"NotSupportedError"!==i.name)throw i;e.buffer=t.createBuffer(1,5*DefaultDeviceController.defaultSampleRate,DefaultDeviceController.defaultSampleRate)}e.buffer.getChannelData(0)[0]=3e-4,e.loop=!0,e.connect(i),e.start()}return i.stream}listDevicesOfKind(e,t){return __awaiter$Q(this,void 0,void 0,(function*(){return!t&&null!==this.deviceInfoCache&&this.isWatchingForDeviceChanges()||(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind(e)}))}updateDeviceInfoCacheFromBrowser(){var e;return __awaiter$Q(this,void 0,void 0,(function*(){if("undefined"==typeof MediaDeviceInfo)return void(this.deviceInfoCache=[]);let t=yield navigator.mediaDevices.enumerateDevices(),i=!0;for(const e of t)if(!e.label){i=!1;break}if(!i)try{this.logger.info("attempting to trigger media device labels since they are hidden");const e=yield this.deviceLabelTrigger();t=yield navigator.mediaDevices.enumerateDevices();for(const t of e.getTracks())t.stop()}catch(t){this.logger.info("unable to get media device labels"),null===(e=this.eventController)||void 0===e||e.publishEvent("deviceLabelTriggerFailed",{deviceLabelTriggerErrorMessage:this.getErrorMessage(t)})}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(t)}`),this.deviceInfoCache=t}))}listCachedDevicesOfKind(e){const t=[];if(this.deviceInfoCache)for(const i of this.deviceInfoCache)i.kind===e&&t.push(i);return t}handleDeviceChange(){return __awaiter$Q(this,void 0,void 0,(function*(){if(null===this.deviceInfoCache)return;if(this.alreadyHandlingDeviceChange)return void AsyncScheduler_1$6.default.nextTick((()=>{this.handleDeviceChange()}));this.alreadyHandlingDeviceChange=!0;const e=this.listCachedDevicesOfKind("audioinput"),t=this.listCachedDevicesOfKind("videoinput"),i=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();const n=this.listCachedDevicesOfKind("audioinput"),r=this.listCachedDevicesOfKind("videoinput"),o=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver((a=>{this.areDeviceListsEqual(e,n)||Types_1$8.Maybe.of(a.audioInputsChanged).map((e=>e.bind(a)(n))),this.areDeviceListsEqual(t,r)||Types_1$8.Maybe.of(a.videoInputsChanged).map((e=>e.bind(a)(r))),this.areDeviceListsEqual(i,o)||Types_1$8.Maybe.of(a.audioOutputsChanged).map((e=>e.bind(a)(o)))})),this.alreadyHandlingDeviceChange=!1}))}handleDeviceStreamEnded(e,t){return __awaiter$Q(this,void 0,void 0,(function*(){try{"audio"===e?(this.logger.warn("Audio input device which was active is no longer available, resetting to null device"),yield this.startAudioInput(null)):(this.logger.warn("Video input device which was active is no longer available, stopping video"),yield this.stopVideoInput())}catch(e){this.logger.error("Failed to choose null device after stream ended.")}"audio"===e?this.forEachObserver((e=>{Types_1$8.Maybe.of(e.audioInputStreamEnded).map((i=>i.bind(e)(t)))})):this.forEachObserver((e=>{Types_1$8.Maybe.of(e.videoInputStreamEnded).map((i=>i.bind(e)(t)))}))}))}forEachObserver(e){for(const t of this.deviceChangeObservers)AsyncScheduler_1$6.default.nextTick((()=>{this.deviceChangeObservers.has(t)&&e(t)}))}forEachMediaStreamBrokerObserver(e){for(const t of this.mediaStreamBrokerObservers)AsyncScheduler_1$6.default.nextTick((()=>{this.mediaStreamBrokerObservers.has(t)&&e(t)}))}areDeviceListsEqual(e,t){return JSON.stringify(e.map((e=>JSON.stringify(e))).sort())===JSON.stringify(t.map((e=>JSON.stringify(e))).sort())}intrinsicDeviceAsMediaStream(e){return e&&e.id?e:null}hasSameMediaStreamId(e,t,i){var n,r,o,a;let s;return"audio"===e?(s=null==i?void 0:i.audio.streamId,!!s&&s===(null===(r=null===(n=t.constraints)||void 0===n?void 0:n.audio)||void 0===r?void 0:r.streamId)):(s=null==i?void 0:i.video.streamId,!!s&&s===(null===(a=null===(o=null==t?void 0:t.constraints)||void 0===o?void 0:o.video)||void 0===a?void 0:a.streamId))}hasSameGroupId(e,t,i){if(""===e)return!0;const n=DefaultDeviceController.getIntrinsicDeviceId(i);return this.logger.debug(`Checking deviceIds ${n} of type ${typeof n} with groupId ${e}`),"string"==typeof n&&e===this.getGroupIdFromDeviceId(t,n)}getGroupIdFromDeviceId(e,t){if(null!==this.deviceInfoCache){const i=this.listCachedDevicesOfKind(`${e}input`).find((e=>e.deviceId===t));if(i&&i.groupId)return this.logger.debug(`GroupId of deviceId ${t} found in cache is ${i.groupId}`),i.groupId}return this.logger.debug(`GroupId of deviceId ${t} found in cache is empty`),""}handleGetUserMediaError(e,t){if(!e)throw new GetUserMediaError_1.default(e);switch(e.name){case"NotReadableError":case"TrackStartError":throw new NotReadableError_1.default(e);case"NotFoundError":case"DevicesNotFoundError":throw new NotFoundError_1.default(e);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw t&&t<DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs?new PermissionDeniedError_1$1.default(e,"Permission denied by browser"):new PermissionDeniedError_1$1.default(e,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new OverconstrainedError_1.default(e);case"TypeError":throw new TypeError_1.default(e);default:throw new GetUserMediaError_1.default(e)}}matchesDeviceSelection(e,t,i,n){return!!(i&&i.stream.active&&(this.hasSameMediaStreamId(e,i,n)||null!==i.groupId&&this.hasSameGroupId(i.groupId,e,t)))&&(this.logger.debug(`Compare current device constraint ${JSON.stringify(i.constraints)} to proposed constraints ${JSON.stringify(n)}`),i.matchesConstraints(n))}chooseInputIntrinsicDevice(e,t){var i,n;return __awaiter$Q(this,void 0,void 0,(function*(){const r=this.getMediaStreamConstraints(e,t);if(this.matchesDeviceSelection(e,t,this.activeDevices[e],r))return void this.logger.info(`reusing existing ${e} input device`);this.activeDevices[e]&&this.activeDevices[e].stream&&this.stopTracksAndRemoveCallbacks(e);const o=Date.now(),a=new DeviceSelection_1.default;try{this.logger.info(`requesting new ${e} device with constraint ${JSON.stringify(r)}`);const i=this.intrinsicDeviceAsMediaStream(t);"audio"===e&&null===t?(a.stream=DefaultDeviceController.createEmptyAudioDevice(),a.constraints=null):i?(this.logger.info(`using media stream ${i.id} for ${e} device`),a.stream=i,a.constraints=r):(a.stream=yield navigator.mediaDevices.getUserMedia(r),a.constraints=r),yield this.handleNewInputDevice(e,a)}catch(s){const d=this.getErrorMessage(s);"audio"===e?null===(i=this.eventController)||void 0===i||i.publishEvent("audioInputFailed",{audioInputErrorMessage:d}):null===(n=this.eventController)||void 0===n||n.publishEvent("videoInputFailed",{videoInputErrorMessage:d}),this.logger.error(`failed to get ${e} device for constraints ${JSON.stringify(r)}: ${d}`);let l=!0;if(s&&"constraint"in s&&(this.logger.error(`Over-constrained by constraint: ${s.constraint}`),this.useMediaConstraintsFallback)){const i=this.getMediaStreamConstraints(e,t,!0),n=JSON.stringify(i);if(n!==JSON.stringify(r)){this.logger.info(`retry requesting new ${e} device with minimal constraint ${n}`);try{a.stream=yield navigator.mediaDevices.getUserMedia(i),a.constraints=i,yield this.handleNewInputDevice(e,a),l=!1}catch(t){this.logger.error(`failed to get ${e} device for constraints ${n}: ${this.getErrorMessage(t)}`)}}}if(l){if("audio"===e){this.logger.info(`choosing null ${e} device instead`);try{a.stream=DefaultDeviceController.createEmptyAudioDevice(),a.constraints=null,yield this.handleNewInputDevice(e,a)}catch(t){this.logger.error(`failed to choose null ${e} device. ${t.name}: ${t.message}`)}}this.handleGetUserMediaError(s,Date.now()-o)}}finally{this.watchForDeviceChangesIfNecessary()}}))}getErrorMessage(e){return e?e.name&&e.message?`${e.name}: ${e.message}`:e.name?e.name:e.message?e.message:"UnknownError":"UnknownError"}handleNewInputDevice(e,t){var i;return __awaiter$Q(this,void 0,void 0,(function*(){this.logger.info(`got ${e} device for constraints ${JSON.stringify(t.constraints)}`);const n=null===(i=this.getMediaTrackSettings(t.stream))||void 0===i?void 0:i.deviceId;t.groupId=n?this.getGroupIdFromDeviceId(e,n):"",this.activeDevices[e]=t,this.logger.debug(`Set activeDevice to ${JSON.stringify(t)}`),this.watchForDeviceChangesIfNecessary();const r=t.stream.getTracks()[0];if(r&&(t.endedCallback=()=>{this.activeDevices[e]&&this.activeDevices[e].stream===t.stream&&(this.handleDeviceStreamEnded(e,n),delete t.endedCallback)},r.addEventListener("ended",t.endedCallback,{once:!0})),"audio"===e){const e=t.stream.getAudioTracks()[0];if(e){const i=e.getSettings().deviceId||t.stream;t.trackMuteCallback=()=>{this.mediaStreamMuteObserver(i,!0)},t.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(i,!1)},e.addEventListener("mute",t.trackMuteCallback,{once:!1}),e.addEventListener("unmute",t.trackUnmuteCallback,{once:!1}),this.logger.debug("Notifying mute state after selection"),e.muted?t.trackMuteCallback():t.trackUnmuteCallback()}}}))}calculateMediaStreamConstraints(e,t,i,n){if(n&&1===this.listCachedDevicesOfKind(`${e}input`).length)return!0;const r={};if(this.browserBehavior.requiresNoExactMediaStreamConstraints()?r.deviceId=t:r.deviceId={exact:t},i&&(r.groupId=i),n)return r;if("video"===e)return r.width={ideal:this.videoInputQualitySettings.videoWidth},r.height={ideal:this.videoInputQualitySettings.videoHeight},r.frameRate={ideal:this.videoInputQualitySettings.videoFrameRate},r;this.supportSampleRateConstraint()&&(r.sampleRate={ideal:DefaultDeviceController.defaultSampleRate}),this.supportSampleSizeConstraint()&&(r.sampleSize={ideal:DefaultDeviceController.defaultSampleSize}),this.supportChannelCountConstraint()&&(r.channelCount={ideal:DefaultDeviceController.defaultChannelCount});return Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},r)}getMediaStreamConstraintsFromTrackConstraints(e,t){return"audio"===e?{audio:t}:{video:t}}getMediaStreamConstraints(e,t,i=!1){let n={};if(!t)return null;const r=this.intrinsicDeviceAsMediaStream(t);if(r)return n.streamId=r.id,this.getMediaStreamConstraintsFromTrackConstraints(e,n);if("string"==typeof t){let r="";return this.browserBehavior.requiresGroupIdMediaStreamConstraints()&&(null!==this.deviceInfoCache?r=this.getGroupIdFromDeviceId(e,t):this.logger.error("Device cache is not populated. Please make sure to call list devices first")),n=this.calculateMediaStreamConstraints(e,t,r,i),this.getMediaStreamConstraintsFromTrackConstraints(e,n)}return isMediaDeviceInfo(t)?(n=this.calculateMediaStreamConstraints(e,t.deviceId,t.groupId,i),this.getMediaStreamConstraintsFromTrackConstraints(e,n)):(n=t,this.getMediaStreamConstraintsFromTrackConstraints(e,n))}deviceInfoFromDeviceId(e,t){if(null===this.deviceInfoCache)return null;for(const i of this.deviceInfoCache)if(i.kind===e&&i.deviceId===t)return i;return null}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId(e,t){if(!e||!e.active||!t)return!1;if(t.id)return e.id===t.id;const i=this.getMediaTrackSettings(e);if(!i.deviceId)return!1;const n=DefaultDeviceController.getIntrinsicDeviceId(t);return"string"==typeof n&&i.deviceId===n}getMediaTrackSettings(e){var t;return null===(t=e.getTracks()[0])||void 0===t?void 0:t.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();const e=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(e)}setTransform(e,t){var i,n;null===(n=null===(i=this.transform)||void 0===i?void 0:i.nodes)||void 0===n||n.end.disconnect(),this.transform={nodes:t,device:e};const r=null==t?void 0:t.end,o=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${r} to destination ${o}.`),null==r||r.connect(o),this.reconnectAudioInputs()}removeTransform(){var e;const t=this.transform;if(t)return null===(e=this.transform.nodes)||void 0===e||e.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),t}attachAudioInputStreamToAudioContext(e){var t;null===(t=this.audioInputSourceNode)||void 0===t||t.disconnect(),this.audioInputSourceNode=DefaultDeviceController.getAudioContext().createMediaStreamSource(e);const i=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(i)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=DefaultDeviceController.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var e,t;return(null===(t=null===(e=this.transform)||void 0===e?void 0:e.nodes)||void 0===t?void 0:t.start)||this.getMediaStreamDestinationNode()}static setDefaultLatencyHint(e){DefaultDeviceController.defaultLatencyHint=e}static getAudioContext(){if(!DefaultDeviceController.audioContext){const e={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&(e.sampleRate=DefaultDeviceController.defaultSampleRate);(new DefaultBrowserBehavior_1$7.default).requiresPlaybackLatencyHintForAudioContext()&&(e.latencyHint="playback"),DefaultDeviceController.defaultLatencyHint&&(e.latencyHint=DefaultDeviceController.defaultLatencyHint),DefaultDeviceController.audioContext=new(window.AudioContext||window.webkitAudioContext)(e)}return DefaultDeviceController.audioContext}static closeAudioContext(){if(DefaultDeviceController.audioContext)try{DefaultDeviceController.audioContext.close()}catch(e){}DefaultDeviceController.audioContext=null}addMediaStreamBrokerObserver(e){this.mediaStreamBrokerObservers.add(e)}removeMediaStreamBrokerObserver(e){this.mediaStreamBrokerObservers.delete(e)}publishVideoInputDidChangeEvent(e){this.forEachMediaStreamBrokerObserver((t=>{t.videoInputDidChange&&t.videoInputDidChange(e)})),this.pushVideoMeetingStateForPermissions(e)}publishAudioInputDidChangeEvent(e){this.forEachMediaStreamBrokerObserver((t=>{t.audioInputDidChange&&t.audioInputDidChange(e)})),this.pushAudioMeetingStateForPermissions(e)}publishAudioOutputDidChangeEvent(e){this.forEachMediaStreamBrokerObserver((t=>{t.audioOutputDidChange&&t.audioOutputDidChange(e)}))}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace(e,t,i){let n=`API/DefaultDeviceController/${e}`;void 0!==t&&(n+=` ${JSON.stringify(t)}`),void 0!==i&&(n+=` -> ${JSON.stringify(i)}`),this.logger.info(n)}}function isMediaDeviceInfo(e){return"object"==typeof e&&"deviceId"in e&&"groupId"in e&&"kind"in e&&"label"in e}DefaultDeviceController$1.default=DefaultDeviceController,DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs=500,DefaultDeviceController.defaultVideoWidth=960,DefaultDeviceController.defaultVideoHeight=540,DefaultDeviceController.defaultVideoFrameRate=15,DefaultDeviceController.defaultSampleRate=48e3,DefaultDeviceController.defaultSampleSize=16,DefaultDeviceController.defaultChannelCount=1,DefaultDeviceController.audioContext=null;var __awaiter$P=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1f=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ContentShareMediaStreamBroker$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$6=__importDefault$1f(DefaultBrowserBehavior$1),DefaultDeviceController_1$1=__importDefault$1f(DefaultDeviceController$1);class ContentShareMediaStreamBroker{constructor(e){this.logger=e}get mediaStream(){return this._mediaStream}set mediaStream(e){this._mediaStream=e}acquireAudioInputStream(){return __awaiter$P(this,void 0,void 0,(function*(){return 0===this._mediaStream.getAudioTracks().length?(this.logger.info("No audio stream available. Synthesizing an audio stream."),DefaultDeviceController_1$1.default.synthesizeAudioDevice(0)):this._mediaStream}))}acquireVideoInputStream(){return __awaiter$P(this,void 0,void 0,(function*(){return this._mediaStream}))}acquireDisplayInputStream(e){return __awaiter$P(this,void 0,void 0,(function*(){return e&&e.video&&e.video.mandatory&&e.video.mandatory.chromeMediaSource&&e.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(e):navigator.mediaDevices.getDisplayMedia(e)}))}acquireScreenCaptureDisplayInputStream(e,t){return __awaiter$P(this,void 0,void 0,(function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints(e,t))}))}screenCaptureDisplayMediaConstraints(e,t){return{audio:!(e||!(new DefaultBrowserBehavior_1$6.default).getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!e&&{frameRate:{max:t||ContentShareMediaStreamBroker.defaultFrameRate}}),e&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:t||ContentShareMediaStreamBroker.defaultFrameRate}})}}toggleMediaStream(e){let t=!1;if(this.mediaStream)for(let i=0;i<this.mediaStream.getTracks().length;i++)this.mediaStream.getTracks()[i].enabled!==e&&(this.mediaStream.getTracks()[i].enabled=e,t=!0);return t}cleanup(){if(this.mediaStream)for(let e=0;e<this.mediaStream.getTracks().length;e++){this.mediaStream.getTracks()[e].stop()}this.mediaStream=null}muteLocalAudioInputStream(){throw new Error("unsupported")}unmuteLocalAudioInputStream(){throw new Error("unsupported")}addMediaStreamBrokerObserver(e){}removeMediaStreamBrokerObserver(e){}}ContentShareMediaStreamBroker$1.default=ContentShareMediaStreamBroker,ContentShareMediaStreamBroker.defaultFrameRate=15;var CreatePeerConnectionTask$1={},__awaiter$O=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1e=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CreatePeerConnectionTask$1,"__esModule",{value:!0});const BaseTask_1$m=__importDefault$1e(BaseTask$1);class CreatePeerConnectionTask extends BaseTask_1$m.default{constructor(e){super(e.logger),this.context=e,this.taskName="CreatePeerConnectionTask",this.removeTrackAddedEventListener=null,this.removeTrackRemovedEventListeners={},this.trackEvents=["ended","mute","unmute","isolationchange","overconstrained"],this.removeVideoTrackEventListeners={},this.trackAddedHandler=e=>{const t=e.track;if(this.context.logger.info(`received track event: kind=${t.kind} id=${t.id} label=${t.label}`),e.transceiver&&"inactive"===e.transceiver.currentDirection)return;if(0===e.streams.length)return void this.context.logger.warn("Track event but no stream");const i=e.streams[0];"audio"===t.kind?this.context.audioMixController.bindAudioStream(i):"video"!==t.kind||this.trackIsVideoInput(t)||this.addRemoteVideoTrack(t,i)}}removeObserver(){this.removeTrackAddedEventListener&&this.removeTrackAddedEventListener();for(const e in this.removeTrackRemovedEventListeners)this.removeTrackRemovedEventListeners[e]()}addPeerConnectionEventLogger(){const e=this.context.peer;e.addEventListener("connectionstatechange",(()=>{this.context.logger.info(`peer connection state changed: ${e.connectionState}`)})),e.addEventListener("negotiationneeded",(()=>{this.context.logger.info("peer connection negotiation is needed")})),e.addEventListener("icegatheringstatechange",(()=>{this.context.logger.info(`peer connection ice gathering state changed: ${e.iceGatheringState}`)})),e.addEventListener("icecandidate",(e=>{this.context.logger.info(`peer connection ice candidate: ${e.candidate?e.candidate.candidate:"(null)"}`)})),e.addEventListener("iceconnectionstatechange",(()=>{this.context.logger.info(`peer connection ice connection state changed: ${e.iceConnectionState}`)}))}run(){return __awaiter$O(this,void 0,void 0,(function*(){this.context.removableObservers.push(this);const e=this.context.turnCredentials&&this.context.turnCredentials.uris.length>0?{iceServers:[{urls:this.context.turnCredentials.uris,username:this.context.turnCredentials.username,credential:this.context.turnCredentials.password,credentialType:"password"}],iceTransportPolicy:"relay"}:{};e.bundlePolicy=this.context.browserBehavior.requiresBundlePolicy(),e.sdpSemantics="unified-plan",e.encodedInsertableStreams=this.context.audioProfile.hasRedundancyEnabled(),this.context.peer?this.context.logger.info("reusing peer connection"):(this.context.logger.info("creating new peer connection"),this.context.peer=new RTCPeerConnection(e),this.addPeerConnectionEventLogger()),this.removeTrackAddedEventListener=()=>{this.context.peer&&this.context.peer.removeEventListener("track",this.trackAddedHandler),this.removeTrackAddedEventListener=null},this.context.peer.addEventListener("track",this.trackAddedHandler)}))}trackIsVideoInput(e){return!!this.context.transceiverController.useTransceivers()&&(this.logger.debug((()=>"getting video track type")),this.context.transceiverController.trackIsVideoInput(e))}addRemoteVideoTrack(e,t){var i;const n=t.id,r=this.context.videoStreamIndex.attendeeIdForTrack(n);let o,a;if(this.context.videoTileController.getVideoTileForAttendeeId?(a=this.context.videoTileController.getVideoTileForAttendeeId(r),o=!!(null===(i=null==a?void 0:a.state())||void 0===i?void 0:i.boundVideoStream)):o=this.context.videoTileController.haveVideoTileForAttendeeId(r),o)return void this.context.logger.info(`Not adding remote track. Already have tile for attendeeId:  ${r}`);a||(a=this.context.videoTileController.addVideoTile(),this.logger.info(`Created video tile ${a.id()}`));let s,d,l=this.context.videoStreamIndex.streamIdForTrack(n);void 0===l&&(this.logger.warn(`stream not found for tile=${a.id()} track=${n}`),l=null);for(let i=0;i<this.trackEvents.length;i++){const n=this.trackEvents[i],r=t.getVideoTracks();if(r&&r.length){const t=r[0],i=()=>{this.context.logger.info(`received the ${n} event for tile=${a.id()} id=${e.id} streamId=${l}`),"ended"===n&&this.removeRemoteVideoTrack(e,a.state())};t.addEventListener(n,i),this.removeVideoTrackEventListeners[e.id]||(this.removeVideoTrackEventListeners[e.id]=[]),this.removeVideoTrackEventListeners[e.id].push((()=>{t.removeEventListener(n,i)}))}}if(e.getSettings){const t=e.getSettings();s=t.width,d=t.height}else{const t=e.getCapabilities();s=t.width,d=t.height}const c=this.context.videoStreamIndex.externalUserIdForTrack(n);a.bindVideoStream(r,!1,t,s,d,l,c),this.logger.info(`video track added, use tile=${a.id()} track=${n} streamId=${l}`);const u="removetrack",h=t,p=()=>this.removeRemoteVideoTrack(e,a.state());this.removeTrackRemovedEventListeners[e.id]=()=>{h.removeEventListener(u,p),delete this.removeTrackRemovedEventListeners[e.id]},h.addEventListener(u,p)}removeRemoteVideoTrack(e,t){if(this.removeTrackRemovedEventListeners.hasOwnProperty(e.id)){this.removeTrackRemovedEventListeners[e.id]();for(const t of this.removeVideoTrackEventListeners[e.id])t();delete this.removeVideoTrackEventListeners[e.id]}this.logger.info(`video track ended, removing tile=${t.tileId} id=${e.id} stream=${t.streamId}`),t.streamId?this.context.videosPaused.remove(t.streamId):this.logger.warn(`no stream found for tile=${t.tileId}`),this.context.videoTileController.removeVideoTile(t.tileId)}}CreatePeerConnectionTask$1.default=CreatePeerConnectionTask,CreatePeerConnectionTask.REMOVE_HANDLER_INTERVAL_MS=1e4;var CreateSDPTask$1={},MeetingSessionStatusCode={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MeetingSessionStatusCode=void 0,function(e){e[e.OK=0]="OK",e[e.Left=1]="Left",e[e.AudioJoinedFromAnotherDevice=2]="AudioJoinedFromAnotherDevice",e[e.AudioAuthenticationRejected=3]="AudioAuthenticationRejected",e[e.AudioCallAtCapacity=4]="AudioCallAtCapacity",e[e.MeetingEnded=5]="MeetingEnded",e[e.AudioInternalServerError=6]="AudioInternalServerError",e[e.AudioServiceUnavailable=7]="AudioServiceUnavailable",e[e.AudioDisconnected=8]="AudioDisconnected",e[e.VideoCallSwitchToViewOnly=9]="VideoCallSwitchToViewOnly",e[e.VideoCallAtSourceCapacity=10]="VideoCallAtSourceCapacity",e[e.SignalingBadRequest=11]="SignalingBadRequest",e[e.SignalingInternalServerError=12]="SignalingInternalServerError",e[e.SignalingRequestFailed=13]="SignalingRequestFailed",e[e.ICEGatheringTimeoutWorkaround=14]="ICEGatheringTimeoutWorkaround",e[e.ConnectionHealthReconnect=15]="ConnectionHealthReconnect",e[e.RealtimeApiFailed=16]="RealtimeApiFailed",e[e.TaskFailed=17]="TaskFailed",e[e.IncompatibleSDP=18]="IncompatibleSDP",e[e.TURNCredentialsForbidden=19]="TURNCredentialsForbidden",e[e.NoAttendeePresent=20]="NoAttendeePresent",e[e.AudioAttendeeRemoved=21]="AudioAttendeeRemoved",e[e.AudioVideoWasRemovedFromPrimaryMeeting=22]="AudioVideoWasRemovedFromPrimaryMeeting",e[e.AudioDisconnectAudio=23]="AudioDisconnectAudio"}(t=e.MeetingSessionStatusCode||(e.MeetingSessionStatusCode={})),e.default=t}(MeetingSessionStatusCode);var SDP$1={},SDPCandidateType={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SDPCandidateType=void 0,function(e){e.Host="host",e.ServerReflexive="srflx",e.PeerReflexive="prflx",e.Relay="relay"}(t=e.SDPCandidateType||(e.SDPCandidateType={})),e.default=t}(SDPCandidateType);var SDPMediaSection$1={};Object.defineProperty(SDPMediaSection$1,"__esModule",{value:!0});class SDPMediaSection{}SDPMediaSection$1.default=SDPMediaSection;var VideoCodecCapability$1={};Object.defineProperty(VideoCodecCapability$1,"__esModule",{value:!0});const SignalingProtocol_1$2=SignalingProtocol;class VideoCodecCapability{constructor(e,t){this.codecName=e,this.codecCapability=t}equals(e){return void 0!==e&&this.codecName===e.codecName&&this.codecCapability.mimeType===e.codecCapability.mimeType&&this.codecCapability.clockRate===e.codecCapability.clockRate&&this.codecCapability.sdpFmtpLine===e.codecCapability.sdpFmtpLine}static vp8(){return new VideoCodecCapability("VP8",{clockRate:9e4,mimeType:"video/VP8"})}static h264ConstrainedBaselineProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"})}static h264(){return VideoCodecCapability.h264ConstrainedBaselineProfile()}static av1Main(){return new VideoCodecCapability("AV1",{clockRate:9e4,mimeType:"video/AV1"})}static vp9Profile0(){return new VideoCodecCapability("VP9",{clockRate:9e4,mimeType:"video/VP9",sdpFmtpLine:"profile-id=0"})}static fromSignaled(e){switch(e){case SignalingProtocol_1$2.SdkVideoCodecCapability.VP8:return VideoCodecCapability.vp8();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_CONSTRAINED_BASELINE_PROFILE:return VideoCodecCapability.h264ConstrainedBaselineProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.VP9_PROFILE_0:return this.vp9Profile0();case SignalingProtocol_1$2.SdkVideoCodecCapability.AV1_MAIN:return this.av1Main();default:return}}}VideoCodecCapability$1.default=VideoCodecCapability;var __importDefault$1d=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SDP$1,"__esModule",{value:!0});const SDPCandidateType_1=__importDefault$1d(SDPCandidateType),SDPMediaSection_1=__importDefault$1d(SDPMediaSection$1),VideoCodecCapability_1$2=__importDefault$1d(VideoCodecCapability$1);class SDP{constructor(e){this.sdp=e}clone(){return new SDP(this.sdp)}static isRTPCandidate(e){const t=/candidate[:](\S+) (\d+)/g.exec(e);return null!==t&&"1"===t[2]}static linesToSDP(e){return new SDP(e.join(SDP.CRLF))}static candidateTypeFromString(e){switch(e){case SDPCandidateType_1.default.Host:return SDPCandidateType_1.default.Host;case SDPCandidateType_1.default.ServerReflexive:return SDPCandidateType_1.default.ServerReflexive;case SDPCandidateType_1.default.PeerReflexive:return SDPCandidateType_1.default.PeerReflexive;case SDPCandidateType_1.default.Relay:return SDPCandidateType_1.default.Relay}return null}static candidateType(e){const t=/a[=]candidate[:].* typ ([a-z]+) /g.exec(e);return null===t?null:SDP.candidateTypeFromString(t[1])}static mediaType(e){const t=/m=(audio|video)/g.exec(e);if(null!==t)return t[1]}static mid(e){if(e.includes("a=mid:"))return e.replace(/^(a=mid:)/,"")}static direction(e){const t=/a=(sendrecv|sendonly|recvonly|inactive)/g.exec(e);if(null!==t)return t[1]}static splitLines(e){return e.trim().split("\n").map((e=>e.trim()))}static splitSections(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+SDP.CRLF))}static findActiveCameraSection(e){let t=0,i=!1;for(const n of e){if(/^m=video/.test(n)&&(n.indexOf("sendrecv")>-1||-1===n.indexOf("sendonly")&&-1===n.indexOf("recvonly")&&-1===n.indexOf("inactive"))){i=!0;break}t++}return!1===i&&(t=-1),t}static extractSSRCsFromFIDGroupLine(e){return/^a=ssrc-group:FID\s(.+)/.exec(e)[1]}static matchPrefix(e,t){return SDP.splitLines(e).filter((e=>0===e.indexOf(t)))}lines(){return this.sdp.split(SDP.CRLF)}hasVideo(){return null!==/^m=video/gm.exec(this.sdp)}hasCandidates(){return null!==/a[=]candidate[:]/g.exec(this.sdp)}hasCandidatesForAllMLines(){return!(this.sdp.indexOf("c=IN IP4 0.0.0.0")>-1)}withoutCandidateType(e){return SDP.linesToSDP(this.lines().filter((t=>SDP.candidateType(t)!==e)))}withoutServerReflexiveCandidates(){return this.withoutCandidateType(SDPCandidateType_1.default.ServerReflexive)}withAudioMaxAverageBitrate(e){if(!e)return this.clone();e=Math.trunc(Math.min(Math.max(e,SDP.rfc7587LowestBitrate),SDP.rfc7587HighestBitrate));const t=this.lines(),i=SDP.findOpusFmtpAttributes(t),n=SDP.updateOpusFmtpAttributes(t,i,[`maxaveragebitrate=${e}`]);return SDP.linesToSDP(n)}withStereoAudio(){const e=this.lines(),t=SDP.findOpusFmtpAttributes(e),i=SDP.updateOpusFmtpAttributes(e,t,["stereo=1","sprop-stereo=1"]);return SDP.linesToSDP(i)}static findOpusFmtpAttributes(e){const t=/^a=rtpmap:\s*(\d+)\s+opus\/48000/;let i=!1;const n=[];for(const r of e)if(r.startsWith("m=audio")&&(n.push(null),i=!0),r.startsWith("m=video")&&(i=!1),i){const e=t.exec(r);null!==e&&(n[n.length-1]=`a=fmtp:${e[1]} `)}return n}static updateOpusFmtpAttributes(e,t,i){const n=[];let r=0,o=null;for(const a of e)if(a.startsWith("m=audio")&&(o=t[r],r++),a.startsWith("m=video")&&(o=null),o&&a.startsWith(o)){const e=a.slice(o.length).split(";"),t=[];for(const n of e){i.findIndex((e=>e.startsWith(n.split("=")[0])))<0&&t.push(n)}for(const e of i)t.push(e);n.push(o+t.join(";"))}else n.push(a);return n}withUnifiedPlanFormat(){let e=this.sdp;return e.includes("mozilla")?this.clone():(e=e.replace("o=-","o=mozilla-chrome"),new SDP(e))}getUniqueRtpHeaderExtensionId(e){const t=[];for(const i of e)if(/^a=extmap:/.test(i.trim())){const e=+i.split("a=extmap:")[1].split(" ")[0];t.includes(e)||t.push(e)}t.sort(((e,t)=>e-t));let i=0;for(const e of t){if(e-i>1)return i+1;i=e}return 14===i?-1:i+1}withVideoLayersAllocationRtpHeaderExtension(e){return this.withRtpHeaderExtension(e,SDP.videoLayersAllocationRtpHeaderExtensionUrl)}withDependencyDescriptorRtpHeaderExtension(e){return this.withRtpHeaderExtension(e,SDP.dependencyDescriptorRtpHeaderExtensionUrl)}withoutDependencyDescriptorRtpHeaderExtension(){const e=SDP.splitLines(this.sdp).filter((e=>!e.includes(SDP.dependencyDescriptorRtpHeaderExtensionUrl)));return new SDP(e.join(SDP.CRLF)+SDP.CRLF)}withRtpHeaderExtension(e,t){const i=e?e.getRtpHeaderExtensionId(t):-1,n=-1===i?this.getUniqueRtpHeaderExtensionId(SDP.splitLines(this.sdp)):i,r=SDP.splitSections(this.sdp),o=[];for(let e of r){if(/^m=video/.test(e)&&-1===SDP.getRtpHeaderExtensionIdInSection(e,t)){const i=SDP.splitLines(e),r=[];if(-1===n||this.hasRtpHeaderExtensionId(n)){o.push(e);continue}for(const e of i)if(r.push(e),/^a=sendrecv/.test(e.trim())){const e="a=extmap:"+n+" "+t;r.push(e)}e=r.join(SDP.CRLF)+SDP.CRLF}else if(-1!==i&&/^m=video/.test(e)&&SDP.getRtpHeaderExtensionIdInSection(e,t)!==i){const n=SDP.splitLines(e),r=[];for(const e of n){if(/^a=extmap:/.test(e.trim())){if(e.split("a=extmap:")[1].split(" ")[1]===t){if(!this.hasRtpHeaderExtensionId(i)){const e="a=extmap:"+i+" "+t;r.push(e)}continue}}r.push(e)}e=r.join(SDP.CRLF)+SDP.CRLF}o.push(e)}const a=o.join("");return new SDP(a)}ssrcForVideoSendingSection(){const e=this.sdp,t=SDP.splitSections(e);if(t.length<2)return"";const i=SDP.findActiveCameraSection(t);if(-1===i)return"";const n=SDP.matchPrefix(t[i],"a=ssrc-group:FID ");if(n.length<1)return"";const r=SDP.extractSSRCsFromFIDGroupLine(n[0]),[o]=r.split(" ").map((e=>parseInt(e,10)));return o.toString()}videoSendSectionHasDifferentSSRC(e){const t=this.ssrcForVideoSendingSection(),i=e.ssrcForVideoSendingSection();if(""===t||""===i)return!1;return parseInt(t,10)!==parseInt(i,10)}removeH264SupportFromSendSection(){const e=this.sdp,t=SDP.splitSections(e),i=SDP.findActiveCameraSection(t);if(-1===i)return new SDP(this.sdp);const n=t[i],r=SDP.splitLines(n),o=[],a=new Map;r.forEach((e=>{if(/^a=rtpmap:/.test(e)){const t=/^a=rtpmap:([0-9]+)\s/.exec(e);t&&e.toLowerCase().includes("h264")&&o.push(parseInt(t[1],10))}if(/^a=fmtp:/.test(e)){const t=/^a=fmtp:([0-9]+) apt=([0-9]+)/.exec(e);if(t&&3===t.length){const e=parseInt(t[1],10),i=parseInt(t[2],10);a.has(i)?a.get(i).push(e):a.set(i,[e])}}}));const s=new Set;for(const e of o){s.add(e);const t=a.get(e);if(t)for(const e of t)s.add(e)}if(o.length>0){const e=r[0].split(" ");r[0]=e.filter((e=>!s.has(parseInt(e)))).join(" ")}const d=r.filter((e=>{if(!e.includes("rtpmap")&&!e.includes("rtcp-fb")&&!e.includes("fmtp"))return!0;for(const t of s)if(e.includes(t.toString()))return!1;return!0}));t[i]=d.join(SDP.CRLF)+SDP.CRLF;const l=t.join("");return new SDP(l)}mediaSections(){const e=SDP.splitSections(this.sdp);if(e.length<2)return[];const t=[];for(let i=1;i<e.length;i++){const n=new SDPMediaSection_1.default,r=SDP.splitLines(e[i]);for(const e of r){const t=SDP.mediaType(e);if(void 0!==t){n.mediaType=t;continue}const i=SDP.direction(e);if(void 0!==i){n.direction=i;continue}const r=SDP.mid(e);void 0===r||(n.mid=r)}t.push(n)}return t}static getRtpHeaderExtensionIdInSection(e,t){const i=SDP.splitLines(e);for(const e of i)if(/^a=extmap:/.test(e.trim())){const i=e.split("a=extmap:")[1].split(" "),n=+i[0];if(i[1]===t)return n}return-1}getRtpHeaderExtensionId(e){const t=SDP.splitSections(this.sdp);for(const i of t)if(/^m=video/.test(i)){const t=SDP.getRtpHeaderExtensionIdInSection(i,e);if(-1!==t)return t}return-1}hasRtpHeaderExtensionId(e){const t=SDP.splitLines(this.sdp);for(const i of t)if(/^a=extmap:/.test(i.trim())){if(+i.split("a=extmap:")[1].split(" ")[0]===e)return!0}return!1}withVideoSendCodecPreferences(e){const t=this.sdp,i=SDP.splitSections(t),n=SDP.findActiveCameraSection(i);if(-1===n)return new SDP(this.sdp);i[n]=this.sectionWithCodecPreferences(i[n],e);const r=i.join("");return new SDP(r)}sectionWithCodecPreferences(e,t){const i=new Map,n=SDP.splitLines(e);n.forEach((e=>{if(/^a=rtpmap:/.test(e))for(const r of t){if(!e.includes(`${r.codecName}/${r.codecCapability.clockRate}`))continue;const t=/^a=rtpmap:([0-9]+)\s/.exec(e);let o=!1;if(void 0!==r.codecCapability.sdpFmtpLine){let e=!1;for(const i of n){if(i.startsWith(`a=fmtp:${t[1]} ${r.codecCapability.sdpFmtpLine}`)){o=!0;break}i.startsWith(`a=fmtp:${t[1]} profile-id=`)&&(e=!0)}r.equals(VideoCodecCapability_1$2.default.vp9Profile0())&&!e&&(o=!0)}else o=!0;if(o){i.set(r.codecName,t[1]);break}}}));const r=new Set(i.values()),o=n[0].split(" ").filter((e=>!r.has(e))),a=Array.from(i.values()).sort(((e,n)=>t.findIndex((t=>i.get(t.codecName)===e))-t.findIndex((e=>i.get(e.codecName)===n))));return o.splice(3,0,...a.values()),n[0]=o.join(" "),n.join(SDP.CRLF)+SDP.CRLF}highestPriorityVideoSendCodec(){const e=this.sdp,t=SDP.splitSections(e),i=SDP.findActiveCameraSection(t);if(-1===i)return;const n=SDP.splitLines(t[i]),r=n[0].split(" ");if(r.length<4)return;const o=r[3];let a,s,d;for(const e of n){const t=/^a=rtpmap:([0-9]+)\s/.exec(e);if(null===t||t.length<2||t[1]!==o)continue;const i=e.split(" ")[1].split("/");if(!(void 0===i||i.length<2)){a=i[0],s=i[1];for(const e of n)if(e.startsWith(`a=fmtp:${o}`)){const t=e.split(" ");if(void 0===t||t.length<2)return;d=t[1]}else;break}}return void 0!==a?new VideoCodecCapability_1$2.default(a,{clockRate:parseInt(s),mimeType:`video/${a}`,sdpFmtpLine:d}):void 0}getAudioPayloadTypes(){const e=new Map,t=this.sdp,i=SDP.splitSections(t);return e.set("opus",SDP.findAudioPayloadType("opus",i)),e.set("red",SDP.findAudioPayloadType("red",i)),e}static findAudioPayloadType(e,t){const i=new RegExp(`a=rtpmap:\\s*(\\d+)\\s+${e}\\/48000`);for(const e of t)if(/^m=audio/.test(e)){const t=i.exec(e);if(null!==t)return Number(t[1])}return 0}withStartingVideoSendBitrate(e){const t=SDP.splitSections(this.sdp),i=SDP.findActiveCameraSection(t);if(-1===i)return this;const n=SDP.splitLines(t[i]),r=[];for(const t of n)if(/^a=fmtp:\d*/.test(t)){const i=t+";x-google-start-bitrate="+1e3*e;r.push(i)}else r.push(t);t[i]=r.join(SDP.CRLF)+SDP.CRLF;const o=t.join("");return new SDP(o)}}SDP$1.default=SDP,SDP.CRLF="\r\n",SDP.rfc7587LowestBitrate=6e3,SDP.rfc7587HighestBitrate=51e4,SDP.dependencyDescriptorRtpHeaderExtensionUrl="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension",SDP.videoLayersAllocationRtpHeaderExtensionUrl="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00";var __awaiter$N=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1c=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CreateSDPTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$7=__importDefault$1c(MeetingSessionStatusCode),SDP_1$4=__importDefault$1c(SDP$1),BaseTask_1$l=__importDefault$1c(BaseTask$1);class CreateSDPTask extends BaseTask_1$l.default{constructor(e){super(e.logger),this.context=e,this.taskName="CreateSDPTask"}cancel(){if(this.cancelPromise){const e=new Error(`canceling ${this.name()}`);this.cancelPromise(e),delete this.cancelPromise}}sessionUsesAudio(){var e,t;return!!(null===(t=null===(e=this.context.meetingSessionConfiguration)||void 0===e?void 0:e.urls)||void 0===t?void 0:t.audioHostURL)}sessionUsesVideo(){let e;e=this.context.transceiverController.useTransceivers()?this.context.transceiverController.hasVideoInput():this.context.videoTileController.hasStartedLocalVideoTile();const t=!!this.context.videosToReceive&&!this.context.videosToReceive.empty(),i=e||t;return this.context.logger.info(`uses video: ${i} (enabled: true, sending: ${e}, receiving: ${t})`),i}run(){return __awaiter$N(this,void 0,void 0,(function*(){const e={offerToReceiveAudio:this.sessionUsesAudio(),offerToReceiveVideo:this.sessionUsesVideo()};this.logger.info(`peer connection offerOptions: ${JSON.stringify(e)}`),yield new Promise(((t,i)=>__awaiter$N(this,void 0,void 0,(function*(){this.cancelPromise=e=>{i(e)};try{if(this.context.sdpOfferInit=yield this.context.peer.createOffer(e),this.context.logger.info("peer connection created offer"),this.context.previousSdpOffer&&new SDP_1$4.default(this.context.sdpOfferInit.sdp).videoSendSectionHasDifferentSSRC(this.context.previousSdpOffer)){const e=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$7.default.IncompatibleSDP}`);return this.context.previousSdpOffer=null,void i(e)}t()}catch(e){i(e)}finally{delete this.cancelPromise}}))))}))}}CreateSDPTask$1.default=CreateSDPTask;var DataMessage$1={};Object.defineProperty(DataMessage$1,"__esModule",{value:!0});class DataMessage{constructor(e,t,i,n,r,o){this.timestampMs=e,this.topic=t,this.data=i,this.senderAttendeeId=n,this.senderExternalUserId=r,this.throttled=!!o}text(){return(new TextDecoder).decode(this.data)}json(){return JSON.parse((new TextDecoder).decode(this.data))}}DataMessage$1.default=DataMessage;var DefaultActiveSpeakerDetector$1={},__awaiter$M=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1b=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultActiveSpeakerDetector$1,"__esModule",{value:!0});const IntervalScheduler_1$4=__importDefault$1b(IntervalScheduler$1);class DefaultActiveSpeakerDetector{constructor(e,t,i,n=1e3,r=200){this.realtimeController=e,this.selfAttendeeId=t,this.hasBandwidthPriorityCallback=i,this.waitIntervalMs=n,this.updateIntervalMs=r,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate(e){return!this.activeSpeakers||(0===this.speakerScores[e]&&this.activeSpeakers.includes(e)||this.speakerScores[e]>0&&!this.activeSpeakers.includes(e))}updateActiveSpeakers(e,t,i){if(!this.needUpdate(i))return;const n=[],r=Object.keys(this.speakerScores);for(let e=0;e<r.length;e++){const t=r[e];n.push({attendeeId:t,activeScore:this.speakerScores[t]})}const o=n.sort(((e,t)=>t.activeScore-e.activeScore)).filter((function(e){return e.activeScore>0})).map((function(e){return e.attendeeId}));this.activeSpeakers=o,t(o);const a=o.length>0&&o[0]===this.selfAttendeeId&&e.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==a&&(this.hasBandwidthPriority=a,this.hasBandwidthPriorityCallback(a))}updateScore(e,t,i,n,r){const o=e.calculateScore(i,n,r);this.speakerScores[i]!==o&&(this.speakerScores[i]=o,this.mostRecentUpdateTimestamp[i]=Date.now(),this.updateActiveSpeakers(e,t,i))}subscribe(e,t,i,n){const r=(i,n)=>{if(!n)return this.speakerScores[i]=0,this.mostRecentUpdateTimestamp[i]=Date.now(),void this.updateActiveSpeakers(e,t,i);this.realtimeController.realtimeSubscribeToVolumeIndicator(i,((i,n,r,o)=>{this.mostRecentUpdateTimestamp[i]=Date.now(),null!==r&&(this.speakerMuteState[i]=r),this.updateScore(e,t,i,n,r)}))};this.detectorCallbackToHandler.set(t,r);const o=new IntervalScheduler_1$4.default(this.updateIntervalMs);if(o.start((()=>{for(const i in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[i]>this.waitIntervalMs&&this.updateScore(e,t,i,0,this.speakerMuteState[i])})),this.detectorCallbackToActivityTimer.set(t,o),i&&n){const e=new IntervalScheduler_1$4.default(n);e.start((()=>{i(this.speakerScores)})),this.detectorCallbackToScoresTimer.set(t,e)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(r)}unsubscribe(e){const t=this.detectorCallbackToHandler.get(e);this.detectorCallbackToHandler.delete(e),t&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t);const i=this.detectorCallbackToActivityTimer.get(e);i&&(i.stop(),this.detectorCallbackToActivityTimer.delete(e));const n=this.detectorCallbackToScoresTimer.get(e);n&&(n.stop(),this.detectorCallbackToHandler.delete(e))}destroy(){return __awaiter$M(this,void 0,void 0,(function*(){for(const e of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e);for(const e of this.detectorCallbackToActivityTimer.values())e.stop();for(const e of this.detectorCallbackToScoresTimer.values())e.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()}))}}DefaultActiveSpeakerDetector$1.default=DefaultActiveSpeakerDetector;var DefaultActiveSpeakerPolicy$1={};Object.defineProperty(DefaultActiveSpeakerPolicy$1,"__esModule",{value:!0});class DefaultActiveSpeakerPolicy{constructor(e=.9,t=.01,i=.2,n=.2){this.speakerWeight=e,this.cutoffThreshold=t,this.silenceThreshold=i,this.takeoverRate=n,this.volumes={}}calculateScore(e,t,i){(i||null===t)&&(t=0),this.volumes.hasOwnProperty(e)||(this.volumes[e]=0),t=t>this.silenceThreshold?1:0;const n=this.volumes[e]*this.speakerWeight+t*(1-this.speakerWeight);this.volumes[e]=n;for(const i in this.volumes)i!==e&&(this.volumes[i]=Math.max(this.volumes[i]-this.takeoverRate*t,0));return n<this.cutoffThreshold?0:n}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}}DefaultActiveSpeakerPolicy$1.default=DefaultActiveSpeakerPolicy;var DefaultAudioMixController$1={},__awaiter$L=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1a=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultAudioMixController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$5=__importDefault$1a(DefaultBrowserBehavior$1),AsyncScheduler_1$5=__importDefault$1a(AsyncScheduler$1);class DefaultAudioMixController{constructor(e){this.logger=e,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new DefaultBrowserBehavior_1$5.default,this.observers=new Set}bindAudioElement(e){return __awaiter$L(this,void 0,void 0,(function*(){if(!e)throw new Error(`Cannot bind audio element: ${e}`);return this.audioElement=e,this.audioElement.autoplay=!0,this.bindAudioMix()}))}unbindAudioElement(){this.audioElement&&(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver((e=>{this.audioStream&&e.meetingAudioStreamBecameInactive(this.audioStream)})))}bindAudioStream(e){return __awaiter$L(this,void 0,void 0,(function*(){if(e){this.audioStream=e;try{yield this.bindAudioMix()}catch(e){this.logger&&this.logger.warn(`Failed to bind audio stream: ${e}`)}}}))}bindAudioDevice(e){return __awaiter$L(this,void 0,void 0,(function*(){if(e&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=e,this.bindAudioMix()}))}forEachObserver(e){for(const t of this.observers)AsyncScheduler_1$5.default.nextTick((()=>{e(t)}))}bindAudioMix(){var e,t;return __awaiter$L(this,void 0,void 0,(function*(){if(!this.audioElement)return;const i=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),i!==this.audioStream&&this.forEachObserver((e=>{i&&e.meetingAudioStreamBecameInactive(i),this.audioStream&&e.meetingAudioStreamBecameActive(this.audioStream)}));const n=(null===(e=this.audioDevice)||void 0===e?void 0:e.deviceId)!==this.audioElement.sinkId;if(n&&void 0===this.audioElement.sinkId)throw new Error("Cannot select audio output device. This browser does not support setSinkId.");const r=this.audioDevice?this.audioDevice.deviceId:"";if(r===this.audioElement.sinkId)return;const o=this.audioElement,a=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(o.srcObject=null),n)try{yield o.setSinkId(r)}catch(e){throw null===(t=this.logger)||void 0===t||t.error(`Failed to set sinkId for audio element: ${e}`),e}this.browserBehavior.hasChromiumWebRTC()&&(o.srcObject=a)}))}getCurrentMeetingAudioStream(){return __awaiter$L(this,void 0,void 0,(function*(){return this.audioStream}))}addAudioMixObserver(e){return __awaiter$L(this,void 0,void 0,(function*(){this.observers.add(e)}))}removeAudioMixObserver(e){return __awaiter$L(this,void 0,void 0,(function*(){this.observers.delete(e)}))}audioOutputDidChange(e){return __awaiter$L(this,void 0,void 0,(function*(){return this.logger.info("Receive an audio output change event"),this.bindAudioDevice(e)}))}}DefaultAudioMixController$1.default=DefaultAudioMixController;var DefaultAudioVideoController={},SignalingAndMetricsConnectionMonitor$1={};Object.defineProperty(SignalingAndMetricsConnectionMonitor$1,"__esModule",{value:!0});const Types_1$7=Types;class SignalingAndMetricsConnectionMonitor{constructor(e,t,i,n,r){this.audioVideoController=e,this.realtimeController=t,this.connectionHealthData=i,this.pingPong=n,this.statsCollector=r,this.isActive=!1,this.hasSeenValidPacketMetricsBefore=!1,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange((e=>{this.isActive&&this.receiveSignalStrengthChange(e)}))}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange(e){0===e?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):e<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong(e,t,i){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",t),this.statsCollector.logLatency("ping_pong_clock_skew",i),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive(e){let t=0,i=0;const n=e.getObservableMetrics(),r=n.audioPacketsReceived,o=n.audioPacketsReceivedFractionLoss,a=n.audioSpeakerDelayMs;"number"!=typeof a||isNaN(a)||this.connectionHealthData.setAudioSpeakerDelayMs(a),"number"==typeof r&&"number"==typeof o&&(t=r,i=o,t<0||i<0||(this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,t),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,i),t>0?(this.hasSeenValidPacketMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidPacketMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(0===t||i>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),"number"==typeof n.audioPacketsSent&&this.updateAudioPacketsSentInConnectionHealth(n.audioPacketsSent),this.updateConnectionHealth()))}updateAudioPacketsSentInConnectionHealth(e){e>0?this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(0):this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(this.connectionHealthData.consecutiveStatsWithNoAudioPacketsSent+1)}addToMinuteWindow(e,t){e.unshift(t),e.length>60&&e.pop()}updateConnectionHealth(){this.audioVideoController.forEachObserver((e=>{Types_1$7.Maybe.of(e.connectionHealthDidChange).map((t=>t.bind(e)(this.connectionHealthData.clone())))}))}}SignalingAndMetricsConnectionMonitor$1.default=SignalingAndMetricsConnectionMonitor;var MeetingSessionStatus$1={},__importDefault$19=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MeetingSessionStatus$1,"__esModule",{value:!0});const SignalingProtocol_js_1$e=SignalingProtocol,MeetingSessionStatusCode_1$6=__importDefault$19(MeetingSessionStatusCode);class MeetingSessionStatus{constructor(e){this._statusCode=e}statusCode(){return this._statusCode}isFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$6.default.ConnectionHealthReconnect:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.TaskFailed:case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return!0;default:return!1}}isTerminal(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.Left:case MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice:case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$6.default.MeetingEnded:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:case MeetingSessionStatusCode_1$6.default.TURNCredentialsForbidden:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved:return!0;default:return!1}}isAudioConnectionFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return!0;default:return!1}}toString(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.OK:return"Everything is OK so far.";case MeetingSessionStatusCode_1$6.default.Left:return"The attendee left the meeting.";case MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice:return"The attendee joined from another device.";case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:return"The meeting rejected the attendee.";case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:return"The attendee couldn't join because the meeting was at capacity.";case MeetingSessionStatusCode_1$6.default.MeetingEnded:return"The meeting ended.";case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:return"The audio connection failed.";case MeetingSessionStatusCode_1$6.default.VideoCallSwitchToViewOnly:return"The attendee couldn't start the local video because the maximum video capacity was reached.";case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:return"The connection failed due to an internal server error.";case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:return"The signaling connection failed.";case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:return"Gathering ICE candidates timed out. In Chrome, this might indicate that the browser is in a bad state after reconnecting to VPN.";case MeetingSessionStatusCode_1$6.default.ConnectionHealthReconnect:return"The meeting was reconnected.";case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:return"The real-time API failed. This status code might indicate that the callback you passed to the real-time API threw an exception.";case MeetingSessionStatusCode_1$6.default.TaskFailed:return"The connection failed. See the error message for more details.";case MeetingSessionStatusCode_1$6.default.IncompatibleSDP:return"The connection failed due to incompatible SDP.";case MeetingSessionStatusCode_1$6.default.TURNCredentialsForbidden:return"The meeting ended, or the attendee was removed.";case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return"The attendee was not present.";case MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved:return"The meeting ended because attendee removed.";case MeetingSessionStatusCode_1$6.default.AudioVideoWasRemovedFromPrimaryMeeting:return"The Primary meeting credentials provided are no longer valid. chime::DeleteAttendee may have been called on them.";case MeetingSessionStatusCode_1$6.default.AudioDisconnectAudio:return"The audio connection failed.";default:{const e=this._statusCode;throw new Error(`Unhandled case: ${e}`)}}}static fromSignalFrame(e){return e.error&&e.error.status?this.fromSignalingStatus(e.error.status):e.type===SignalingProtocol_js_1$e.SdkSignalFrame.Type.AUDIO_STATUS?e.audioStatus?this.fromAudioStatus(e.audioStatus.audioStatus):new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingRequestFailed):e.type===SignalingProtocol_js_1$e.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE?new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioVideoWasRemovedFromPrimaryMeeting):new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK)}static fromAudioStatus(e){switch(e){case 200:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK);case 301:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice);case 302:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioDisconnectAudio);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity);case 410:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.MeetingEnded);case 411:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved);case 500:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioInternalServerError);case 503:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable);default:return 2===Math.floor(e/100)?new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK):new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioDisconnected)}}static fromSignalingStatus(e){switch(e){case 206:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.VideoCallSwitchToViewOnly);case 509:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity);default:switch(Math.floor(e/100)){case 2:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK);case 4:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingBadRequest);case 5:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingInternalServerError);default:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingRequestFailed)}}}}MeetingSessionStatus$1.default=MeetingSessionStatus;var MeetingSessionVideoAvailability$1={};Object.defineProperty(MeetingSessionVideoAvailability$1,"__esModule",{value:!0});class MeetingSessionVideoAvailability{constructor(){this.remoteVideoAvailable=!1,this.canStartLocalVideo=!1}equal(e){return this.remoteVideoAvailable===e.remoteVideoAvailable&&this.canStartLocalVideo===e.canStartLocalVideo}clone(){const e=new MeetingSessionVideoAvailability;return e.remoteVideoAvailable=this.remoteVideoAvailable,e.canStartLocalVideo=this.canStartLocalVideo,e}}MeetingSessionVideoAvailability$1.default=MeetingSessionVideoAvailability;var DefaultPingPong$1={},__importDefault$18=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultPingPong$1,"__esModule",{value:!0});const AsyncScheduler_1$4=__importDefault$18(AsyncScheduler$1),IntervalScheduler_1$3=__importDefault$18(IntervalScheduler$1),SignalingClientEventType_1$b=__importDefault$18(SignalingClientEventType),SignalingProtocol_js_1$d=SignalingProtocol,Types_1$6=Types;class DefaultPingPong{constructor(e,t,i){this.signalingClient=e,this.intervalMs=t,this.logger=i,this.observerQueue=new Set,this.consecutivePongsUnaccountedFor=0,this.intervalScheduler=new IntervalScheduler_1$3.default(this.intervalMs),this.pingId=0}addObserver(e){this.logger.info("adding a ping-pong observer"),this.observerQueue.add(e)}removeObserver(e){this.logger.info("removing a ping-pong observer"),this.observerQueue.delete(e)}forEachObserver(e){for(const t of this.observerQueue)AsyncScheduler_1$4.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}start(){this.stop(),this.signalingClient.registerObserver(this),this.signalingClient.ready()&&this.startPingInterval()}stop(){this.stopPingInterval(),this.signalingClient.removeObserver(this)}startPingInterval(){this.intervalScheduler.start((()=>{this.ping()})),this.ping()}stopPingInterval(){this.intervalScheduler.stop(),this.pingId=0,this.consecutivePongsUnaccountedFor=0}ping(){this.consecutivePongsUnaccountedFor>0&&(this.logger.warn(`missed pong ${this.consecutivePongsUnaccountedFor} time(s)`),this.forEachObserver((e=>{Types_1$6.Maybe.of(e.didMissPongs).map((t=>t.bind(e)(this.consecutivePongsUnaccountedFor)))}))),this.consecutivePongsUnaccountedFor+=1,this.pingId=this.pingId+1&4294967295;const e=SignalingProtocol_js_1$d.SdkPingPongFrame.create();e.pingId=this.pingId,e.type=SignalingProtocol_js_1$d.SdkPingPongType.PING,this.pingTimestampLocalMs=this.signalingClient.pingPong(e),this.logger.debug((()=>`sent ping ${this.pingId}`))}pong(e){const t=SignalingProtocol_js_1$d.SdkPingPongFrame.create();t.pingId=e,t.type=SignalingProtocol_js_1$d.SdkPingPongType.PONG,this.signalingClient.pingPong(t)}handleSignalingClientEvent(e){switch(e.type){case SignalingClientEventType_1$b.default.WebSocketOpen:this.startPingInterval();break;case SignalingClientEventType_1$b.default.WebSocketFailed:case SignalingClientEventType_1$b.default.WebSocketError:this.logger.warn(`stopped pinging (${SignalingClientEventType_1$b.default[e.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$b.default.WebSocketClosing:case SignalingClientEventType_1$b.default.WebSocketClosed:this.logger.info(`stopped pinging (${SignalingClientEventType_1$b.default[e.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$b.default.ReceivedSignalFrame:if(e.message.type!==SignalingProtocol_js_1$d.SdkSignalFrame.Type.PING_PONG)break;if(e.message.pingPong.type===SignalingProtocol_js_1$d.SdkPingPongType.PONG){const t=e.message.pingPong.pingId;if(t!==this.pingId){this.logger.warn(`unexpected ping id ${t} (expected ${this.pingId})`);break}let i;if(this.consecutivePongsUnaccountedFor=0,"number"!=typeof e.message.timestampMs)break;i=e.message.timestampMs,this.logger.debug((()=>`received pong ${t} with timestamp ${i}`));const n=e.timestampMs-this.pingTimestampLocalMs,r=Math.round(i-n/2),o=this.pingTimestampLocalMs-r;this.logger.info(`local clock skew estimate=${o}ms from ping-pong time=${n}ms`),this.forEachObserver((e=>{Types_1$6.Maybe.of(e.didReceivePong).map((i=>i.bind(e)(t,o,n)))}))}else this.pong(e.message.pingPong.pingId)}}}DefaultPingPong$1.default=DefaultPingPong;var DefaultRealtimeController$1={},DefaultTranscriptionController={},TranscriptEvent={},Transcript$1={};Object.defineProperty(Transcript$1,"__esModule",{value:!0});class Transcript{}Transcript$1.default=Transcript;var TranscriptionStatus$1={};Object.defineProperty(TranscriptionStatus$1,"__esModule",{value:!0});class TranscriptionStatus{}TranscriptionStatus$1.default=TranscriptionStatus;var TranscriptionStatusType$1={},TranscriptionStatusType;Object.defineProperty(TranscriptionStatusType$1,"__esModule",{value:!0}),function(e){e.STARTED="started",e.INTERRUPTED="interrupted",e.RESUMED="resumed",e.STOPPED="stopped",e.FAILED="failed"}(TranscriptionStatusType||(TranscriptionStatusType={})),TranscriptionStatusType$1.default=TranscriptionStatusType;var TranscriptItemType$1={},TranscriptItemType;Object.defineProperty(TranscriptItemType$1,"__esModule",{value:!0}),function(e){e.PRONUNCIATION="pronunciation",e.PUNCTUATION="punctuation"}(TranscriptItemType||(TranscriptItemType={})),TranscriptItemType$1.default=TranscriptItemType;var __importDefault$17=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(TranscriptEvent,"__esModule",{value:!0}),TranscriptEvent.TranscriptEventConverter=void 0;const SignalingProtocol_1$1=SignalingProtocol,Transcript_1=__importDefault$17(Transcript$1),TranscriptionStatus_1=__importDefault$17(TranscriptionStatus$1),TranscriptionStatusType_1=__importDefault$17(TranscriptionStatusType$1),TranscriptItemType_1=__importDefault$17(TranscriptItemType$1),TranscriptionStatusTypes={[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STARTED]:TranscriptionStatusType_1.default.STARTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.INTERRUPTED]:TranscriptionStatusType_1.default.INTERRUPTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.RESUMED]:TranscriptionStatusType_1.default.RESUMED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STOPPED]:TranscriptionStatusType_1.default.STOPPED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.FAILED]:TranscriptionStatusType_1.default.FAILED};class TranscriptEventConverter{static from(e){let t;try{t=SignalingProtocol_1$1.SdkTranscriptFrame.decode(e.data)}catch(e){throw new Error("Cannot decode transcript data message: "+e)}const i=[];for(const e of t.events)if(e.status){const t=TranscriptionStatusTypes[e.status.type];if(!t)continue;const n=new TranscriptionStatus_1.default;n.type=t,n.eventTimeMs=e.status.eventTime,n.transcriptionRegion=e.status.transcriptionRegion,n.transcriptionConfiguration=e.status.transcriptionConfiguration,e.status.message&&(n.message=e.status.message),i.push(n)}else if(e.transcript){const t=new Transcript_1.default;t.results=[];for(const i of e.transcript.results){const e={channelId:i.channelId,isPartial:i.isPartial,resultId:i.resultId,startTimeMs:i.startTime,endTimeMs:i.endTime,alternatives:[]};if(i.languageCode&&(e.languageCode=i.languageCode),i.languageIdentification&&i.languageIdentification.length>0){e.languageIdentification=[];for(const t of i.languageIdentification){const i={languageCode:t.languageCode,score:t.score};e.languageIdentification.push(i)}}for(const t of i.alternatives){const i={items:[],transcript:t.transcript};for(const e of t.items){const t={content:e.content,attendee:{attendeeId:e.speakerAttendeeId,externalUserId:e.speakerExternalUserId},startTimeMs:e.startTime,endTimeMs:e.endTime,type:null};switch(e.vocabularyFilterMatch&&(t.vocabularyFilterMatch=e.vocabularyFilterMatch),e.hasOwnProperty("stable")&&(t.stable=e.stable),e.hasOwnProperty("confidence")&&(t.confidence=e.confidence),e.type){case SignalingProtocol_1$1.SdkTranscriptItem.Type.PRONUNCIATION:t.type=TranscriptItemType_1.default.PRONUNCIATION;break;case SignalingProtocol_1$1.SdkTranscriptItem.Type.PUNCTUATION:t.type=TranscriptItemType_1.default.PUNCTUATION}i.items.push(t)}for(const e of t.entities){i.entities||(i.entities=[]);const t={category:e.category,confidence:e.confidence,content:e.content,startTimeMs:e.startTime,endTimeMs:e.endTime};e.type&&(t.type=e.type),i.entities.push(t)}e.alternatives.push(i)}t.results.push(e)}i.push(t)}return i}}TranscriptEvent.TranscriptEventConverter=TranscriptEventConverter,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TRANSCRIPTION_DATA_MESSAGE_TOPIC=void 0;const t=TranscriptEvent;e.TRANSCRIPTION_DATA_MESSAGE_TOPIC="aws:chime:transcription";e.default=class{constructor(e){this.realtimeController=e,this.transcriptEventCallbacks=new Set}subscribeToTranscriptEvent(i){0===this.transcriptEventCallbacks.size&&this.realtimeController.realtimeSubscribeToReceiveDataMessage(e.TRANSCRIPTION_DATA_MESSAGE_TOPIC,(e=>{for(const i of t.TranscriptEventConverter.from(e))for(const e of this.transcriptEventCallbacks)e(i)})),this.transcriptEventCallbacks.add(i)}unsubscribeFromTranscriptEvent(t){this.transcriptEventCallbacks.delete(t),0===this.transcriptEventCallbacks.size&&this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(e.TRANSCRIPTION_DATA_MESSAGE_TOPIC)}}}(DefaultTranscriptionController);var RealtimeState$1={};Object.defineProperty(RealtimeState$1,"__esModule",{value:!0});class RealtimeState{constructor(){this.localAttendeeId=null,this.localExternalUserId=null,this.attendeeIdChangesCallbacks=[],this.canUnmute=!0,this.setCanUnmuteLocalAudioCallbacks=[],this.muted=!1,this.muteAndUnmuteLocalAudioCallbacks=[],this.volumeIndicatorState={},this.attendeeIdToExternalUserId={},this.volumeIndicatorCallbacks={},this.localSignalStrengthChangeCallbacks=[],this.fatalErrorCallbacks=[],this.sendDataMessageCallbacks=[],this.receiveDataMessageCallbacks=new Map}}RealtimeState$1.default=RealtimeState;var RealtimeVolumeIndicator$1={};Object.defineProperty(RealtimeVolumeIndicator$1,"__esModule",{value:!0});class RealtimeVolumeIndicator{constructor(){this.volume=null,this.muted=null,this.signalStrength=null}}RealtimeVolumeIndicator$1.default=RealtimeVolumeIndicator;var __importDefault$16=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultRealtimeController$1,"__esModule",{value:!0});const DefaultTranscriptionController_1=__importDefault$16(DefaultTranscriptionController),RealtimeState_1=__importDefault$16(RealtimeState$1),RealtimeVolumeIndicator_1=__importDefault$16(RealtimeVolumeIndicator$1);class DefaultRealtimeController{constructor(e,t){this.mediaStreamBroker=e,this.state=new RealtimeState_1.default,this._transcriptionController=t||new DefaultTranscriptionController_1.default(this)}realtimeSetLocalAttendeeId(e,t){this.state.localAttendeeId=e,this.state.localExternalUserId=t}realtimeSetAttendeeIdPresence(e,t,i,n,r){try{t&&(this.state.attendeeIdToExternalUserId[e]=i);for(const o of this.state.attendeeIdChangesCallbacks)o(e,t,i,n,r)}catch(e){this.onError(e)}}realtimeSubscribeToAttendeeIdPresence(e){try{this.state.attendeeIdChangesCallbacks.push(e)}catch(e){this.onError(e)}}realtimeUnsubscribeToAttendeeIdPresence(e){try{const t=this.state.attendeeIdChangesCallbacks.indexOf(e);-1!==t&&this.state.attendeeIdChangesCallbacks.splice(t,1)}catch(e){this.onError(e)}}realtimeSetCanUnmuteLocalAudio(e){try{if(this.state.canUnmute===e)return;this.state.canUnmute=e;for(const t of this.state.setCanUnmuteLocalAudioCallbacks)t(e)}catch(e){this.onError(e)}}realtimeSubscribeToSetCanUnmuteLocalAudio(e){try{this.state.setCanUnmuteLocalAudioCallbacks.push(e)}catch(e){this.onError(e)}}realtimeUnsubscribeToSetCanUnmuteLocalAudio(e){try{const t=this.state.setCanUnmuteLocalAudioCallbacks.indexOf(e);-1!==t&&this.state.setCanUnmuteLocalAudioCallbacks.splice(t,1)}catch(e){this.onError(e)}}realtimeCanUnmuteLocalAudio(){return this.state.canUnmute}realtimeMuteLocalAudio(){if(!this.state.muted)try{this.setAudioInputEnabled(!1),this.state.muted=!0,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const e of this.state.muteAndUnmuteLocalAudioCallbacks)e(!0)}catch(e){this.onError(e)}}realtimeUnmuteLocalAudio(){if(!this.state.muted)return!0;if(!this.state.canUnmute)return!1;try{this.setAudioInputEnabled(!0),this.state.muted=!1,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const e of this.state.muteAndUnmuteLocalAudioCallbacks)e(!1);return!0}catch(e){return this.onError(e),!1}}realtimeSubscribeToMuteAndUnmuteLocalAudio(e){try{this.state.muteAndUnmuteLocalAudioCallbacks.push(e)}catch(e){this.onError(e)}}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(e){try{const t=this.state.muteAndUnmuteLocalAudioCallbacks.indexOf(e);-1!==t&&this.state.muteAndUnmuteLocalAudioCallbacks.splice(t,1)}catch(e){this.onError(e)}}realtimeIsLocalAudioMuted(){return this.state.muted}realtimeSubscribeToVolumeIndicator(e,t){try{this.state.volumeIndicatorCallbacks.hasOwnProperty(e)||(this.state.volumeIndicatorCallbacks[e]=[]),this.state.volumeIndicatorCallbacks[e].push(t),this.sendVolumeIndicatorChange(e,!0,!0,!0,this.state.attendeeIdToExternalUserId[e])}catch(e){this.onError(e)}}realtimeUnsubscribeFromVolumeIndicator(e,t){if(this.state.volumeIndicatorCallbacks[e])if(t){const i=this.state.volumeIndicatorCallbacks[e].indexOf(t);i>=0&&this.state.volumeIndicatorCallbacks[e].splice(i,1)}else delete this.state.volumeIndicatorCallbacks[e]}realtimeUpdateVolumeIndicator(e,t,i,n,r){try{i=this.applyLocalMuteOverride(e,i);const o=this.getVolumeIndicatorState(e);let a=!1,s=!1,d=!1;null!==i&&o.muted!==i&&(o.muted=i,s=!0,o.muted&&0!==o.volume&&(o.volume=0,a=!0)),o.muted||null===t||(o.volume!==t&&(o.volume=t,a=!0),null===o.muted&&(o.muted=!1,s=!0)),null!==n&&o.signalStrength!==n&&(o.signalStrength=n,d=!0),this.sendVolumeIndicatorChange(e,a,s,d,r)}catch(e){this.onError(e)}}realtimeSubscribeToLocalSignalStrengthChange(e){try{if(this.state.localSignalStrengthChangeCallbacks.push(e),null===this.state.localAttendeeId)return;this.sendLocalSignalStrengthChange(this.state.localAttendeeId,!0)}catch(e){this.onError(e)}}realtimeUnsubscribeToLocalSignalStrengthChange(e){try{const t=this.state.localSignalStrengthChangeCallbacks.indexOf(e);-1!==t&&this.state.localSignalStrengthChangeCallbacks.splice(t,1)}catch(e){this.onError(e)}}realtimeSubscribeToSendDataMessage(e){try{this.state.sendDataMessageCallbacks.push(e)}catch(e){this.onError(e)}}realtimeUnsubscribeFromSendDataMessage(e){try{const t=this.state.sendDataMessageCallbacks.indexOf(e);-1!==t&&this.state.sendDataMessageCallbacks.splice(t,1)}catch(e){this.onError(e)}}realtimeSendDataMessage(e,t,i){try{for(const n of this.state.sendDataMessageCallbacks)n(e,t,i)}catch(e){this.onError(e)}}realtimeSubscribeToReceiveDataMessage(e,t){try{this.state.receiveDataMessageCallbacks.has(e)?this.state.receiveDataMessageCallbacks.get(e).push(t):this.state.receiveDataMessageCallbacks.set(e,[t])}catch(e){this.onError(e)}}realtimeUnsubscribeFromReceiveDataMessage(e){try{this.state.receiveDataMessageCallbacks.delete(e)}catch(e){this.onError(e)}}realtimeReceiveDataMessage(e){try{if(this.state.receiveDataMessageCallbacks.has(e.topic))for(const t of this.state.receiveDataMessageCallbacks.get(e.topic))t(e)}catch(e){this.onError(e)}}realtimeSubscribeToFatalError(e){try{this.state.fatalErrorCallbacks.push(e)}catch(e){this.onError(e)}}realtimeUnsubscribeToFatalError(e){try{const t=this.state.fatalErrorCallbacks.indexOf(e);-1!==t&&this.state.fatalErrorCallbacks.splice(t,1)}catch(e){this.onError(e)}}get transcriptionController(){return this._transcriptionController}setAudioInputEnabled(e){e?this.mediaStreamBroker.unmuteLocalAudioInputStream():this.mediaStreamBroker.muteLocalAudioInputStream()}applyLocalMuteOverride(e,t){const i=this.state.localAttendeeId,n=this.state.muted;return e!==i?t:"activeDevices"in this.mediaStreamBroker&&this.mediaStreamBroker.activeDevices.audio?n:t}sendVolumeIndicatorChange(e,t,i,n,r){if(this.sendLocalSignalStrengthChange(e,n),!this.state.volumeIndicatorCallbacks.hasOwnProperty(e))return;const o=this.getVolumeIndicatorState(e),a=new RealtimeVolumeIndicator_1.default;if(t&&(a.volume=o.volume),i&&(a.muted=o.muted),n&&(a.signalStrength=o.signalStrength),!this.stateIsEmpty(a))for(const t of this.state.volumeIndicatorCallbacks[e])t(e,a.volume,a.muted,a.signalStrength,r)}sendLocalSignalStrengthChange(e,t){if(!t)return;if(e!==this.state.localAttendeeId)return;const i=this.getVolumeIndicatorState(e).signalStrength;if(null!==i)for(const e of this.state.localSignalStrengthChangeCallbacks)e(i)}getVolumeIndicatorState(e){return this.state.volumeIndicatorState.hasOwnProperty(e)||(this.state.volumeIndicatorState[e]=new RealtimeVolumeIndicator_1.default),this.state.volumeIndicatorState[e]}stateIsEmpty(e){return null===e.volume&&null===e.muted&&null===e.signalStrength}onError(e){try{for(const t of this.state.fatalErrorCallbacks)t(e)}catch(t){try{console.error(e),console.error(t)}catch(e){}}}}DefaultRealtimeController$1.default=DefaultRealtimeController;var DefaultSessionStateController$1={},SessionStateControllerAction={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SessionStateControllerAction=void 0,function(e){e[e.Connect=0]="Connect",e[e.FinishConnecting=1]="FinishConnecting",e[e.Update=2]="Update",e[e.FinishUpdating=3]="FinishUpdating",e[e.Reconnect=4]="Reconnect",e[e.Disconnect=5]="Disconnect",e[e.Fail=6]="Fail",e[e.FinishDisconnecting=7]="FinishDisconnecting"}(t=e.SessionStateControllerAction||(e.SessionStateControllerAction={})),e.default=t}(SessionStateControllerAction);var SessionStateControllerDeferPriority={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SessionStateControllerDeferPriority=void 0,function(e){e[e.DoNotDefer=0]="DoNotDefer",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.VeryHigh=4]="VeryHigh"}(t=e.SessionStateControllerDeferPriority||(e.SessionStateControllerDeferPriority={})),e.default=t}(SessionStateControllerDeferPriority);var SessionStateControllerState={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SessionStateControllerState=void 0,function(e){e[e.NotConnected=0]="NotConnected",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.Updating=3]="Updating",e[e.Disconnecting=4]="Disconnecting"}(t=e.SessionStateControllerState||(e.SessionStateControllerState={})),e.default=t}(SessionStateControllerState);var SessionStateControllerTransitionResult={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SessionStateControllerTransitionResult=void 0,function(e){e[e.Transitioned=0]="Transitioned",e[e.NoTransitionAvailable=1]="NoTransitionAvailable",e[e.DeferredTransition=2]="DeferredTransition",e[e.TransitionFailed=3]="TransitionFailed"}(t=e.SessionStateControllerTransitionResult||(e.SessionStateControllerTransitionResult={})),e.default=t}(SessionStateControllerTransitionResult),Object.defineProperty(DefaultSessionStateController$1,"__esModule",{value:!0});const SessionStateControllerAction_1=SessionStateControllerAction,SessionStateControllerDeferPriority_1=SessionStateControllerDeferPriority,SessionStateControllerState_1=SessionStateControllerState,SessionStateControllerTransitionResult_1=SessionStateControllerTransitionResult;class DefaultSessionStateController{constructor(e){this.logger=e,this.currentState=SessionStateControllerState_1.SessionStateControllerState.NotConnected,this.deferredAction=null,this.deferredWork=null}perform(e,t){const i=this.currentState;if(i===SessionStateControllerState_1.SessionStateControllerState.NotConnected&&e===SessionStateControllerAction_1.SessionStateControllerAction.Connect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connecting&&e===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connecting&&e===SessionStateControllerAction_1.SessionStateControllerAction.FinishConnecting)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connected&&e===SessionStateControllerAction_1.SessionStateControllerAction.Disconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connected&&e===SessionStateControllerAction_1.SessionStateControllerAction.Reconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connected&&e===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Connected&&e===SessionStateControllerAction_1.SessionStateControllerAction.Update)this.transition(SessionStateControllerState_1.SessionStateControllerState.Updating,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Updating&&e===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,e);else if(i===SessionStateControllerState_1.SessionStateControllerState.Updating&&e===SessionStateControllerAction_1.SessionStateControllerAction.FinishUpdating)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,e);else{if(i!==SessionStateControllerState_1.SessionStateControllerState.Disconnecting||e!==SessionStateControllerAction_1.SessionStateControllerAction.FinishDisconnecting)return this.canDefer(e)?(this.logger.info(`deferring transition from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[e]}`),this.deferAction(e,t),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.DeferredTransition):(this.logger.warn(`no transition found from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[e]}`),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.NoTransitionAvailable);this.transition(SessionStateControllerState_1.SessionStateControllerState.NotConnected,e)}try{t()}catch(t){return this.logger.error(`error during state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with action ${SessionStateControllerAction_1.SessionStateControllerAction[e]}: ${t}`),this.logger.info(`rolling back transition to ${SessionStateControllerState_1.SessionStateControllerState[i]}`),this.currentState=i,SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.TransitionFailed}return this.performDeferredAction(),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned}state(){return this.currentState}transition(e,t){this.logger.info(`transitioning from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} to ${SessionStateControllerState_1.SessionStateControllerState[e]} with ${SessionStateControllerAction_1.SessionStateControllerAction[t]}`),this.currentState=e}deferPriority(e){switch(e){case SessionStateControllerAction_1.SessionStateControllerAction.Disconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.VeryHigh;case SessionStateControllerAction_1.SessionStateControllerAction.Fail:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.High;case SessionStateControllerAction_1.SessionStateControllerAction.Reconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Medium;case SessionStateControllerAction_1.SessionStateControllerAction.Update:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Low;default:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer}}deferAction(e,t){null!==this.deferredAction&&this.deferPriority(this.deferredAction)>this.deferPriority(e)||(this.deferredAction=e,this.deferredWork=t)}canDefer(e){return this.deferPriority(e)!==SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer&&(this.currentState===SessionStateControllerState_1.SessionStateControllerState.Connecting||this.currentState===SessionStateControllerState_1.SessionStateControllerState.Updating)}performDeferredAction(){if(!this.deferredAction)return;const e=this.deferredAction,t=this.deferredWork;this.deferredAction=null,this.deferredWork=null,this.logger.info(`performing deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[e]}`),this.perform(e,t)!==SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned&&this.logger.info(`unable to perform deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[e]} in state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]}`)}}DefaultSessionStateController$1.default=DefaultSessionStateController;var DefaultSignalingClient$1={},Utils$1={},__importDefault$15=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Utils$1,"__esModule",{value:!0}),Utils$1.getFormattedOffset=Utils$1.getDefaultAssetSpec=Utils$1.toLowerCasePropertyNames=Utils$1.isIFramed=Utils$1.wait=void 0;const Versioning_1$8=__importDefault$15(Versioning$1);function wait(e){return new Promise((t=>setTimeout(t,e)))}function isIFramed(){var e;try{return"IFRAME"===(null===(e=window.frameElement)||void 0===e?void 0:e.nodeName)||parent!==top}catch(e){return!0}}function toLowerCasePropertyNames(e){return null===e?null:"object"!=typeof e?e:Array.isArray(e)?e.map(toLowerCasePropertyNames):Object.keys(e).reduce(((t,i)=>{const n=e[i],r="object"==typeof n?toLowerCasePropertyNames(n):n;return t[i.toLowerCase()]=r,t}),{})}function getDefaultAssetSpec(){const e=Versioning_1$8.default.sdkVersionSemVer;return{assetGroup:`sdk-${e.major}.${e.minor}`}}function getFormattedOffset(e){const t=Math.abs(e);return`${e<=0?"+":"-"}${Math.floor(t/60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")}`}Utils$1.wait=wait,Utils$1.isIFramed=isIFramed,Utils$1.toLowerCasePropertyNames=toLowerCasePropertyNames,Utils$1.getDefaultAssetSpec=getDefaultAssetSpec,Utils$1.getFormattedOffset=getFormattedOffset;var VideoQualityAdaptationPreference={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.VideoQualityAdaptationPreference=void 0,function(e){e[e.Balanced=0]="Balanced",e[e.MaintainFramerate=1]="MaintainFramerate",e[e.MaintainResolution=2]="MaintainResolution"}(t=e.VideoQualityAdaptationPreference||(e.VideoQualityAdaptationPreference={})),e.default=t}(VideoQualityAdaptationPreference);var WebSocketReadyState={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.WebSocketReadyState=void 0,function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Open=2]="Open",e[e.Closing=3]="Closing",e[e.Closed=4]="Closed"}(t=e.WebSocketReadyState||(e.WebSocketReadyState={})),e.default=t}(WebSocketReadyState);var ServerSideNetworkAdaption={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.convertServerSideNetworkAdaptionEnumToSignaled=e.convertServerSideNetworkAdaptionEnumFromSignaled=e.serverSideNetworkAdaptionIsNoneOrDefault=e.ServerSideNetworkAdaption=void 0;const t=SignalingProtocol;var i;!function(e){e[e.Default=0]="Default",e[e.None=1]="None",e[e.BandwidthProbing=2]="BandwidthProbing",e[e.BandwidthProbingAndRemoteVideoQualityAdaption=3]="BandwidthProbingAndRemoteVideoQualityAdaption"}(i=e.ServerSideNetworkAdaption||(e.ServerSideNetworkAdaption={})),e.default=i,e.serverSideNetworkAdaptionIsNoneOrDefault=function(e){return e===i.None||e===i.Default},e.convertServerSideNetworkAdaptionEnumFromSignaled=function(e){switch(e){case t.SdkServerSideNetworkAdaption.DEFAULT:return i.Default;case t.SdkServerSideNetworkAdaption.NONE:return i.None;case t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING:return i.BandwidthProbing;case t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION:return i.BandwidthProbingAndRemoteVideoQualityAdaption}},e.convertServerSideNetworkAdaptionEnumToSignaled=function(e){switch(e){case i.Default:return t.SdkServerSideNetworkAdaption.DEFAULT;case i.None:return t.SdkServerSideNetworkAdaption.NONE;case i.BandwidthProbing:return t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING;case i.BandwidthProbingAndRemoteVideoQualityAdaption:return t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION}}}(ServerSideNetworkAdaption);var SignalingClientEvent$1={},__importDefault$14=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SignalingClientEvent$1,"__esModule",{value:!0});const SignalingClientEventType_1$a=__importDefault$14(SignalingClientEventType);class SignalingClientEvent{constructor(e,t,i,n,r){this.client=e,this.type=t,this.message=i,this.closeCode=n,this.closeReason=r,this.timestampMs=Date.now()}isConnectionTerminated(){switch(this.type){case SignalingClientEventType_1$a.default.WebSocketFailed:case SignalingClientEventType_1$a.default.WebSocketError:case SignalingClientEventType_1$a.default.WebSocketClosing:case SignalingClientEventType_1$a.default.WebSocketClosed:return!0;default:return!1}}}SignalingClientEvent$1.default=SignalingClientEvent;var __importDefault$13=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultSignalingClient$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$4=__importDefault$13(DefaultBrowserBehavior$1),TimeoutScheduler_1$2=__importDefault$13(TimeoutScheduler$1),SignalingProtocol_js_1$c=SignalingProtocol,Utils_1$4=Utils$1,Versioning_1$7=__importDefault$13(Versioning$1),VideoQualityAdaptationPreference_1$2=__importDefault$13(VideoQualityAdaptationPreference),WebSocketReadyState_1$2=__importDefault$13(WebSocketReadyState),ServerSideNetworkAdaption_1$5=ServerSideNetworkAdaption,SignalingClientEvent_1=__importDefault$13(SignalingClientEvent$1),SignalingClientEventType_1$9=__importDefault$13(SignalingClientEventType);class DefaultSignalingClient{constructor(e,t){this.webSocket=e,this.logger=t,this.unloadHandler=null,this.closeEventHandler=e=>{this.deactivatePageUnloadHandler(),this.resetConnection(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketClosed,null,e.code,e.reason)),this.serviceConnectionRequestQueue()},this.observerQueue=new Set,this.connectionRequestQueue=[],this.resetConnection(),this.logger.debug((()=>"signaling client init")),this.audioSessionId=this.generateNewAudioSessionId()}registerObserver(e){this.logger.debug((()=>"registering signaling client observer")),this.observerQueue.add(e)}removeObserver(e){this.logger.debug((()=>"removing signaling client observer")),this.observerQueue.delete(e)}openConnection(e){this.logger.info("adding connection request to queue: "+e.url()),this.connectionRequestQueue.push(e),this.closeConnection()}pingPong(e){this.logger.debug((()=>"sending ping"));const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();return t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PING_PONG,t.pingPong=e,this.sendMessage(t),t.timestampMs}join(e){this.logger.info("sending join");const t=SignalingProtocol_js_1$c.SdkJoinFrame.create();t.protocolVersion=2,t.flags=SignalingProtocol_js_1$c.SdkJoinFlags.HAS_STREAM_UPDATE;const i=new DefaultBrowserBehavior_1$4.default,n={platformName:i.name(),platformVersion:i.version(),clientSource:Versioning_1$7.default.sdkName,chimeSdkVersion:Versioning_1$7.default.sdkVersion,clientUtcOffset:Utils_1$4.getFormattedOffset((new Date).getTimezoneOffset())};if(e.applicationMetadata){const{appName:t,appVersion:i}=e.applicationMetadata;n.appName=t,n.appVersion=i}t.clientDetails=SignalingProtocol_js_1$c.SdkClientDetails.create(n),t.audioSessionId=this.audioSessionId,t.wantsCompressedSdp=DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION,t.disablePeriodicKeyframeRequestOnContentSender=e.disablePeriodicKeyframeRequestOnContentSender,t.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$5.convertServerSideNetworkAdaptionEnumToSignaled(e.serverSideNetworkAdaption),t.supportedServerSideNetworkAdaptions=e.supportedServerSideNetworkAdaptions.map(ServerSideNetworkAdaption_1$5.convertServerSideNetworkAdaptionEnumToSignaled),t.wantsAllTemporalLayersInIndex=e.wantsAllTemporalLayersInIndex;const r=SignalingProtocol_js_1$c.SdkSignalFrame.create();r.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.JOIN,r.join=t,this.sendMessage(r)}subscribe(e){const t=SignalingProtocol_js_1$c.SdkSubscribeFrame.create();if(t.sendStreams=[],t.sdpOffer=e.sdpOffer,e.connectionTypeHasVideo&&(t.receiveStreamIds=e.receiveStreamIds),e.audioHost&&(t.audioCheckin=e.audioCheckin,t.audioHost=e.audioHost,t.audioMuted=e.audioMuted,!e.audioCheckin)){const i=SignalingProtocol_js_1$c.SdkStreamDescriptor.create();i.mediaType=SignalingProtocol_js_1$c.SdkStreamMediaType.AUDIO,i.trackLabel="AmazonChimeExpressAudio",i.attendeeId=e.attendeeId,i.streamId=1,i.groupId=1,i.framerate=15,i.maxBitrateKbps=600,i.avgBitrateBps=4e5,t.sendStreams.push(i)}if(t.compressedSdpOffer=e.compressedSdpOffer,t.duplex=SignalingProtocol_js_1$c.SdkStreamServiceType.RX,e.localVideoEnabled){t.duplex=SignalingProtocol_js_1$c.SdkStreamServiceType.DUPLEX;for(let i=0;i<e.videoStreamDescriptions.length;i++){const n=e.videoStreamDescriptions[i].clone();n.attendeeId=e.attendeeId,t.sendStreams.push(n.toStreamDescriptor())}}e.videoSubscriptionConfiguration.length>0&&(t.videoSubscriptionConfiguration=e.videoSubscriptionConfiguration.map(this.convertSignalingClientVideoSubscriptionConfiguration));const i=SignalingProtocol_js_1$c.SdkSignalFrame.create();i.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.SUBSCRIBE,i.sub=t,this.sendMessage(i)}remoteVideoUpdate(e,t){const i=SignalingProtocol_js_1$c.SdkRemoteVideoUpdateFrame.create();i.addedOrUpdatedVideoSubscriptions=e.map(this.convertSignalingClientVideoSubscriptionConfiguration),i.removedVideoSubscriptionMids=t;const n=SignalingProtocol_js_1$c.SdkSignalFrame.create();n.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.REMOTE_VIDEO_UPDATE,n.remoteVideoUpdate=i,this.sendMessage(n)}convertSignalingClientVideoSubscriptionConfiguration(e){const t=new SignalingProtocol_js_1$c.SdkVideoSubscriptionConfiguration;switch(t.mid=e.mid,t.attendeeId=e.attendeeId,t.streamId=e.streamId,t.groupId=e.groupId,t.priority=e.priority,t.targetBitrateKbps=e.targetBitrateKbps,e.qualityAdaptationPreference){case VideoQualityAdaptationPreference_1$2.default.Balanced:t.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.BALANCED;break;case VideoQualityAdaptationPreference_1$2.default.MaintainFramerate:t.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.MAINTAIN_FRAMERATE;break;case VideoQualityAdaptationPreference_1$2.default.MaintainResolution:t.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.MAINTAIN_RESOLUTION;break;default:t.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.BALANCED}return t}leave(){const e=SignalingProtocol_js_1$c.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.LEAVE,e.leave=SignalingProtocol_js_1$c.SdkLeaveFrame.create(),this.sendMessage(e),this.logger.debug((()=>"sent leave"))}sendClientMetrics(e){const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.CLIENT_METRIC,t.clientMetric=e,this.sendMessage(t)}sendDataMessage(e){const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.DATA_MESSAGE,t.dataMessage=e,this.sendMessage(t)}closeConnection(){var e,t;if(this.webSocket.readyState()!==WebSocketReadyState_1$2.default.None&&this.webSocket.readyState()!==WebSocketReadyState_1$2.default.Closed){this.isClosing=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketClosing,null));const i=new TimeoutScheduler_1$2.default(DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS),n=e=>{var t,r;null===(r=(t=this.webSocket).removeEventListener)||void 0===r||r.call(t,"close",n),i.stop(),this.closeEventHandler(e)};null===(t=(e=this.webSocket).removeEventListener)||void 0===t||t.call(e,"close",this.closeEventHandler),this.webSocket.addEventListener("close",n),i.start((()=>{n(new CloseEvent("close",{wasClean:!1,code:1006,reason:"",bubbles:!1}))})),this.webSocket.close(),this.deactivatePageUnloadHandler()}else this.logger.info("no existing signaling client connection needs closing"),this.serviceConnectionRequestQueue()}ready(){return this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open&&!this.isClosing&&this.wasOpened}mute(e){const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.AUDIO_CONTROL;const i=SignalingProtocol_js_1$c.SdkAudioControlFrame.create();i.muted=e,t.audioControl=i,this.sendMessage(t)}pause(e){const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PAUSE,t.pause=SignalingProtocol_js_1$c.SdkPauseResumeFrame.create(),t.pause.streamIds=e,this.sendMessage(t)}resume(e){const t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.RESUME,t.pause=SignalingProtocol_js_1$c.SdkPauseResumeFrame.create(),t.pause.streamIds=e,this.sendMessage(t)}resetConnection(){this.webSocket.destroy(),this.wasOpened=!1}sendMessage(e){e.timestampMs=Date.now(),this.logger.debug((()=>`sending: ${JSON.stringify(e)}`));const t=this.prependWithFrameTypeRTC(SignalingProtocol_js_1$c.SdkSignalFrame.encode(e).finish());if(this.ready()){if(!this.webSocket.send(t))return void this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSendMessageFailure,null));this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSentMessage,null))}else this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSkippedMessage,null))}receiveMessage(e){let t;try{t=SignalingProtocol_js_1$c.SdkSignalFrame.decode(e)}catch(t){return this.logger.info(`failed to decode: ${e}`),void this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.ProtocolDecodeFailure,null))}this.logger.debug((()=>`received: ${JSON.stringify(t)}`)),this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open?this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.ReceivedSignalFrame,t)):this.logger.info(`skipping notification of message since WebSocket is not open: ${JSON.stringify(t)}`)}stripFrameTypeRTC(e){const t=e[0];return t!==DefaultSignalingClient.FRAME_TYPE_RTC&&2!==t&&this.logger.warn(`expected FrameTypeRTC for message but got ${t}`),e.slice(1)}prependWithFrameTypeRTC(e){const t=new Uint8Array(e.length+1);return t[0]=DefaultSignalingClient.FRAME_TYPE_RTC,t.set(e,1),t}serviceConnectionRequestQueue(){if(0===this.connectionRequestQueue.length)return void this.logger.info("no connection requests to service");const e=this.connectionRequestQueue.shift();this.logger.info(`opening connection to ${e.url()}`),this.isClosing=!1,this.webSocket.create(e.url(),e.protocols()),this.setUpEventListeners(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketConnecting,null))}sendEvent(e){switch(e.type){case SignalingClientEventType_1$9.default.WebSocketMessage:case SignalingClientEventType_1$9.default.ReceivedSignalFrame:case SignalingClientEventType_1$9.default.WebSocketSentMessage:this.logger.debug((()=>`notifying event: ${SignalingClientEventType_1$9.default[e.type]}`));break;case SignalingClientEventType_1$9.default.WebSocketSkippedMessage:this.logger.debug((()=>`notifying event: ${SignalingClientEventType_1$9.default[e.type]}, websocket state=${WebSocketReadyState_1$2.default[this.webSocket.readyState()]}`));break;default:this.logger.info(`notifying event: ${SignalingClientEventType_1$9.default[e.type]}`)}for(const t of this.observerQueue)t.handleSignalingClientEvent(e)}setUpEventListeners(){this.webSocket.addEventListener("open",(()=>{this.activatePageUnloadHandler(),this.wasOpened=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketOpen,null))})),this.webSocket.addEventListener("message",(e=>{this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketMessage,null)),this.receiveMessage(this.stripFrameTypeRTC(new Uint8Array(e.data)))})),this.webSocket.addEventListener("close",this.closeEventHandler),this.webSocket.addEventListener("error",(()=>{!this.isClosing||this.wasOpened?this.wasOpened?(this.logger.error("received error while connected"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketError,null))):(this.logger.error("failed to connect"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketFailed,null))):this.logger.info("ignoring error closing signaling while connecting")}))}activatePageUnloadHandler(){this.unloadHandler=()=>{this.leave()};const e=commonjsGlobal;e.window&&e.window.addEventListener&&window.addEventListener("unload",this.unloadHandler)}deactivatePageUnloadHandler(){const e=commonjsGlobal;e.window&&e.window.removeEventListener&&window.removeEventListener("unload",this.unloadHandler),this.unloadHandler=null}generateNewAudioSessionId(){const e=new Uint32Array(1);return window.crypto.getRandomValues(e)[0]}promoteToPrimaryMeeting(e){const t=SignalingProtocol_js_1$c.SdkMeetingSessionCredentials.create();t.attendeeId=e.attendeeId,t.externalUserId=e.externalUserId,t.joinToken=e.joinToken;const i=SignalingProtocol_js_1$c.SdkPrimaryMeetingJoinFrame.create();i.credentials=t;const n=SignalingProtocol_js_1$c.SdkSignalFrame.create();n.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN,n.primaryMeetingJoin=i,this.sendMessage(n)}demoteFromPrimaryMeeting(){const e=SignalingProtocol_js_1$c.SdkPrimaryMeetingLeaveFrame.create(),t=SignalingProtocol_js_1$c.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE,t.primaryMeetingLeave=e,this.sendMessage(t)}}DefaultSignalingClient$1.default=DefaultSignalingClient,DefaultSignalingClient.FRAME_TYPE_RTC=5,DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS=2e3,DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION=!0;var SignalingClientVideoSubscriptionConfiguration$1={};Object.defineProperty(SignalingClientVideoSubscriptionConfiguration$1,"__esModule",{value:!0});class SignalingClientVideoSubscriptionConfiguration{equals(e){return void 0!==e&&this.mid===e.mid&&this.attendeeId===e.attendeeId&&this.streamId===e.streamId&&this.groupId===e.groupId&&this.priority===e.priority&&this.targetBitrateKbps===e.targetBitrateKbps&&this.qualityAdaptationPreference===e.qualityAdaptationPreference}}SignalingClientVideoSubscriptionConfiguration$1.default=SignalingClientVideoSubscriptionConfiguration;var StatsCollector$1={},RedundantAudioRecoveryMetricReport$1={};Object.defineProperty(RedundantAudioRecoveryMetricReport$1,"__esModule",{value:!0});class RedundantAudioRecoveryMetricReport{constructor(){this.currentTimestampMs=0,this.ssrc=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsExpected=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}}RedundantAudioRecoveryMetricReport$1.default=RedundantAudioRecoveryMetricReport;var StreamMetricReport$1={};Object.defineProperty(StreamMetricReport$1,"__esModule",{value:!0});class StreamMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}}StreamMetricReport$1.default=StreamMetricReport;var MeetingSessionLifecycleEvent={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MeetingSessionLifecycleEvent=void 0,function(e){e[e.Connecting=0]="Connecting",e[e.Started=1]="Started",e[e.Stopped=2]="Stopped"}(t=e.MeetingSessionLifecycleEvent||(e.MeetingSessionLifecycleEvent={})),e.default=t}(MeetingSessionLifecycleEvent);var MeetingSessionLifecycleEventCondition={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MeetingSessionLifecycleEventCondition=void 0,function(e){e[e.ConnectingNew=0]="ConnectingNew",e[e.ReconnectingExisting=1]="ReconnectingExisting",e[e.StartedNew=2]="StartedNew",e[e.StartedExisting=3]="StartedExisting",e[e.StartedAfterReconnect=4]="StartedAfterReconnect",e[e.StoppedCleanly=5]="StoppedCleanly",e[e.StoppedWithFailure=6]="StoppedWithFailure"}(t=e.MeetingSessionLifecycleEventCondition||(e.MeetingSessionLifecycleEventCondition={})),e.default=t}(MeetingSessionLifecycleEventCondition);var __awaiter$K=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$12=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(StatsCollector$1,"__esModule",{value:!0});const ClientMetricReport_1=__importDefault$12(ClientMetricReport$1),ClientMetricReportDirection_1$2=__importDefault$12(ClientMetricReportDirection),ClientMetricReportMediaType_1$2=__importDefault$12(ClientMetricReportMediaType),RedundantAudioRecoveryMetricReport_1$1=__importDefault$12(RedundantAudioRecoveryMetricReport$1),StreamMetricReport_1=__importDefault$12(StreamMetricReport$1),MeetingSessionLifecycleEvent_1=__importDefault$12(MeetingSessionLifecycleEvent),MeetingSessionLifecycleEventCondition_1=__importDefault$12(MeetingSessionLifecycleEventCondition),IntervalScheduler_1$2=__importDefault$12(IntervalScheduler$1),SignalingProtocol_js_1$b=SignalingProtocol,Types_1$5=Types,AudioLogEvent_1$1=__importDefault$12(AudioLogEvent),VideoLogEvent_1=__importDefault$12(VideoLogEvent);class StatsCollector{constructor(e,t,i=StatsCollector.INTERVAL_MS){this.audioVideoController=e,this.logger=t,this.interval=i,this.intervalScheduler=null,this.redRecoveryMetricReport=new RedundantAudioRecoveryMetricReport_1$1.default,this.lastRedRecoveryMetricReportConsumedTimestampMs=0,this.metricsAddTime=(e,t,i)=>{},this.metricsLogEvent=(e,t)=>{}}toAttribute(e){return this.toSuffix(e).substring(1)}toSuffix(e){return e.toLowerCase()===e?`_${e}`:e.toUpperCase()===e?`_${e.toLowerCase()}`:e.replace(/([A-Z][a-z]+)/g,(function(e){return`_${e}`})).replace(/([A-Z][A-Z]+)/g,(function(e){return`_${e}`})).toLowerCase()}logLatency(e,t,i){const n=this.toSuffix(e);this.logEventTime("meeting"+n,t,i)}logStateTimeout(e,t){const i=this.toSuffix(e);this.logEvent("meeting_session_state_timeout",Object.assign(Object.assign({},t),{state:`state${i}`}))}logAudioEvent(e,t){const i="audio"+this.toSuffix(AudioLogEvent_1$1.default[e]);this.logEvent(i,t)}logVideoEvent(e,t){const i="video"+this.toSuffix(VideoLogEvent_1.default[e]);this.logEvent(i,t)}logEventTime(e,t,i={}){const n=Object.assign(Object.assign({},i),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE,metric_type:"latency"});this.logger.debug((()=>`[StatsCollector] ${e}: ${JSON.stringify(n)}`)),this.metricsAddTime(e,t,n)}logMeetingSessionStatus(e){const t=`${e.statusCode()}`;this.logEvent(t);const i={status:t,status_code:`${e.statusCode()}`};this.logEvent("meeting_session_status",i),e.isTerminal()&&this.logEvent("meeting_session_stopped",i),e.isAudioConnectionFailure()&&this.logEvent("meeting_session_audio_failed",i),e.isFailure()&&this.logEvent("meeting_session_failed",i)}logLifecycleEvent(e,t){const i={lifecycle_event:`lifecycle${this.toSuffix(MeetingSessionLifecycleEvent_1.default[e])}`,lifecycle_event_code:`${e}`,lifecycle_event_condition:`condition${this.toSuffix(MeetingSessionLifecycleEventCondition_1.default[t])}`,lifecycle_event_condition_code:`${t}`};this.logEvent("meeting_session_lifecycle",i)}logEvent(e,t={}){const i=Object.assign(Object.assign({},t),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE});this.logger.debug((()=>`[StatsCollector] ${e}: ${JSON.stringify(i)}`)),this.metricsLogEvent(e,i)}start(e,t){return!this.intervalScheduler&&(this.logger.info("Starting StatsCollector"),this.signalingClient=e,this.videoStreamIndex=t,this.clientMetricReport=new ClientMetricReport_1.default(this.logger,this.videoStreamIndex,this.audioVideoController.configuration.credentials.attendeeId),this.intervalScheduler=new IntervalScheduler_1$2.default(this.interval),this.intervalScheduler.start((()=>__awaiter$K(this,void 0,void 0,(function*(){yield this.getStatsWrapper()})))),!0)}stop(){this.logger.info("Stopping StatsCollector"),this.intervalScheduler&&this.intervalScheduler.stop(),this.intervalScheduler=null}updateMetricValues(e,t){const i=t?this.clientMetricReport.streamMetricReports[Number(e.ssrc)]:this.clientMetricReport.globalMetricReport;let n;n=t?this.clientMetricReport.getMetricMap(i.mediaType,i.direction):this.clientMetricReport.getMetricMap();for(const t in e)t in n&&("number"==typeof e[t]?(i.previousMetrics[t]=i.currentMetrics[t],i.currentMetrics[t]=e[t]):"string"==typeof e[t]?i.currentStringMetrics[t]=e[t]:"object"==typeof e[t]?(i.previousObjectMetrics[t]=void 0===i.currentObjectMetrics[t]?e[t]:i.currentObjectMetrics[t],i.currentObjectMetrics[t]=e[t]):this.logger.error(`Unknown metric value type ${typeof e[t]} for metric ${t}`))}processRawMetricReports(e){this.clientMetricReport.currentSsrcs={};const t=Date.now();for(const t of e){const e=this.isStreamRawMetricReport(t.type);if(e){const e=this.clientMetricReport.streamMetricReports[Number(t.ssrc)];if(e)e.mediaType===ClientMetricReportMediaType_1$2.default.VIDEO&&e.direction===ClientMetricReportDirection_1$2.default.UPSTREAM?e.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(t.rid):e.streamId=this.videoStreamIndex.streamIdForSSRC(Number(t.ssrc));else{const e=new StreamMetricReport_1.default;e.mediaType=this.getMediaType(t),e.direction=this.getDirectionType(t),e.mediaType===ClientMetricReportMediaType_1$2.default.VIDEO&&e.direction===ClientMetricReportDirection_1$2.default.UPSTREAM?e.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(t.rid):this.videoStreamIndex.allStreams().empty()||(e.streamId=this.videoStreamIndex.streamIdForSSRC(Number(t.ssrc)),void 0!==this.videoStreamIndex.groupIdForSSRC&&(e.groupId=this.videoStreamIndex.groupIdForSSRC(Number(t.ssrc)))),this.clientMetricReport.streamMetricReports[Number(t.ssrc)]=e}this.clientMetricReport.currentSsrcs[Number(t.ssrc)]=1}this.updateMetricValues(t,e)}this.clientMetricReport.removeDestroyedSsrcs(),this.clientMetricReport.previousTimestampMs=this.clientMetricReport.currentTimestampMs,this.clientMetricReport.currentTimestampMs=t,this.clientMetricReport.print()}addStreamMetricDimensionFrames(e,t){const i=this.clientMetricReport.getStreamDimensionMap();for(const n in t.currentStringMetrics)if(n in i){const r=SignalingProtocol_js_1$b.SdkStreamDimension.create();r.type=i[n];const o=SignalingProtocol_js_1$b.SdkDimensionValue.create();o.stringValue=t.currentStringMetrics[n],r.value=o,e.dimensions.push(r)}}addMetricFrame(e,t,i,n){const r=i.type,o=i.transform,a=i.source,s=t.streamMetricFrames.length,d=t.streamMetricFrames[s-1];if(r){const i=SignalingProtocol_js_1$b.SdkMetric.create();i.type=r,i.value=o(a||e,n),n?d.metrics.push(i):t.globalMetrics.push(i)}}addGlobalMetricsToProtobuf(e){const t=this.clientMetricReport.getMetricMap();for(const i in this.clientMetricReport.globalMetricReport.currentMetrics)this.addMetricFrame(i,e,t[i])}addStreamMetricsToProtobuf(e){for(const t in this.clientMetricReport.streamMetricReports){const i=this.clientMetricReport.streamMetricReports[t],n=SignalingProtocol_js_1$b.SdkStreamMetricFrame.create();n.streamId=i.streamId,n.metrics=[],this.addStreamMetricDimensionFrames(n,i),e.streamMetricFrames.push(n);const r=this.clientMetricReport.getMetricMap(i.mediaType,i.direction);for(const n in i.currentMetrics)this.addMetricFrame(n,e,r[n],Number(t));for(const n in i.currentStringMetrics)this.addMetricFrame(n,e,r[n],Number(t));for(const n in i.currentObjectMetrics)this.addMetricFrame(n,e,r[n],Number(t))}}makeClientMetricProtobuf(){const e=SignalingProtocol_js_1$b.SdkClientMetricFrame.create();return e.globalMetrics=[],e.streamMetricFrames=[],this.addGlobalMetricsToProtobuf(e),this.addStreamMetricsToProtobuf(e),e}sendClientMetricProtobuf(e){this.signalingClient.sendClientMetrics(e)}isStreamRawMetricReport(e){return["inbound-rtp","inbound-rtp-red","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp"].includes(e)}getMediaType(e){return"audio"===e.kind?ClientMetricReportMediaType_1$2.default.AUDIO:ClientMetricReportMediaType_1$2.default.VIDEO}getDirectionType(e){const{type:t}=e;return"inbound-rtp"===t||"remote-outbound-rtp"===t||"inbound-rtp-red"===t?ClientMetricReportDirection_1$2.default.DOWNSTREAM:ClientMetricReportDirection_1$2.default.UPSTREAM}isValidStandardRawMetric(e){return"inbound-rtp"===e.type||"inbound-rtp-red"===e.type||"outbound-rtp"===e.type||"remote-inbound-rtp"===e.type||"remote-outbound-rtp"===e.type||"candidate-pair"===e.type&&"succeeded"===e.state||"media-source"===e.type&&"audio"===e.kind}isValidSsrc(e){let t=!0;return this.isStreamRawMetricReport(e.type)&&this.getDirectionType(e)===ClientMetricReportDirection_1$2.default.DOWNSTREAM&&this.getMediaType(e)===ClientMetricReportMediaType_1$2.default.VIDEO&&(t=this.videoStreamIndex.streamIdForSSRC(Number(e.ssrc))>0),t}isValidRawMetricReport(e){return this.isValidStandardRawMetric(e)&&this.isValidSsrc(e)}filterRawMetricReports(e){const t=[];for(const i of e)this.isValidRawMetricReport(i)&&t.push(i);return t}handleRawMetricReports(e){const t=this.filterRawMetricReports(e);this.logger.debug((()=>`Filtered raw metrics : ${JSON.stringify(t)}`));const i=[];this.maybeAddRedRecoveryMetrics(i),this.clientMetricReport.customStatsReports=i,t.push(...i),this.processRawMetricReports(t);const n=this.makeClientMetricProtobuf();this.sendClientMetricProtobuf(n),this.audioVideoController.forEachObserver((e=>{Types_1$5.Maybe.of(e.metricsDidReceive).map((t=>t.bind(e)(this.clientMetricReport.clone())))}))}getStatsWrapper(){return __awaiter$K(this,void 0,void 0,(function*(){if(!this.audioVideoController.rtcPeerConnection)return;const e=[];try{const t=yield this.audioVideoController.rtcPeerConnection.getStats();this.clientMetricReport.rtcStatsReport=t,t.forEach((t=>{e.push(t)})),this.handleRawMetricReports(e)}catch(e){this.logger.error(e.message)}}))}overrideObservableMetric(e,t){this.clientMetricReport.overrideObservableMetric(e,t)}recoveryMetricsDidReceive(e){this.redRecoveryMetricReport=e}maybeAddRedRecoveryMetrics(e){this.redRecoveryMetricReport.currentTimestampMs!==this.lastRedRecoveryMetricReportConsumedTimestampMs&&(e.push({kind:"audio",type:"inbound-rtp-red",ssrc:this.redRecoveryMetricReport.ssrc,timestamp:this.redRecoveryMetricReport.currentTimestampMs,totalAudioPacketsLost:this.redRecoveryMetricReport.totalAudioPacketsLost,totalAudioPacketsExpected:this.redRecoveryMetricReport.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.redRecoveryMetricReport.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.redRecoveryMetricReport.totalAudioPacketsRecoveredFec}),this.lastRedRecoveryMetricReportConsumedTimestampMs=this.redRecoveryMetricReport.currentTimestampMs)}}StatsCollector$1.default=StatsCollector,StatsCollector.INTERVAL_MS=1e3,StatsCollector.CLIENT_TYPE="amazon-chime-sdk-js";var FinishGatheringICECandidatesTask$1={},__awaiter$J=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$11=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(FinishGatheringICECandidatesTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$5=__importDefault$11(MeetingSessionStatusCode),SDP_1$3=__importDefault$11(SDP$1),BaseTask_1$k=__importDefault$11(BaseTask$1);class FinishGatheringICECandidatesTask extends BaseTask_1$k.default{constructor(e,t=FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS){super(e.logger),this.context=e,this.chromeVpnTimeoutMs=t,this.taskName="FinishGatheringICECandidatesTask"}removeEventListener(){this.context.peer&&(this.context.peer.removeEventListener("icecandidate",this.context.iceCandidateHandler),this.context.turnCredentials||this.context.peer.removeEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler))}cancel(){let e;if(this.context.browserBehavior.requiresIceCandidateGatheringTimeoutWorkaround()&&this.chromeVpnTimeoutMs<this.context.meetingSessionConfiguration.connectionTimeoutMs){Date.now()-this.startTimestampMs>this.chromeVpnTimeoutMs&&(e=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$5.default.ICEGatheringTimeoutWorkaround}`))}this.cancelPromise&&(e=e||new Error(`canceling ${this.name()}`),this.cancelPromise(e),delete this.cancelPromise)}run(){return __awaiter$J(this,void 0,void 0,(function*(){if(this.context.peer||this.logAndThrow("session does not have peer connection; bypass ice gathering"),this.context.browserBehavior.requiresCheckForSdpConnectionAttributes()){if(new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidatesForAllMLines())return void this.context.logger.info(`ice gathering already complete; bypass gathering, current local description ${this.context.peer.localDescription.sdp}`)}else this.context.logger.info(`iOS device does not require checking for connection attributes in SDP, current local description ${this.context.peer.localDescription.sdp}`);if(!this.context.browserBehavior.hasFirefoxWebRTC()&&"complete"!==this.context.peer.iceGatheringState||!new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates())try{yield new Promise(((e,t)=>{this.cancelPromise=e=>{this.removeEventListener(),t(e)},this.context.turnCredentials||(this.context.iceGatheringStateEventHandler=()=>{if("complete"===this.context.peer.iceGatheringState)return this.removeEventListener(),e(),void delete this.cancelPromise},this.context.peer.addEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler)),this.context.iceCandidateHandler=i=>{if(this.context.logger.info(`ice candidate: ${i.candidate?i.candidate.candidate:"(null)"} state: ${this.context.peer.iceGatheringState}`),i.candidate&&(SDP_1$3.default.isRTPCandidate(i.candidate.candidate)&&this.context.iceCandidates.push(i.candidate),this.context.turnCredentials&&this.context.iceCandidates.length>=1))return this.context.logger.info("gathered at least one relay candidate"),this.removeEventListener(),e(),void delete this.cancelPromise;"complete"===this.context.peer.iceGatheringState&&(this.context.logger.info("done gathering ice candidates"),this.removeEventListener(),new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates()&&0!==this.context.iceCandidates.length?(e(),delete this.cancelPromise):(t(new Error("no ice candidates were gathered")),delete this.cancelPromise))},this.context.peer.addEventListener("icecandidate",this.context.iceCandidateHandler),this.startTimestampMs=Date.now()}))}catch(e){throw e}finally{this.startTimestampMs&&(this.context.iceGatheringDurationMs=Math.round(Date.now()-this.startTimestampMs))}else this.context.logger.info("ice gathering state is complete and candidates are in SDP; bypass gathering")}))}}FinishGatheringICECandidatesTask$1.default=FinishGatheringICECandidatesTask,FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS=5e3;var JoinAndReceiveIndexTask$1={},MeetingSessionTURNCredentials$1={};Object.defineProperty(MeetingSessionTURNCredentials$1,"__esModule",{value:!0});class MeetingSessionTURNCredentials{constructor(){this.username=null,this.password=null,this.ttl=null,this.uris=null}}MeetingSessionTURNCredentials$1.default=MeetingSessionTURNCredentials;var SignalingClientJoin$1={},__importDefault$10=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SignalingClientJoin$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$4=__importDefault$10(ServerSideNetworkAdaption);class SignalingClientJoin{constructor(e){this.applicationMetadata=e,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$4.default.Default,this.supportedServerSideNetworkAdaptions=[],this.wantsAllTemporalLayersInIndex=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1}}SignalingClientJoin$1.default=SignalingClientJoin;var __createBinding$2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$2=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding$2(t,e,i);return __setModuleDefault$1(t,e),t},__awaiter$I=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$$=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(JoinAndReceiveIndexTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1$2=__importDefault$$(MeetingSessionStatus$1),MeetingSessionStatusCode_1$4=__importDefault$$(MeetingSessionStatusCode),MeetingSessionTURNCredentials_1$1=__importDefault$$(MeetingSessionTURNCredentials$1),ServerSideNetworkAdaption_1$3=__importStar$2(ServerSideNetworkAdaption),SignalingClientEventType_1$8=__importDefault$$(SignalingClientEventType),SignalingClientJoin_1=__importDefault$$(SignalingClientJoin$1),SignalingProtocol_js_1$a=SignalingProtocol,BaseTask_1$j=__importDefault$$(BaseTask$1);class JoinAndReceiveIndexTask extends BaseTask_1$j.default{constructor(e){super(e.logger),this.context=e,this.taskName="JoinAndReceiveIndexTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$I(this,void 0,void 0,(function*(){const e=yield new Promise(((e,t)=>{const i=this.context;i.turnCredentials=null;const n=new class{constructor(e){this.signalingClient=e}cancel(){this.signalingClient.removeObserver(this),t(new Error("JoinAndReceiveIndexTask got canceled while waiting for SdkIndexFrame"))}handleSignalingClientEvent(t){if(t.type===SignalingClientEventType_1$8.default.WebSocketClosed){let e=`The signaling connection was closed with code ${t.closeCode} and reason: ${t.closeReason}`;i.logger.warn(e);let n=MeetingSessionStatusCode_1$4.default.SignalingBadRequest;return 4410===t.closeCode?(e="The meeting already ended.",i.logger.warn(e),n=MeetingSessionStatusCode_1$4.default.MeetingEnded):t.closeCode>=4500&&t.closeCode<4600&&(n=MeetingSessionStatusCode_1$4.default.SignalingInternalServerError),void i.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$2.default(n),new Error(e))}if(t.type!==SignalingClientEventType_1$8.default.ReceivedSignalFrame)return;if(t.message.type===SignalingProtocol_js_1$a.SdkSignalFrame.Type.JOIN_ACK){const e=t.message.joinack;if(e&&e.videoSubscriptionLimit&&(i.videoSubscriptionLimit=e.videoSubscriptionLimit),i.serverSupportsCompression=null==e?void 0:e.wantsCompressedSdp,void 0!==(null==e?void 0:e.defaultServerSideNetworkAdaption)&&e.defaultServerSideNetworkAdaption!==ServerSideNetworkAdaption_1$3.default.Default&&void 0!==i.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption){const t=e.defaultServerSideNetworkAdaption;i.logger.info(`Overriding server side network adaption value to ${t}`),i.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption(ServerSideNetworkAdaption_1$3.convertServerSideNetworkAdaptionEnumFromSignaled(t))}return void(e&&e.turnCredentials?(i.turnCredentials=new MeetingSessionTURNCredentials_1$1.default,i.turnCredentials.username=e.turnCredentials.username,i.turnCredentials.password=e.turnCredentials.password,i.turnCredentials.ttl=e.turnCredentials.ttl,i.turnCredentials.uris=e.turnCredentials.uris.map((e=>i.meetingSessionConfiguration.urls.urlRewriter(e))).filter((e=>!!e))):i.logger.error("missing TURN credentials in JoinAckFrame"))}if(t.message.type!==SignalingProtocol_js_1$a.SdkSignalFrame.Type.INDEX)return;this.signalingClient.removeObserver(this);const n=t.message.index;e(n)}}(this.context.signalingClient);this.context.signalingClient.registerObserver(n),this.taskCanceler=n,this.context.previousSdpAnswerAsString="",this.context.previousSdpOffer=null,this.context.serverSupportsCompression=!1;const r=new SignalingClientJoin_1.default(this.context.meetingSessionConfiguration.applicationMetadata);void 0!==this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption&&void 0!==this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions&&(r.serverSideNetworkAdaption=this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption(),r.supportedServerSideNetworkAdaptions=this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions()),void 0!==this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex&&(r.wantsAllTemporalLayersInIndex=this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex()),r.disablePeriodicKeyframeRequestOnContentSender=this.context.meetingSessionConfiguration.disablePeriodicKeyframeRequestOnContentSender,this.context.signalingClient.join(r)}));this.context.logger.info(`received first index ${JSON.stringify(e)}`),this.context.indexFrame=e}))}}JoinAndReceiveIndexTask$1.default=JoinAndReceiveIndexTask;var LeaveAndReceiveLeaveAckTask$1={},__awaiter$H=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$_=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(LeaveAndReceiveLeaveAckTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$7=__importDefault$_(SignalingClientEventType),SignalingProtocol_js_1$9=SignalingProtocol,BaseTask_1$i=__importDefault$_(BaseTask$1);class LeaveAndReceiveLeaveAckTask extends BaseTask_1$i.default{constructor(e){super(e.logger),this.context=e,this.taskName="LeaveAndReceiveLeaveAckTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$H(this,void 0,void 0,(function*(){this.context.signalingClient.ready()&&(this.context.signalingClient.leave(),this.context.logger.info("sent leave"),yield this.receiveLeaveAck())}))}receiveLeaveAck(){return new Promise(((e,t)=>{const i=new class{constructor(e,t){this.signalingClient=e,this.logger=t}cancel(){this.signalingClient.removeObserver(this),t(new Error("LeaveAndReceiveLeaveAckTask got canceled while waiting for IndexFrame"))}handleSignalingClientEvent(t){if(t.isConnectionTerminated())return this.signalingClient.removeObserver(this),this.logger.info("LeaveAndReceiveLeaveAckTask connection terminated"),void e();t.type===SignalingClientEventType_1$7.default.ReceivedSignalFrame&&t.message.type===SignalingProtocol_js_1$9.SdkSignalFrame.Type.LEAVE_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("got leave ack"),e())}}(this.context.signalingClient,this.context.logger);this.taskCanceler=i,this.context.signalingClient.registerObserver(i)}))}}LeaveAndReceiveLeaveAckTask$1.default=LeaveAndReceiveLeaveAckTask;var ListenForVolumeIndicatorsTask$1={},__awaiter$G=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$Z=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ListenForVolumeIndicatorsTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$6=__importDefault$Z(SignalingClientEventType),SignalingProtocol_js_1$8=SignalingProtocol,BaseTask_1$h=__importDefault$Z(BaseTask$1);class ListenForVolumeIndicatorsTask extends BaseTask_1$h.default{constructor(e){super(e.logger),this.context=e,this.taskName="ListenForVolumeIndicatorsTask",this.realtimeMuteAndUnmuteHandler=e=>{this.context.signalingClient.mute(e)}}run(){return __awaiter$G(this,void 0,void 0,(function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler)}))}removeObserver(){this.context.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(e){if(e.type===SignalingClientEventType_1$6.default.ReceivedSignalFrame)if(e.message.type===SignalingProtocol_js_1$8.SdkSignalFrame.Type.AUDIO_STREAM_ID_INFO){const t=e.message.audioStreamIdInfo;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioStreamIdInfo(t)}else if(e.message.type===SignalingProtocol_js_1$8.SdkSignalFrame.Type.AUDIO_METADATA){const t=e.message.audioMetadata;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioMetadata(t)}}}ListenForVolumeIndicatorsTask$1.default=ListenForVolumeIndicatorsTask;var MonitorTask$1={},ReconnectionHealthPolicy$1={},__importDefault$Y=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReconnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$2=__importDefault$Y(BaseConnectionHealthPolicy$1);class ReconnectionHealthPolicy extends BaseConnectionHealthPolicy_1$2.default{constructor(e,t,i){super(t,i,"Reconnection Health"),this.logger=e,this.audioDelayPointsOverMaximum=0,ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD=t.connectionUnhealthyThreshold,ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS=t.connectionWaitTimeMs,ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD=t.missedPongsUpperThreshold,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS=t.maximumAudioDelayMs,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS=t.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS))return 1;const e=this.currentData.consecutiveStatsWithNoPackets>=ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD,t=this.currentData.consecutiveMissedPongs>=ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;const i=this.audioDelayPointsOverMaximum>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS;i&&(this.audioDelayPointsOverMaximum=0);return e||t||i?(this.logger.warn(`reconnection recommended due to: no packets received: ${e}, missed pongs: ${t}, bad audio delay: ${i}`),0):1}}ReconnectionHealthPolicy$1.default=ReconnectionHealthPolicy;var SendingAudioFailureConnectionHealthPolicy$1={},__importDefault$X=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SendingAudioFailureConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$1=__importDefault$X(BaseConnectionHealthPolicy$1);class SendingAudioFailureConnectionHealthPolicy extends BaseConnectionHealthPolicy_1$1.default{constructor(e,t,i){super(t,i,"Sending Audio Health"),this.logger=e,this.sendingAudioFailureSamplesToConsider=t.sendingAudioFailureSamplesToConsider>0?t.sendingAudioFailureSamplesToConsider:1,this.sendingAudioFailureInitialWaitTimeMs=t.sendingAudioFailureInitialWaitTimeMs,this.maximumTimesToWarn=t.maximumTimesToWarn,this.coolDownTimeMs=t.cooldownTimeMs,this.lastWarnTimestampMs=0,this.warnCount=0}isSendingAudioUnhealthy(){const e=!this.currentData.isConnectionStartRecent(this.sendingAudioFailureInitialWaitTimeMs),t=this.currentData.consecutiveStatsWithNoAudioPacketsSent>=this.sendingAudioFailureSamplesToConsider;return e&&t}health(){if(this.isSendingAudioUnhealthy()){const e=Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs;return this.currentHealth>this.minimumHealth()&&!e?(this.logger.warn(`Sending Audio is unhealthy for ${this.sendingAudioFailureSamplesToConsider} seconds consecutively.`),this.warnCount++,this.warnCount>this.maximumTimesToWarn?(this.logger.warn("SendingAudioFailure health policy maximum warnings breached. Falling back to reporting healthy."),this.maximumHealth()):(this.lastWarnTimestampMs=Date.now(),this.minimumHealth())):this.currentHealth}return this.maximumHealth()}}SendingAudioFailureConnectionHealthPolicy$1.default=SendingAudioFailureConnectionHealthPolicy;var UnusableAudioWarningConnectionHealthPolicy$1={},__importDefault$W=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(UnusableAudioWarningConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1=__importDefault$W(BaseConnectionHealthPolicy$1);class UnusableAudioWarningConnectionHealthPolicy extends BaseConnectionHealthPolicy_1.default{constructor(e,t){super(e,t,"Unusable Audio Warning"),this.coolDownTimeMs=e.cooldownTimeMs,this.pastSamplesToConsider=e.pastSamplesToConsider,this.fractionalLoss=e.fractionalLoss,this.packetsExpected=e.packetsExpected,this.maximumTimesToWarn=e.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;const e=this.pastSamplesToConsider,t=e*this.packetsExpected;let i=0;for(let t=0;t<e;t++)i+=this.currentData.packetsReceivedInLastMinute[t];return Math.min(Math.max(1-i/t,0),1)}health(){if(Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs)return this.currentHealth;return this.calculateFractionalLoss()>=this.fractionalLoss?0!==this.currentHealth&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}}UnusableAudioWarningConnectionHealthPolicy$1.default=UnusableAudioWarningConnectionHealthPolicy;var __awaiter$F=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$V=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MonitorTask$1,"__esModule",{value:!0});const ClientMetricReportDirection_1$1=__importDefault$V(ClientMetricReportDirection),ClientMetricReportMediaType_1$1=__importDefault$V(ClientMetricReportMediaType),ReconnectionHealthPolicy_1=__importDefault$V(ReconnectionHealthPolicy$1),SendingAudioFailureConnectionHealthPolicy_1=__importDefault$V(SendingAudioFailureConnectionHealthPolicy$1),UnusableAudioWarningConnectionHealthPolicy_1=__importDefault$V(UnusableAudioWarningConnectionHealthPolicy$1),MeetingSessionStatus_1$1=__importDefault$V(MeetingSessionStatus$1),MeetingSessionStatusCode_1$3=__importDefault$V(MeetingSessionStatusCode),SignalingClientEventType_1$5=__importDefault$V(SignalingClientEventType),SignalingProtocol_1=SignalingProtocol,AudioLogEvent_1=__importDefault$V(AudioLogEvent),Types_1$4=Types,BaseTask_1$g=__importDefault$V(BaseTask$1);class MonitorTask extends BaseTask_1$g.default{constructor(e,t,i){super(e.logger),this.context=e,this.initialConnectionHealthData=i,this.taskName="MonitorTask",this.prevSignalStrength=1,this.currentAvailableStreamAvgBitrates=null,this.hasSignalingError=!1,this.presenceHandlerCalled=!1,this.isResubscribeCheckPaused=!1,this.pendingMetricsReport=void 0,this.isMeetingConnected=!1,this.checkAndSendWeakSignalEvent=e=>{const t=e<1,i=this.prevSignalStrength<1,n=t?i?null:AudioLogEvent_1.default.RedmicStartLoss:i?AudioLogEvent_1.default.RedmicEndLoss:null;n&&this.context.statsCollector.logAudioEvent(n),this.prevSignalStrength=e},this.realtimeFatalErrorCallback=e=>{this.logger.error(`realtime error: ${e}: ${e.stack}`),this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$3.default.RealtimeApiFailed),e)},this.realtimeAttendeeIdPresenceHandler=(e,t)=>{var i;const n=this.context.meetingSessionConfiguration.credentials.attendeeId;this.logger.info(`attendeePresenceReceived: ${n}`),n===e&&t&&!this.presenceHandlerCalled&&(this.presenceHandlerCalled=!0,this.context.attendeePresenceDurationMs=Date.now()-this.context.startAudioVideoTimestamp,null===(i=this.context.eventController)||void 0===i||i.publishEvent("attendeePresenceReceived",{attendeePresenceDurationMs:this.context.attendeePresenceDurationMs}))},this.generateBaseAudioVideoEventAttributes=()=>{const{signalingOpenDurationMs:e,startTimeMs:t,iceGatheringDurationMs:i,attendeePresenceDurationMs:n,meetingStartDurationMs:r}=this.context;return{meetingDurationMs:null===t?0:Math.round(Date.now()-t),signalingOpenDurationMs:e,iceGatheringDurationMs:i,attendeePresenceDurationMs:n,meetingStartDurationMs:r}},this.generateAudioVideoEventAttributesForReceivingAudioDropped=()=>{const e=this.generateBaseAudioVideoEventAttributes();return Object.assign(Object.assign({},e),{maxVideoTileCount:this.context.maxVideoTileCount,poorConnectionCount:this.context.poorConnectionCount})},this.reconnectionHealthPolicy=new ReconnectionHealthPolicy_1.default(e.logger,Object.assign({},t),this.initialConnectionHealthData.clone()),this.unusableAudioWarningHealthPolicy=new UnusableAudioWarningConnectionHealthPolicy_1.default(Object.assign({},t),this.initialConnectionHealthData.clone()),this.sendingAudioFailureHealthPolicy=new SendingAudioFailureConnectionHealthPolicy_1.default(e.logger,Object.assign({},t),this.initialConnectionHealthData.clone())}removeObserver(){this.context.audioVideoController.removeObserver(this),this.context.realtimeController.realtimeUnsubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.signalingClient.removeObserver(this)}run(){return __awaiter$F(this,void 0,void 0,(function*(){this.context.removableObservers.push(this),this.context.audioVideoController.addObserver(this),this.context.realtimeController.realtimeSubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.connectionMonitor.start(),this.context.statsCollector.start(this.context.signalingClient,this.context.videoStreamIndex),this.context.signalingClient.registerObserver(this)}))}pauseResubscribeCheck(){this.isResubscribeCheckPaused=!0}resumeResubscribeCheck(){this.isResubscribeCheckPaused&&(this.isResubscribeCheckPaused=!1,this.pendingMetricsReport&&(this.context.logger.info("Resuming resubscribe check with pending metrics report"),this.checkResubscribe(this.pendingMetricsReport)&&this.context.audioVideoController.update({needsRenegotiation:!1})))}videoTileDidUpdate(e){this.context.maxVideoTileCount=Math.max(this.context.maxVideoTileCount,this.context.videoTileController.getAllVideoTiles().length)}checkResubscribe(e){if(this.isResubscribeCheckPaused)return this.context.logger.info("Resubscribe check is paused, setting incoming client metric report as pending"),void(this.pendingMetricsReport=e);this.pendingMetricsReport=void 0;const t=e.getObservableMetrics(),i=t.availableOutgoingBitrate,n=t.nackCountReceivedPerSecond;let r=!1;this.context.videoDownlinkBandwidthPolicy.updateMetrics(e);const o=this.context.videoDownlinkBandwidthPolicy.wantsResubscribe();if(r=r||o,o){const e=this.context.videoDownlinkBandwidthPolicy.chooseSubscriptions();this.context.videosToReceive=e.truncate(this.context.videoSubscriptionLimit),e.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.logger.info(`trigger resubscribe for down=${o}; videosToReceive=[${this.context.videosToReceive.array()}]`)}if(this.context.videoTileController.hasStartedLocalVideoTile()){this.context.videoUplinkBandwidthPolicy.updateConnectionMetric({uplinkKbps:i/1e3,nackCountPerSecond:n});const e=this.context.videoUplinkBandwidthPolicy.wantsResubscribe();r=r||e,e&&(this.logger.info(`trigger resubscribe for up=${e}; videosToReceive=[${this.context.videosToReceive.array()}]`),this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters(),this.context.videoUplinkBandwidthPolicy.chooseMediaTrackConstraints())}return r}metricsDidReceive(e){if(this.checkResubscribe(e)&&this.context.audioVideoController.update({needsRenegotiation:!1}),!this.currentAvailableStreamAvgBitrates)return;const t=e.streamMetricReports,i=new Map;for(const e in t)t[e].mediaType===ClientMetricReportMediaType_1$1.default.VIDEO&&t[e].direction===ClientMetricReportDirection_1$1.default.DOWNSTREAM&&i.set(t[e].streamId,t[e])}connectionHealthDidChange(e){0===e.consecutiveMissedPongs&&this.context.reconnectController&&this.context.reconnectController.setLastActiveTimestampMs(Date.now()),this.applyHealthPolicy(this.reconnectionHealthPolicy,e,(()=>{this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$3.default.ConnectionHealthReconnect),null)})),this.applyHealthPolicy(this.unusableAudioWarningHealthPolicy,e,(()=>{var e;this.context.poorConnectionCount+=1;const t=this.generateAudioVideoEventAttributesForReceivingAudioDropped();null===(e=this.context.eventController)||void 0===e||e.publishEvent("receivingAudioDropped",t),this.context.videoTileController.haveVideoTilesWithStreams()?this.context.audioVideoController.forEachObserver((e=>{Types_1$4.Maybe.of(e.connectionDidSuggestStopVideo).map((t=>t.bind(e)()))})):this.context.audioVideoController.forEachObserver((e=>{Types_1$4.Maybe.of(e.connectionDidBecomePoor).map((t=>t.bind(e)()))}))}),(()=>{this.context.audioVideoController.forEachObserver((e=>{Types_1$4.Maybe.of(e.connectionDidBecomeGood).map((t=>t.bind(e)()))}))})),this.isMeetingConnected&&this.applyHealthPolicy(this.sendingAudioFailureHealthPolicy,e,(()=>{var e;const t=this.generateBaseAudioVideoEventAttributes();null===(e=this.context.eventController)||void 0===e||e.publishEvent("sendingAudioFailed",t)}),(()=>{var e;const t=this.generateBaseAudioVideoEventAttributes();null===(e=this.context.eventController)||void 0===e||e.publishEvent("sendingAudioRecovered",t)}))}audioVideoDidStart(){this.isMeetingConnected=!0}audioVideoDidStartConnecting(e){this.isMeetingConnected=!1}audioVideoDidStop(e){this.isMeetingConnected=!1}applyHealthPolicy(e,t,i,n){e.update(t);const r=e.healthIfChanged();null!==r&&(this.logger.info(`${e.name} value is now ${r}`),r<=e.minimumHealth()?Types_1$4.Maybe.of(i).map((e=>e.bind(this)())):Types_1$4.Maybe.of(n).map((e=>e.bind(this)())))}handleBitrateFrame(e){this.currentAvailableStreamAvgBitrates=e,e.serverAvailableOutgoingBitrate>0&&(this.logger.info(`Received server side estimation of available incoming bitrate ${e.serverAvailableOutgoingBitrate}kbps`),this.context.statsCollector.overrideObservableMetric("availableIncomingBitrate",1e3*e.serverAvailableOutgoingBitrate))}handleSignalingClientEvent(e){var t;if(e.type===SignalingClientEventType_1$5.default.WebSocketClosed&&(4410===e.closeCode||e.closeCode>=4500&&e.closeCode<4600)||e.type===SignalingClientEventType_1$5.default.WebSocketError||e.type===SignalingClientEventType_1$5.default.WebSocketFailed){if(!this.hasSignalingError){const e=this.generateAudioVideoEventAttributesForReceivingAudioDropped();null===(t=this.context.eventController)||void 0===t||t.publishEvent("signalingDropped",e),this.hasSignalingError=!0}}else e.type===SignalingClientEventType_1$5.default.WebSocketOpen&&(this.hasSignalingError=!1);if(e.type===SignalingClientEventType_1$5.default.ReceivedSignalFrame){if(e.message.type===SignalingProtocol_1.SdkSignalFrame.Type.NOTIFICATION){switch(e.message.notification.level){case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.INFO:this.logger.info(`Received notification from server: ${e.message.notification.message}`);break;case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.WARNING:this.logger.warn(`Received warning from server: ${e.message.notification.message}`);break;case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.ERROR:this.logger.error(`Received error from server: ${e.message.notification.message}`);break;default:this.logger.error(`Received notification from server with unknown level ${e.message.notification.level}: ${e.message.notification.message}`)}return}if(e.message.bitrates){const t=e.message.bitrates;this.context.videoStreamIndex.integrateBitratesFrame(t),this.context.videoDownlinkBandwidthPolicy.updateIndex(this.context.videoStreamIndex),this.handleBitrateFrame(e.message.bitrates)}const t=MeetingSessionStatus_1$1.default.fromSignalFrame(e.message);e.message.type!==SignalingProtocol_1.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&t.statusCode()!==MeetingSessionStatusCode_1$3.default.OK&&this.context.audioVideoController.handleMeetingSessionStatus(t,null)}}}MonitorTask$1.default=MonitorTask;var OpenSignalingConnectionTask$1={},SignalingClientConnectionRequest$1={};Object.defineProperty(SignalingClientConnectionRequest$1,"__esModule",{value:!0});class SignalingClientConnectionRequest{constructor(e,t){this.signalingURL=e,this.joinToken=t}url(){return this.signalingURL+"?X-Chime-Control-Protocol-Version=3&X-Amzn-Chime-Send-Close-On-Error=1"}protocols(){return["_aws_wt_session",this.joinToken]}}SignalingClientConnectionRequest$1.default=SignalingClientConnectionRequest;var __awaiter$E=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$U=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(OpenSignalingConnectionTask$1,"__esModule",{value:!0});const SignalingClientConnectionRequest_1=__importDefault$U(SignalingClientConnectionRequest$1),SignalingClientEventType_1$4=__importDefault$U(SignalingClientEventType),BaseTask_1$f=__importDefault$U(BaseTask$1);class OpenSignalingConnectionTask extends BaseTask_1$f.default{constructor(e){super(e.logger),this.context=e,this.taskName="OpenSignalingConnectionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$E(this,void 0,void 0,(function*(){const e=this.context.meetingSessionConfiguration;this.context.signalingClient.openConnection(new SignalingClientConnectionRequest_1.default(e.urls.signalingURL,e.credentials.joinToken));const t=Date.now();try{yield new Promise(((e,t)=>{const i=new class{constructor(e){this.signalingClient=e}cancel(){this.signalingClient.removeObserver(this),t(new Error("OpenSignalingConnectionTask got canceled while waiting to open signaling connection"))}handleSignalingClientEvent(i){switch(i.type){case SignalingClientEventType_1$4.default.WebSocketOpen:this.signalingClient.removeObserver(this),e();break;case SignalingClientEventType_1$4.default.WebSocketFailed:this.signalingClient.removeObserver(this),t(new Error("WebSocket connection failed"))}}}(this.context.signalingClient);this.context.signalingClient.registerObserver(i),this.taskCanceler=i}))}catch(e){throw e}finally{this.context.signalingOpenDurationMs=Math.round(Date.now()-t),this.logger.info(`Opening signaling connection took ${this.context.signalingOpenDurationMs} ms`)}}))}}OpenSignalingConnectionTask$1.default=OpenSignalingConnectionTask;var ParallelGroupTask$1={},__awaiter$D=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$T=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ParallelGroupTask$1,"__esModule",{value:!0});const BaseTask_1$e=__importDefault$T(BaseTask$1);class ParallelGroupTask extends BaseTask_1$e.default{constructor(e,t,i){super(e),this.taskName=t,this.tasksToRunParallel=i;for(const e of i)e.setParent(this)}cancel(){for(const e of this.tasksToRunParallel)this.logger.info(`canceling parallel group task ${this.name()} subtask ${e.name()}`),e.cancel()}run(){return __awaiter$D(this,void 0,void 0,(function*(){const e=[];for(const t of this.tasksToRunParallel)this.logger.info(`parallel group task ${this.name()} running subtask ${t.name()}`),e.push(t.run());const t=[];for(let i=0;i<e.length;i++){try{yield e[i]}catch(e){t.push(`task ${this.tasksToRunParallel[i].name()} failed: ${e.message}`)}this.logger.info(`parallel group task ${this.name()} completed subtask ${this.tasksToRunParallel[i].name()}`)}if(t.length>0){const e=t.join(", ");this.logAndThrow(`parallel group task ${this.name()} failed for tasks: ${e}`)}this.logger.info(`parallel group task ${this.name()} completed`)}))}}ParallelGroupTask$1.default=ParallelGroupTask;var PromoteToPrimaryMeetingTask={},hasRequiredPromoteToPrimaryMeetingTask;function requirePromoteToPrimaryMeetingTask(){if(hasRequiredPromoteToPrimaryMeetingTask)return PromoteToPrimaryMeetingTask;hasRequiredPromoteToPrimaryMeetingTask=1;var e=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PromoteToPrimaryMeetingTask,"__esModule",{value:!0});const i=requireBuild(),n=t(SignalingClientEventType),r=SignalingProtocol,o=t(BaseTask$1);let a=class extends o.default{constructor(e,t,i){super(e.logger),this.context=e,this.credentials=t,this.completionCallback=i,this.taskName="PromoteToPrimaryMeetingTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return e(this,void 0,void 0,(function*(){this.context.signalingClient.ready()?(this.context.signalingClient.promoteToPrimaryMeeting(this.credentials),this.context.logger.info("Sent request to join primary meeting"),yield this.receivePrimaryMeetingJoinAck()):this.completionCallback(new i.MeetingSessionStatus(i.MeetingSessionStatusCode.SignalingRequestFailed))}))}receivePrimaryMeetingJoinAck(){return new Promise(((e,t)=>{const o=new class{constructor(e,t,i){this.signalingClient=e,this.completionCallback=t,this.logger=i}cancel(){this.signalingClient.removeObserver(this),this.completionCallback(new i.MeetingSessionStatus(i.MeetingSessionStatusCode.SignalingRequestFailed)),e()}handleSignalingClientEvent(t){t.isConnectionTerminated()&&(this.signalingClient.removeObserver(this),this.logger.info("PromoteToPrimaryMeetingTask connection terminated"),this.completionCallback(new i.MeetingSessionStatus(i.MeetingSessionStatusCode.SignalingRequestFailed)),e()),t.type===n.default.ReceivedSignalFrame&&t.message.type===r.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("Got a primary meeting join ACK"),this.completionCallback(i.MeetingSessionStatus.fromSignalFrame(t.message)),e())}}(this.context.signalingClient,this.completionCallback,this.context.logger);this.taskCanceler=o,this.context.signalingClient.registerObserver(o)}))}};return PromoteToPrimaryMeetingTask.default=a,PromoteToPrimaryMeetingTask}var ReceiveAudioInputTask$1={},__awaiter$C=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$S=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReceiveAudioInputTask$1,"__esModule",{value:!0});const BaseTask_1$d=__importDefault$S(BaseTask$1);class ReceiveAudioInputTask extends BaseTask_1$d.default{constructor(e){super(e.logger),this.context=e,this.taskName="ReceiveAudioInputTask"}run(){var e,t;return __awaiter$C(this,void 0,void 0,(function*(){if(!(null===(t=null===(e=this.context.meetingSessionConfiguration)||void 0===e?void 0:e.urls)||void 0===t?void 0:t.audioHostURL))return void this.context.logger.info("No audio connection: not acquiring audio input");if(this.context.activeAudioInput)return void this.context.logger.info("an active audio input exists");let i;try{i=yield this.context.mediaStreamBroker.acquireAudioInputStream()}catch(e){this.context.logger.warn("could not acquire audio input from current device")}i?this.context.activeAudioInput=i:this.context.logger.warn("an audio input is not available")}))}}ReceiveAudioInputTask$1.default=ReceiveAudioInputTask;var ReceiveRemoteVideoPauseResumeTask={},__awaiter$B=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$R=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReceiveRemoteVideoPauseResumeTask,"__esModule",{value:!0});const SignalingClientEventType_1$3=__importDefault$R(SignalingClientEventType),SignalingProtocol_js_1$7=SignalingProtocol,BaseTask_1$c=__importDefault$R(BaseTask$1);class ReceiveRemoteVideoPauseResume extends BaseTask_1$c.default{constructor(e){super(e.logger),this.context=e,this.taskName="ReceiveRemoteVideoPauseResume",this.serverPausedVideoTileIds=new Set}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return __awaiter$B(this,void 0,void 0,(function*(){this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)}))}handleSignalingClientEvent(e){if(e.type!==SignalingClientEventType_1$3.default.ReceivedSignalFrame||e.message.type!==SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE&&e.message.type!==SignalingProtocol_js_1$7.SdkSignalFrame.Type.RESUME)return;const t=e.message.pause,i=e.message.type;if(this.context.logger.info(`received new ${i===SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE?"pause":"resume"} frame: ${JSON.stringify(t)}`),!t||void 0===this.context.videoTileController.getVideoTileForAttendeeId||void 0===this.context.videoDownlinkBandwidthPolicy.forEachObserver||void 0===this.context.videoStreamIndex.attendeeIdForGroupId)return;const n=t.groupIds.map((e=>{const t=this.context.videoStreamIndex.attendeeIdForGroupId(e);return this.context.videoTileController.getVideoTileForAttendeeId(t)}));for(const e of n)void 0!==e&&(i===SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE?e.state().paused||(this.serverPausedVideoTileIds.add(e.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver((t=>{t.tileWillBePausedByDownlinkPolicy(e.id())})),e.pause()):e.state().paused&&this.serverPausedVideoTileIds.has(e.id())&&(this.serverPausedVideoTileIds.delete(e.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver((t=>{t.tileWillBeUnpausedByDownlinkPolicy(e.id())})),e.unpause()))}}ReceiveRemoteVideoPauseResumeTask.default=ReceiveRemoteVideoPauseResume;var ReceiveTURNCredentialsTask$1={},__awaiter$A=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$Q=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReceiveTURNCredentialsTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$2=__importDefault$Q(MeetingSessionStatusCode),MeetingSessionTURNCredentials_1=__importDefault$Q(MeetingSessionTURNCredentials$1),DefaultModality_1$5=__importDefault$Q(DefaultModality$1),Versioning_1$6=__importDefault$Q(Versioning$1),BaseTask_1$b=__importDefault$Q(BaseTask$1);class ReceiveTURNCredentialsTask extends BaseTask_1$b.default{constructor(e){super(e.logger),this.context=e,this.taskName="ReceiveTURNCredentialsTask",this.url=e.meetingSessionConfiguration.urls.turnControlURL,this.meetingId=e.meetingSessionConfiguration.meetingId,this.joinToken=e.meetingSessionConfiguration.credentials.joinToken}cancel(){if(this.cancelPromise){const e=new Error(`canceling ${this.name()}`);this.cancelPromise(e),delete this.cancelPromise}}run(){return __awaiter$A(this,void 0,void 0,(function*(){if(this.context.turnCredentials)return void this.context.logger.info("TURN credentials available, skipping credentials fetch");if(this.context.logger.error("missing TURN credentials - falling back to fetch"),!this.url)return void this.context.logger.info("TURN control url not supplied, skipping credentials fetch");const e={method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json","X-Chime-Auth-Token":"_aws_wt_session="+new DefaultModality_1$5.default(this.joinToken).base()},redirect:"follow",referrer:"no-referrer",body:JSON.stringify({meetingId:this.meetingId})};this.context.logger.info(`requesting TURN credentials from ${this.url}`);const t=yield new Promise(((t,i)=>__awaiter$A(this,void 0,void 0,(function*(){this.cancelPromise=e=>{i(e)};try{const n=yield fetch(Versioning_1$6.default.urlWithVersion(this.url),e);if(this.context.logger.info("received TURN credentials"),n.status&&403===n.status)return void i(new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$2.default.TURNCredentialsForbidden}`));if(n.status&&404===n.status)return void i(new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$2.default.MeetingEnded}`));t(yield n.json())}catch(e){i(e)}finally{delete this.cancelPromise}}))));this.context.turnCredentials=new MeetingSessionTURNCredentials_1.default,this.context.turnCredentials.password=t.password,this.context.turnCredentials.ttl=t.ttl,this.context.turnCredentials.uris=t.uris.map((e=>this.context.meetingSessionConfiguration.urls.urlRewriter(e))).filter((e=>!!e)),this.context.turnCredentials.username=t.username}))}}ReceiveTURNCredentialsTask$1.default=ReceiveTURNCredentialsTask;var ReceiveVideoInputTask$1={},__awaiter$z=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$P=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReceiveVideoInputTask$1,"__esModule",{value:!0});const DefaultModality_1$4=__importDefault$P(DefaultModality$1),SignalingProtocol_js_1$6=SignalingProtocol,BaseTask_1$a=__importDefault$P(BaseTask$1);class ReceiveVideoInputTask extends BaseTask_1$a.default{constructor(e){super(e.logger),this.context=e,this.taskName="ReceiveVideoInputTask"}checkAndApplyVideoConstraint(e,t,i,n,r){return __awaiter$z(this,void 0,void 0,(function*(){const o=t.getSettings();let a;if(a=e?this.context.meetingSessionConfiguration.meetingFeatures.contentMaxResolution:this.context.meetingSessionConfiguration.meetingFeatures.videoMaxResolution,i>a.videoWidth||n>a.videoHeight||r>a.videoFrameRate){const i={width:{ideal:a.videoWidth},height:{ideal:a.videoHeight},frameRate:{ideal:a.videoFrameRate}};this.context.logger.warn(`Video track (content = ${e}) will be constrained to: ${JSON.stringify(i)} to remain below configured video quality settings, trackSettings: ${JSON.stringify(o)}`);try{yield t.applyConstraints(i)}catch(t){this.context.logger.info(`Could not apply constraint for video track (content = ${e})`)}}}))}run(){return __awaiter$z(this,void 0,void 0,(function*(){const e=this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.RX||this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX;if(this.context.videoTileController.hasStartedLocalVideoTile()?this.context.videoDuplexMode=e?SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX:SignalingProtocol_js_1$6.SdkStreamServiceType.TX:this.context.videoDuplexMode=e?SignalingProtocol_js_1$6.SdkStreamServiceType.RX:0,this.context.videoCaptureAndEncodeParameter=this.context.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters(),!this.context.videoTileController.hasStartedLocalVideoTile())return this.context.logger.info("has not started local video tile"),void(this.context.activeVideoInput&&(this.context.activeVideoInput=void 0,this.context.videoStreamIndex.integrateUplinkPolicyDecision([])));const t=this.context.videoTileController.getLocalVideoTile();let i;try{i=yield this.context.mediaStreamBroker.acquireVideoInputStream()}catch(e){this.context.logger.warn("could not acquire video input from current device"),this.context.videoTileController.stopLocalVideoTile()}if(this.context.enableSimulcast){const e=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();this.context.videoStreamIndex.integrateUplinkPolicyDecision(Array.from(e.values()))}if(this.context.activeVideoInput=i,i){const e=i.getVideoTracks();if(!e||0===e.length)return;const n=this.context.meetingSessionConfiguration.credentials.attendeeId,r=new DefaultModality_1$4.default(n).hasModality(DefaultModality_1$4.default.MODALITY_CONTENT),o=e[0].getSettings();if(this.context.enableSimulcast){const t=this.context.videoUplinkBandwidthPolicy.chooseMediaTrackConstraints();this.context.logger.info(`simulcast: choose constraint ${JSON.stringify(t)}`);try{yield e[0].applyConstraints(t)}catch(e){this.context.logger.info("simulcast: pass video without more constraint")}}else this.checkAndApplyVideoConstraint(r,e[0],o.width,o.height,o.frameRate);const a=this.context.audioVideoController.configuration.credentials.externalUserId;t.bindVideoStream(n,!0,i,o.width,o.height,null,a);for(let t=0;t<e.length;t++){const i=e[t];this.logger.info(`using video device label=${i.label} id=${i.id}`),this.context.videoDeviceInformation.current_camera_name=i.label,this.context.videoDeviceInformation.current_camera_id=i.id}}}))}}ReceiveVideoInputTask$1.default=ReceiveVideoInputTask;var ReceiveVideoStreamIndexTask$1={},__awaiter$y=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$O=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ReceiveVideoStreamIndexTask$1,"__esModule",{value:!0});const MeetingSessionVideoAvailability_1=__importDefault$O(MeetingSessionVideoAvailability$1),DefaultModality_1$3=__importDefault$O(DefaultModality$1),VideoCodecCapability_1$1=__importDefault$O(VideoCodecCapability$1),SignalingClientEventType_1$2=__importDefault$O(SignalingClientEventType),SignalingProtocol_js_1$5=SignalingProtocol,Types_1$3=Types,BaseTask_1$9=__importDefault$O(BaseTask$1);class ReceiveVideoStreamIndexTask extends BaseTask_1$9.default{constructor(e){super(e.logger),this.context=e,this.taskName="ReceiveVideoStreamIndexTask",this.isIngestionPaused=!1,this.pendingIndex=null}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return __awaiter$y(this,void 0,void 0,(function*(){this.handleIndexFrame(this.context.indexFrame),this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)}))}handleSignalingClientEvent(e){if(e.type!==SignalingClientEventType_1$2.default.ReceivedSignalFrame||e.message.type!==SignalingProtocol_js_1$5.SdkSignalFrame.Type.INDEX)return;const t=e.message.index;this.context.logger.info(`received new index ${JSON.stringify(t)}`),this.handleIndexFrame(t)}pauseIngestion(){this.isIngestionPaused=!0}resumeIngestion(){this.isIngestionPaused&&(this.isIngestionPaused=!1,this.pendingIndex&&(this.context.logger.info("Resuming index ingestion with pending index"),this.handleIndexFrame(this.pendingIndex)))}handleIndexFrame(e){if(!e)return;if(this.isIngestionPaused)return this.context.logger.info("Index ingestion is paused, setting most recent index as pending"),void(this.pendingIndex=e);this.pendingIndex=null;const t=this.context.audioVideoController.configuration.credentials.attendeeId;e.sources=e.sources.filter((e=>{const i=new DefaultModality_1$3.default(e.attendeeId);return!(i.base()===t&&i.hasModality(DefaultModality_1$3.default.MODALITY_CONTENT))}));const{videoStreamIndex:i,videoDownlinkBandwidthPolicy:n,videoUplinkBandwidthPolicy:r}=this.context,o=i.allVideoSendingSourcesExcludingSelf(t);i.integrateIndexFrame(e),n.updateIndex(i),r.updateIndex(i),this.resubscribe(n,r),this.updateVideoAvailability(e),this.handleIndexVideosPausedAtSource(),e.supportedReceiveCodecIntersection.length>0&&this.handleSupportedVideoReceiveCodecIntersection(e);const a=i.allVideoSendingSourcesExcludingSelf(t);this.areVideoSourcesEqual(o,a)||this.context.audioVideoController.forEachObserver((e=>{Types_1$3.Maybe.of(e.remoteVideoSourcesDidChange).map((t=>t.bind(e)(a)))}))}areVideoSourcesEqual(e,t){if(e.length!==t.length)return!1;const i=(e,t)=>e.attendee.attendeeId.localeCompare(t.attendee.attendeeId),n=[...e].sort(i),r=[...t].sort(i);for(let e=0;e<n.length;e++)if(n[e].attendee.attendeeId!==r[e].attendee.attendeeId)return!1;return!0}resubscribe(e,t){const i=e.wantsResubscribe(),n=(this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.DUPLEX)&&t.wantsResubscribe(),r=i||n;if(this.logger.info(`should resubscribe: ${r} (downlink: ${i} uplink: ${n})`),!r)return;const o=e.chooseSubscriptions();this.context.videosToReceive=o.truncate(this.context.videoSubscriptionLimit),o.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.context.videoCaptureAndEncodeParameter=t.chooseCaptureAndEncodeParameters(),this.logger.info(`trigger resubscribe for up=${n} down=${i}; videosToReceive=[${this.context.videosToReceive.array()}] captureParams=${JSON.stringify(this.context.videoCaptureAndEncodeParameter)}`),this.context.audioVideoController.update({needsRenegotiation:!1})}updateVideoAvailability(e){if(!this.context.videosToReceive)return void this.logger.error("videosToReceive must be set in the meeting context.");const t=new MeetingSessionVideoAvailability_1.default;t.remoteVideoAvailable=!this.context.videosToReceive.empty(),t.canStartLocalVideo=!e.atCapacity,this.context.lastKnownVideoAvailability&&this.context.lastKnownVideoAvailability.equal(t)||(this.context.lastKnownVideoAvailability=t.clone(),this.context.audioVideoController.forEachObserver((e=>{Types_1$3.Maybe.of(e.videoAvailabilityDidChange).map((i=>i.bind(e)(t.clone())))})))}handleSupportedVideoReceiveCodecIntersection(e){if(void 0===this.context.videoSendCodecPreferences)return;const t=[];let i=!1;for(const n of this.context.videoSendCodecPreferences){let r=!1;for(const i of e.supportedReceiveCodecIntersection)if(n.equals(VideoCodecCapability_1$1.default.fromSignaled(i))){r=!0,t.push(n);break}void 0!==this.context.currentVideoSendCodec&&!r&&n.equals(this.context.currentVideoSendCodec)&&(i=!0)}t.length>0?this.context.meetingSupportedVideoSendCodecPreferences=t:(this.logger.warn("Interesection of meeting receive codec support and send codec preferences has no overlap, falling back to just values provided in `setVideoCodecSendPreferences`"),this.context.meetingSupportedVideoSendCodecPreferences=void 0),this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),i&&this.context.audioVideoController.update({needsRenegotiation:!0})}handleIndexVideosPausedAtSource(){const e=this.context.videoStreamIndex.streamsPausedAtSource();for(const t of this.context.videoTileController.getAllVideoTiles()){const i=t.state();e.contain(i.streamId)?t.markPoorConnection()&&this.logger.info(`marks the tile ${i.tileId} as having a poor connection`):t.unmarkPoorConnection()&&this.logger.info(`unmarks the tile ${i.tileId} as having a poor connection`)}}}ReceiveVideoStreamIndexTask$1.default=ReceiveVideoStreamIndexTask;var SendAndReceiveDataMessagesTask$1={},__awaiter$x=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$N=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SendAndReceiveDataMessagesTask$1,"__esModule",{value:!0});const DataMessage_1=__importDefault$N(DataMessage$1),SignalingClientEventType_1$1=__importDefault$N(SignalingClientEventType),SignalingProtocol_js_1$4=SignalingProtocol,BaseTask_1$8=__importDefault$N(BaseTask$1);class SendAndReceiveDataMessagesTask extends BaseTask_1$8.default{constructor(e){super(e.logger),this.context=e,this.taskName="SendAndReceiveDataMessagesTask",this.sendDataMessageHandler=(e,t,i)=>{if(this.context.signalingClient.ready()){let n;n=t instanceof Uint8Array?t:"string"==typeof t?(new TextEncoder).encode(t):(new TextEncoder).encode(JSON.stringify(t)),this.validateDataMessage(e,n,i);const r=SignalingProtocol_js_1$4.SdkDataMessagePayload.create();r.topic=e,r.lifetimeMs=i,r.data=n;const o=SignalingProtocol_js_1$4.SdkDataMessageFrame.create();o.messages=[r],this.context.signalingClient.sendDataMessage(o)}else this.context.logger.error("Signaling client is not ready")}}run(){return __awaiter$x(this,void 0,void 0,(function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToSendDataMessage(this.sendDataMessageHandler)}))}removeObserver(){this.context.realtimeController.realtimeUnsubscribeFromSendDataMessage(this.sendDataMessageHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(e){if(e.type===SignalingClientEventType_1$1.default.ReceivedSignalFrame&&e.message.type===SignalingProtocol_js_1$4.SdkSignalFrame.Type.DATA_MESSAGE)for(const t of e.message.dataMessage.messages){const e=new DataMessage_1.default(t.ingestTimeNs/1e6,t.topic,t.data,t.senderAttendeeId,t.senderExternalUserId,0===t.ingestTimeNs);this.context.realtimeController.realtimeReceiveDataMessage(e)}}validateDataMessage(e,t,i){if(!SendAndReceiveDataMessagesTask.TOPIC_REGEX.test(e))throw new Error("Invalid topic");if(t.length>SendAndReceiveDataMessagesTask.DATA_SIZE)throw new Error("Data size has to be less than 2048 bytes");if(i&&i<0)throw new Error("The life time of the message has to be non negative")}}SendAndReceiveDataMessagesTask$1.default=SendAndReceiveDataMessagesTask,SendAndReceiveDataMessagesTask.TOPIC_REGEX=new RegExp(/^[a-zA-Z0-9_-]{1,36}$/),SendAndReceiveDataMessagesTask.DATA_SIZE=2048;var SerialGroupTask$1={},__awaiter$w=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$M=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SerialGroupTask$1,"__esModule",{value:!0});const BaseTask_1$7=__importDefault$M(BaseTask$1),TaskStatus_1=__importDefault$M(TaskStatus$1);class SerialGroupTask extends BaseTask_1$7.default{constructor(e,t,i){super(e),this.taskName=t,this.tasksToRunSerially=i,this.currentTask=null;for(const e of i)e.setParent(this)}cancel(){this.currentTask&&(this.logger.info(`canceling serial group task ${this.name()} subtask ${this.currentTask.name()}`),this.currentTask.cancel())}run(){return __awaiter$w(this,void 0,void 0,(function*(){for(const e of this.tasksToRunSerially){this.getStatus()===TaskStatus_1.default.CANCELED&&this.logAndThrow(`serial group task ${this.name()} was canceled`);try{this.logger.info(`serial group task ${this.name()} running subtask ${e.name()}`),this.currentTask=e,yield e.run(),this.logger.info(`serial group task ${this.name()} completed subtask ${e.name()}`)}catch(e){this.logAndThrow(`serial group task ${this.name()} was canceled due to subtask ${this.currentTask.name()} error: ${e.message}`)}finally{this.currentTask=null}}this.logger.info(`serial group task ${this.name()} completed`)}))}}SerialGroupTask$1.default=SerialGroupTask;var SetLocalDescriptionTask$1={},__awaiter$v=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$L=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SetLocalDescriptionTask$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$3=__importDefault$L(DefaultBrowserBehavior$1),DefaultModality_1$2=__importDefault$L(DefaultModality$1),SDP_1$2=__importDefault$L(SDP$1),BaseTask_1$6=__importDefault$L(BaseTask$1);class SetLocalDescriptionTask extends BaseTask_1$6.default{constructor(e){super(e.logger),this.context=e,this.taskName="SetLocalDescriptionTask"}cancel(){if(this.cancelPromise){const e=new Error(`canceling ${this.name()}`);this.cancelPromise(e),delete this.cancelPromise}}run(){return __awaiter$v(this,void 0,void 0,(function*(){const e=this.context.peer;let t=this.context.sdpOfferInit.sdp;this.context.browserBehavior.supportsVideoLayersAllocationRtpHeaderExtension()&&(t=new SDP_1$2.default(t).withVideoLayersAllocationRtpHeaderExtension(this.context.previousSdpOffer).sdp),this.context.browserBehavior.supportsDependencyDescriptorRtpHeaderExtension()&&void 0!==this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension()&&(t=new SDP_1$2.default(t).withDependencyDescriptorRtpHeaderExtension(this.context.previousSdpOffer).sdp),(new DefaultBrowserBehavior_1$3.default).requiresDisablingH264Encoding()&&(t=new SDP_1$2.default(t).removeH264SupportFromSendSection().sdp);const i=this.context.audioVideoController.configuration.credentials.attendeeId;if(new DefaultModality_1$2.default(i).hasModality(DefaultModality_1$2.default.MODALITY_CONTENT)&&this.context.audioVideoController.configuration.enableSVC&&(t=new SDP_1$2.default(t).withStartingVideoSendBitrate(100).sdp),void 0!==this.context.videoSendCodecPreferences&&this.context.videoSendCodecPreferences.length>0&&(t=new SDP_1$2.default(t).withVideoSendCodecPreferences(void 0!==this.context.meetingSupportedVideoSendCodecPreferences?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.audioProfile&&(t=new SDP_1$2.default(t).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(t=new SDP_1$2.default(t).withStereoAudio().sdp),this.context.audioProfile.hasRedundancyEnabled())){const e=new SDP_1$2.default(t).getAudioPayloadTypes();this.context.transceiverController&&this.context.transceiverController.setAudioPayloadTypes&&this.context.transceiverController.setAudioPayloadTypes(e)}this.logger.debug((()=>`local description is >>>${t}<<<`));const n={type:"offer",sdp:t,toJSON:null};yield new Promise(((t,i)=>__awaiter$v(this,void 0,void 0,(function*(){this.cancelPromise=e=>{i(e)};try{yield e.setLocalDescription(n),t()}catch(e){i(e)}finally{delete this.cancelPromise}})))),this.context.logger.info("set local description")}))}}SetLocalDescriptionTask$1.default=SetLocalDescriptionTask;var SetRemoteDescriptionTask$1={},__awaiter$u=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$K=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SetRemoteDescriptionTask$1,"__esModule",{value:!0});const DefaultModality_1$1=__importDefault$K(DefaultModality$1),SDP_1$1=__importDefault$K(SDP$1),VideoCodecCapability_1=__importDefault$K(VideoCodecCapability$1),BaseTask_1$5=__importDefault$K(BaseTask$1);class SetRemoteDescriptionTask extends BaseTask_1$5.default{constructor(e){super(e.logger),this.context=e,this.taskName="SetRemoteDescriptionTask"}cancel(){this.cancelICEPromise&&this.cancelICEPromise()}run(){var e;return __awaiter$u(this,void 0,void 0,(function*(){this.context.peer||this.logAndThrow("session does not have peer connection; bypass set remote description");let t=this.context.sdpAnswer;t=new SDP_1$1.default(t).withoutServerReflexiveCandidates().sdp,this.context.audioProfile&&(t=new SDP_1$1.default(t).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(t=new SDP_1$1.default(t).withStereoAudio().sdp)),void 0!==this.context.videoSendCodecPreferences&&this.context.videoSendCodecPreferences.length>0&&(t=new SDP_1$1.default(t).withVideoSendCodecPreferences(void 0!==this.context.meetingSupportedVideoSendCodecPreferences?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.currentVideoSendCodec=new SDP_1$1.default(t).highestPriorityVideoSendCodec();const i=this.context.activeVideoInput;if(void 0!==i){const t=this.context.audioVideoController.configuration.credentials.attendeeId,n=new DefaultModality_1$1.default(t).hasModality(DefaultModality_1$1.default.MODALITY_CONTENT),r=i.getVideoTracks()[0];n&&((null===(e=this.context.currentVideoSendCodec)||void 0===e?void 0:e.codecName)===VideoCodecCapability_1.default.av1Main().codecName?(r.contentHint="text",this.logger.info(`Setting content hint to text for AV1, attendee: ${t}`)):this.context.audioVideoController.configuration.enableSVC&&(r.contentHint="motion",this.logger.info(`Setting content hint to motion to enable SVC, attendee: ${t}`)))}this.logger.info(`processed remote description is >>>${t}<<<`);const n={type:"answer",sdp:t,toJSON:null};try{yield this.createICEConnectionCompletedPromise(n)}catch(e){throw e}}))}createICEConnectionCompletedPromise(e){return new Promise(((t,i)=>__awaiter$u(this,void 0,void 0,(function*(){const n=()=>{"connected"!==this.context.peer.iceConnectionState&&"completed"!==this.context.peer.iceConnectionState||(this.context.peer.removeEventListener("iceconnectionstatechange",n),t())};this.cancelICEPromise=()=>{this.context.peer&&this.context.peer.removeEventListener("iceconnectionstatechange",n),i(new Error(`${this.name()} got canceled while waiting for the ICE connection state`))},this.context.peer.addEventListener("iceconnectionstatechange",n);try{yield this.context.peer.setRemoteDescription(e),this.logger.info("set remote description, waiting for ICE connection"),n()}catch(e){i(e)}}))))}}SetRemoteDescriptionTask$1.default=SetRemoteDescriptionTask;var SubscribeAndReceiveSubscribeAckTask$1={},ZLIBTextCompressor$1={},pako$1={},deflate$4={},deflate$3={},trees={};const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES$1+2));zero$1(static_ltree);const static_dtree=new Array(2*D_CODES$1);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);function StaticTreeDesc(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}zero$1(base_dist);const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,i)=>{e.bi_valid>Buf_size-i?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=i-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},send_code=(e,t,i)=>{send_bits(e,i[2*t],i[2*t+1])},bi_reverse=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},bi_flush=e=>{16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const i=t.dyn_tree,n=t.max_code,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,d=t.stat_desc.max_length;let l,c,u,h,p,m,f=0;for(h=0;h<=MAX_BITS$1;h++)e.bl_count[h]=0;for(i[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<HEAP_SIZE$1;l++)c=e.heap[l],h=i[2*i[2*c+1]+1]+1,h>d&&(h=d,f++),i[2*c+1]=h,c>n||(e.bl_count[h]++,p=0,c>=s&&(p=a[c-s]),m=i[2*c],e.opt_len+=m*(h+p),o&&(e.static_len+=m*(r[2*c+1]+p)));if(0!==f){do{for(h=d-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[d]--,f-=2}while(f>0);for(h=d;0!==h;h--)for(c=e.bl_count[h];0!==c;)u=e.heap[--l],u>n||(i[2*u+1]!==h&&(e.opt_len+=(h-i[2*u+1])*i[2*u],i[2*u+1]=h),c--)}},gen_codes=(e,t,i)=>{const n=new Array(MAX_BITS$1+1);let r,o,a=0;for(r=1;r<=MAX_BITS$1;r++)a=a+i[r-1]<<1,n[r]=a;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=bi_reverse(n[t]++,t))}},tr_static_init=()=>{let e,t,i,n,r;const o=new Array(MAX_BITS$1+1);for(i=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=i,e=0;e<1<<extra_lbits[n];e++)_length_code[i++]=n;for(_length_code[i-1]=n,r=0,n=0;n<16;n++)for(base_dist[n]=r,e=0;e<1<<extra_dbits[n];e++)_dist_code[r++]=n;for(r>>=7;n<D_CODES$1;n++)for(base_dist[n]=r<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+r++]=n;for(t=0;t<=MAX_BITS$1;t++)o[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,o[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,o[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,o[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,o[8]++;for(gen_codes(static_ltree,L_CODES$1+1,o),e=0;e<D_CODES$1;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,t,i,n)=>{const r=2*t,o=2*i;return e[r]<e[o]||e[r]===e[o]&&n[t]<=n[i]},pqdownheap=(e,t,i)=>{const n=e.heap[i];let r=i<<1;for(;r<=e.heap_len&&(r<e.heap_len&&smaller(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!smaller(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n},compress_block=(e,t,i)=>{let n,r,o,a,s=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+s++],n+=(255&e.pending_buf[e.sym_buf+s++])<<8,r=e.pending_buf[e.sym_buf+s++],0===n?send_code(e,r,t):(o=_length_code[r],send_code(e,o+LITERALS$1+1,t),a=extra_lbits[o],0!==a&&(r-=base_length[o],send_bits(e,r,a)),n--,o=d_code(n),send_code(e,o,i),a=extra_dbits[o],0!==a&&(n-=base_dist[o],send_bits(e,n,a)))}while(s<e.sym_next);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.elems;let a,s,d,l=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,a=0;a<o;a++)0!==i[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):i[2*a+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=l<2?++l:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,r&&(e.static_len-=n[2*d+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)pqdownheap(e,i,a);d=o;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,i,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,i[2*d]=i[2*a]+i[2*s],e.depth[d]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,i[2*a+1]=i[2*s+1]=d,e.heap[1]=d++,pqdownheap(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(i,l,e.bl_count)},scan_tree=(e,t,i)=>{let n,r,o=-1,a=t[1],s=0,d=7,l=4;for(0===a&&(d=138,l=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)r=a,a=t[2*(n+1)+1],++s<d&&r===a||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*REP_3_6]++):s<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,s=0,o=r,0===a?(d=138,l=3):r===a?(d=6,l=3):(d=7,l=4))},send_tree=(e,t,i)=>{let n,r,o=-1,a=t[1],s=0,d=7,l=4;for(0===a&&(d=138,l=3),n=0;n<=i;n++)if(r=a,a=t[2*(n+1)+1],!(++s<d&&r===a)){if(s<l)do{send_code(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(send_code(e,r,e.bl_tree),s--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,s-3,2)):s<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,s-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,s-11,7));s=0,o=r,0===a?(d=138,l=3):r===a?(d=6,l=3):(d=7,l=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,i,n)=>{let r;for(send_bits(e,t-257,5),send_bits(e,i-1,5),send_bits(e,n-4,4),r=0;r<n;r++)send_bits(e,e.bl_tree[2*bl_order[r]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,i-1)},detect_data_type=e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,i,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(e),put_short(e,i),put_short(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,i,n)=>{let r,o,a=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),a=build_bl_tree(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=i+5,i+4<=r&&-1!==t?_tr_stored_block$1(e,t,i,n):e.strategy===Z_FIXED$1||o===r?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally$1=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[i]+LITERALS$1+1)]++,e.dyn_dtree[2*d_code(t)]++),e.sym_next===e.sym_end);trees._tr_init=_tr_init$1,trees._tr_stored_block=_tr_stored_block$1,trees._tr_flush_block=_tr_flush_block$1,trees._tr_tally=_tr_tally$1,trees._tr_align=_tr_align$1;const adler32$2=(e,t,i,n)=>{let r=65535&e|0,o=e>>>16&65535|0,a=0;for(;0!==i;){a=i>2e3?2e3:i,i-=a;do{r=r+t[n++]|0,o=o+r|0}while(--a);r%=65521,o%=65521}return r|o<<16|0};var adler32_1=adler32$2;const makeTable=()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t},crcTable=new Uint32Array(makeTable()),crc32$2=(e,t,i,n)=>{const r=crcTable,o=n+i;e^=-1;for(let i=n;i<o;i++)e=e>>>8^r[255&(e^t[i])];return-1^e};var crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$4={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_tr_init,_tr_stored_block:_tr_stored_block,_tr_flush_block:_tr_flush_block,_tr_tally:_tr_tally,_tr_align:_tr_align}=trees,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH:Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED:Z_FILTERED,Z_HUFFMAN_ONLY:Z_HUFFMAN_ONLY,Z_RLE:Z_RLE,Z_FIXED:Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN:Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$4,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=msg$2[t],t),rank=e=>2*e-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash=e=>{let t,i,n,r=e.w_size;t=e.hash_size,n=t;do{i=e.head[--n],e.head[n]=i>=r?i-r:0}while(--t);t=r,n=t;do{i=e.prev[--n],e.prev[n]=i>=r?i-r:0}while(--t)};let HASH_ZLIB=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},read_buf=(e,t,i,n)=>{let r=e.avail_in;return r>n&&(r=n),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),i),1===e.state.wrap?e.adler=adler32$1(e.adler,t,r,i):2===e.state.wrap&&(e.adler=crc32$1(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)},longest_match=(e,t)=>{let i,n,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match;const d=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,l=e.window,c=e.w_mask,u=e.prev,h=e.strstart+MAX_MATCH;let p=l[o+a-1],m=l[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,l[i+a]===m&&l[i+a-1]===p&&l[i]===l[o]&&l[++i]===l[o+1]){o+=2,i++;do{}while(l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&o<h);if(n=MAX_MATCH-(h-o),o=h-MAX_MATCH,n>a){if(e.match_start=t,a=n,n>=s)break;p=l[o+a-1],m=l[o+a]}}}while((t=u[t&c])>d&&0!=--r);return a<=e.lookahead?a:e.lookahead},fill_window=e=>{const t=e.w_size;let i,n,r;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),n+=t),0===e.strm.avail_in)break;if(i=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=MIN_MATCH)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=HASH(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[r+MIN_MATCH-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)},deflate_stored=(e,t)=>{let i,n,r,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(i=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,n=e.strstart-e.block_start,i>n+e.strm.avail_in&&(i=n+e.strm.avail_in),i>r&&(i=r),i<o&&(0===i&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||i!==n+e.strm.avail_in))break;a=t===Z_FINISH$3&&i===n+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,a),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,flush_pending(e.strm),n&&(n>i&&(n=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,i-=n),i&&(read_buf(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===a);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&0===e.strm.avail_in&&e.strstart===e.block_start?BS_BLOCK_DONE:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(read_buf(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,o=r>e.w_size?e.w_size:r,n=e.strstart-e.block_start,(n>=o||(n||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&0===e.strm.avail_in&&n<=r)&&(i=n>r?r:n,a=t===Z_FINISH$3&&0===e.strm.avail_in&&i===n?1:0,_tr_stored_block(e,e.block_start,i,a),e.block_start+=i,flush_pending(e.strm)),a?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,t)=>{let i,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(0===e.lookahead)break}if(i=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,i)),e.match_length>=MIN_MATCH)if(n=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do{e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let i,n,r;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(0===e.lookahead)break}if(i=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,i),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-MIN_MATCH,n=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let i,n,r,o;const a=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(r=e.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){o=e.strstart+MAX_MATCH;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);e.match_length=MAX_MATCH-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(i=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let i;for(;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,i=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*HEAP_SIZE),this.dyn_dtree=new Uint16Array(2*(2*D_CODES+1)),this.bl_tree=new Uint16Array(2*(2*BL_CODES+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>deflateStateCheck(e)||2!==e.state.wrap?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,i,n,r,o)=>{if(!e)return Z_STREAM_ERROR$2;let a=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>MAX_MEM_LEVEL||i!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||o<0||o>Z_FIXED||8===n&&1!==a)return err(e,Z_STREAM_ERROR$2);8===n&&(n=9);const s=new DeflateState;return e.state=s,s.strm=e,s.status=INIT_STATE,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=i,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{if(deflateStateCheck(e)||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||i.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,0===e.avail_out?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=i.last_flush;if(i.last_flush=t,0!==i.pending){if(flush_pending(e),0===e.avail_out)return i.last_flush=-1,Z_OK$3}else if(0===e.avail_in&&rank(t)<=rank(n)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(i.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR$1);if(i.status===INIT_STATE&&0===i.wrap&&(i.status=BUSY_STATE),i.status===INIT_STATE){let t=Z_DEFLATED$2+(i.w_bits-8<<4)<<8,n=-1;if(n=i.strategy>=Z_HUFFMAN_ONLY||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=n<<6,0!==i.strstart&&(t|=PRESET_DICT),t+=31-t%31,putShortMSB(i,t),0!==i.strstart&&(putShortMSB(i,e.adler>>>16),putShortMSB(i,65535&e.adler)),e.adler=1,i.status=BUSY_STATE,flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3}if(i.status===GZIP_STATE)if(e.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead)put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=EXTRA_STATE;else if(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,OS_CODE),i.status=BUSY_STATE,flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3;if(i.status===EXTRA_STATE){if(i.gzhead.extra){let t=i.pending,n=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+n>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=r,flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3;t=0,n-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending+=n,i.gzhead.hcrc&&i.pending>t&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=NAME_STATE}if(i.status===NAME_STATE){if(i.gzhead.name){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-n,n)),flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3;n=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=COMMENT_STATE}if(i.status===COMMENT_STATE){if(i.gzhead.comment){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-n,n)),flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3;n=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=crc32$1(e.adler,i.pending_buf,i.pending-n,n))}i.status=HCRC_STATE}if(i.status===HCRC_STATE){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(flush_pending(e),0!==i.pending))return i.last_flush=-1,Z_OK$3;put_byte(i,255&e.adler),put_byte(i,e.adler>>8&255),e.adler=0}if(i.status=BUSY_STATE,flush_pending(e),0!==i.pending)return i.last_flush=-1,Z_OK$3}if(0!==e.avail_in||0!==i.lookahead||t!==Z_NO_FLUSH$2&&i.status!==FINISH_STATE){let n=0===i.level?deflate_stored(i,t):i.strategy===Z_HUFFMAN_ONLY?deflate_huff(i,t):i.strategy===Z_RLE?deflate_rle(i,t):configuration_table[i.level].func(i,t);if(n!==BS_FINISH_STARTED&&n!==BS_FINISH_DONE||(i.status=FINISH_STATE),n===BS_NEED_MORE||n===BS_FINISH_STARTED)return 0===e.avail_out&&(i.last_flush=-1),Z_OK$3;if(n===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(i):t!==Z_BLOCK$1&&(_tr_stored_block(i,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(e),0===e.avail_out))return i.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:i.wrap<=0?Z_STREAM_END$3:(2===i.wrap?(put_byte(i,255&e.adler),put_byte(i,e.adler>>8&255),put_byte(i,e.adler>>16&255),put_byte(i,e.adler>>24&255),put_byte(i,255&e.total_in),put_byte(i,e.total_in>>8&255),put_byte(i,e.total_in>>16&255),put_byte(i,e.total_in>>24&255)):(putShortMSB(i,e.adler>>>16),putShortMSB(i,65535&e.adler)),flush_pending(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const t=e.state.status;return e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,t)=>{let i=t.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const n=e.state,r=n.wrap;if(2===r||1===r&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(1===r&&(e.adler=adler32$1(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===r&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let e=n.strstart,t=n.lookahead-(MIN_MATCH-1);do{n.ins_h=HASH(n,n.ins_h,n.window[e+MIN_MATCH-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,n.wrap=r,Z_OK$3};deflate$3.deflateInit=deflateInit,deflate$3.deflateInit2=deflateInit2,deflate$3.deflateReset=deflateReset,deflate$3.deflateResetKeep=deflateResetKeep,deflate$3.deflateSetHeader=deflateSetHeader,deflate$3.deflate=deflate$2,deflate$3.deflateEnd=deflateEnd,deflate$3.deflateSetDictionary=deflateSetDictionary,deflate$3.deflateInfo="pako deflate (from Nodeca project)";var common={};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);common.assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)_has(i,t)&&(e[t]=i[t])}}return e},common.flattenChunks=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,r=e.length;t<r;t++){let r=e[t];i.set(r,n),n+=r.length}return i};var strings$2={};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1,strings$2.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,n,r,o,a=e.length,s=0;for(r=0;r<a;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<a&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),o=0,r=0;o<s;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<a&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i};function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}strings$2.buf2string=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,r;const o=new Array(2*i);for(r=0,n=0;n<i;){let t=e[n++];if(t<128){o[r++]=t;continue}let a=_utf8len[t];if(a>4)o[r++]=65533,n+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&n<i;)t=t<<6|63&e[n++],a--;a>1?o[r++]=65533:t<65536?o[r++]=t:(t-=65536,o[r++]=55296|t>>10&1023,o[r++]=56320|1023&t)}}return buf2binstring(o,r)},strings$2.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+_utf8len[e[i]]>t?i:t};var zstream=ZStream$2;const zlib_deflate=deflate$3,utils$1=common,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH:Z_SYNC_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$4;function Deflate$1(e){this.options=utils$1.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0;let i=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Z_OK$2)throw new Error(msg$1[i]);if(t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?strings$1.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=zlib_deflate.deflateSetDictionary(this.strm,e),i!==Z_OK$2)throw new Error(msg$1[i]);this._dict_set=!0}}function deflate$1(e,t){const i=new Deflate$1(t);if(i.push(e,!0),i.err)throw i.msg||msg$1[i.err];return i.result}function deflateRaw$1(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip$1(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate$1.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize;let r,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Z_FINISH$2:Z_NO_FLUSH$1,"string"==typeof e?i.input=strings$1.string2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(o===Z_SYNC_FLUSH||o===Z_FULL_FLUSH)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=zlib_deflate.deflate(i,o),r===Z_STREAM_END$2)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=zlib_deflate.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$2;if(0!==i.avail_out){if(o>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Deflate$1.prototype.onData=function(e){this.chunks.push(e)},Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=utils$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},deflate$4.Deflate=Deflate$1,deflate$4.deflate=deflate$1,deflate$4.deflateRaw=deflateRaw$1,deflate$4.gzip=gzip$1,deflate$4.constants=constants$4;var inflate$4={},inflate$3={};const BAD$1=16209,TYPE$1=16191;var inffast=function(e,t){let i,n,r,o,a,s,d,l,c,u,h,p,m,f,g,S,v,b,_,y,C,w,E,T;const k=e.state;i=e.next_in,E=e.input,n=i+(e.avail_in-5),r=e.next_out,T=e.output,o=r-(t-e.avail_out),a=r+(e.avail_out-257),s=k.dmax,d=k.wsize,l=k.whave,c=k.wnext,u=k.window,h=k.hold,p=k.bits,m=k.lencode,f=k.distcode,g=(1<<k.lenbits)-1,S=(1<<k.distbits)-1;e:do{p<15&&(h+=E[i++]<<p,p+=8,h+=E[i++]<<p,p+=8),v=m[h&g];t:for(;;){if(b=v>>>24,h>>>=b,p-=b,b=v>>>16&255,0===b)T[r++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=m[(65535&v)+(h&(1<<b)-1)];continue t}if(32&b){k.mode=TYPE$1;break e}e.msg="invalid literal/length code",k.mode=BAD$1;break e}_=65535&v,b&=15,b&&(p<b&&(h+=E[i++]<<p,p+=8),_+=h&(1<<b)-1,h>>>=b,p-=b),p<15&&(h+=E[i++]<<p,p+=8,h+=E[i++]<<p,p+=8),v=f[h&S];i:for(;;){if(b=v>>>24,h>>>=b,p-=b,b=v>>>16&255,!(16&b)){if(0==(64&b)){v=f[(65535&v)+(h&(1<<b)-1)];continue i}e.msg="invalid distance code",k.mode=BAD$1;break e}if(y=65535&v,b&=15,p<b&&(h+=E[i++]<<p,p+=8,p<b&&(h+=E[i++]<<p,p+=8)),y+=h&(1<<b)-1,y>s){e.msg="invalid distance too far back",k.mode=BAD$1;break e}if(h>>>=b,p-=b,b=r-o,y>b){if(b=y-b,b>l&&k.sane){e.msg="invalid distance too far back",k.mode=BAD$1;break e}if(C=0,w=u,0===c){if(C+=d-b,b<_){_-=b;do{T[r++]=u[C++]}while(--b);C=r-y,w=T}}else if(c<b){if(C+=d+c-b,b-=c,b<_){_-=b;do{T[r++]=u[C++]}while(--b);if(C=0,c<_){b=c,_-=b;do{T[r++]=u[C++]}while(--b);C=r-y,w=T}}}else if(C+=c-b,b<_){_-=b;do{T[r++]=u[C++]}while(--b);C=r-y,w=T}for(;_>2;)T[r++]=w[C++],T[r++]=w[C++],T[r++]=w[C++],_-=3;_&&(T[r++]=w[C++],_>1&&(T[r++]=w[C++]))}else{C=r-y;do{T[r++]=T[C++],T[r++]=T[C++],T[r++]=T[C++],_-=3}while(_>2);_&&(T[r++]=T[C++],_>1&&(T[r++]=T[C++]))}break}}break}}while(i<n&&r<a);_=p>>3,i-=_,p-=_<<3,h&=(1<<p)-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<a?a-r+257:257-(r-a),k.hold=h,k.bits=p};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(e,t,i,n,r,o,a,s)=>{const d=s.bits;let l,c,u,h,p,m,f=0,g=0,S=0,v=0,b=0,_=0,y=0,C=0,w=0,E=0,T=null;const k=new Uint16Array(MAXBITS+1),M=new Uint16Array(MAXBITS+1);let R,A,P,I=null;for(f=0;f<=MAXBITS;f++)k[f]=0;for(g=0;g<n;g++)k[t[i+g]]++;for(b=d,v=MAXBITS;v>=1&&0===k[v];v--);if(b>v&&(b=v),0===v)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(S=1;S<v&&0===k[S];S++);for(b<S&&(b=S),C=1,f=1;f<=MAXBITS;f++)if(C<<=1,C-=k[f],C<0)return-1;if(C>0&&(e===CODES$1||1!==v))return-1;for(M[1]=0,f=1;f<MAXBITS;f++)M[f+1]=M[f]+k[f];for(g=0;g<n;g++)0!==t[i+g]&&(a[M[t[i+g]]++]=g);if(e===CODES$1?(T=I=a,m=20):e===LENS$1?(T=lbase,I=lext,m=257):(T=dbase,I=dext,m=0),E=0,g=0,f=S,p=o,_=b,y=0,u=-1,w=1<<b,h=w-1,e===LENS$1&&w>ENOUGH_LENS$1||e===DISTS$1&&w>ENOUGH_DISTS$1)return 1;for(;;){R=f-y,a[g]+1<m?(A=0,P=a[g]):a[g]>=m?(A=I[a[g]-m],P=T[a[g]-m]):(A=96,P=0),l=1<<f-y,c=1<<_,S=c;do{c-=l,r[p+(E>>y)+c]=R<<24|A<<16|P|0}while(0!==c);for(l=1<<f-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,g++,0==--k[f]){if(f===v)break;f=t[i+a[g]]}if(f>b&&(E&h)!==u){for(0===y&&(y=b),p+=S,_=f-y,C=1<<_;_+y<v&&(C-=k[_+y],!(C<=0));)_++,C<<=1;if(w+=1<<_,e===LENS$1&&w>ENOUGH_LENS$1||e===DISTS$1&&w>ENOUGH_DISTS$1)return 1;u=E&h,r[u]=b<<24|_<<16|p-o|0}}return 0!==E&&(r[p+E]=f-y<<24|64<<16|0),s.bits=b,0};var inftrees=inflate_table$1;const adler32=adler32_1,crc32=crc32_1,inflate_fast=inffast,inflate_table=inftrees,CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK:Z_BLOCK,Z_TREES:Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR:Z_BUF_ERROR,Z_DEFLATED:Z_DEFLATED}=constants$4,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let i;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const i=new InflateState;e.state=i,i.strm=e,i.window=null,i.mode=HEAD;const n=inflateReset2(e,t);return n!==Z_OK$1&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inflate_table(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inflate_table(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,i,n)=>{let r;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(i-o.wsize,i),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>n&&(r=n),o.window.set(t.subarray(i-n,i-n+r),o.wnext),(n-=r)?(o.window.set(t.subarray(i-n,i),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},inflate$2=(e,t)=>{let i,n,r,o,a,s,d,l,c,u,h,p,m,f,g,S,v,b,_,y,C,w,E=0;const T=new Uint8Array(4);let k,M;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR$1;i=e.state,i.mode===TYPE&&(i.mode=TYPEDO),a=e.next_out,r=e.output,d=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,l=i.hold,c=i.bits,u=s,h=d,w=Z_OK$1;e:for(;;)switch(i.mode){case HEAD:if(0===i.wrap){i.mode=TYPEDO;break}for(;c<16;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(2&i.wrap&&35615===l){0===i.wbits&&(i.wbits=15),i.check=0,T[0]=255&l,T[1]=l>>>8&255,i.check=crc32(i.check,T,2,0),l=0,c=0,i.mode=FLAGS;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=BAD;break}if((15&l)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD;break}if(l>>>=4,c-=4,C=8+(15&l),0===i.wbits&&(i.wbits=C),C>15||C>i.wbits){e.msg="invalid window size",i.mode=BAD;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&l?DICTID:TYPE,l=0,c=0;break;case FLAGS:for(;c<16;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(i.flags=l,(255&i.flags)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=BAD;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&4&i.wrap&&(T[0]=255&l,T[1]=l>>>8&255,i.check=crc32(i.check,T,2,0)),l=0,c=0,i.mode=TIME;case TIME:for(;c<32;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.head&&(i.head.time=l),512&i.flags&&4&i.wrap&&(T[0]=255&l,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,i.check=crc32(i.check,T,4,0)),l=0,c=0,i.mode=OS;case OS:for(;c<16;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&4&i.wrap&&(T[0]=255&l,T[1]=l>>>8&255,i.check=crc32(i.check,T,2,0)),l=0,c=0,i.mode=EXLEN;case EXLEN:if(1024&i.flags){for(;c<16;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&4&i.wrap&&(T[0]=255&l,T[1]=l>>>8&255,i.check=crc32(i.check,T,2,0)),l=0,c=0}else i.head&&(i.head.extra=null);i.mode=EXTRA;case EXTRA:if(1024&i.flags&&(p=i.length,p>s&&(p=s),p&&(i.head&&(C=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(o,o+p),C)),512&i.flags&&4&i.wrap&&(i.check=crc32(i.check,n,p,o)),s-=p,o+=p,i.length-=p),i.length))break e;i.length=0,i.mode=NAME;case NAME:if(2048&i.flags){if(0===s)break e;p=0;do{C=n[o+p++],i.head&&C&&i.length<65536&&(i.head.name+=String.fromCharCode(C))}while(C&&p<s);if(512&i.flags&&4&i.wrap&&(i.check=crc32(i.check,n,p,o)),s-=p,o+=p,C)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=COMMENT;case COMMENT:if(4096&i.flags){if(0===s)break e;p=0;do{C=n[o+p++],i.head&&C&&i.length<65536&&(i.head.comment+=String.fromCharCode(C))}while(C&&p<s);if(512&i.flags&&4&i.wrap&&(i.check=crc32(i.check,n,p,o)),s-=p,o+=p,C)break e}else i.head&&(i.head.comment=null);i.mode=HCRC;case HCRC:if(512&i.flags){for(;c<16;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(4&i.wrap&&l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=BAD;break}l=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=TYPE;break;case DICTID:for(;c<32;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}e.adler=i.check=zswap32(l),l=0,c=0,i.mode=DICT;case DICT:if(0===i.havedict)return e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=c,Z_NEED_DICT$1;e.adler=i.check=1,i.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(i.last){l>>>=7&c,c-=7&c,i.mode=CHECK;break}for(;c<3;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}switch(i.last=1&l,l>>>=1,c-=1,3&l){case 0:i.mode=STORED;break;case 1:if(fixedtables(i),i.mode=LEN_,t===Z_TREES){l>>>=2,c-=2;break e}break;case 2:i.mode=TABLE;break;case 3:e.msg="invalid block type",i.mode=BAD}l>>>=2,c-=2;break;case STORED:for(l>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=BAD;break}if(i.length=65535&l,l=0,c=0,i.mode=COPY_,t===Z_TREES)break e;case COPY_:i.mode=COPY;case COPY:if(p=i.length,p){if(p>s&&(p=s),p>d&&(p=d),0===p)break e;r.set(n.subarray(o,o+p),a),s-=p,o+=p,d-=p,a+=p,i.length-=p;break}i.mode=TYPE;break;case TABLE:for(;c<14;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(i.nlen=257+(31&l),l>>>=5,c-=5,i.ndist=1+(31&l),l>>>=5,c-=5,i.ncode=4+(15&l),l>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=BAD;break}i.have=0,i.mode=LENLENS;case LENLENS:for(;i.have<i.ncode;){for(;c<3;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.lens[R[i.have++]]=7&l,l>>>=3,c-=3}for(;i.have<19;)i.lens[R[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,k={bits:i.lenbits},w=inflate_table(CODES,i.lens,0,19,i.lencode,0,i.work,k),i.lenbits=k.bits,w){e.msg="invalid code lengths set",i.mode=BAD;break}i.have=0,i.mode=CODELENS;case CODELENS:for(;i.have<i.nlen+i.ndist;){for(;E=i.lencode[l&(1<<i.lenbits)-1],g=E>>>24,S=E>>>16&255,v=65535&E,!(g<=c);){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(v<16)l>>>=g,c-=g,i.lens[i.have++]=v;else{if(16===v){for(M=g+2;c<M;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(l>>>=g,c-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=BAD;break}C=i.lens[i.have-1],p=3+(3&l),l>>>=2,c-=2}else if(17===v){for(M=g+3;c<M;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}l>>>=g,c-=g,C=0,p=3+(7&l),l>>>=3,c-=3}else{for(M=g+7;c<M;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}l>>>=g,c-=g,C=0,p=11+(127&l),l>>>=7,c-=7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=BAD;break}for(;p--;)i.lens[i.have++]=C}}if(i.mode===BAD)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=BAD;break}if(i.lenbits=9,k={bits:i.lenbits},w=inflate_table(LENS,i.lens,0,i.nlen,i.lencode,0,i.work,k),i.lenbits=k.bits,w){e.msg="invalid literal/lengths set",i.mode=BAD;break}if(i.distbits=6,i.distcode=i.distdyn,k={bits:i.distbits},w=inflate_table(DISTS,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,k),i.distbits=k.bits,w){e.msg="invalid distances set",i.mode=BAD;break}if(i.mode=LEN_,t===Z_TREES)break e;case LEN_:i.mode=LEN;case LEN:if(s>=6&&d>=258){e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=c,inflate_fast(e,h),a=e.next_out,r=e.output,d=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,l=i.hold,c=i.bits,i.mode===TYPE&&(i.back=-1);break}for(i.back=0;E=i.lencode[l&(1<<i.lenbits)-1],g=E>>>24,S=E>>>16&255,v=65535&E,!(g<=c);){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(S&&0==(240&S)){for(b=g,_=S,y=v;E=i.lencode[y+((l&(1<<b+_)-1)>>b)],g=E>>>24,S=E>>>16&255,v=65535&E,!(b+g<=c);){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=g,c-=g,i.back+=g,i.length=v,0===S){i.mode=LIT;break}if(32&S){i.back=-1,i.mode=TYPE;break}if(64&S){e.msg="invalid literal/length code",i.mode=BAD;break}i.extra=15&S,i.mode=LENEXT;case LENEXT:if(i.extra){for(M=i.extra;c<M;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=DIST;case DIST:for(;E=i.distcode[l&(1<<i.distbits)-1],g=E>>>24,S=E>>>16&255,v=65535&E,!(g<=c);){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(0==(240&S)){for(b=g,_=S,y=v;E=i.distcode[y+((l&(1<<b+_)-1)>>b)],g=E>>>24,S=E>>>16&255,v=65535&E,!(b+g<=c);){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=g,c-=g,i.back+=g,64&S){e.msg="invalid distance code",i.mode=BAD;break}i.offset=v,i.extra=15&S,i.mode=DISTEXT;case DISTEXT:if(i.extra){for(M=i.extra;c<M;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=BAD;break}i.mode=MATCH;case MATCH:if(0===d)break e;if(p=h-d,i.offset>p){if(p=i.offset-p,p>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=BAD;break}p>i.wnext?(p-=i.wnext,m=i.wsize-p):m=i.wnext-p,p>i.length&&(p=i.length),f=i.window}else f=r,m=a-i.offset,p=i.length;p>d&&(p=d),d-=p,i.length-=p;do{r[a++]=f[m++]}while(--p);0===i.length&&(i.mode=LEN);break;case LIT:if(0===d)break e;r[a++]=i.length,d--,i.mode=LEN;break;case CHECK:if(i.wrap){for(;c<32;){if(0===s)break e;s--,l|=n[o++]<<c,c+=8}if(h-=d,e.total_out+=h,i.total+=h,4&i.wrap&&h&&(e.adler=i.check=i.flags?crc32(i.check,r,h,a-h):adler32(i.check,r,h,a-h)),h=d,4&i.wrap&&(i.flags?l:zswap32(l))!==i.check){e.msg="incorrect data check",i.mode=BAD;break}l=0,c=0}i.mode=LENGTH;case LENGTH:if(i.wrap&&i.flags){for(;c<32;){if(0===s)break e;s--,l+=n[o++]<<c,c+=8}if(4&i.wrap&&l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=BAD;break}l=0,c=0}i.mode=DONE;case DONE:w=Z_STREAM_END$1;break e;case BAD:w=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;default:return Z_STREAM_ERROR$1}return e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=c,(i.wsize||h!==e.avail_out&&i.mode<BAD&&(i.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,i.total+=h,4&i.wrap&&h&&(e.adler=i.check=i.flags?crc32(i.check,r,h,e.next_out-h):adler32(i.check,r,h,e.next_out-h)),e.data_type=i.bits+(i.last?64:0)+(i.mode===TYPE?128:0)+(i.mode===LEN_||i.mode===COPY_?256:0),(0===u&&0===h||t===Z_FINISH$1)&&w===Z_OK$1&&(w=Z_BUF_ERROR),w},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const i=e.state;return 0==(2&i.wrap)?Z_STREAM_ERROR$1:(i.head=t,t.done=!1,Z_OK$1)},inflateSetDictionary=(e,t)=>{const i=t.length;let n,r,o;return inflateStateCheck(e)?Z_STREAM_ERROR$1:(n=e.state,0!==n.wrap&&n.mode!==DICT?Z_STREAM_ERROR$1:n.mode===DICT&&(r=1,r=adler32(r,t,i,0),r!==n.check)?Z_DATA_ERROR$1:(o=updatewindow(e,t,i,i),o?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1)))};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}inflate$3.inflateReset=inflateReset,inflate$3.inflateReset2=inflateReset2,inflate$3.inflateResetKeep=inflateResetKeep,inflate$3.inflateInit=inflateInit,inflate$3.inflateInit2=inflateInit2,inflate$3.inflate=inflate$2,inflate$3.inflateEnd=inflateEnd,inflate$3.inflateGetHeader=inflateGetHeader,inflate$3.inflateSetDictionary=inflateSetDictionary,inflate$3.inflateInfo="pako inflate (from Nodeca project)";var gzheader=GZheader$1;const zlib_inflate=inflate$3,utils=common,strings=strings$2,msg=messages,ZStream=zstream,GZheader=gzheader,toString=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH,Z_FINISH:Z_FINISH,Z_OK:Z_OK,Z_STREAM_END:Z_STREAM_END,Z_NEED_DICT:Z_NEED_DICT,Z_STREAM_ERROR:Z_STREAM_ERROR,Z_DATA_ERROR:Z_DATA_ERROR,Z_MEM_ERROR:Z_MEM_ERROR}=constants$4;function Inflate$1(e){this.options=utils.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;let i=zlib_inflate.inflateInit2(this.strm,t.windowBits);if(i!==Z_OK)throw new Error(msg[i]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=zlib_inflate.inflateSetDictionary(this.strm,t.dictionary),i!==Z_OK)))throw new Error(msg[i])}function inflate$1(e,t){const i=new Inflate$1(t);if(i.push(e),i.err)throw i.msg||msg[i.err];return i.result}function inflateRaw$1(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate$1.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Z_FINISH:Z_NO_FLUSH,"[object ArrayBuffer]"===toString.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),o=zlib_inflate.inflate(i,a),o===Z_NEED_DICT&&r&&(o=zlib_inflate.inflateSetDictionary(i,r),o===Z_OK?o=zlib_inflate.inflate(i,a):o===Z_DATA_ERROR&&(o=Z_NEED_DICT));i.avail_in>0&&o===Z_STREAM_END&&i.state.wrap>0&&0!==e[i.next_in];)zlib_inflate.inflateReset(i),o=zlib_inflate.inflate(i,a);switch(o){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(o),this.ended=!0,!1}if(s=i.avail_out,i.next_out&&(0===i.avail_out||o===Z_STREAM_END))if("string"===this.options.to){let e=strings.utf8border(i.output,i.next_out),t=i.next_out-e,r=strings.buf2string(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(o!==Z_OK||0!==s){if(o===Z_STREAM_END)return o=zlib_inflate.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Inflate$1.prototype.onData=function(e){this.chunks.push(e)},Inflate$1.prototype.onEnd=function(e){e===Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},inflate$4.Inflate=Inflate$1,inflate$4.inflate=inflate$1,inflate$4.inflateRaw=inflateRaw$1,inflate$4.ungzip=inflate$1,inflate$4.constants=constants$4;const{Deflate:Deflate,deflate:deflate,deflateRaw:deflateRaw,gzip:gzip}=deflate$4,{Inflate:Inflate,inflate:inflate,inflateRaw:inflateRaw,ungzip:ungzip}=inflate$4,constants$3=constants$4;pako$1.Deflate=Deflate,pako$1.deflate=deflate,pako$1.deflateRaw=deflateRaw,pako$1.gzip=gzip,pako$1.Inflate=Inflate,pako$1.inflate=inflate,pako$1.inflateRaw=inflateRaw,pako$1.ungzip=ungzip,pako$1.constants=constants$3,Object.defineProperty(ZLIBTextCompressor$1,"__esModule",{value:!0});const pako=pako$1;class ZLIBTextCompressor{constructor(e){this.logger=e}compress(e,t){if(t.length>0){const e=Math.min(t.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);t=t.slice(0,e)}const i={memLevel:ZLIBTextCompressor.Z_MEM_LEVEL,dictionary:t};return pako.deflateRaw(e,i)}decompress(e,t){if(t.length>0){const e=Math.min(t.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);t=t.slice(0,e)}const i={to:"string",dictionary:t,chunkSize:4096};let n="";try{n=pako.inflateRaw(e,i)}catch(e){this.logger.error(`failed to decompress the string with error: [${e}]`)}return n}}ZLIBTextCompressor$1.default=ZLIBTextCompressor,ZLIBTextCompressor.Z_MEM_LEVEL=9,ZLIBTextCompressor.MAX_DICTIONARY_SIZE=31744;var SignalingClientSubscribe$1={};Object.defineProperty(SignalingClientSubscribe$1,"__esModule",{value:!0});class SignalingClientSubscribe{constructor(e,t,i,n,r,o,a,s,d,l){this.attendeeId=e,this.sdpOffer=t,this.audioHost=i,this.audioMuted=n,this.audioCheckin=r,this.receiveStreamIds=o,this.localVideoEnabled=a,this.videoStreamDescriptions=s,this.connectionTypeHasVideo=d,this.compressedSdpOffer=l,this.videoSubscriptionConfiguration=[]}}SignalingClientSubscribe$1.default=SignalingClientSubscribe;var VideoPreferences$1={},__importDefault$J=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoPreferences$1,"__esModule",{value:!0}),VideoPreferences$1.VideoPreferences=VideoPreferences$1.MutableVideoPreferences=VideoPreferences$1.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=void 0;const SignalingClientVideoSubscriptionConfiguration_1=__importDefault$J(SignalingClientVideoSubscriptionConfiguration$1);function convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(e,t,i){if(void 0===e.transceiverController.getMidForGroupId||void 0===e.videoStreamIndex.attendeeIdForGroupId||void 0===i)return[];const n=new Array,r=new Map,o=new Map;for(const i of t){const t=e.transceiverController.getMidForGroupId(i);if(void 0===t)continue;const n=e.videoStreamIndex.attendeeIdForGroupId(i);r.set(n,t),o.set(n,i)}for(const e of i){const t=new SignalingClientVideoSubscriptionConfiguration_1.default,i=r.get(e.attendeeId);void 0!==i&&(t.mid=i,t.attendeeId=e.attendeeId,t.groupId=o.get(e.attendeeId),t.priority=Number.MAX_SAFE_INTEGER-e.priority,t.targetBitrateKbps=e.targetSizeToBitrateKbps(e.targetSize),t.qualityAdaptationPreference=e.degradationPreference,n.push(t))}return n}VideoPreferences$1.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration;class ObjectSet{constructor(e=[]){this.items=e}static default(){return new ObjectSet([])}[Symbol.iterator](){let e=0;const t=this.items;return{next:()=>e<t.length?{done:!1,value:t[e++]}:{done:!0,value:null}}}first(){return this.items[0]}add(e){this.items.push(e)}replaceFirst(e,t){const i=this.items.findIndex(t);-1===i?this.items.push(e):this.has(e)?this.items.splice(i,1):this.items[i]=e}remove(e){this.items=this.items.filter((t=>!t.equals(e)))}clear(){this.items=[]}isEmpty(){return 0===this.items.length}equals(e){if(e===this)return!0;if(e.items.length!==this.items.length)return!1;for(const t of this.items)if(!e.items.some((e=>e.equals(t))))return!1;return!0}has(e){return this.items.some((t=>t.equals(e)))}some(e){return this.items.some(e)}clone(){return new ObjectSet([...this.items])}sort(){this.items.sort(((e,t)=>e.partialCompare(t)))}modify(){return new SetBuilder(this)}}class SetBuilder{constructor(e=new ObjectSet){this.items=e,this.copied=!1}cow(){this.copied||(this.items=this.items.clone(),this.copied=!0)}add(e){this.items.has(e)||(this.cow(),this.items.add(e))}replaceFirst(e,t){this.items.has(e)&&!this.items.some(t)||(this.cow(),this.items.replaceFirst(e,t))}remove(e){this.items.has(e)&&(this.cow(),this.items.remove(e))}some(e){return this.items.some(e)}clear(){this.items.isEmpty()||(this.cow(),this.items.clear())}build(){return this.copied&&this.items.sort(),this.copied=!1,this.items}}class MutableVideoPreferences{constructor(e){this.builder=e}add(e){this.builder.add(e)}replaceFirst(e,t){this.builder.replaceFirst(e,t)}remove(e){this.builder.remove(e)}some(e){return this.builder.some(e)}clear(){this.builder.clear()}build(){return new VideoPreferences(this.builder.build())}}VideoPreferences$1.MutableVideoPreferences=MutableVideoPreferences;class VideoPreferences{constructor(e){this.items=e}static prepare(){return new MutableVideoPreferences(new SetBuilder)}static default(){return new VideoPreferences(ObjectSet.default())}[Symbol.iterator](){return this.items[Symbol.iterator]()}highestPriority(){var e;return null===(e=this.items.first())||void 0===e?void 0:e.priority}sorted(){return this.items[Symbol.iterator]()}equals(e){return e===this||this.items.equals(e.items)}modify(){return new MutableVideoPreferences(this.items.modify())}some(e){return this.items.some(e)}isEmpty(){return this.items.isEmpty()}clone(){const e=VideoPreferences.prepare();for(const t of this.items)e.add(t.clone());return e.build()}}VideoPreferences$1.VideoPreferences=VideoPreferences,VideoPreferences$1.default=VideoPreferences;var __awaiter$t=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$I=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SubscribeAndReceiveSubscribeAckTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1=__importDefault$I(MeetingSessionStatus$1),MeetingSessionStatusCode_1$1=__importDefault$I(MeetingSessionStatusCode),SDP_1=__importDefault$I(SDP$1),ZLIBTextCompressor_1=__importDefault$I(ZLIBTextCompressor$1),ServerSideNetworkAdaption_1$2=ServerSideNetworkAdaption,SignalingClientEventType_1=__importDefault$I(SignalingClientEventType),SignalingClientSubscribe_1=__importDefault$I(SignalingClientSubscribe$1),SignalingProtocol_js_1$3=SignalingProtocol,VideoPreferences_1$2=VideoPreferences$1,BaseTask_1$4=__importDefault$I(BaseTask$1);class SubscribeAndReceiveSubscribeAckTask extends BaseTask_1$4.default{constructor(e){super(e.logger),this.context=e,this.taskName="SubscribeAndReceiveSubscribeAckTask",this.taskCanceler=null,this.textCompressor=new ZLIBTextCompressor_1.default(e.logger)}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$t(this,void 0,void 0,(function*(){let e="";if(this.context.peer&&this.context.peer.localDescription&&(e=new SDP_1.default(this.context.peer.localDescription.sdp).withUnifiedPlanFormat().sdp),!this.context.enableSimulcast){let e=0,t=0;this.context.videoCaptureAndEncodeParameter&&(e=this.context.videoCaptureAndEncodeParameter.captureFrameRate(),t=this.context.videoCaptureAndEncodeParameter.encodeBitrates()[0]);const i={rid:"hi",maxBitrate:1e3*t,maxFramerate:e,active:!0};this.context.videoStreamIndex.integrateUplinkPolicyDecision([i])}this.context.videoStreamIndex.subscribeFrameSent();const t=this.fixUpSubscriptionOrder(e,this.context.videoSubscriptions),i=this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.DUPLEX;let n,r=e;if(void 0!==this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension()||(r=new SDP_1.default(r).withoutDependencyDescriptorRtpHeaderExtension().sdp),this.context.serverSupportsCompression){const t=this.context.previousSdpOffer?this.context.previousSdpOffer.sdp:"";n=this.textCompressor.compress(r,t),this.context.logger.info(`Compressed the SDP message from ${r.length} to ${n.length} bytes.`),e=""}this.context.previousSdpOffer=new SDP_1.default(e);const o=new SignalingClientSubscribe_1.default(this.context.meetingSessionConfiguration.credentials.attendeeId,e,this.context.meetingSessionConfiguration.urls.audioHostURL,this.context.realtimeController.realtimeIsLocalAudioMuted(),!1,t,i,this.context.videoStreamIndex.localStreamDescriptions(),!0,n);void 0===this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption||ServerSideNetworkAdaption_1$2.serverSideNetworkAdaptionIsNoneOrDefault(this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())||void 0===this.context.videoDownlinkBandwidthPolicy.getVideoPreferences||(o.videoSubscriptionConfiguration=VideoPreferences_1$2.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(this.context,t.map((e=>0===e?0:this.context.videoStreamIndex.groupIdForStreamId(e))),this.context.videoDownlinkBandwidthPolicy.getVideoPreferences())),this.context.logger.info(`sending subscribe: ${JSON.stringify(o)}`),this.context.signalingClient.subscribe(o);const a=yield this.receiveSubscribeAck();this.context.logger.info(`got subscribe ack: ${JSON.stringify(a)}`);let s="";a.compressedSdpAnswer&&a.compressedSdpAnswer.length?(s=this.textCompressor.decompress(a.compressedSdpAnswer,this.context.previousSdpAnswerAsString),0===s.length&&(this.context.sdpAnswer="",this.context.previousSdpAnswerAsString="",this.logAndThrow("Error occurred while trying to decompress the SDP answer.")),this.context.logger.info(`Decompressed the SDP message from ${a.compressedSdpAnswer.length} to ${s.length} bytes.`),this.context.sdpAnswer=s):this.context.sdpAnswer=a.sdpAnswer,this.context.previousSdpAnswerAsString=this.context.sdpAnswer,this.context.videoStreamIndex.integrateSubscribeAckFrame(a)}))}fixUpSubscriptionOrder(e,t){if(void 0===this.context.transceiverController.getMidForStreamId)return t;const i=new Map;for(const e of t){const t=this.context.transceiverController.getMidForStreamId(e);void 0!==t?i.set(t,e):0!==e&&this.logger.warn(`Could not find MID for stream ID: ${e}`)}const n=new SDP_1.default(e).mediaSections(),r=[];for(const e of n)if("video"===e.mediaType)if("recvonly"===e.direction){const t=i.get(e.mid);if(void 0===t){this.logger.warn(`Could not find stream ID for MID: ${e.mid}`);continue}r.push(t)}else r.push(0);return this.logger.info(`Fixed up ${JSON.stringify(t)} to ${JSON.stringify(r)} (may be same))}`),r}receiveSubscribeAck(){return new Promise(((e,t)=>{const i=this.context;const n=new class{constructor(e){this.signalingClient=e}cancel(){this.signalingClient.removeObserver(this),t(new Error("SubscribeAndReceiveSubscribeAckTask got canceled while waiting for SdkSubscribeAckFrame"))}handleSignalingClientEvent(t){if(t.isConnectionTerminated()){const e=`SubscribeAndReceiveSubscribeAckTask connection was terminated with code ${t.closeCode} and reason: ${t.closeReason}`;i.logger.warn(e);let n=MeetingSessionStatusCode_1$1.default.TaskFailed;return t.closeCode>=4500&&t.closeCode<4600&&(n=MeetingSessionStatusCode_1$1.default.SignalingInternalServerError),void i.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1.default(n),new Error(e))}if(t.type!==SignalingClientEventType_1.default.ReceivedSignalFrame||t.message.type!==SignalingProtocol_js_1$3.SdkSignalFrame.Type.SUBSCRIBE_ACK)return;this.signalingClient.removeObserver(this);const n=t.message.suback;e(n)}}(this.context.signalingClient);this.context.signalingClient.registerObserver(n),this.taskCanceler=n}))}}SubscribeAndReceiveSubscribeAckTask$1.default=SubscribeAndReceiveSubscribeAckTask;var TimeoutTask$1={},__awaiter$s=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$H=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(TimeoutTask$1,"__esModule",{value:!0});const TimeoutScheduler_1$1=__importDefault$H(TimeoutScheduler$1),BaseTask_1$3=__importDefault$H(BaseTask$1);class TimeoutTask extends BaseTask_1$3.default{constructor(e,t,i){super(e),this.taskToRunBeforeTimeout=t,this.timeoutMs=i,this.taskName=`Timeout${this.timeoutMs}ms`,t.setParent(this)}cancel(){this.logger.info(`canceling timeout task ${this.name()} subtask ${this.taskToRunBeforeTimeout}`),this.taskToRunBeforeTimeout.cancel()}run(){return __awaiter$s(this,void 0,void 0,(function*(){const e=new TimeoutScheduler_1$1.default(this.timeoutMs);e.start((()=>{this.logger.info(`timeout reached for task ${this.name()}`),this.taskToRunBeforeTimeout.cancel()}));try{yield this.taskToRunBeforeTimeout.run()}finally{e.stop()}this.logger.info(`timeout task ${this.name()} completed`)}))}}TimeoutTask$1.default=TimeoutTask;var WaitForAttendeePresenceTask$1={},__awaiter$r=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$G=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(WaitForAttendeePresenceTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1=__importDefault$G(MeetingSessionStatusCode),BaseTask_1$2=__importDefault$G(BaseTask$1);class WaitForAttendeePresenceTask extends BaseTask_1$2.default{constructor(e){super(e.logger),this.context=e,this.taskName="WaitForAttendeePresenceTask"}cancel(){if(this.cancelPromise){const e=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1.default.NoAttendeePresent}`);this.cancelPromise(e),delete this.cancelPromise}}run(){return __awaiter$r(this,void 0,void 0,(function*(){const e=this.context.meetingSessionConfiguration.credentials.attendeeId;return new Promise(((t,i)=>{const n=(i,r,o,a,s)=>{e===i&&r&&(this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(n),t(),delete this.cancelPromise)};this.cancelPromise=e=>{this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(n),i(e)},this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(n)}))}))}}WaitForAttendeePresenceTask$1.default=WaitForAttendeePresenceTask;var DefaultTransceiverController$1={},RedundantAudioEncoder$1={};Object.defineProperty(RedundantAudioEncoder$1,"__esModule",{value:!0});class RedundantAudioEncoder{constructor(){this.maxRedPacketSizeBytes=1024,this.maxAudioPayloadSizeBytes=1e3,this.maxRedTimestampOffset=16384,this.redHeaderSizeBytes=4,this.redLastHeaderSizeBytes=1,this.redPacketizationTime=960,this.redPacketDistance=2,this.maxRedEncodings=2,this.redMaxRecoveryDistance=this.redPacketDistance*this.maxRedEncodings+1,this.maxEncodingHistorySize=10,this.numRedundantEncodings=0,this.redundancyEnabled=!0,this.lossReportInterval=24e4,this.maxOutOfOrderPacketDistance=16,this.OPUS_BAD_ARG=-1,this.OPUS_INVALID_PACKET=-4,this.OPUS_MAX_OPUS_FRAMES=48,this.OPUS_MAX_FRAME_SIZE_BYTES=1275,this.encodingHistory=new Array,this.opusPayloadType=0,this.redPayloadType=0,this.initializePacketLogs()}static initializeWorker(){RedundantAudioEncoder.log("Initializing RedundantAudioEncoder");const e=new RedundantAudioEncoder;self.RTCRtpScriptTransformer&&(self.onrtctransform=t=>{"SenderTransform"===t.transformer.options.type?e.setupSenderTransform(t.transformer.readable,t.transformer.writable):"ReceiverTransform"===t.transformer.options.type?e.setupReceiverTransform(t.transformer.readable,t.transformer.writable):"PassthroughTransform"===t.transformer.options.type&&e.setupPassthroughTransform(t.transformer.readable,t.transformer.writable)}),self.onmessage=t=>{"StartRedWorker"===t.data.msgType?(e.setupSenderTransform(t.data.send.readable,t.data.send.writable),e.setupReceiverTransform(t.data.receive.readable,t.data.receive.writable)):"RedPayloadType"===t.data.msgType?e.setRedPayloadType(t.data.payloadType):"OpusPayloadType"===t.data.msgType?e.setOpusPayloadType(t.data.payloadType):"UpdateNumRedundantEncodings"===t.data.msgType?e.setNumRedundantEncodings(t.data.numRedundantEncodings):"Enable"===t.data.msgType?e.setRedundancyEnabled(!0):"Disable"===t.data.msgType&&e.setRedundancyEnabled(!1)}}static log(e){RedundantAudioEncoder.shouldLog&&self.postMessage({type:"REDWorkerLog",log:`[AudioRed] ${e}`})}static getNumRedundantEncodingsForPacketLoss(e){let t=0,i=!1;return e<=8?t=0:e<=18?t=1:e<=75?t=2:(t=0,i=!0),[t,i]}setupPassthroughTransform(e,t){RedundantAudioEncoder.log("Setting up passthrough transform"),e.pipeTo(t)}setupSenderTransform(e,t){RedundantAudioEncoder.log("Setting up sender RED transform");const i=new TransformStream({transform:this.senderTransform.bind(this)});e.pipeThrough(i).pipeTo(t)}setupReceiverTransform(e,t){RedundantAudioEncoder.log("Setting up receiver RED transform");const i=new TransformStream({transform:this.receivePacketLogTransform.bind(this)});e.pipeThrough(i).pipeTo(t)}setRedPayloadType(e){this.redPayloadType=e,RedundantAudioEncoder.log(`red payload type set to ${this.redPayloadType}`)}setOpusPayloadType(e){this.opusPayloadType=e,RedundantAudioEncoder.log(`opus payload type set to ${this.opusPayloadType}`)}setNumRedundantEncodings(e){this.numRedundantEncodings=e,this.numRedundantEncodings>this.maxRedEncodings&&(this.numRedundantEncodings=this.maxRedEncodings),RedundantAudioEncoder.log(`Updated numRedundantEncodings to ${this.numRedundantEncodings}`)}setRedundancyEnabled(e){this.redundancyEnabled=e,RedundantAudioEncoder.log("redundancy "+(this.redundancyEnabled?"enabled":"disabled"))}enqueueAudioFrameIfPayloadSizeIsValid(e,t){e.data.byteLength>this.maxAudioPayloadSizeBytes||t.enqueue(e)}senderTransform(e,t){if(e.getMetadata().payloadType!==this.redPayloadType)return void this.enqueueAudioFrameIfPayloadSizeIsValid(e,t);const i=this.getPrimaryPayload(e.timestamp,e.data);if(!i)return void this.enqueueAudioFrameIfPayloadSizeIsValid(e,t);const n=this.encode(e.timestamp,i);n?(e.data=n,this.enqueueAudioFrameIfPayloadSizeIsValid(e,t)):this.enqueueAudioFrameIfPayloadSizeIsValid(e,t)}getPrimaryPayload(e,t){const i=this.splitEncodings(e,t);return!i||i.length<1?null:i[i.length-1].payload}splitEncodings(e,t,i=!1,n=undefined){const r=new DataView(t);let o=r.byteLength,a=0,s=0,d=0,l=0,c=!1;const u=new Array,h=new Array,p=new Array;for(;o>0;){if(c=0==(128&r.getUint8(l)),c){if((127&r.getUint8(l))!==this.opusPayloadType)return null;if(a+=this.redLastHeaderSizeBytes,s+=this.redLastHeaderSizeBytes,a>=r.byteLength)return null;d=r.byteLength-a;break}{if(o<this.redHeaderSizeBytes)return null;const t=((3&r.getUint8(l+2))<<8)+r.getUint8(l+3);h.push(t);const i=e-(r.getUint16(l+1)>>2);p.push(i),a+=t+this.redHeaderSizeBytes,s+=this.redHeaderSizeBytes,l+=this.redHeaderSizeBytes,o-=this.redHeaderSizeBytes}}if(!c)return null;let m=s;for(let e=0;e<p.length;e++){const t=new ArrayBuffer(h[e]);new Uint8Array(t).set(new Uint8Array(r.buffer,m,h[e]),0);const n={timestamp:p[e],payload:t,isRedundant:!0};i&&(n.hasFec=this.opusPacketHasFec(new DataView(t),t.byteLength)),u.push(n),m+=h[e]}const f=r.byteLength-d,g=new ArrayBuffer(d);new Uint8Array(g).set(new Uint8Array(r.buffer,f,d),0);const S={timestamp:e,payload:g,isRedundant:!1,seq:n};return i&&(S.hasFec=this.opusPacketHasFec(new DataView(g),g.byteLength)),u.push(S),u}encode(e,t){const i=t.byteLength;if(0===i||i>=this.maxRedPacketSizeBytes||i>=this.maxAudioPayloadSizeBytes)return null;const n=this.numRedundantEncodings;let r=this.redLastHeaderSizeBytes,o=i,a=this.maxAudioPayloadSizeBytes-i-r;const s=new Array,d=new Array;if(this.redundancyEnabled){let t=this.uint32WrapAround(e-this.redPacketizationTime*this.redPacketDistance);for(let i=0;i<n&&!(this.uint32WrapAround(e-t)>=this.maxRedTimestampOffset);i++){let e=t,i=this.encodingHistory.find((t=>t.timestamp===e));if(i||(e=this.uint32WrapAround(t-this.redPacketizationTime),i=this.encodingHistory.find((t=>t.timestamp===e))),i){const e=i.payload.byteLength;if(a<this.redHeaderSizeBytes+e)break;a-=this.redHeaderSizeBytes+e,r+=this.redHeaderSizeBytes,o+=e,s.unshift(i.timestamp),d.unshift(i.payload)}t-=this.redPacketizationTime*this.redPacketDistance,t=this.uint32WrapAround(t)}}const l=new ArrayBuffer(r+o),c=new DataView(l);let u=0;for(let t=0;t<s.length;t++){const i=e-s[t];c.setUint8(u,128|this.opusPayloadType),c.setUint16(u+1,i<<2|d[t].byteLength>>8),c.setUint8(u+3,255&d[t].byteLength),u+=this.redHeaderSizeBytes}c.setUint8(u,this.opusPayloadType),u+=this.redLastHeaderSizeBytes;const h=new Uint8Array(l);for(let e=0;e<d.length;e++)h.set(new Uint8Array(d[e]),u),u+=d[e].byteLength;return h.set(new Uint8Array(t),u),u+=t.byteLength,u!==r+o?null:(this.updateEncodingHistory(e,t),l)}updateEncodingHistory(e,t){for(const t of this.encodingHistory){const i=this.redPacketizationTime*this.redMaxRecoveryDistance;if(!(e-t.timestamp>=i))break;this.encodingHistory.shift()}const i=new DataView(t);(this.opusPacketIsCeltOnly(i)||this.opusPacketHasVoiceActivity(i,i.byteLength)>0)&&(this.encodingHistory.length+1>this.maxEncodingHistorySize&&(this.encodingHistory.length=0),this.encodingHistory.push({timestamp:e,payload:t}))}initializePacketLogs(){const e=this.maxOutOfOrderPacketDistance+this.redMaxRecoveryDistance;this.primaryPacketLog={window:new Array(e),index:0,windowSize:e},this.redRecoveryLog={window:new Array(e),index:0,windowSize:e},this.fecRecoveryLog={window:new Array(e),index:0,windowSize:e},this.totalAudioPacketsExpected=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}receivePacketLogTransform(e,t){const i=e.getMetadata();if(i.payloadType!==this.redPayloadType)return void this.enqueueAudioFrameIfPayloadSizeIsValid(e,t);const n=this.splitEncodings(e.timestamp,e.data,!0,i.sequenceNumber);if(n){for(let e=n.length-1;e>=0;e--)this.updateLossStats(n[e])&&(this.updateRedStats(n[e]),this.updateFecStats(n[e]));this.maybeReportLossStats(n[n.length-1].timestamp,i.synchronizationSource),this.enqueueAudioFrameIfPayloadSizeIsValid(e,t)}else this.enqueueAudioFrameIfPayloadSizeIsValid(e,t)}updateLossStats(e){if(e.isRedundant)return!0;const t=e.timestamp,i=e.seq;if(0===this.totalAudioPacketsExpected)return this.totalAudioPacketsExpected=1,this.newestSequenceNumber=i,this.addTimestamp(this.primaryPacketLog,t),!0;const n=this.int16(i-this.newestSequenceNumber);return!(n<-this.maxOutOfOrderPacketDistance)&&(n<0?this.hasTimestamp(this.primaryPacketLog,t)||(this.totalAudioPacketsLost>0&&this.totalAudioPacketsLost--,this.addTimestamp(this.primaryPacketLog,t),this.removeFromRecoveryWindows(t)):n>1&&(this.totalAudioPacketsLost+=n-1),n>0&&(this.totalAudioPacketsExpected+=n,this.newestSequenceNumber=e.seq,this.addTimestamp(this.primaryPacketLog,t)),!0)}updateRedStats(e){if(!e.isRedundant||0===this.totalAudioPacketsLost)return;const t=e.timestamp;this.hasTimestamp(this.primaryPacketLog,t)||(this.hasTimestamp(this.redRecoveryLog,t)||(this.totalAudioPacketsRecoveredRed++,this.addTimestamp(this.redRecoveryLog,t)),this.removeTimestamp(this.fecRecoveryLog,t)&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--)}updateFecStats(e){if(!e.hasFec||0===this.totalAudioPacketsLost)return;const t=e.timestamp-this.redPacketizationTime;this.hasTimestamp(this.primaryPacketLog,t)||this.hasTimestamp(this.redRecoveryLog,t)||this.hasTimestamp(this.fecRecoveryLog,t)||(this.totalAudioPacketsRecoveredFec++,this.addTimestamp(this.fecRecoveryLog,t))}maybeReportLossStats(e,t){e-this.lastLossReportTimestamp<this.lossReportInterval||(RedundantAudioEncoder.shouldReportStats&&self.postMessage({type:"RedundantAudioEncoderStats",ssrc:t,totalAudioPacketsLost:this.totalAudioPacketsLost,totalAudioPacketsExpected:this.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.totalAudioPacketsRecoveredFec}),this.lastLossReportTimestamp=e)}addTimestamp(e,t){e.window[e.index]=t,e.index=(e.index+1)%e.windowSize}hasTimestamp(e,t){const i=e.window.find((e=>e===t));return!!i}removeTimestamp(e,t){const i=e.window.indexOf(t);return i>=0&&(e.window[i]=void 0,!0)}removeFromRecoveryWindows(e){let t=this.removeTimestamp(this.redRecoveryLog,e);t&&this.totalAudioPacketsRecoveredRed>0&&this.totalAudioPacketsRecoveredRed--,t=this.removeTimestamp(this.fecRecoveryLog,e),t&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--}uint32WrapAround(e){const t=4294967296;let i=e;return e>=t?i=e-t:e<0&&(i=t+e),i}int16(e){return e<<16>>16}opusPacketIsCeltOnly(e){return!!(128&e.getUint8(0))}opusPacketGetSamplesPerFrame(e,t){let i,n;return t=Math.round(t),t=Math.min(Math.max(t,-Math.pow(2,32)),Math.pow(2,32)-1),this.opusPacketIsCeltOnly(e)?(n=e.getUint8(0)>>3&3,i=(t<<n)/400):96==(96&e.getUint8(0))?i=8&e.getUint8(0)?t/50:t/100:(n=e.getUint8(0)>>3&3,i=3===n?60*t/1e3:(t<<n)/100),i}opusNumSilkFrames(e){let t=this.opusPacketGetSamplesPerFrame(e,48e3)/48;switch(t<10&&(t=10),t){case 10:case 20:return 1;case 40:return 2;case 60:return 3;default:return 0}}opusPacketGetNumChannels(e){return 4&e.getUint8(0)?2:1}opusParseSize(e,t,i,n){return i<1?(n[0]=-1,-1):e.getUint8(t)<252?(n[0]=e.getUint8(t),1):i<2?(n[0]=-1,-1):(n[0]=4*e.getUint8(t+1)+e.getUint8(t),2)}opusPacketParseImpl(e,t,i,n,r,o,a,s){if(!o||t<0)return this.OPUS_BAD_ARG;if(0===t)return this.OPUS_INVALID_PACKET;let d,l,c=0,u=!1;const h=e.getUint8(0);n&&(n[0]=h);let p=t-1,m=1,f=p;switch(3&h){case 0:d=1;break;case 1:if(d=2,u=!0,!i){if(1&p)return this.OPUS_INVALID_PACKET;f=p/2,o[0][0]=f}break;case 2:if(d=2,l=this.opusParseSize(e,m,p,o[0]),p-=l,o[0][0]<0||o[0][0]>p)return this.OPUS_INVALID_PACKET;m+=l,f=p-o[0][0];break;default:if(p<1)return this.OPUS_INVALID_PACKET;const t=e.getUint8(m++);if(--p,d=63&t,d<=0)return this.OPUS_INVALID_PACKET;if(this.opusPacketGetSamplesPerFrame(e,48e3)*d>5760)return this.OPUS_INVALID_PACKET;if(64&t){let t,i;do{if(p<=0)return this.OPUS_INVALID_PACKET;t=e.getUint8(m++),--p,i=255===t?254:t,p-=i,c+=i}while(255===t)}if(p<0)return this.OPUS_INVALID_PACKET;if(u=!(128&t),u){if(!i){if(f=Math.trunc(p/d),f*d!==p)return this.OPUS_INVALID_PACKET;for(let e=0;e<d-1;++e)o[e][0]=f}}else{f=p;for(let t=0;t<d-1;++t){if(l=this.opusParseSize(e,m,p,o[t]),p-=l,o[t][0]<0||o[t][0]>p)return this.OPUS_INVALID_PACKET;m+=l,f-=l+o[t][0]}if(f<0)return this.OPUS_INVALID_PACKET}}if(i){if(l=this.opusParseSize(e,m,p,o[d-1]),p-=l,o[d-1][0]<0||o[d-1][0]>p)return this.OPUS_INVALID_PACKET;if(m+=l,u){if(o[d-1][0]*d>p)return this.OPUS_INVALID_PACKET;for(let e=0;e<d-1;++e)o[e][0]=o[d-1][0]}else if(!(l+o[d-1][0]<=f))return this.OPUS_INVALID_PACKET}else{if(f>this.OPUS_MAX_FRAME_SIZE_BYTES)return this.OPUS_INVALID_PACKET;o[d-1][0]=f}a&&(a[0]=m);for(let e=0;e<d;++e)r&&(r[e][0]=m),m+=o[e][0];return s&&(s[0]=m+c),d}opusPacketParse(e,t,i,n,r,o){return this.opusPacketParseImpl(e,t,!1,i,n,r,o,null)}opusPacketHasVoiceActivity(e,t){if(!e||t<=0)return 0;if(this.opusPacketIsCeltOnly(e))return-1;const i=this.opusNumSilkFrames(e);if(0===i)return-1;const n=new Array(this.OPUS_MAX_OPUS_FRAMES),r=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let e=0;e<this.OPUS_MAX_OPUS_FRAMES;++e)n[e]=[void 0],r[e]=[void 0];const o=this.opusPacketParse(e,t,null,n,r,null);if(o<0)return-1;for(let t=0;t<o;++t){if(r[t][0]<1)continue;if(e.getUint8(n[t][0])>>8-i)return 1;if(2===this.opusPacketGetNumChannels(e)&&e.getUint8(n[t][0])<<i+1>>8-i)return 1}return 0}opusPacketHasFec(e,t){if(!e||t<=0)return!1;if(this.opusPacketIsCeltOnly(e))return!1;const i=new Array(this.OPUS_MAX_OPUS_FRAMES),n=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let e=0;e<this.OPUS_MAX_OPUS_FRAMES;++e)i[e]=[void 0],n[e]=[void 0];if(this.opusPacketParse(e,t,null,i,n,null)<0)return!1;if(n[0][0]<=1)return!1;const r=this.opusNumSilkFrames(e);if(0===r)return!1;const o=this.opusPacketGetNumChannels(e);if(1!==o&&2!==o)return!1;for(let t=0;t<o;t++)if(e.getUint8(i[0][0])&128>>(t+1)*(r+1)-1)return!0;return!1}}RedundantAudioEncoder$1.default=RedundantAudioEncoder,RedundantAudioEncoder.shouldLog=!1,RedundantAudioEncoder.shouldReportStats=!1;var RedundantAudioEncoderWorkerCode$1={};Object.defineProperty(RedundantAudioEncoderWorkerCode$1,"__esModule",{value:!0});const RedundantAudioEncoderWorkerCode="class RedundantAudioEncoder {\n    constructor() {\n        // Each payload must be less than 1024 bytes to fit the 10 bit block length\n        this.maxRedPacketSizeBytes = 1 << 10;\n        // Limit payload to 1000 bytes to handle small MTU. 1000 is chosen because in Chromium-based browsers, writing audio\n        // payloads larger than 1000 bytes using the WebRTC Insertable Streams API (which is used to enable dynamic audio\n        // redundancy) will cause an error to be thrown and cause audio flow to permanently stop. See\n        // https://crbug.com/1248479.\n        this.maxAudioPayloadSizeBytes = 1000;\n        // Each payload can encode a timestamp delta of 14 bits\n        this.maxRedTimestampOffset = 1 << 14;\n        // 4 byte RED header\n        this.redHeaderSizeBytes = 4;\n        // reduced size for last RED header\n        this.redLastHeaderSizeBytes = 1;\n        // P-Time for Opus 20 msec packets\n        // We do not support other p-times or clock rates\n        this.redPacketizationTime = 960;\n        // distance between redundant payloads, Opus FEC handles a distance of 1\n        // TODO(https://issues.amazon.com/issues/ChimeSDKAudio-55):\n        // Consider making this dynamic\n        this.redPacketDistance = 2;\n        // maximum number of redundant payloads per RTP packet\n        this.maxRedEncodings = 2;\n        // Maximum number of encodings that can be recovered with a single RED packet, assuming the primary and redundant\n        // payloads have FEC.\n        this.redMaxRecoveryDistance = this.redPacketDistance * this.maxRedEncodings + 1;\n        // maximum history of prior payloads to keep\n        // generally we will expire old entries based on timestamp\n        // this limit is in place just to make sure the history does not\n        // grow too large in the case of erroneous timestamp inputs\n        this.maxEncodingHistorySize = 10;\n        // Current number of encodings we want to send\n        // to the remote end. This will be dynamically\n        // updated through the setNumEncodingsFromPacketloss API\n        this.numRedundantEncodings = 0;\n        // Used to enable or disable redundancy\n        // in response to very high packet loss events\n        this.redundancyEnabled = true;\n        // Loss stats are reported to the main thread every 5 seconds.\n        // Since timestamp differences between 2 consecutive packets\n        // give us the number of samples in each channel, 1 second\n        // is equivalent to 48000 samples:\n        // P-time * (1000ms/1s)\n        // = (960 samples/20ms) * (1000ms/1s)\n        // = 48000 samples/s\n        this.lossReportInterval = 48000 * 5;\n        // Maximum distance of a packet from the most recent packet timestamp\n        // that we will consider for recovery.\n        this.maxOutOfOrderPacketDistance = 16;\n        /**\n         * Below are Opus helper methods and constants.\n         */\n        this.OPUS_BAD_ARG = -1;\n        this.OPUS_INVALID_PACKET = -4;\n        // Max number of Opus frames in an Opus packet is 48 (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5).\n        this.OPUS_MAX_OPUS_FRAMES = 48;\n        // Max number of bytes that any individual Opus frame can have.\n        this.OPUS_MAX_FRAME_SIZE_BYTES = 1275;\n        this.encodingHistory = new Array();\n        this.opusPayloadType = 0;\n        this.redPayloadType = 0;\n        this.initializePacketLogs();\n    }\n    /**\n     * Creates an instance of RedundantAudioEncoder and sets up callbacks.\n     */\n    static initializeWorker() {\n        RedundantAudioEncoder.log('Initializing RedundantAudioEncoder');\n        const encoder = new RedundantAudioEncoder();\n        // RED encoding is done using WebRTC Encoded Transform\n        // https://github.com/w3c/webrtc-encoded-transform/blob/main/explainer.md\n        // Check the DedicatedWorkerGlobalScope for existence of\n        // RTCRtpScriptTransformer interface. If exists, then\n        // RTCRtpScriptTransform is supported by this browser.\n        // @ts-ignore\n        if (self.RTCRtpScriptTransformer) {\n            // @ts-ignore\n            self.onrtctransform = (event) => {\n                if (event.transformer.options.type === 'SenderTransform') {\n                    encoder.setupSenderTransform(event.transformer.readable, event.transformer.writable);\n                }\n                else if (event.transformer.options.type === 'ReceiverTransform') {\n                    encoder.setupReceiverTransform(event.transformer.readable, event.transformer.writable);\n                }\n                else if (event.transformer.options.type === 'PassthroughTransform') {\n                    encoder.setupPassthroughTransform(event.transformer.readable, event.transformer.writable);\n                }\n            };\n        }\n        self.onmessage = (event) => {\n            if (event.data.msgType === 'StartRedWorker') {\n                encoder.setupSenderTransform(event.data.send.readable, event.data.send.writable);\n                encoder.setupReceiverTransform(event.data.receive.readable, event.data.receive.writable);\n            }\n            else if (event.data.msgType === 'RedPayloadType') {\n                encoder.setRedPayloadType(event.data.payloadType);\n            }\n            else if (event.data.msgType === 'OpusPayloadType') {\n                encoder.setOpusPayloadType(event.data.payloadType);\n            }\n            else if (event.data.msgType === 'UpdateNumRedundantEncodings') {\n                encoder.setNumRedundantEncodings(event.data.numRedundantEncodings);\n            }\n            else if (event.data.msgType === 'Enable') {\n                encoder.setRedundancyEnabled(true);\n            }\n            else if (event.data.msgType === 'Disable') {\n                encoder.setRedundancyEnabled(false);\n            }\n        };\n    }\n    /**\n     * Post logs to the main thread\n     */\n    static log(msg) {\n        if (RedundantAudioEncoder.shouldLog) {\n            // @ts-ignore\n            self.postMessage({\n                type: 'REDWorkerLog',\n                log: `[AudioRed] ${msg}`,\n            });\n        }\n    }\n    /**\n     * Returns the number of encodings based on packetLoss value. This is used by `DefaultTransceiverController` to\n     * determine when to alert the encoder to update the number of encodings. It also determines if we need to\n     * turn off red in cases of very high packet loss to avoid congestion collapse.\n     */\n    static getNumRedundantEncodingsForPacketLoss(packetLoss) {\n        let recommendedRedundantEncodings = 0;\n        let shouldTurnOffRed = false;\n        if (packetLoss <= 8) {\n            recommendedRedundantEncodings = 0;\n        }\n        else if (packetLoss <= 18) {\n            recommendedRedundantEncodings = 1;\n        }\n        else if (packetLoss <= 75) {\n            recommendedRedundantEncodings = 2;\n        }\n        else {\n            recommendedRedundantEncodings = 0;\n            shouldTurnOffRed = true;\n        }\n        return [recommendedRedundantEncodings, shouldTurnOffRed];\n    }\n    /**\n     * Sets up a passthrough (no-op) transform for the given streams.\n     */\n    setupPassthroughTransform(readable, writable) {\n        RedundantAudioEncoder.log('Setting up passthrough transform');\n        readable.pipeTo(writable);\n    }\n    /**\n     * Sets up the transform stream and pipes the outgoing encoded audio frames through the transform function.\n     */\n    setupSenderTransform(readable, writable) {\n        RedundantAudioEncoder.log('Setting up sender RED transform');\n        const transformStream = new TransformStream({\n            transform: this.senderTransform.bind(this),\n        });\n        readable.pipeThrough(transformStream).pipeTo(writable);\n        return;\n    }\n    /**\n     * Sets up the transform stream and pipes the received encoded audio frames through the transform function.\n     */\n    setupReceiverTransform(readable, writable) {\n        RedundantAudioEncoder.log('Setting up receiver RED transform');\n        const transformStream = new TransformStream({\n            transform: this.receivePacketLogTransform.bind(this),\n        });\n        readable.pipeThrough(transformStream).pipeTo(writable);\n        return;\n    }\n    /**\n     * Set the RED payload type ideally obtained from local offer.\n     */\n    setRedPayloadType(payloadType) {\n        this.redPayloadType = payloadType;\n        RedundantAudioEncoder.log(`red payload type set to ${this.redPayloadType}`);\n    }\n    /**\n     * Set the opus payload type ideally obtained from local offer.\n     */\n    setOpusPayloadType(payloadType) {\n        this.opusPayloadType = payloadType;\n        RedundantAudioEncoder.log(`opus payload type set to ${this.opusPayloadType}`);\n    }\n    /**\n     * Set the number of redundant encodings\n     */\n    setNumRedundantEncodings(numRedundantEncodings) {\n        this.numRedundantEncodings = numRedundantEncodings;\n        if (this.numRedundantEncodings > this.maxRedEncodings) {\n            this.numRedundantEncodings = this.maxRedEncodings;\n        }\n        RedundantAudioEncoder.log(`Updated numRedundantEncodings to ${this.numRedundantEncodings}`);\n    }\n    /**\n     * Enable or disable redundancy in response to\n     * high packet loss event.\n     */\n    setRedundancyEnabled(enabled) {\n        this.redundancyEnabled = enabled;\n        RedundantAudioEncoder.log(`redundancy ${this.redundancyEnabled ? 'enabled' : 'disabled'}`);\n    }\n    /**\n     * Helper function to only enqueue audio frames if they do not exceed the audio payload byte limit imposed by\n     * Chromium-based browsers. Chromium will throw an error (https://crbug.com/1248479) if an audio payload larger than\n     * 1000 bytes is enqueued. Any controller that attempts to enqueue an audio payload larger than 1000 bytes will\n     * encounter this error and will permanently stop sending or receiving audio.\n     */\n    enqueueAudioFrameIfPayloadSizeIsValid(\n    // @ts-ignore\n    frame, controller) {\n        if (frame.data.byteLength > this.maxAudioPayloadSizeBytes)\n            return;\n        controller.enqueue(frame);\n    }\n    /**\n     * Receives encoded frames and modifies as needed before sending to transport.\n     */\n    senderTransform(\n    // @ts-ignore\n    frame, controller) {\n        const frameMetadata = frame.getMetadata();\n        // @ts-ignore\n        if (frameMetadata.payloadType !== this.redPayloadType) {\n            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n            return;\n        }\n        const primaryPayloadBuffer = this.getPrimaryPayload(frame.timestamp, frame.data);\n        if (!primaryPayloadBuffer) {\n            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n            return;\n        }\n        const encodedBuffer = this.encode(frame.timestamp, primaryPayloadBuffer);\n        /* istanbul ignore next */\n        if (!encodedBuffer) {\n            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n            return;\n        }\n        frame.data = encodedBuffer;\n        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n        return;\n    }\n    /**\n     * Get the primary payload from encoding\n     */\n    getPrimaryPayload(primaryTimestamp, frame) {\n        const encodings = this.splitEncodings(primaryTimestamp, frame);\n        if (!encodings || encodings.length < 1)\n            return null;\n        return encodings[encodings.length - 1].payload;\n    }\n    /**\n     * Split up the encoding received into primary and redundant encodings\n     * These will be ordered oldest to newest which is the same ordering\n     * in the RTP red payload.\n     */\n    splitEncodings(primaryTimestamp, frame, getFecInfo = false, primarySequenceNumber = undefined) {\n        // process RED headers (according to RFC 2198)\n        //   0                   1                   2                   3\n        //   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n        //  |F|   block PT  |  timestamp offset         |   block length    |\n        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n        //\n        // last header\n        //   0 1 2 3 4 5 6 7\n        //  +-+-+-+-+-+-+-+-+\n        //  |0|   Block PT  |\n        //  +-+-+-+-+-+-+-+-+\n        const payload = new DataView(frame);\n        let payloadSizeBytes = payload.byteLength;\n        let totalPayloadSizeBytes = 0;\n        let totalHeaderSizeBytes = 0;\n        let primaryPayloadSizeBytes = 0;\n        let payloadOffset = 0;\n        let gotLastBlock = false;\n        const encodings = new Array();\n        const redundantEncodingBlockLengths = new Array();\n        const redundantEncodingTimestamps = new Array();\n        while (payloadSizeBytes > 0) {\n            gotLastBlock = (payload.getUint8(payloadOffset) & 0x80) === 0;\n            if (gotLastBlock) {\n                // Bits 1 through 7 are payload type\n                const payloadType = payload.getUint8(payloadOffset) & 0x7f;\n                // Unexpected payload type. This is a bad packet.\n                if (payloadType !== this.opusPayloadType) {\n                    return null;\n                }\n                totalPayloadSizeBytes += this.redLastHeaderSizeBytes;\n                totalHeaderSizeBytes += this.redLastHeaderSizeBytes;\n                // Accumulated block lengths are equal to or larger than the buffer, which means there is no primary block. This\n                // is a bad packet.\n                if (totalPayloadSizeBytes >= payload.byteLength) {\n                    return null;\n                }\n                primaryPayloadSizeBytes = payload.byteLength - totalPayloadSizeBytes;\n                break;\n            }\n            else {\n                if (payloadSizeBytes < this.redHeaderSizeBytes) {\n                    return null;\n                }\n                // Bits 22 through 31 are payload length\n                const blockLength = ((payload.getUint8(payloadOffset + 2) & 0x03) << 8) + payload.getUint8(payloadOffset + 3);\n                redundantEncodingBlockLengths.push(blockLength);\n                const timestampOffset = payload.getUint16(payloadOffset + 1) >> 2;\n                const timestamp = primaryTimestamp - timestampOffset;\n                redundantEncodingTimestamps.push(timestamp);\n                totalPayloadSizeBytes += blockLength + this.redHeaderSizeBytes;\n                totalHeaderSizeBytes += this.redHeaderSizeBytes;\n                payloadOffset += this.redHeaderSizeBytes;\n                payloadSizeBytes -= this.redHeaderSizeBytes;\n            }\n        }\n        // The last block was never found. This is a bad packet.\n        if (!gotLastBlock) {\n            return null;\n        }\n        let redundantPayloadOffset = totalHeaderSizeBytes;\n        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {\n            const redundantPayloadBuffer = new ArrayBuffer(redundantEncodingBlockLengths[i]);\n            const redundantPayloadArray = new Uint8Array(redundantPayloadBuffer);\n            redundantPayloadArray.set(new Uint8Array(payload.buffer, redundantPayloadOffset, redundantEncodingBlockLengths[i]), 0);\n            const encoding = {\n                timestamp: redundantEncodingTimestamps[i],\n                payload: redundantPayloadBuffer,\n                isRedundant: true,\n            };\n            if (getFecInfo) {\n                encoding.hasFec = this.opusPacketHasFec(new DataView(redundantPayloadBuffer), redundantPayloadBuffer.byteLength);\n            }\n            encodings.push(encoding);\n            redundantPayloadOffset += redundantEncodingBlockLengths[i];\n        }\n        const primaryPayloadOffset = payload.byteLength - primaryPayloadSizeBytes;\n        const primaryPayloadBuffer = new ArrayBuffer(primaryPayloadSizeBytes);\n        const primaryArray = new Uint8Array(primaryPayloadBuffer);\n        primaryArray.set(new Uint8Array(payload.buffer, primaryPayloadOffset, primaryPayloadSizeBytes), 0);\n        const encoding = {\n            timestamp: primaryTimestamp,\n            payload: primaryPayloadBuffer,\n            isRedundant: false,\n            seq: primarySequenceNumber,\n        };\n        if (getFecInfo) {\n            encoding.hasFec = this.opusPacketHasFec(new DataView(primaryPayloadBuffer), primaryPayloadBuffer.byteLength);\n        }\n        encodings.push(encoding);\n        return encodings;\n    }\n    /**\n     * Create a new encoding with current primary payload and the older payloads of choice.\n     */\n    encode(primaryTimestamp, primaryPayload) {\n        const primaryPayloadSize = primaryPayload.byteLength;\n        // Payload size needs to be valid.\n        if (primaryPayloadSize === 0 ||\n            primaryPayloadSize >= this.maxRedPacketSizeBytes ||\n            primaryPayloadSize >= this.maxAudioPayloadSizeBytes) {\n            return null;\n        }\n        const numRedundantEncodings = this.numRedundantEncodings;\n        let headerSizeBytes = this.redLastHeaderSizeBytes;\n        let payloadSizeBytes = primaryPayloadSize;\n        let bytesAvailable = this.maxAudioPayloadSizeBytes - primaryPayloadSize - headerSizeBytes;\n        const redundantEncodingTimestamps = new Array();\n        const redundantEncodingPayloads = new Array();\n        // If redundancy is disabled then only send the primary payload\n        if (this.redundancyEnabled) {\n            // Determine how much redundancy we can fit into our packet\n            let redundantTimestamp = this.uint32WrapAround(primaryTimestamp - this.redPacketizationTime * this.redPacketDistance);\n            for (let i = 0; i < numRedundantEncodings; i++) {\n                // Do not add redundant encodings that are beyond the maximum timestamp offset.\n                if (this.uint32WrapAround(primaryTimestamp - redundantTimestamp) >= this.maxRedTimestampOffset) {\n                    break;\n                }\n                let findTimestamp = redundantTimestamp;\n                let encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);\n                if (!encoding) {\n                    // If not found or not important then look for the previous packet.\n                    // The current packet may have included FEC for the previous, so just\n                    // use the previous packet instead provided that it has voice activity.\n                    findTimestamp = this.uint32WrapAround(redundantTimestamp - this.redPacketizationTime);\n                    encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);\n                }\n                if (encoding) {\n                    const redundantEncodingSizeBytes = encoding.payload.byteLength;\n                    // Only add redundancy if there are enough bytes available.\n                    if (bytesAvailable < this.redHeaderSizeBytes + redundantEncodingSizeBytes)\n                        break;\n                    bytesAvailable -= this.redHeaderSizeBytes + redundantEncodingSizeBytes;\n                    headerSizeBytes += this.redHeaderSizeBytes;\n                    payloadSizeBytes += redundantEncodingSizeBytes;\n                    redundantEncodingTimestamps.unshift(encoding.timestamp);\n                    redundantEncodingPayloads.unshift(encoding.payload);\n                }\n                redundantTimestamp -= this.redPacketizationTime * this.redPacketDistance;\n                redundantTimestamp = this.uint32WrapAround(redundantTimestamp);\n            }\n        }\n        const redPayloadBuffer = new ArrayBuffer(headerSizeBytes + payloadSizeBytes);\n        const redPayloadView = new DataView(redPayloadBuffer);\n        // Add redundant encoding header(s) to new buffer\n        let redPayloadOffset = 0;\n        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {\n            const timestampDelta = primaryTimestamp - redundantEncodingTimestamps[i];\n            redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType | 0x80);\n            redPayloadView.setUint16(redPayloadOffset + 1, (timestampDelta << 2) | (redundantEncodingPayloads[i].byteLength >> 8));\n            redPayloadView.setUint8(redPayloadOffset + 3, redundantEncodingPayloads[i].byteLength & 0xff);\n            redPayloadOffset += this.redHeaderSizeBytes;\n        }\n        // Add primary encoding header to new buffer\n        redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType);\n        redPayloadOffset += this.redLastHeaderSizeBytes;\n        // Add redundant payload(s) to new buffer\n        const redPayloadArray = new Uint8Array(redPayloadBuffer);\n        for (let i = 0; i < redundantEncodingPayloads.length; i++) {\n            redPayloadArray.set(new Uint8Array(redundantEncodingPayloads[i]), redPayloadOffset);\n            redPayloadOffset += redundantEncodingPayloads[i].byteLength;\n        }\n        // Add primary payload to new buffer\n        redPayloadArray.set(new Uint8Array(primaryPayload), redPayloadOffset);\n        redPayloadOffset += primaryPayload.byteLength;\n        /* istanbul ignore next */\n        // Sanity check that we got the expected total payload size.\n        if (redPayloadOffset !== headerSizeBytes + payloadSizeBytes)\n            return null;\n        this.updateEncodingHistory(primaryTimestamp, primaryPayload);\n        return redPayloadBuffer;\n    }\n    /**\n     * Update the encoding history with the latest primary encoding\n     */\n    updateEncodingHistory(primaryTimestamp, primaryPayload) {\n        // Remove encodings from the history if they are too old.\n        for (const encoding of this.encodingHistory) {\n            const maxTimestampDelta = this.redPacketizationTime * this.redMaxRecoveryDistance;\n            if (primaryTimestamp - encoding.timestamp >= maxTimestampDelta) {\n                this.encodingHistory.shift();\n            }\n            else {\n                break;\n            }\n        }\n        // Only add an encoding to the history if the encoding is deemed to be important. An encoding is important if it is\n        // a CELT-only packet or contains voice activity.\n        const packet = new DataView(primaryPayload);\n        if (this.opusPacketIsCeltOnly(packet) ||\n            this.opusPacketHasVoiceActivity(packet, packet.byteLength) > 0) {\n            // Check if adding an encoding will cause the length of the encoding history to exceed the maximum history size.\n            // This is not expected to happen but could occur if we get incorrect timestamps. We want to make sure our memory\n            // usage is bounded. In this case, just clear the history and start over from empty.\n            if (this.encodingHistory.length + 1 > this.maxEncodingHistorySize)\n                this.encodingHistory.length = 0;\n            this.encodingHistory.push({ timestamp: primaryTimestamp, payload: primaryPayload });\n        }\n    }\n    /**\n     * Initialize packet logs and metric values.\n     */\n    initializePacketLogs() {\n        // The extra space from the max RED recovery distance is to ensure that we do not incorrectly count recovery for\n        // packets that have already been received but are outside of the max out-of-order distance.\n        const packetLogSize = this.maxOutOfOrderPacketDistance + this.redMaxRecoveryDistance;\n        this.primaryPacketLog = {\n            window: new Array(packetLogSize),\n            index: 0,\n            windowSize: packetLogSize,\n        };\n        this.redRecoveryLog = {\n            window: new Array(packetLogSize),\n            index: 0,\n            windowSize: packetLogSize,\n        };\n        this.fecRecoveryLog = {\n            window: new Array(packetLogSize),\n            index: 0,\n            windowSize: packetLogSize,\n        };\n        this.totalAudioPacketsExpected = 0;\n        this.totalAudioPacketsLost = 0;\n        this.totalAudioPacketsRecoveredRed = 0;\n        this.totalAudioPacketsRecoveredFec = 0;\n    }\n    /**\n     * Receives encoded frames from the server\n     * and adds the timestamps to a packet log\n     * to calculate an approximate recovery metric.\n     */\n    receivePacketLogTransform(\n    // @ts-ignore\n    frame, controller) {\n        const frameMetadata = frame.getMetadata();\n        // @ts-ignore\n        if (frameMetadata.payloadType !== this.redPayloadType) {\n            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n            return;\n        }\n        // @ts-ignore\n        const encodings = this.splitEncodings(frame.timestamp, frame.data, \n        /*getFecInfo*/ true, frameMetadata.sequenceNumber);\n        if (!encodings) {\n            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n            return;\n        }\n        for (let i = encodings.length - 1; i >= 0; i--) {\n            if (this.updateLossStats(encodings[i])) {\n                this.updateRedStats(encodings[i]);\n                this.updateFecStats(encodings[i]);\n            }\n        }\n        this.maybeReportLossStats(encodings[encodings.length - 1].timestamp, frameMetadata.synchronizationSource);\n        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);\n    }\n    /**\n     * Adds a timestamp to the primary packet log.\n     * This also updates totalAudioPacketsLost and totalAudioPacketsExpected by looking\n     * at the difference between timestamps.\n     *\n     * @param encoding : The encoding to be analyzed\n     * @returns false if sequence number was greater than max out of order distance\n     *          true otherwise\n     */\n    updateLossStats(encoding) {\n        if (encoding.isRedundant)\n            return true;\n        const timestamp = encoding.timestamp;\n        const seq = encoding.seq;\n        if (this.totalAudioPacketsExpected === 0) {\n            this.totalAudioPacketsExpected = 1;\n            this.newestSequenceNumber = seq;\n            this.addTimestamp(this.primaryPacketLog, timestamp);\n            return true;\n        }\n        const diff = this.int16(seq - this.newestSequenceNumber);\n        if (diff < -this.maxOutOfOrderPacketDistance)\n            return false;\n        if (diff < 0) {\n            if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {\n                if (this.totalAudioPacketsLost > 0)\n                    this.totalAudioPacketsLost--;\n                this.addTimestamp(this.primaryPacketLog, timestamp);\n                this.removeFromRecoveryWindows(timestamp);\n            }\n        }\n        else if (diff > 1) {\n            this.totalAudioPacketsLost += diff - 1;\n        }\n        if (diff > 0) {\n            this.totalAudioPacketsExpected += diff;\n            this.newestSequenceNumber = encoding.seq;\n            this.addTimestamp(this.primaryPacketLog, timestamp);\n        }\n        return true;\n    }\n    /**\n     * Adds a timestamp to the red recovery log if it is not present in\n     * the primary packet log and if it's not too old.\n     *\n     * @param encoding : The encoding to be analyzed\n     */\n    updateRedStats(encoding) {\n        if (!encoding.isRedundant || this.totalAudioPacketsLost === 0)\n            return;\n        const timestamp = encoding.timestamp;\n        if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {\n            if (!this.hasTimestamp(this.redRecoveryLog, timestamp)) {\n                this.totalAudioPacketsRecoveredRed++;\n                this.addTimestamp(this.redRecoveryLog, timestamp);\n            }\n            if (this.removeTimestamp(this.fecRecoveryLog, timestamp)) {\n                /* istanbul ignore else */\n                if (this.totalAudioPacketsRecoveredFec > 0)\n                    this.totalAudioPacketsRecoveredFec--;\n            }\n        }\n    }\n    /**\n     * Adds a timestamp to the fec recovery log if it is not present in\n     * the primary packet log and red recovery log and if it is not too old.\n     *\n     * @param encoding : The encoding to be analyzed\n     */\n    updateFecStats(encoding) {\n        if (!encoding.hasFec || this.totalAudioPacketsLost === 0)\n            return;\n        const fecTimestamp = encoding.timestamp - this.redPacketizationTime;\n        if (this.hasTimestamp(this.primaryPacketLog, fecTimestamp) ||\n            this.hasTimestamp(this.redRecoveryLog, fecTimestamp) ||\n            this.hasTimestamp(this.fecRecoveryLog, fecTimestamp)) {\n            return;\n        }\n        this.totalAudioPacketsRecoveredFec++;\n        this.addTimestamp(this.fecRecoveryLog, fecTimestamp);\n    }\n    /**\n     * Reports loss metrics to DefaultTransceiverController\n     *\n     * @param timestamp : Timestamp of most recent primary packet\n     */\n    maybeReportLossStats(timestamp, ssrc) {\n        if (timestamp - this.lastLossReportTimestamp < this.lossReportInterval)\n            return;\n        /* istanbul ignore next */\n        if (RedundantAudioEncoder.shouldReportStats) {\n            // @ts-ignore\n            self.postMessage({\n                type: 'RedundantAudioEncoderStats',\n                ssrc,\n                totalAudioPacketsLost: this.totalAudioPacketsLost,\n                totalAudioPacketsExpected: this.totalAudioPacketsExpected,\n                totalAudioPacketsRecoveredRed: this.totalAudioPacketsRecoveredRed,\n                totalAudioPacketsRecoveredFec: this.totalAudioPacketsRecoveredFec,\n            });\n        }\n        this.lastLossReportTimestamp = timestamp;\n    }\n    /**\n     * Adds a timestamp to a packet log\n     *\n     * @param packetLog : The packetlog to add the timestamp to\n     * @param timestamp : The timestamp that should be added\n     */\n    addTimestamp(packetLog, timestamp) {\n        packetLog.window[packetLog.index] = timestamp;\n        packetLog.index = (packetLog.index + 1) % packetLog.windowSize;\n    }\n    /**\n     * Checks if a timestamp is in a packetlog\n     *\n     * @param packetLog : The packetlog to search\n     * @param timestamp : The timestamp to search for\n     * @returns true if timestamp is present, false otherwise\n     */\n    hasTimestamp(packetLog, timestamp) {\n        const element = packetLog.window.find(t => t === timestamp);\n        return !!element;\n    }\n    /**\n     * Removes a timestamp from a packet log\n     *\n     * @param packetLog : The packetlog from which the timestamp should be removed\n     * @param timestamp : The timestamp to be removed\n     * @returns true if timestamp was present in the log and removed, false otherwise\n     */\n    removeTimestamp(packetLog, timestamp) {\n        const index = packetLog.window.indexOf(timestamp);\n        if (index >= 0) {\n            packetLog.window[index] = undefined;\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Removes a timestamp from red and fec recovery windows.\n     *\n     * @param timestamp : The timestamp to be removed\n     */\n    removeFromRecoveryWindows(timestamp) {\n        let removed = this.removeTimestamp(this.redRecoveryLog, timestamp);\n        if (removed) {\n            if (this.totalAudioPacketsRecoveredRed > 0)\n                this.totalAudioPacketsRecoveredRed--;\n        }\n        removed = this.removeTimestamp(this.fecRecoveryLog, timestamp);\n        if (removed) {\n            if (this.totalAudioPacketsRecoveredFec > 0)\n                this.totalAudioPacketsRecoveredFec--;\n        }\n    }\n    /**\n     * Converts the supplied argument to 32-bit unsigned integer\n     */\n    uint32WrapAround(num) {\n        const mod = 4294967296; // 2^32\n        let res = num;\n        if (num >= mod) {\n            res = num - mod;\n        }\n        else if (num < 0) {\n            res = mod + num;\n        }\n        return res;\n    }\n    /**\n     * Converts the supplied argument to 16-bit signed integer\n     */\n    int16(num) {\n        return (num << 16) >> 16;\n    }\n    /**\n     * Determines if an Opus packet is in CELT-only mode.\n     *\n     * @param packet Opus packet.\n     * @returns `true` if the packet is in CELT-only mode.\n     */\n    opusPacketIsCeltOnly(packet) {\n        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):\n        //  0\n        //  0 1 2 3 4 5 6 7\n        // +-+-+-+-+-+-+-+-+\n        // | config  |s| c |\n        // +-+-+-+-+-+-+-+-+\n        // Since CELT-only packets are represented using configurations 16 to 31, the highest 'config' bit will always be 1\n        // for CELT-only packets.\n        return !!(packet.getUint8(0) & 0x80);\n    }\n    /**\n     * Gets the number of samples per frame from an Opus packet.\n     *\n     * @param packet Opus packet. This must contain at least one byte of data.\n     * @param sampleRateHz 32-bit integer sampling rate in Hz. This must be a multiple of 400 or inaccurate results will\n     *                     be returned.\n     * @returns Number of samples per frame.\n     */\n    opusPacketGetSamplesPerFrame(packet, sampleRateHz) {\n        // Sample rate must be a 32-bit integer.\n        sampleRateHz = Math.round(sampleRateHz);\n        sampleRateHz = Math.min(Math.max(sampleRateHz, -(Math.pow(2, 32))), Math.pow(2, 32) - 1);\n        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):\n        //  0\n        //  0 1 2 3 4 5 6 7\n        // +-+-+-+-+-+-+-+-+\n        // | config  |s| c |\n        // +-+-+-+-+-+-+-+-+\n        let numSamples;\n        let frameSizeOption;\n        // Case for CELT-only packet.\n        if (this.opusPacketIsCeltOnly(packet)) {\n            // The lower 3 'config' bits indicate the frame size option.\n            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;\n            // The frame size options 0, 1, 2, 3 correspond to frame sizes of 2.5, 5, 10, 20 ms. Notice that the frame sizes\n            // can be represented as (2.5 * 2^0), (2.5 * 2^1), (2.5 * 2^2), (2.5 * 2^3) ms. So, the number of samples can be\n            // calculated as follows:\n            // (sample/s) * (1s/1000ms) * (2.5ms) * 2^(frameSizeOption)\n            // = (sample/s) * (1s/400) * 2^(frameSizeOption)\n            // = (sample/s) * 2^(frameSizeOption) * (1s/400)\n            numSamples = (sampleRateHz << frameSizeOption) / 400;\n        }\n        // Case for Hybrid packet. Since Hybrid packets are represented using configurations 12 to 15, bits 1 and 2 in the\n        // above TOC byte diagram will both be 1.\n        else if ((packet.getUint8(0) & 0x60) === 0x60) {\n            // In the case of configuration 13 or 15, bit 4 in the above TOC byte diagram will be 1. Configurations 13 and 15\n            // correspond to a 20ms frame size, so the number of samples is calculated as follows:\n            // (sample/s) * (1s/1000ms) * (20ms)\n            // = (sample/s) * (1s/50)\n            //\n            // In the case of configuration 12 or 14, bit 4 in the above TOC byte diagram will be 0. Configurations 12 and 14\n            // correspond to a 10ms frame size, so the number of samples is calculated as follows:\n            // (sample/s) * (1s/1000ms) * (10ms)\n            // = (sample/s) * (1s/100)\n            numSamples = packet.getUint8(0) & 0x08 ? sampleRateHz / 50 : sampleRateHz / 100;\n        }\n        // Case for SILK-only packet.\n        else {\n            // The lower 3 'config' bits indicate the frame size option for SILK-only packets.\n            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;\n            if (frameSizeOption === 3) {\n                // Frame size option 3 corresponds to a frame size of 60ms, so the number of samples is calculated as follows:\n                // (sample/s) * (1s/1000ms) * (60ms)\n                // = (sample/s) * (60ms) * (1s/1000ms)\n                numSamples = (sampleRateHz * 60) / 1000;\n            }\n            else {\n                // The frame size options 0, 1, 2 correspond to frame sizes of 10, 20, 40 ms. Notice that the frame sizes can be\n                // represented as (10 * 2^0), (10 * 2^1), (10 * 2^2) ms. So, the number of samples can be calculated as follows:\n                // (sample/s) * (1s/1000ms) * (10ms) * 2^(frameSizeOption)\n                // = (sample/s) * (1s/100) * 2^(frameSizeOption)\n                // = (sample/s) * 2^(frameSizeOption) * (1s/100)\n                numSamples = (sampleRateHz << frameSizeOption) / 100;\n            }\n        }\n        return numSamples;\n    }\n    /**\n     * Gets the number of SILK frames per Opus frame.\n     *\n     * @param packet Opus packet.\n     * @returns Number of SILK frames per Opus frame.\n     */\n    opusNumSilkFrames(packet) {\n        // For computing the frame length in ms, the sample rate is not important since it cancels out. We use 48 kHz, but\n        // any valid sample rate would work.\n        //\n        // To calculate the length of a frame (with a 48kHz sample rate) in ms:\n        // (samples/frame) * (1s/48000 samples) * (1000ms/s)\n        // = (samples/frame) * (1000ms/48000 samples)\n        // = (samples/frame) * (1ms/48 samples)\n        let frameLengthMs = this.opusPacketGetSamplesPerFrame(packet, 48000) / 48;\n        if (frameLengthMs < 10)\n            frameLengthMs = 10;\n        // The number of SILK frames per Opus frame is described in https://www.rfc-editor.org/rfc/rfc6716#section-4.2.2.\n        switch (frameLengthMs) {\n            case 10:\n            case 20:\n                return 1;\n            case 40:\n                return 2;\n            case 60:\n                return 3;\n            // It is not possible to reach the default case since an Opus packet can only encode sizes of 2.5, 5, 10, 20, 40,\n            // or 60 ms, so we ignore the default case for test coverage.\n            /* istanbul ignore next */\n            default:\n                return 0;\n        }\n    }\n    /**\n     * Gets the number of channels from an Opus packet.\n     *\n     * @param packet Opus packet.\n     * @returns Number of channels.\n     */\n    opusPacketGetNumChannels(packet) {\n        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):\n        //  0\n        //  0 1 2 3 4 5 6 7\n        // +-+-+-+-+-+-+-+-+\n        // | config  |s| c |\n        // +-+-+-+-+-+-+-+-+\n        // The 's' bit indicates mono or stereo audio, with 0 indicating mono and 1 indicating stereo.\n        return packet.getUint8(0) & 0x4 ? 2 : 1;\n    }\n    /**\n     * Determine the size (in bytes) of an Opus frame.\n     *\n     * @param packet Opus packet.\n     * @param byteOffset Offset (from the start of the packet) to the byte containing the size information.\n     * @param remainingBytes Remaining number of bytes to parse from the Opus packet.\n     * @param sizeBytes Variable to store the parsed frame size (in bytes).\n     * @returns Number of bytes that were parsed to determine the frame size.\n     */\n    opusParseSize(packet, byteOffset, remainingBytes, sizeBytes) {\n        // See https://www.rfc-editor.org/rfc/rfc6716#section-3.2.1 for an explanation of how frame size is represented.\n        // If there are no remaining bytes to parse the size from, then the size cannot be determined.\n        if (remainingBytes < 1) {\n            sizeBytes[0] = -1;\n            return -1;\n        }\n        // If the first byte is in the range 0...251, then this value is the size of the frame.\n        else if (packet.getUint8(byteOffset) < 252) {\n            sizeBytes[0] = packet.getUint8(byteOffset);\n            return 1;\n        }\n        // If the first byte is in the range 252...255, a second byte is needed. If there is no second byte, then the size\n        // cannot be determined.\n        else if (remainingBytes < 2) {\n            sizeBytes[0] = -1;\n            return -1;\n        }\n        // The total size of the frame given two size bytes is:\n        // (4 * secondSizeByte) + firstSizeByte\n        else {\n            sizeBytes[0] = 4 * packet.getUint8(byteOffset + 1) + packet.getUint8(byteOffset);\n            return 2;\n        }\n    }\n    /**\n     * Parse binary data containing an Opus packet into one or more Opus frames.\n     *\n     * @param data Binary data containing an Opus packet to be parsed. The data should begin with the first byte (i.e the\n     *             TOC byte) of an Opus packet. Note that the size of the data does not have to equal the size of the\n     *             contained Opus packet.\n     * @param lenBytes Size of the data (in bytes).\n     * @param selfDelimited Indicates if the Opus packet is self-delimiting\n     *                      (https://www.rfc-editor.org/rfc/rfc6716#appendix-B).\n     * @param tocByte Optional variable to store the TOC (table of contents) byte.\n     * @param frameOffsets Optional variable to store the offsets (from the start of the data) to the first bytes of each\n     *                     Opus frame.\n     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.\n     * @param payloadOffset Optional variable to store the offset (from the start of the data) to the first byte of the\n     *                      payload.\n     * @param packetLenBytes Optional variable to store the length of the Opus packet (in bytes).\n     * @returns Number of Opus frames.\n     */\n    opusPacketParseImpl(data, lenBytes, selfDelimited, tocByte, frameOffsets, frameSizes, payloadOffset, packetLenBytes) {\n        if (!frameSizes || lenBytes < 0)\n            return this.OPUS_BAD_ARG;\n        if (lenBytes === 0)\n            return this.OPUS_INVALID_PACKET;\n        // The number of Opus frames in the packet.\n        let numFrames;\n        // Intermediate storage for the number of bytes parsed to determine the size of a frame.\n        let numBytesParsed;\n        // The number of the padding bytes (excluding the padding count bytes) in the packet.\n        let paddingBytes = 0;\n        // Indicates whether CBR (constant bitrate) framing is used.\n        let cbr = false;\n        // The TOC (table of contents) byte (https://www.rfc-editor.org/rfc/rfc6716#section-3.1).\n        const toc = data.getUint8(0);\n        // Store the TOC byte.\n        if (tocByte)\n            tocByte[0] = toc;\n        // The remaining number of bytes to parse from the packet. Note that the TOC byte has already been parsed, hence the\n        // minus 1.\n        let remainingBytes = lenBytes - 1;\n        // This keeps track of where we are in the packet. This starts at 1 since the TOC byte has already been read.\n        let byteOffset = 1;\n        // The size of the last Opus frame in bytes.\n        let lastSizeBytes = remainingBytes;\n        // Read the `c` bits (i.e. code bits) from the TOC byte.\n        switch (toc & 0x3) {\n            // A code 0 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.2) has one frame.\n            case 0:\n                numFrames = 1;\n                break;\n            // A code 1 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.3) has two CBR (constant bitrate) frames.\n            case 1:\n                numFrames = 2;\n                cbr = true;\n                if (!selfDelimited) {\n                    // Undelimited code 1 packets must be an even number of data bytes, otherwise the packet is invalid.\n                    if (remainingBytes & 0x1)\n                        return this.OPUS_INVALID_PACKET;\n                    // The sizes of both frames are equal (i.e. half of the number of data bytes).\n                    lastSizeBytes = remainingBytes / 2;\n                    // If `lastSizeBytes` is too large, we will catch it later.\n                    frameSizes[0][0] = lastSizeBytes;\n                }\n                break;\n            // A code 2 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.4) has two VBR (variable bitrate) frames.\n            case 2:\n                numFrames = 2;\n                numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[0]);\n                remainingBytes -= numBytesParsed;\n                // The parsed size of the first frame cannot be larger than the number of remaining bytes in the packet.\n                if (frameSizes[0][0] < 0 || frameSizes[0][0] > remainingBytes) {\n                    return this.OPUS_INVALID_PACKET;\n                }\n                byteOffset += numBytesParsed;\n                // The size of the second frame is the remaining number of bytes after the first frame.\n                lastSizeBytes = remainingBytes - frameSizes[0][0];\n                break;\n            // A code 3 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5) has multiple CBR/VBR frames (from 0 to\n            // 120 ms).\n            default:\n                // Code 3 packets must have at least 2 bytes (i.e. at least 1 byte after the TOC byte).\n                if (remainingBytes < 1)\n                    return this.OPUS_INVALID_PACKET;\n                // Frame count byte format:\n                //  0\n                //  0 1 2 3 4 5 6 7\n                // +-+-+-+-+-+-+-+-+\n                // |v|p|     M     |\n                // +-+-+-+-+-+-+-+-+\n                //\n                // Read the frame count byte, which immediately follows the TOC byte.\n                const frameCountByte = data.getUint8(byteOffset++);\n                --remainingBytes;\n                // Read the 'M' bits of the frame count byte, which encode the number of frames.\n                numFrames = frameCountByte & 0x3f;\n                // The number of frames in a code 3 packet must not be 0.\n                if (numFrames <= 0)\n                    return this.OPUS_INVALID_PACKET;\n                const samplesPerFrame = this.opusPacketGetSamplesPerFrame(data, 48000);\n                // A single frame can have at most 2880 samples, which happens in the case where 60ms of 48kHz audio is encoded\n                // per frame. A code 3 packet cannot contain more than 120ms of audio, so the total number of samples cannot\n                // exceed 2880 * 2 = 5760.\n                if (samplesPerFrame * numFrames > 5760)\n                    return this.OPUS_INVALID_PACKET;\n                // Parse padding bytes if the 'p' bit is 1.\n                if (frameCountByte & 0x40) {\n                    let paddingCountByte;\n                    let numPaddingBytes;\n                    // Remove padding bytes (including padding count bytes) from the remaining byte count.\n                    do {\n                        // Sanity check that there are enough bytes to parse and remove the padding.\n                        if (remainingBytes <= 0)\n                            return this.OPUS_INVALID_PACKET;\n                        // Get the next padding count byte.\n                        paddingCountByte = data.getUint8(byteOffset++);\n                        --remainingBytes;\n                        // If the padding count byte has a value in the range 0...254, then the total size of the padding is the\n                        // value in the padding count byte.\n                        //\n                        // If the padding count byte has value 255, then the total size of the padding is 254 plus the value in the\n                        // next padding count byte. Therefore, keep reading padding count bytes while the value is 255.\n                        numPaddingBytes = paddingCountByte === 255 ? 254 : paddingCountByte;\n                        remainingBytes -= numPaddingBytes;\n                        paddingBytes += numPaddingBytes;\n                    } while (paddingCountByte === 255);\n                }\n                // Sanity check that the remaining number of bytes is not negative after removing the padding.\n                if (remainingBytes < 0)\n                    return this.OPUS_INVALID_PACKET;\n                // Read the 'v' bit (i.e. VBR bit).\n                cbr = !(frameCountByte & 0x80);\n                // VBR case\n                if (!cbr) {\n                    lastSizeBytes = remainingBytes;\n                    // Let M be the number of frames. There will be M - 1 frame length indicators (which can be 1 or 2 bytes)\n                    // corresponding to the lengths of frames 0 to M - 2. The size of the last frame (i.e. frame M - 1) is the\n                    // number of data bytes after the end of frame M - 2 and before the start of the padding bytes.\n                    for (let i = 0; i < numFrames - 1; ++i) {\n                        numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[i]);\n                        remainingBytes -= numBytesParsed;\n                        // The remaining number of data bytes must be enough to contain each frame.\n                        if (frameSizes[i][0] < 0 || frameSizes[i][0] > remainingBytes) {\n                            return this.OPUS_INVALID_PACKET;\n                        }\n                        byteOffset += numBytesParsed;\n                        lastSizeBytes -= numBytesParsed + frameSizes[i][0];\n                    }\n                    // Sanity check that the size of the last frame is not negative.\n                    if (lastSizeBytes < 0)\n                        return this.OPUS_INVALID_PACKET;\n                }\n                // CBR case\n                else if (!selfDelimited) {\n                    // The size of each frame is the number of data bytes divided by the number of frames.\n                    lastSizeBytes = Math.trunc(remainingBytes / numFrames);\n                    // The number of data bytes must be a non-negative integer multiple of the number of frames.\n                    if (lastSizeBytes * numFrames !== remainingBytes)\n                        return this.OPUS_INVALID_PACKET;\n                    // All frames have equal size in the undelimited CBR case.\n                    for (let i = 0; i < numFrames - 1; ++i) {\n                        frameSizes[i][0] = lastSizeBytes;\n                    }\n                }\n        }\n        // Self-delimited framing uses an extra 1 or 2 bytes, immediately preceding the data bytes, to indicate either the\n        // size of the last frame (for code 0, code 2, and VBR code 3 packets) or the size of all the frames (for code 1 and\n        // CBR code 3 packets). See https://www.rfc-editor.org/rfc/rfc6716#appendix-B.\n        if (selfDelimited) {\n            // The extra frame size byte(s) will always indicate the size of the last frame.\n            numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[numFrames - 1]);\n            remainingBytes -= numBytesParsed;\n            // There must be enough data bytes for the last frame.\n            if (frameSizes[numFrames - 1][0] < 0 || frameSizes[numFrames - 1][0] > remainingBytes) {\n                return this.OPUS_INVALID_PACKET;\n            }\n            byteOffset += numBytesParsed;\n            // For CBR packets, the sizes of all the frames are equal.\n            if (cbr) {\n                // There must be enough data bytes for all the frames.\n                if (frameSizes[numFrames - 1][0] * numFrames > remainingBytes) {\n                    return this.OPUS_INVALID_PACKET;\n                }\n                for (let i = 0; i < numFrames - 1; ++i) {\n                    frameSizes[i][0] = frameSizes[numFrames - 1][0];\n                }\n            }\n            // At this point, `lastSizeBytes` contains the size of the last frame plus the size of the extra frame size\n            // byte(s), so sanity check that `lastSizeBytes` is the upper bound for the size of the last frame.\n            else if (!(numBytesParsed + frameSizes[numFrames - 1][0] <= lastSizeBytes)) {\n                return this.OPUS_INVALID_PACKET;\n            }\n        }\n        // Undelimited case\n        else {\n            // Because the size of the last packet is not encoded explicitly, it is possible that the size of the last packet\n            // (or of all the packets, for the CBR case) is larger than maximum frame size.\n            if (lastSizeBytes > this.OPUS_MAX_FRAME_SIZE_BYTES)\n                return this.OPUS_INVALID_PACKET;\n            frameSizes[numFrames - 1][0] = lastSizeBytes;\n        }\n        // Store the offset to the start of the payload.\n        if (payloadOffset)\n            payloadOffset[0] = byteOffset;\n        // Store the offsets to the start of each frame.\n        for (let i = 0; i < numFrames; ++i) {\n            if (frameOffsets)\n                frameOffsets[i][0] = byteOffset;\n            byteOffset += frameSizes[i][0];\n        }\n        // Store the length of the Opus packet.\n        if (packetLenBytes)\n            packetLenBytes[0] = byteOffset + paddingBytes;\n        return numFrames;\n    }\n    /**\n     * Parse a single undelimited Opus packet into one or more Opus frames.\n     *\n     * @param packet Opus packet to be parsed.\n     * @param lenBytes Size of the packet (in bytes).\n     * @param tocByte Optional variable to store the TOC (table of contents) byte.\n     * @param frameOffsets Optional variable to store the offsets (from the start of the packet) to the first bytes of\n     *                     each Opus frame.\n     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.\n     * @param payloadOffset Optional variable to store the offset (from the start of the packet) to the first byte of the\n     *                      payload.\n     * @returns Number of Opus frames.\n     */\n    opusPacketParse(packet, lenBytes, tocByte, frameOffsets, frameSizes, payloadOffset) {\n        return this.opusPacketParseImpl(packet, lenBytes, \n        /* selfDelimited */ false, tocByte, frameOffsets, frameSizes, payloadOffset, null);\n    }\n    /**\n     * This function returns the SILK VAD (voice activity detection) information encoded in the Opus packet. For CELT-only\n     * packets that do not have VAD information, it returns -1.\n     *\n     * @param packet Opus packet.\n     * @param lenBytes Size of the packet (in bytes).\n     * @returns  0: no frame had the VAD flag set.\n     *           1: at least one frame had the VAD flag set.\n     *          -1: VAD status could not be determined.\n     */\n    opusPacketHasVoiceActivity(packet, lenBytes) {\n        if (!packet || lenBytes <= 0)\n            return 0;\n        // In CELT-only mode, we can not determine whether there is VAD.\n        if (this.opusPacketIsCeltOnly(packet))\n            return -1;\n        const numSilkFrames = this.opusNumSilkFrames(packet);\n        // It is not possible for `opusNumSilkFrames()` to return 0, so we ignore the next sanity check for test coverage.\n        /* istanbul ignore next */\n        if (numSilkFrames === 0)\n            return -1;\n        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);\n        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);\n        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {\n            opusFrameOffsets[i] = [undefined];\n            opusFrameSizes[i] = [undefined];\n        }\n        // Parse packet to get the Opus frames.\n        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);\n        // VAD status cannot be determined for invalid packets.\n        if (numOpusFrames < 0)\n            return -1;\n        // Iterate over all Opus frames, which may contain multiple SILK frames, to determine the VAD status.\n        for (let i = 0; i < numOpusFrames; ++i) {\n            if (opusFrameSizes[i][0] < 1)\n                continue;\n            // LP layer header bits format (https://www.rfc-editor.org/rfc/rfc6716#section-4.2.3):\n            //\n            // Mono case:\n            // +-----------------+----------+\n            // | 1 to 3 VAD bits | LBRR bit |\n            // +-----------------+----------+\n            //\n            // Stereo case:\n            // +---------------------+--------------+----------------------+---------------+\n            // | 1 to 3 mid VAD bits | mid LBRR bit | 1 to 3 side VAD bits | side LBRR bit |\n            // +---------------------+--------------+----------------------+---------------+\n            // The upper 1 to 3 bits (dependent on the number of SILK frames) of the LP layer contain VAD bits. If any of\n            // these VAD bits are 1, then voice activity is present.\n            if (packet.getUint8(opusFrameOffsets[i][0]) >> (8 - numSilkFrames))\n                return 1;\n            // In the stereo case, there is a second set of 1 to 3 VAD bits, so also check these VAD bits.\n            const channels = this.opusPacketGetNumChannels(packet);\n            if (channels === 2 &&\n                (packet.getUint8(opusFrameOffsets[i][0]) << (numSilkFrames + 1)) >> (8 - numSilkFrames)) {\n                return 1;\n            }\n        }\n        // No voice activity was detected.\n        return 0;\n    }\n    /**\n     * This method is based on Definition of the Opus Audio Codec\n     * (https://tools.ietf.org/html/rfc6716). Basically, this method is based on\n     * parsing the LP layer of an Opus packet, particularly the LBRR flag.\n     *\n     * @param packet Opus packet.\n     * @param lenBytes Size of the packet (in bytes).\n     * @returns  true: packet has fec encoding about previous packet.\n     *           false: no fec encoding present.\n     */\n    opusPacketHasFec(packet, lenBytes) {\n        if (!packet || lenBytes <= 0)\n            return false;\n        // In CELT-only mode, packets should not have FEC.\n        if (this.opusPacketIsCeltOnly(packet))\n            return false;\n        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);\n        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);\n        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {\n            opusFrameOffsets[i] = [undefined];\n            opusFrameSizes[i] = [undefined];\n        }\n        // Parse packet to get the Opus frames.\n        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);\n        if (numOpusFrames < 0)\n            return false;\n        /* istanbul ignore next */\n        if (opusFrameSizes[0][0] <= 1)\n            return false;\n        const numSilkFrames = this.opusNumSilkFrames(packet);\n        /* istanbul ignore next */\n        if (numSilkFrames === 0)\n            return false;\n        const channels = this.opusPacketGetNumChannels(packet);\n        /* istanbul ignore next */\n        if (channels !== 1 && channels !== 2)\n            return false;\n        // A frame starts with the LP layer. The LP layer begins with two to eight\n        // header bits.These consist of one VAD bit per SILK frame (up to 3),\n        // followed by a single flag indicating the presence of LBRR frames.\n        // For a stereo packet, these first flags correspond to the mid channel, and\n        // a second set of flags is included for the side channel. Because these are\n        // the first symbols decoded by the range coder and because they are coded\n        // as binary values with uniform probability, they can be extracted directly\n        // from the most significant bits of the first byte of compressed data.\n        for (let i = 0; i < channels; i++) {\n            if (packet.getUint8(opusFrameOffsets[0][0]) & (0x80 >> ((i + 1) * (numSilkFrames + 1) - 1)))\n                return true;\n        }\n        return false;\n    }\n}\nRedundantAudioEncoder.shouldLog = true;\nRedundantAudioEncoder.shouldReportStats = true;\nRedundantAudioEncoder.initializeWorker();\n";RedundantAudioEncoderWorkerCode$1.default=RedundantAudioEncoderWorkerCode;var __awaiter$q=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$F=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultTransceiverController$1,"__esModule",{value:!0});const AudioProfile_1=__importDefault$F(AudioProfile$1),RedundantAudioRecoveryMetricReport_1=__importDefault$F(RedundantAudioRecoveryMetricReport$1),RedundantAudioEncoder_1=__importDefault$F(RedundantAudioEncoder$1),RedundantAudioEncoderWorkerCode_1=__importDefault$F(RedundantAudioEncoderWorkerCode$1),AsyncScheduler_1$3=__importDefault$F(AsyncScheduler$1);class DefaultTransceiverController{constructor(e,t,i){this.logger=e,this.browserBehavior=t,this.meetingSessionContext=i,this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null,this.streamIdToTransceiver=new Map,this.groupIdToTransceiver=new Map,this.audioRedWorker=null,this.audioRedWorkerURL=null,this.audioMetricsHistory=new Array,this.redMetricsObservers=new Set,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.maxAudioMetricsHistory=20,this.audioRedPacketLossShortEvalPeriodMs=5e3,this.audioRedPacketLossLongEvalPeriodMs=15e3,this.audioRedHoldDownTimeMs=3e5,this.redRecoveryTimeMs=6e4}setEncodingParameters(e){return __awaiter$q(this,void 0,void 0,(function*(){if(!this._localCameraTransceiver||"sendrecv"!==this._localCameraTransceiver.direction)return;const t=this._localCameraTransceiver.sender;if(!e||0===e.size)return;const i=Array.from(e.values()),n=t.getParameters();if(n.encodings&&0!==n.encodings.length)for(const e of n.encodings)for(const t of i){if((e.rid||t.rid)&&e.rid!==t.rid)continue;let i;for(i in t)"rid"!==i&&"codecPayloadType"!==i&&t.hasOwnProperty(i)&&(e[i]=t[i])}else n.encodings=i;yield t.setParameters(n)}))}localAudioTransceiver(){return this._localAudioTransceiver}localVideoTransceiver(){return this._localCameraTransceiver}setVideoSendingBitrateKbps(e){return __awaiter$q(this,void 0,void 0,(function*(){if(!this._localCameraTransceiver||"sendrecv"!==this._localCameraTransceiver.direction)return;const t=this._localCameraTransceiver.sender;if(!t||e<=0)return;const i=t.getParameters();i.encodings||(i.encodings=[{}]);for(const t of i.encodings)t.maxBitrate=1e3*e;yield t.setParameters(i)}))}setPeer(e){this.peer=e}reset(){this.destroyAudioRedWorkerAndStates(),this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null}useTransceivers(){return!!this.peer&&void 0!==this.peer.getTransceivers}hasVideoInput(){return!(!this._localCameraTransceiver||"sendrecv"!==this._localCameraTransceiver.direction)}trackIsVideoInput(e){return!!this._localCameraTransceiver&&(e===this._localCameraTransceiver.sender.track||e===this._localCameraTransceiver.receiver.track)}setupLocalTransceivers(){var e,t;this.useTransceivers()&&(this.defaultMediaStream||"undefined"==typeof MediaStream||(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),(null===(t=null===(e=this.meetingSessionContext)||void 0===e?void 0:e.audioProfile)||void 0===t?void 0:t.hasRedundancyEnabled())&&this.setupAudioRedWorker()),this._localCameraTransceiver||(this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}replaceAudioTrack(e){return __awaiter$q(this,void 0,void 0,(function*(){return this._localAudioTransceiver&&"sendrecv"===this._localAudioTransceiver.direction?(yield this._localAudioTransceiver.sender.replaceTrack(e),!0):(this.logger.info("audio transceiver direction is not set up or not activated"),!1)}))}setAudioInput(e){return __awaiter$q(this,void 0,void 0,(function*(){yield this.setTransceiverInput(this._localAudioTransceiver,e)}))}setVideoInput(e){return __awaiter$q(this,void 0,void 0,(function*(){yield this.setTransceiverInput(this._localCameraTransceiver,e)}))}updateVideoTransceivers(e,t){if(!this.useTransceivers())return t.array();const i=this.peer.getTransceivers();return this.videoSubscriptions=[0],t=t.clone(),this.updateTransceivers(i,e,t),this.logger.debug((()=>this.debugDumpTransceivers())),this.videoSubscriptions}updateTransceivers(e,t,i){const n=i.array();0===e.length||e[0].stop?0!==e.length&&this.updateTransceiverWithStop(e,t,n):(this.logger.info("Updating transceivers without `stop` function"),this.updateTransceiverWithoutStop(e,t,n));for(const e of n){const i=this.addTransceiver("video",{direction:"recvonly",streams:[new MediaStream]});this.streamIdToTransceiver.set(e,i),this.groupIdToTransceiver.set(t.groupIdForStreamId(e),i),this.videoSubscriptions.push(e),this.logger.info(`adding transceiver mid: ${i.mid} subscription: ${e} direction: recvonly`)}}updateTransceiverWithStop(e,t,i){let n=1;this.videoSubscriptions=[0];for(const r of e){if(r===this._localCameraTransceiver||!this.transceiverIsVideo(r)||!r.mid)continue;let e=!1;const o=t.streamIdForTrack("v_"+r.mid);if("inactive"!==r.direction&&void 0!==o)for(const[a,s]of i.entries())if(t.StreamIdsInSameGroup(o,s)){r.direction="recvonly",this.videoSubscriptions[n]=s,e=!0,this.streamIdToTransceiver.delete(o),this.streamIdToTransceiver.set(s,r),i.splice(a,1);break}if(!e){this.videoSubscriptions[n]=0,this.logger.info(`Stopping MID: ${r.mid}, direction: ${r.direction}, current direction: ${r.currentDirection}`),r.stop();for(const[e,i]of this.streamIdToTransceiver.entries())r.mid===i.mid&&(this.streamIdToTransceiver.delete(e),this.groupIdToTransceiver.delete(t.groupIdForStreamId(e)))}n+=1}}updateTransceiverWithoutStop(e,t,i){let n=1;for(const r of e)if(r!==this._localCameraTransceiver&&this.transceiverIsVideo(r)){if(this.videoSubscriptions[n]=0,"inactive"!==r.direction){const e=t.streamIdForTrack("v_"+r.mid);if(void 0!==e)for(const[o,a]of i.entries())if(t.StreamIdsInSameGroup(e,a)){r.direction="recvonly",this.videoSubscriptions[n]=a,this.streamIdToTransceiver.delete(e),this.streamIdToTransceiver.set(a,r),i.splice(o,1);break}}n+=1}n=1;for(const r of e)if(r!==this._localCameraTransceiver&&this.transceiverIsVideo(r)){if("inactive"===r.direction&&i.length>0){r.direction="recvonly";const e=i.shift();this.videoSubscriptions[n]=e,this.streamIdToTransceiver.set(e,r),this.groupIdToTransceiver.set(t.groupIdForStreamId(e),r)}else if(0===this.videoSubscriptions[n]){r.direction="inactive";for(const[e,i]of this.streamIdToTransceiver.entries())r===i&&(this.streamIdToTransceiver.delete(e),this.groupIdToTransceiver.delete(t.groupIdForStreamId(e)))}n+=1}}getMidForStreamId(e){var t;return null===(t=this.streamIdToTransceiver.get(e))||void 0===t?void 0:t.mid}setStreamIdForMid(e,t){for(const[i,n]of this.streamIdToTransceiver.entries())if(n.mid===e)return this.streamIdToTransceiver.delete(i),void this.streamIdToTransceiver.set(t,n)}getMidForGroupId(e){var t;return null===(t=this.groupIdToTransceiver.get(e))||void 0===t?void 0:t.mid}transceiverIsVideo(e){return e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind||e.sender&&e.sender.track&&"video"===e.sender.track.kind}debugDumpTransceivers(){let e="",t=0;for(const i of this.peer.getTransceivers())this.transceiverIsVideo(i)&&(e+=`transceiver index=${t} mid=${i.mid} subscription=${this.videoSubscriptions[t]} direction=${i.direction}\n`,t+=1);return e}setTransceiverInput(e,t){return __awaiter$q(this,void 0,void 0,(function*(){e&&(e.direction=t?"sendrecv":"inactive",yield e.sender.replaceTrack(t))}))}forEachRedMetricsObserver(e){for(const t of this.redMetricsObservers)AsyncScheduler_1$3.default.nextTick((()=>{this.redMetricsObservers.has(t)&&t.recoveryMetricsDidReceive(e)}))}disableAudioRedundancy(){this.meetingSessionContext.audioProfile=new AudioProfile_1.default(this.meetingSessionContext.audioProfile.audioBitrateBps,!1),this.meetingSessionContext.audioVideoController.setAudioProfile(this.meetingSessionContext.audioProfile)}setupAudioRedWorker(){var e,t;const i=!!window.RTCRtpScriptTransform,n=!!RTCRtpSender.prototype.createEncodedStreams;if(i)this.logger.info("[AudioRed] Supports encoded insertable streams using RTCRtpScriptTransform");else{if(!n)throw this.disableAudioRedundancy(),new Error("[AudioRed] Encoded insertable streams not supported. Recreating peer connection with audio redundancy disabled.");this.logger.info("[AudioRed] Supports encoded insertable streams using TransformStream")}try{this.audioRedWorkerURL=URL.createObjectURL(new Blob([RedundantAudioEncoderWorkerCode_1.default],{type:"application/javascript"})),this.logger.info(`[AudioRed] Redundant audio worker URL ${this.audioRedWorkerURL}`),this.audioRedWorker=new Worker(this.audioRedWorkerURL)}catch(e){throw this.logger.error(`[AudioRed] Unable to create audio red worker due to ${e}`),URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker=null,this.disableAudioRedundancy(),this.logger.info("[AudioRed] Recreating peer connection with audio redundancy disabled"),e}if(this.audioRedEnabled=!0,this.audioRedWorker.onmessage=e=>{if("REDWorkerLog"===e.data.type)this.logger.info(e.data.log);else if("RedundantAudioEncoderStats"===e.data.type){const t=new RedundantAudioRecoveryMetricReport_1.default;t.currentTimestampMs=Date.now(),t.ssrc=e.data.ssrc,t.totalAudioPacketsLost=e.data.totalAudioPacketsLost,t.totalAudioPacketsExpected=e.data.totalAudioPacketsExpected,t.totalAudioPacketsRecoveredRed=e.data.totalAudioPacketsRecoveredRed,t.totalAudioPacketsRecoveredFec=e.data.totalAudioPacketsRecoveredFec,this.forEachRedMetricsObserver(t)}},i)this._localAudioTransceiver.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"SenderTransform"}),this._localAudioTransceiver.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"ReceiverTransform"});else if(n){const e=this._localAudioTransceiver.sender.createEncodedStreams(),t=this._localAudioTransceiver.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"StartRedWorker",send:e,receive:t},[e.readable,e.writable,t.readable,t.writable])}null===(e=this.meetingSessionContext)||void 0===e||e.audioVideoController.addObserver(this),this.addRedundantAudioRecoveryMetricsObserver(null===(t=this.meetingSessionContext)||void 0===t?void 0:t.statsCollector)}addTransceiver(e,t){var i;const n=this.peer.addTransceiver(e,t);if(!(null===(i=this.peer.getConfiguration())||void 0===i?void 0:i.encodedInsertableStreams)||!this.audioRedWorker)return n;const r=!!window.RTCRtpScriptTransform,o=!!RTCRtpSender.prototype.createEncodedStreams;if(r)n.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"}),n.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"});else if(o){const e=n.sender.createEncodedStreams();e.readable.pipeTo(e.writable);const t=n.receiver.createEncodedStreams();t.readable.pipeTo(t.writable)}return n}destroyAudioRedWorkerAndStates(){var e,t;this.audioRedWorker&&(URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker=null,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.audioRedEnabled=!0,null===(e=this.meetingSessionContext)||void 0===e||e.audioVideoController.removeObserver(this),this.removeRedundantAudioRecoveryMetricsObserver(null===(t=this.meetingSessionContext)||void 0===t?void 0:t.statsCollector))}setAudioPayloadTypes(e){this.audioRedWorker&&(this.audioRedWorker.postMessage({msgType:"RedPayloadType",payloadType:e.get("red")}),this.audioRedWorker.postMessage({msgType:"OpusPayloadType",payloadType:e.get("opus")}))}metricsDidReceive(e){const{currentTimestampMs:t}=e,i=e.getRTCStatsReport();let n=0,r=0,o=0;i.forEach((e=>{"audio"===e.kind&&("outbound-rtp"===e.type?r=e.packetsSent:"remote-inbound-rtp"===e.type&&(n=e.timestamp,o=e.packetsLost))})),(0===this.audioMetricsHistory.length||n>this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs&&r>this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent)&&this.audioMetricsHistory.push({timestampMs:n,totalPacketsSent:r,totalPacketsLost:o}),this.audioMetricsHistory.length>this.maxAudioMetricsHistory&&this.audioMetricsHistory.shift();const a=this.lossPercent(this.audioRedPacketLossShortEvalPeriodMs),s=this.lossPercent(this.audioRedPacketLossLongEvalPeriodMs),d=Math.max(a,s),[l,c]=RedundantAudioEncoder_1.default.getNumRedundantEncodingsForPacketLoss(d);if(c)return this.lastHighPacketLossEventTimestampMs=t,void(this.audioRedEnabled&&(this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Disable"}),this.audioRedEnabled=!1,this.lastAudioRedTurnOffTimestampMs=t));if(!this.audioRedEnabled){const e=t-this.lastAudioRedTurnOffTimestampMs,i=t-this.lastHighPacketLossEventTimestampMs;if(e>=this.audioRedPacketLossLongEvalPeriodMs&&i<this.redRecoveryTimeMs)return;this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Enable"}),this.audioRedEnabled=!0,this.maybeResetHoldDownTimer(t)}this.shouldUpdateAudioRedWorkerEncodings(t,l)&&this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"UpdateNumRedundantEncodings",numRedundantEncodings:l})}maybeResetHoldDownTimer(e){this.currentNumRedundantEncodings>0&&(this.lastRedHolddownTimerStartTimestampMs=e)}lossPercent(e){if(this.audioMetricsHistory.length<2)return 0;const t=this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs,i=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent,n=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsLost;for(let r=this.audioMetricsHistory.length-2;r>=0;r--)if(t-this.audioMetricsHistory[r].timestampMs>=e){const e=(n-this.audioMetricsHistory[r].totalPacketsLost)/(i-this.audioMetricsHistory[r].totalPacketsSent)*100;return Math.max(0,Math.min(e,100))}return 0}shouldUpdateAudioRedWorkerEncodings(e,t){return this.currentNumRedundantEncodings===t?(this.maybeResetHoldDownTimer(e),!1):!(t<this.currentNumRedundantEncodings&&e-this.lastRedHolddownTimerStartTimestampMs<this.audioRedHoldDownTimeMs)&&(this.currentNumRedundantEncodings=t,this.maybeResetHoldDownTimer(e),!0)}addRedundantAudioRecoveryMetricsObserver(e){this.redMetricsObservers.add(e)}removeRedundantAudioRecoveryMetricsObserver(e){this.redMetricsObservers.delete(e)}}DefaultTransceiverController$1.default=DefaultTransceiverController;var SimulcastContentShareTransceiverController$1={},SimulcastTransceiverController$1={},__awaiter$p=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$E=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SimulcastTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1$1=__importDefault$E(DefaultTransceiverController$1);class SimulcastTransceiverController extends DefaultTransceiverController_1$1.default{constructor(e,t,i){super(e,t,i),this.videoQualityControlParameterMap=new Map;let n=4;for(let e=0;e<SimulcastTransceiverController.NAME_ARR_ASCENDING.length;e++){const t=SimulcastTransceiverController.NAME_ARR_ASCENDING[e];this.videoQualityControlParameterMap.set(t,{rid:t,scaleResolutionDownBy:n,maxBitrate:1e3*SimulcastTransceiverController.BITRATE_ARR_ASCENDING[e]}),n/=2}}setEncodingParameters(e){return __awaiter$p(this,void 0,void 0,(function*(){if(!this._localCameraTransceiver||"sendrecv"!==this._localCameraTransceiver.direction)return;const t=this._localCameraTransceiver.sender,i=Array.from(e.values());if(i.length<=0)return;const n=t.getParameters();if(n.encodings)for(let t=0;t<n.encodings.length;t++)n.encodings[t].rid===SimulcastTransceiverController.LOW_LEVEL_NAME&&this.copyEncodingParams(e.get(SimulcastTransceiverController.LOW_LEVEL_NAME),n.encodings[t]),n.encodings[t].rid===SimulcastTransceiverController.MID_LEVEL_NAME&&this.copyEncodingParams(e.get(SimulcastTransceiverController.MID_LEVEL_NAME),n.encodings[t]),n.encodings[t].rid===SimulcastTransceiverController.HIGH_LEVEL_NAME&&this.copyEncodingParams(e.get(SimulcastTransceiverController.HIGH_LEVEL_NAME),n.encodings[t]);else n.encodings=i;yield t.setParameters(n),this.logVideoTransceiverParameters()}))}setVideoSendingBitrateKbps(e){return __awaiter$p(this,void 0,void 0,(function*(){}))}setupLocalTransceivers(){var e,t;if(this.useTransceivers()&&(this.defaultMediaStream||"undefined"==typeof MediaStream||(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),(null===(t=null===(e=this.meetingSessionContext)||void 0===e?void 0:e.audioProfile)||void 0===t?void 0:t.hasRedundancyEnabled())&&this.setupAudioRedWorker()),!this._localCameraTransceiver)){const e=Array.from(this.videoQualityControlParameterMap.values());this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream],sendEncodings:e})}}logVideoTransceiverParameters(){const e=this._localCameraTransceiver.sender.getParameters().encodings;let t="simulcast: current encoding parameters \n";for(const i of e)t+=`rid=${i.rid} maxBitrate=${i.maxBitrate} active=${i.active} scaleDownBy=${i.scaleResolutionDownBy} maxFrameRate = ${i.maxFramerate} \n`;this.logger.info(t)}copyEncodingParams(e,t){t.active=e.active,t.maxBitrate=e.maxBitrate,t.scaleResolutionDownBy=e.scaleResolutionDownBy,t.maxFramerate=e.maxFramerate}}SimulcastTransceiverController$1.default=SimulcastTransceiverController,SimulcastTransceiverController.LOW_LEVEL_NAME="low",SimulcastTransceiverController.MID_LEVEL_NAME="mid",SimulcastTransceiverController.HIGH_LEVEL_NAME="hi",SimulcastTransceiverController.NAME_ARR_ASCENDING=["low","mid","hi"],SimulcastTransceiverController.BITRATE_ARR_ASCENDING=[200,400,1100];var __awaiter$o=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$D=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SimulcastContentShareTransceiverController$1,"__esModule",{value:!0});const SimulcastTransceiverController_1$1=__importDefault$D(SimulcastTransceiverController$1);class SimulcastContentShareTransceiverController extends SimulcastTransceiverController_1$1.default{constructor(e,t,i){super(e,t,i);let n=2;this.videoQualityControlParameterMap=new Map;for(let e=0;e<SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING.length;e++){const t=SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING[e];this.videoQualityControlParameterMap.set(t,{rid:t,scaleResolutionDownBy:n,maxBitrate:1e3*SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING[e]}),n/=2}}setEncodingParameters(e){return __awaiter$o(this,void 0,void 0,(function*(){if(!this._localCameraTransceiver||"sendrecv"!==this._localCameraTransceiver.direction)return;const t=this._localCameraTransceiver.sender,i=Array.from(e.values());if(i.length<=0)return;const n=t.getParameters();if(n.encodings)for(let t=0;t<n.encodings.length;t++)n.encodings[t].rid===SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME&&this.copyEncodingParams(e.get(SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME),n.encodings[t]),n.encodings[t].rid===SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME&&this.copyEncodingParams(e.get(SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME),n.encodings[t]);else n.encodings=i;yield t.setParameters(n),this.logVideoTransceiverParameters()}))}}SimulcastContentShareTransceiverController$1.default=SimulcastContentShareTransceiverController,SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING=["low","hi"],SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING=[300,1200];var VideoOnlyTransceiverController$1={},__importDefault$C=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoOnlyTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1=__importDefault$C(DefaultTransceiverController$1);class VideoOnlyTransceiverController extends DefaultTransceiverController_1.default{constructor(e,t,i){super(e,t,i)}setupLocalTransceivers(){this.useTransceivers()&&(this.defaultMediaStream||"undefined"==typeof MediaStream||(this.defaultMediaStream=new MediaStream),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}}VideoOnlyTransceiverController$1.default=VideoOnlyTransceiverController;var DefaultVideoCaptureAndEncodeParameter$1={};Object.defineProperty(DefaultVideoCaptureAndEncodeParameter$1,"__esModule",{value:!0});class DefaultVideoCaptureAndEncodeParameter{constructor(e,t,i,n,r,o=1,a=!1){this.cameraWidth=e,this.cameraHeight=t,this.cameraFrameRate=i,this.maxEncodeBitrateKbps=n,this.isSimulcast=r,this.scaleResolutionDownBy=o,this.isSVC=a}equal(e){let t=e.captureWidth()===this.cameraWidth&&e.captureHeight()===this.cameraHeight&&e.captureFrameRate()===this.cameraFrameRate&&e.encodeBitrates().length===this.encodeBitrates().length&&e.encodeScaleResolutionDownBy().length===this.encodeScaleResolutionDownBy().length&&e.encodeWidths().length===this.encodeWidths().length&&e.encodeHeights().length===this.encodeHeights().length&&e.isSVCEncoding()===this.isSVC;if(t)for(let i=0;i<e.encodeWidths().length;i++)if(e.encodeWidths()[i]!==this.encodeWidths()[i]||e.encodeHeights()[i]!==this.encodeHeights()[i]||e.encodeBitrates()[i]!==this.encodeBitrates()[i]||e.encodeScaleResolutionDownBy()[i]!==this.encodeScaleResolutionDownBy()[i])return t=!1,t;return t}clone(){return new DefaultVideoCaptureAndEncodeParameter(this.cameraWidth,this.cameraHeight,this.cameraFrameRate,this.maxEncodeBitrateKbps,this.isSimulcast,this.scaleResolutionDownBy,this.isSVC)}captureWidth(){return this.cameraWidth}captureHeight(){return this.cameraHeight}captureFrameRate(){return this.cameraFrameRate}encodeBitrates(){return[this.maxEncodeBitrateKbps]}encodeScaleResolutionDownBy(){return[this.scaleResolutionDownBy]}encodeWidths(){return[this.cameraWidth]}encodeHeights(){return[this.cameraHeight]}isSVCEncoding(){return this.isSVC}}DefaultVideoCaptureAndEncodeParameter$1.default=DefaultVideoCaptureAndEncodeParameter;var VideoAdaptiveProbePolicy$1={},VideoPreference$1={},TargetDisplaySize={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TargetDisplaySize=void 0,function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High",e[e.Maximum=3]="Maximum"}(t=e.TargetDisplaySize||(e.TargetDisplaySize={})),e.default=t}(TargetDisplaySize);var __importDefault$B=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoPreference$1,"__esModule",{value:!0});const TargetDisplaySize_1$1=__importDefault$B(TargetDisplaySize),VideoQualityAdaptationPreference_1$1=__importDefault$B(VideoQualityAdaptationPreference);class VideoPreference{constructor(e,t,i,n){this.attendeeId=e,this.priority=t,this.targetSize=void 0!==i?i:TargetDisplaySize_1$1.default.Maximum,this.degradationPreference=void 0!==n?n:VideoQualityAdaptationPreference_1$1.default.Balanced}partialCompare(e){return this.priority-e.priority}equals(e){return this.attendeeId===e.attendeeId&&this.targetSize===e.targetSize&&this.priority===e.priority&&this.degradationPreference===e.degradationPreference}clone(){return new VideoPreference(this.attendeeId,this.priority,this.targetSize,this.degradationPreference)}targetSizeToBitrateKbps(e){switch(e){case TargetDisplaySize_1$1.default.Maximum:return VideoPreference.MAXIMUM_BITRATE_KBPS;case TargetDisplaySize_1$1.default.High:return VideoPreference.HIGH_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Medium:return VideoPreference.MID_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Low:return VideoPreference.LOW_BITRATE_KBPS}}}VideoPreference$1.default=VideoPreference,VideoPreference.LOW_BITRATE_KBPS=300,VideoPreference.MID_BITRATE_KBPS=600,VideoPreference.HIGH_BITRATE_KBPS=1500,VideoPreference.MAXIMUM_BITRATE_KBPS=1e4;var VideoPriorityBasedPolicy$1={},VideoSource$1={};Object.defineProperty(VideoSource$1,"__esModule",{value:!0});class VideoSource{}VideoSource$1.default=VideoSource;var VideoPriorityBasedPolicyConfig$1={},__importDefault$A=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoPriorityBasedPolicyConfig$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$1=__importDefault$A(ServerSideNetworkAdaption);class VideoPriorityBasedPolicyConfig{constructor(e=0,t=0){this.networkIssueResponseDelayFactor=e,this.networkIssueRecoveryDelayFactor=t,this.currentNetworkEvent=0,this.bandwidthDecreaseTimestamp=0,this.referenceBitrate=0,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$1.default.Default,e<0?e=0:e>1&&(e=1),this.networkIssueResponseDelayFactor=e,t<0?t=0:t>1&&(t=1),this.networkIssueRecoveryDelayFactor=t}allowSubscribe(e,t){let i=0;const n=this.currentNetworkEvent;if(t>this.referenceBitrate)return this.currentNetworkEvent=2,this.referenceBitrate=t,!0;if(t<this.referenceBitrate){if(this.currentNetworkEvent=1,i=this.getSubscribeDelay(this.currentNetworkEvent,e),1!==n)this.bandwidthDecreaseTimestamp=Date.now();else if(Date.now()-this.bandwidthDecreaseTimestamp>i)return this.referenceBitrate=t,!0;return!1}return this.currentNetworkEvent=0,!1}getSubscribeDelay(e,t){let i=VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS;const n=VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS-VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS,r=this.networkIssueResponseDelayFactor;if(1===e)i+=n*r*(1+t/10),i=Math.min(VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS,i);return i}}VideoPriorityBasedPolicyConfig$1.default=VideoPriorityBasedPolicyConfig,VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS=2e3,VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS=8e3,VideoPriorityBasedPolicyConfig.Default=new VideoPriorityBasedPolicyConfig(0,0),VideoPriorityBasedPolicyConfig.UnstableNetworkPreset=new VideoPriorityBasedPolicyConfig(0,1),VideoPriorityBasedPolicyConfig.StableNetworkPreset=new VideoPriorityBasedPolicyConfig(1,0);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding$1(t,e,i);return __setModuleDefault(t,e),t},__importDefault$z=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoPriorityBasedPolicy$1,"__esModule",{value:!0});const Attendee_1=__importDefault$z(Attendee$1),ClientMetricReportDirection_1=__importDefault$z(ClientMetricReportDirection),ClientMetricReportMediaType_1=__importDefault$z(ClientMetricReportMediaType),ContentShareConstants_1$2=__importDefault$z(ContentShareConstants$1),LogLevel_1$4=LogLevel,ServerSideNetworkAdaption_1=__importStar$1(ServerSideNetworkAdaption),VideoSource_1=__importDefault$z(VideoSource$1),DefaultVideoStreamIdSet_1$2=__importDefault$z(DefaultVideoStreamIdSet$1),AllHighestVideoBandwidthPolicy_1=__importDefault$z(AllHighestVideoBandwidthPolicy$1),TargetDisplaySize_1=__importDefault$z(TargetDisplaySize),VideoPreference_1$1=__importDefault$z(VideoPreference$1),VideoPreferences_1$1=VideoPreferences$1,VideoPriorityBasedPolicyConfig_1=__importDefault$z(VideoPriorityBasedPolicyConfig$1),VideoQualityAdaptationPreference_1=__importDefault$z(VideoQualityAdaptationPreference);class LinkMediaStats{constructor(){this.bandwidthEstimateKbps=0,this.usedBandwidthKbps=0,this.packetsLost=0,this.nackCount=0,this.rttMs=0}}class VideoPriorityBasedPolicy{constructor(e,t=VideoPriorityBasedPolicyConfig_1.default.Default){this.logger=e,this.videoPriorityBasedPolicyConfig=t,this.shouldPauseTiles=!0,this.observerQueue=new Set,this.pausedBwAttendeeIds=new Set,this.wantsResubscribeObserver=void 0,this.reset()}reset(){this.allHighestPolicy=new AllHighestVideoBandwidthPolicy_1.default(""),this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.optimalReceiveStreams=[],this.optimalNonPausedReceiveStreams=[],this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.subscribedReceiveStreams=[],this.videoPreferences=void 0,this.defaultVideoPreferences=void 0,this.shouldPauseTiles=!0,this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default,this.pausedBwAttendeeIds=new Set,this.videoPreferencesUpdated=!1,this.logCount=0,this.startupPeriod=!0,this.usingPrevTargetRate=!1,this.rateProbeState="Not Probing",this.firstEstimateTimestamp=0,this.lastUpgradeRateKbps=0,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.lastProbeTimestamp=Date.now(),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,this.downlinkStats=new LinkMediaStats,this.prevDownlinkStats=new LinkMediaStats,this.probeFailed=!1,this.serverSideNetworkAdaption=this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption,this.pendingActionAfterUpdatedPreferences=!1}bindToTileController(e){this.tileController=e,this.logger.info("tileController bound")}setWantsResubscribeObserver(e){this.wantsResubscribeObserver=e}chooseRemoteVideoSources(e){var t;if(!(null===(t=this.videoPreferences)||void 0===t?void 0:t.equals(e)))if(this.videoPreferences=null==e?void 0:e.clone(),ServerSideNetworkAdaption_1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)||(this.pendingActionAfterUpdatedPreferences=!0,void 0!==this.wantsResubscribeObserver&&(this.wantsResubscribeObserver(),this.pendingActionAfterUpdatedPreferences=!1),this.serverSideNetworkAdaption!==ServerSideNetworkAdaption_1.default.BandwidthProbingAndRemoteVideoQualityAdaption))this.videoPreferencesUpdated=!0,this.logger.info(`bwe: setVideoPreferences bwe: new preferences: ${JSON.stringify(e)}`);else{const e=new Array;for(const t of this.videoPreferences){const i=new VideoSource_1.default;i.attendee=new Attendee_1.default,i.attendee.attendeeId=t.attendeeId,e.push(i)}this.allHighestPolicy.chooseRemoteVideoSources(e)}}updateIndex(e){this.videoIndex=e,this.serverSideNetworkAdaption===ServerSideNetworkAdaption_1.default.BandwidthProbingAndRemoteVideoQualityAdaption&&this.allHighestPolicy.updateIndex(e),this.videoPreferences||this.updateDefaultVideoPreferences()}updateDefaultVideoPreferences(){const e=new Set;for(const t of this.videoIndex.remoteStreamDescriptions())e.add(t.attendeeId);const t=VideoPreferences_1$1.VideoPreferences.prepare(),i=e.size;let n=TargetDisplaySize_1.default.Maximum;i>8?n=TargetDisplaySize_1.default.Low:i>4&&(n=TargetDisplaySize_1.default.Medium);for(const i of e)t.add(new VideoPreference_1$1.default(i,1,n));this.defaultVideoPreferences=t.build()}updateMetrics(e){if(!this.videoIndex||this.videoIndex.allStreams().empty())return;this.prevDownlinkStats=this.downlinkStats,this.downlinkStats=new LinkMediaStats;const t=e.getObservableMetrics();this.downlinkStats.bandwidthEstimateKbps=t.availableIncomingBitrate/1e3;for(const t in e.streamMetricReports){const i=Number.parseInt(t,10),n=e.streamMetricReports[i];n.direction===ClientMetricReportDirection_1.default.DOWNSTREAM&&n.mediaType===ClientMetricReportMediaType_1.default.VIDEO&&(n.currentMetrics.hasOwnProperty("nackCount")&&(this.downlinkStats.nackCount+=e.countPerSecond("nackCount",i)),n.currentMetrics.hasOwnProperty("packetsLost")&&(this.downlinkStats.packetsLost+=e.countPerSecond("packetsLost",i)),n.currentMetrics.hasOwnProperty("bytesReceived")&&(this.downlinkStats.usedBandwidthKbps+=e.bitsPerSecond("bytesReceived",i)/1e3))}}wantsResubscribe(){let e=!1;return ServerSideNetworkAdaption_1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)||(e||(e=this.pendingActionAfterUpdatedPreferences),this.serverSideNetworkAdaption!==ServerSideNetworkAdaption_1.default.BandwidthProbingAndRemoteVideoQualityAdaption)?(this.calculateOptimalReceiveSet(),e||(e=!this.subscribedReceiveSet.equal(this.optimalReceiveSet)),e):e||this.allHighestPolicy.wantsResubscribe()}chooseSubscriptions(){return ServerSideNetworkAdaption_1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)||(this.pendingActionAfterUpdatedPreferences=!1,this.serverSideNetworkAdaption!==ServerSideNetworkAdaption_1.default.BandwidthProbingAndRemoteVideoQualityAdaption)?(this.subscribedReceiveSet.equal(this.optimalReceiveSet)||(this.lastSubscribeTimestamp=Date.now()),this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveStreams=this.optimalReceiveStreams.slice(),this.subscribedReceiveSet.clone()):this.allHighestPolicy.chooseSubscriptions()}addObserver(e){this.observerQueue.add(e)}removeObserver(e){this.observerQueue.delete(e)}forEachObserver(e){for(const t of this.observerQueue)e(t)}setVideoPriorityBasedPolicyConfigs(e){this.videoPriorityBasedPolicyConfig=e}calculateOptimalReceiveStreams(){var e;const t=[],i=this.videoIndex.remoteStreamDescriptions();if(0===i.length||(null===(e=this.videoPreferences)||void 0===e?void 0:e.isEmpty()))return void(this.optimalReceiveStreams=[]);const n=this.rateProbeState;this.cleanBwPausedTiles(i),this.handleAppPausedStreams(t,i);const r=new Map;for(const e of this.getCurrentVideoPreferences())r.set(e.attendeeId,e);const o=i.filter((e=>r.has(e.attendeeId))),a=!this.streamsWithPreferenceDidChange(o),s=!this.startupPeriod&&a;if(s&&Date.now()-this.lastSubscribeTimestamp<this.timeBeforeAllowSubscribeMs)return;o.sort(((e,t)=>e.maxBitrateKbps===t.maxBitrateKbps?e.streamId-t.streamId:e.maxBitrateKbps-t.maxBitrateKbps));for(const e of o)(0===e.avgBitrateKbps||e.avgBitrateKbps>e.maxBitrateKbps)&&(e.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality)&&e.maxBitrateKbps<100?e.maxBitrateKbps=e.avgBitrateKbps:e.avgBitrateKbps=e.maxBitrateKbps);const d=new Set;for(const e of this.getCurrentVideoPreferences()){const t=o.filter((t=>t.attendeeId===e.attendeeId));if(t.length<3)continue;let i,n=15,r=153600;t.forEach((e=>{n=Math.max(n,e.maxFrameRate),r=Math.max(r,e.totalPixels())})),t.sort(((t,i)=>{if(e.degradationPreference===VideoQualityAdaptationPreference_1.default.MaintainResolution)return Math.abs(t.maxFrameRate-i.maxFrameRate)<2?t.totalPixels()-i.totalPixels():t.maxFrameRate-i.maxFrameRate;if(e.degradationPreference===VideoQualityAdaptationPreference_1.default.MaintainFramerate)return t.totalPixels()===i.totalPixels()?t.maxFrameRate-i.maxFrameRate:t.totalPixels()-i.totalPixels();{const e=5,o=2,a=t=>t.avgBitrateKbps*Math.pow(2,e*t.maxFrameRate/n*Math.pow(2*o,t.totalPixels()/r));return a(t)-a(i)}}));for(const e of t)void 0!==i&&(e.maxFrameRate<i.maxFrameRate&&Math.abs(i.maxFrameRate-e.maxFrameRate)>2||e.totalPixels()<i.totalPixels())?d.add(e.streamId):i=e}const l=o.filter((e=>!d.has(e.streamId)));this.logger.info(`Filtered to ${JSON.stringify(l)}`);const c={targetDownlinkBitrate:0,chosenTotalBitrate:0,deltaToNextUpgrade:0};c.targetDownlinkBitrate=this.determineTargetRate();const u=this.subscribedReceiveSet.size(),h=this.downlinkStats.bandwidthEstimateKbps,p=!this.videoPriorityBasedPolicyConfig.allowSubscribe(u,h);if(this.probeFailed&&(this.probeFailed=!1,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,s&&p))return;const m=this.priorityPolicy(c,l,t);let f=0;if(!ServerSideNetworkAdaption_1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)||this.startupPeriod||!a?(this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0):"Probing"===this.rateProbeState?f=this.handleProbe(t,c.targetDownlinkBitrate):0!==c.deltaToNextUpgrade&&(f=this.maybeOverrideOrProbe(t,c,m)),this.previousStreamsWithPreference=o,this.videoPreferencesUpdated=!1,1===f)return this.logger.info(`bwe: keepSameSubscriptions stats:${JSON.stringify(this.downlinkStats)}`),void(this.prevTargetRateKbps=c.targetDownlinkBitrate);if(2===f){const e=this.calculateSubscribeRate(this.preProbeNonPausedReceiveStreams);return this.optimalReceiveStreams=this.preProbeReceiveStreams.slice(),this.processBwPausedStreams(o,this.preProbeNonPausedReceiveStreams),void this.logger.info("bwe: Use Pre-Probe subscription subscribedRate:"+e)}this.optimalNonPausedReceiveStreams=t.slice();const g=this.pausedBwAttendeeIds.size;this.processBwPausedStreams(o,t),this.logger.getLogLevel()<=LogLevel_1$4.LogLevel.INFO&&(this.logCount%15==0||this.rateProbeState!==n||this.optimalReceiveStreams.length!==t.length||g!==this.pausedBwAttendeeIds.size)&&(this.logger.info(this.policyStateLogStr(i,c.targetDownlinkBitrate)),this.logCount=0),this.logCount++,this.prevTargetRateKbps=c.targetDownlinkBitrate,this.optimalReceiveStreams=t.slice()}calculateOptimalReceiveSet(){const e=new DefaultVideoStreamIdSet_1$2.default;this.calculateOptimalReceiveStreams();for(const t of this.optimalReceiveStreams)e.add(t.streamId);if(!this.optimalReceiveSet.equal(e)){const t=this.calculateSubscribeRate(this.optimalReceiveStreams);this.logger.info(`bwe: new streamSelection: ${JSON.stringify(e)} subscribedRate:${t}`)}this.optimalReceiveSet=e}determineTargetRate(){let e=0;const t=Date.now();return 0!==this.downlinkStats.bandwidthEstimateKbps?(0===this.firstEstimateTimestamp&&(this.firstEstimateTimestamp=t),this.startupPeriod&&(this.downlinkStats.bandwidthEstimateKbps>VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS||this.downlinkStats.packetsLost>0||t-this.firstEstimateTimestamp>VideoPriorityBasedPolicy.STARTUP_PERIOD_MS&&this.downlinkStats.bandwidthEstimateKbps<=this.prevDownlinkStats.bandwidthEstimateKbps)&&(this.startupPeriod=!1,this.prevTargetRateKbps=this.downlinkStats.bandwidthEstimateKbps),this.startupPeriod?e=VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:"Probing"===this.rateProbeState&&this.downlinkStats.usedBandwidthKbps>this.downlinkStats.bandwidthEstimateKbps&&this.downlinkStats.packetsLost<VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD?(this.logger.info(`bwe: In probe state, overriding estimate ${this.downlinkStats.bandwidthEstimateKbps} with actual receive bitrate ${this.downlinkStats.usedBandwidthKbps}`),e=this.downlinkStats.usedBandwidthKbps+VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS):e=this.downlinkStats.bandwidthEstimateKbps):e=0===this.firstEstimateTimestamp?VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:this.prevTargetRateKbps,!this.startupPeriod&&(this.usingPrevTargetRate&&this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps||this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps*(100-VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT)/100||this.downlinkStats.bandwidthEstimateKbps<this.downlinkStats.usedBandwidthKbps*VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT/100)&&0===this.downlinkStats.packetsLost?(this.logger.debug((()=>"bwe: ValidateRate: Using Previous rate "+this.prevTargetRateKbps)),this.usingPrevTargetRate=!0,e=this.prevTargetRateKbps):this.usingPrevTargetRate=!1,e>15e3&&this.logger.warn("bwe: "+e+" exceeds maximum limit (15000). Limit TargetDisplaySize with VideoPreferences to avoid this."),Math.min(e,15e3)}setProbeState(e){if(this.rateProbeState===e)return!1;const t=Date.now();switch(e){case"Not Probing":this.probePendingStartTimestamp=0;break;case"Probe Pending":if(!(0===this.lastProbeTimestamp||t-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS))return!1;this.probePendingStartTimestamp=t;break;case"Probing":if(!(t-this.probePendingStartTimestamp>this.timeBeforeAllowProbeMs))return!1;this.lastProbeTimestamp=t,this.preProbeReceiveStreams=this.subscribedReceiveStreams.slice(),this.preProbeNonPausedReceiveStreams=this.optimalNonPausedReceiveStreams,this.timeBeforeAllowProbeMs=Math.min(2*this.timeBeforeAllowProbeMs,VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS)}return this.logger.info("bwe: setProbeState to "+e+" from "+this.rateProbeState),this.rateProbeState=e,!0}upgradeToStream(e,t){for(let i=0;i<e.length;i++)if(e[i].groupId===t.groupId){const n=t.avgBitrateKbps-e[i].avgBitrateKbps;return this.logger.info("bwe: upgradeStream from "+JSON.stringify(e[i])+" to "+t),this.lastUpgradeRateKbps=n,e[i]=t,n}return e.push(t),this.lastUpgradeRateKbps=t.avgBitrateKbps,this.lastUpgradeRateKbps}handleProbe(e,t){if(Date.now()-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS)return this.logger.info("bwe: Canceling probe due to timeout"),this.setProbeState("Not Probing"),0;if(this.downlinkStats.packetsLost>0&&(this.logger.info(`bwe: Probe encountering packets lost:${this.downlinkStats.packetsLost}`),this.downlinkStats.packetsLost>VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD))return this.setProbeState("Not Probing"),this.logger.info(`bwe: Canceling probe due to packets lost:${this.downlinkStats.packetsLost}`),this.probeFailed=!0,this.timeBeforeAllowSubscribeMs=3*Math.max(VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.timeBeforeAllowSubscribeMs),2;const i=this.calculateSubscribeRate(this.optimalReceiveStreams);return this.chosenStreamsSameAsLast(e)||t>i?(this.logger.info("bwe: Probe successful"),this.setProbeState("Not Probing"),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,0):1}maybeOverrideOrProbe(e,t,i){const n=this.chosenStreamsSameAsLast(e);let r=0;const o=t.targetDownlinkBitrate>VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS?VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT:2*VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT,a=t.targetDownlinkBitrate*o/100;if(this.targetRateBaselineForDeltaCheckKbps=void 0!==this.targetRateBaselineForDeltaCheckKbps?this.targetRateBaselineForDeltaCheckKbps:this.prevTargetRateKbps,!n&&Math.abs(t.targetDownlinkBitrate-this.targetRateBaselineForDeltaCheckKbps)<a?(this.logger.info("bwe: MaybeOverrideOrProbe: Reuse last decision based on delta rate. {"+JSON.stringify(this.subscribedReceiveSet)+"}"),r=1):this.targetRateBaselineForDeltaCheckKbps=t.targetDownlinkBitrate,this.downlinkStats.packetsLost>this.prevDownlinkStats.packetsLost)return this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0,r;if(n||1===r)switch(this.rateProbeState){case"Not Probing":this.setProbeState("Probe Pending");break;case"Probe Pending":this.setProbeState("Probing")&&(this.upgradeToStream(e,i),r=0)}else this.setProbeState("Not Probing");return r}calculateSubscribeRate(e){let t=0;for(const i of e)this.pausedStreamIds.contain(i.streamId)||this.pausedBwAttendeeIds.has(i.attendeeId)||(t+=i.maxBitrateKbps);return t}handleAppPausedStreams(e,t){if(!this.tileController)return void this.logger.warn("tileController not found!");this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default;const i=this.tileController.getAllRemoteVideoTiles();for(const n of i){const i=n.state();if(i.paused&&!this.pausedBwAttendeeIds.has(i.boundAttendeeId)){let n=t.length;for(;n--;)t[n].attendeeId===i.boundAttendeeId&&(this.logger.info("bwe: removed paused attendee "+i.boundAttendeeId+" streamId: "+t[n].streamId),this.pausedStreamIds.add(t[n].streamId),this.subscribedReceiveSet.contain(t[n].streamId)&&e.push(t[n]),t.splice(n,1))}}}processBwPausedStreams(e,t){if(!this.tileController)return void this.logger.warn("tileController not found!");const i=this.getCurrentVideoPreferences();if(i&&this.shouldPauseTiles){const n=this.tileController.getAllVideoTiles();for(const r of i){const i=this.getVideoTileForAttendeeId(r.attendeeId,n),o=(null==i?void 0:i.state().paused)||!1;if(t.some((e=>e.attendeeId===r.attendeeId)))o&&this.pausedBwAttendeeIds.has(r.attendeeId)&&(this.logger.info(`bwe: unpausing attendee ${r.attendeeId} due to bandwidth`),this.forEachObserver((e=>{e.tileWillBeUnpausedByDownlinkPolicy(i.id())})),this.tileController.unpauseVideoTile(i.id()),this.pausedBwAttendeeIds.delete(r.attendeeId));else{const n=e.some((e=>e.attendeeId===r.attendeeId));if(i&&n){const e=this.optimalReceiveStreams.find((e=>e.attendeeId===r.attendeeId));void 0!==e&&(o||(this.logger.info(`bwe: pausing streamId ${e.streamId} attendee ${r.attendeeId} due to bandwidth`),this.forEachObserver((e=>{e.tileWillBePausedByDownlinkPolicy(i.id())})),this.tileController.pauseVideoTile(i.id())),t.push(e)),this.pausedBwAttendeeIds.add(r.attendeeId)}else if(n){const e=this.tileController.addVideoTile();e.bindVideoStream(r.attendeeId,!1,null,0,0,0,null),this.forEachObserver((t=>{t.tileWillBePausedByDownlinkPolicy(e.id())})),e.pause(),this.logger.info(`bwe: Created video tile ${e.id()} for bw paused attendee ${r.attendeeId}`),this.pausedBwAttendeeIds.add(r.attendeeId)}}}}}cleanBwPausedTiles(e){if(!this.tileController)return void this.logger.warn("tileController not found!");const t=this.tileController.getAllRemoteVideoTiles(),i=this.getCurrentVideoPreferences();for(const n of t){const t=n.state();t.boundVideoStream||(e.some((e=>e.attendeeId===t.boundAttendeeId))?void 0===i||i.some((e=>e.attendeeId===t.boundAttendeeId))||this.tileController.removeVideoTile(t.tileId):(this.tileController.removeVideoTile(t.tileId),this.logger.info(`bwe: Removed video tile ${t.tileId} for bw paused attendee ${t.boundAttendeeId}`)))}}priorityPolicy(e,t,i){let n;const r=this.getCurrentVideoPreferences(),o=r.highestPriority();let a,s=o;for(;-1!==s;){a=-1;for(const o of r)if(o.priority===s)for(const r of t)r.attendeeId===o.attendeeId&&(i.some((e=>e.groupId===r.groupId))||(e.chosenTotalBitrate+r.avgBitrateKbps<=e.targetDownlinkBitrate?(i.push(r),e.chosenTotalBitrate+=r.avgBitrateKbps):0===e.deltaToNextUpgrade&&(e.deltaToNextUpgrade=r.avgBitrateKbps,n=r)));else if(o.priority>s){a=o.priority;break}for(const o of r)if(o.priority===s){for(const r of t)if(r.attendeeId===o.attendeeId){const a=i.findIndex((e=>e.groupId===r.groupId&&e.maxBitrateKbps<=r.maxBitrateKbps&&e.avgBitrateKbps<r.avgBitrateKbps));if(-1!==a){const s=r.avgBitrateKbps-i[a].avgBitrateKbps;this.hasSimulcastStreams(t,r.attendeeId,r.groupId)&&this.canUpgrade(r.avgBitrateKbps,o.targetSize,o.targetSizeToBitrateKbps(o.targetSize),r.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality))?(this.logger.info(`bwe: attendee: ${r.attendeeId} group: ${r.groupId} has simulcast and can upgrade avgBitrate: ${r.avgBitrateKbps} target: ${o.targetSizeToBitrateKbps(o.targetSize)} targetTotalBitrate: ${e.targetDownlinkBitrate}`),e.chosenTotalBitrate+s<=e.targetDownlinkBitrate?(e.chosenTotalBitrate+=s,i[a]=r):0===e.deltaToNextUpgrade&&(e.deltaToNextUpgrade=s,n=r)):this.logger.info("bwe: cannot upgrade stream quality beyond target size")}}}else if(o.priority>s)break;if(s===o&&0!==e.deltaToNextUpgrade)break;s=a}return n}getVideoTileForAttendeeId(e,t){for(const i of t){if(i.state().boundAttendeeId===e)return i}return null}canUpgrade(e,t,i,n){let r=!1;return(t===TargetDisplaySize_1.default.High||!n&&e<=i||n&&t===TargetDisplaySize_1.default.Medium&&e<=i)&&(r=!0),r?(this.logger.info(`bwe: canUpgrade: bitrateKbps: ${e} targetBitrateKbps: ${i}`),!0):(this.logger.info(`bwe: cannot Upgrade: bitrateKbps: ${e} targetBitrateKbps: ${i}`),!1)}hasSimulcastStreams(e,t,i){let n=0;for(const r of e)r.attendeeId===t&&r.groupId===i&&n++;return this.logger.info(`bwe: attendeeId: ${t} groupId: ${i} hasSimulcastStreams: streamCount: ${n}`),n>1}streamsWithPreferenceDidChange(e){if(void 0===this.previousStreamsWithPreference||e.length!==this.previousStreamsWithPreference.length||!0===this.videoPreferencesUpdated)return!0;for(const t of e){if(void 0===this.previousStreamsWithPreference.find((e=>e.groupId===t.groupId&&e.streamId===t.streamId&&e.maxBitrateKbps===t.maxBitrateKbps)))return!0}return!1}chosenStreamsSameAsLast(e){if(this.optimalNonPausedReceiveStreams.length!==e.length)return!1;for(const t of this.optimalNonPausedReceiveStreams)if(!e.some((e=>e.streamId===t.streamId)))return!1;return!0}policyStateLogStr(e,t){const i={targetBitrate:t,subscribedRate:this.calculateSubscribeRate(this.optimalReceiveStreams),probeState:this.rateProbeState,startupPeriod:this.startupPeriod};let n="remoteInfos: [";for(const t of e)n+=`{grpId:${t.groupId} strId:${t.streamId} maxBr:${t.maxBitrateKbps} avgBr:${t.avgBitrateKbps}}, `;n+="]";let r=`bwe: optimalReceiveSet ${JSON.stringify(i)}\nbwe:   prev ${JSON.stringify(this.prevDownlinkStats)}\nbwe:   now  ${JSON.stringify(this.downlinkStats)}\nbwe:   ${n}\n`;return(this.pausedStreamIds.size()>0||this.pausedBwAttendeeIds.size>0)&&(r+=`bwe:   paused: app stream ids ${JSON.stringify(this.pausedStreamIds)}  bw attendees { ${Array.from(this.pausedBwAttendeeIds).join(" ")} }\n`),this.videoPreferences?r+=`bwe:   preferences: ${JSON.stringify(this.videoPreferences)}`:r+=`bwe:   default preferences: ${JSON.stringify(this.defaultVideoPreferences)}`,r}getCurrentVideoPreferences(){return this.videoPreferences||this.defaultVideoPreferences}getServerSideNetworkAdaption(){return this.serverSideNetworkAdaption}setServerSideNetworkAdaption(e){this.serverSideNetworkAdaption=e,this.setProbeState("Not Probing")}supportedServerSideNetworkAdaptions(){return[ServerSideNetworkAdaption_1.default.None,ServerSideNetworkAdaption_1.default.BandwidthProbing,ServerSideNetworkAdaption_1.default.BandwidthProbingAndRemoteVideoQualityAdaption]}getVideoPreferences(){let e=this.getCurrentVideoPreferences();if(!e){e=VideoPreferences_1$1.VideoPreferences.prepare().build()}return e}wantsAllTemporalLayersInIndex(){return!0}}VideoPriorityBasedPolicy$1.default=VideoPriorityBasedPolicy,VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS=2800,VideoPriorityBasedPolicy.STARTUP_PERIOD_MS=6e3,VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT=20,VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT=15,VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS=300,VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS=5e3,VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS=2e3,VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS=3e4,VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS=6e4,VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD=2,VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS=100;var __importDefault$y=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoAdaptiveProbePolicy$1,"__esModule",{value:!0});const ContentShareConstants_1$1=__importDefault$y(ContentShareConstants$1),VideoPreference_1=__importDefault$y(VideoPreference$1),VideoPreferences_1=VideoPreferences$1,VideoPriorityBasedPolicy_1=__importDefault$y(VideoPriorityBasedPolicy$1);class VideoAdaptiveProbePolicy extends VideoPriorityBasedPolicy_1.default{constructor(e){super(e),this.logger=e,super.shouldPauseTiles=!1,this.videoPreferences=void 0}reset(){super.reset(),super.shouldPauseTiles=!1,this.videoPreferences=void 0}updateIndex(e){super.updateIndex(e);const t=VideoPreferences_1.VideoPreferences.prepare();let i=!1;const n=e.remoteStreamDescriptions();for(const e of n)t.some((t=>t.attendeeId===e.attendeeId))||(e.attendeeId.endsWith(ContentShareConstants_1$1.default.Modality)?(t.add(new VideoPreference_1.default(e.attendeeId,1)),i=!0):t.add(new VideoPreference_1.default(e.attendeeId,2)));i?(this.videoPreferences=t.build(),this.videoPreferencesUpdated=!0):this.videoPreferences=void 0}chooseRemoteVideoSources(e){this.logger.error("chooseRemoteVideoSources should not be called by VideoAdaptiveProbePolicy")}}VideoAdaptiveProbePolicy$1.default=VideoAdaptiveProbePolicy;var DefaultVideoStreamIndex$1={},VideoStreamDescription$1={};Object.defineProperty(VideoStreamDescription$1,"__esModule",{value:!0});const SignalingProtocol_js_1$2=SignalingProtocol;class VideoStreamDescription{constructor(e,t,i,n,r){this.attendeeId="",this.groupId=0,this.streamId=0,this.ssrc=0,this.trackLabel="",this.maxBitrateKbps=0,this.avgBitrateKbps=0,this.maxFrameRate=0,this.width=0,this.height=0,this.timeEnabled=0,this.disabledByWebRTC=!1,this.disabledByUplinkPolicy=!1,this.rid="",this.attendeeId=e,this.groupId=t,this.streamId=i,this.maxBitrateKbps=n,this.avgBitrateKbps=r}clone(){const e=new VideoStreamDescription;return e.attendeeId=this.attendeeId,e.groupId=this.groupId,e.streamId=this.streamId,e.ssrc=this.ssrc,e.trackLabel=this.trackLabel,e.maxBitrateKbps=this.maxBitrateKbps,e.avgBitrateKbps=this.avgBitrateKbps,e.maxFrameRate=this.maxFrameRate,e.timeEnabled=this.timeEnabled,e.disabledByWebRTC=this.disabledByWebRTC,e.disabledByUplinkPolicy=this.disabledByUplinkPolicy,e.width=this.width,e.height=this.height,e}toStreamDescriptor(){const e=SignalingProtocol_js_1$2.SdkStreamDescriptor.create();return e.mediaType=SignalingProtocol_js_1$2.SdkStreamMediaType.VIDEO,e.trackLabel=this.trackLabel,e.attendeeId=this.attendeeId,e.streamId=this.streamId,e.groupId=this.groupId,e.framerate=this.maxFrameRate,e.maxBitrateKbps=this.disabledByUplinkPolicy||this.disabledByWebRTC?0:this.maxBitrateKbps,e.avgBitrateBps=this.avgBitrateKbps,e}totalPixels(){return this.width*this.height}}VideoStreamDescription$1.default=VideoStreamDescription;var __importDefault$x=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1$1=SignalingProtocol,DefaultVideoStreamIdSet_1$1=__importDefault$x(DefaultVideoStreamIdSet$1),VideoStreamDescription_1$1=__importDefault$x(VideoStreamDescription$1);class DefaultVideoStreamIndex{constructor(e){this.logger=e,this.currentIndex=null,this.indexForSubscribe=null,this.currentSubscribeAck=null,this.subscribeTrackToStreamMap=null,this.subscribeStreamToAttendeeMap=null,this.subscribeStreamToExternalUserIdMap=null,this.subscribeSsrcToStreamMap=null,this.subscribeSsrcToGroupMap=null,this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null,this.videoStreamDescription=new VideoStreamDescription_1$1.default,this.sendVideoStreamId=0,this.videoStreamDescription.trackLabel="AmazonChimeExpressVideo",this.videoStreamDescription.streamId=2,this.videoStreamDescription.groupId=2}localStreamDescriptions(){return[this.videoStreamDescription.clone()]}convertBpsToKbps(e){return e>0&&e<1e3?1:Math.trunc(e/1e3)}remoteStreamDescriptions(){if(!this.currentIndex||!this.currentIndex.sources)return[];const e=[];return this.currentIndex.sources.forEach((t=>{const i=new VideoStreamDescription_1$1.default;i.attendeeId=t.attendeeId,i.groupId=t.groupId,i.streamId=t.streamId,i.maxBitrateKbps=t.maxBitrateKbps,i.avgBitrateKbps=this.convertBpsToKbps(t.avgBitrateBps),i.width=t.width,i.height=t.height,i.maxFrameRate=t.framerate,e.push(i)})),e}integrateUplinkPolicyDecision(e){if(e&&e.length){const t=e[0];this.videoStreamDescription.maxBitrateKbps=t.maxBitrate/1e3,this.videoStreamDescription.maxFrameRate=t.maxFramerate}}integrateIndexFrame(e){if(this.currentIndex=e,!e)return;const t=new Map;let i=!1;for(const n of e.sources){if(!t.has(n.attendeeId)){t.set(n.attendeeId,n.groupId);continue}const e=t.get(n.attendeeId);e<n.groupId&&(this.logger.warn(`Old group ID ${e} found for attendee ID ${n.attendeeId}, replacing with newer group ID ${n.groupId}`),t.set(n.attendeeId,n.groupId)),i=!0}i&&(this.currentIndex.sources=this.currentIndex.sources.filter((e=>t.get(e.attendeeId)===e.groupId))),this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null}subscribeFrameSent(){this.indexForSubscribe=this.currentIndex}integrateSubscribeAckFrame(e){this.currentSubscribeAck=e,this.subscribeTrackToStreamMap=this.buildTrackToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToStreamMap=this.buildSSRCToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToGroupMap=this.buildSSRCToGroupMap(this.currentSubscribeAck),this.subscribeStreamToAttendeeMap=this.buildStreamToAttendeeMap(this.indexForSubscribe),this.subscribeStreamToExternalUserIdMap=this.buildStreamExternalUserIdMap(this.indexForSubscribe),this.sendVideoStreamId=0,e.allocations&&void 0!==e.allocations&&e.allocations.length>0&&(this.sendVideoStreamId=e.allocations[0].streamId)}integrateBitratesFrame(e){if(this.currentIndex)for(const t of e.bitrates){const e=this.currentIndex.sources.find((e=>e.streamId===t.sourceStreamId));void 0!==e&&(e.avgBitrateBps=t.avgBitrateBps)}}allStreams(){const e=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const t of this.currentIndex.sources)e.add(t.streamId);return e}allVideoSendingSourcesExcludingSelf(e){const t=[],i=new Set;if(this.currentIndex&&this.currentIndex.sources&&this.currentIndex.sources.length)for(const n of this.currentIndex.sources){const{attendeeId:r,externalUserId:o,mediaType:a}=n;r!==e&&a===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(i.has(r)||(t.push({attendee:{attendeeId:r,externalUserId:o}}),i.add(r)))}return t}streamSelectionUnderBandwidthConstraint(e,t,i,n){const r=new Set;if(this.currentIndex)for(const n of this.currentIndex.sources)n.attendeeId!==e&&n.mediaType===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(t.has(n.attendeeId)||i.has(n.attendeeId)||r.add(n.attendeeId));const o=this.buildAttendeeToSortedStreamDescriptorMapExcludingSelf(e),a=new Map;let s=0;o.forEach(((e,t)=>{a.set(t,e[0]),s+=e[0].maxBitrateKbps})),s=this.trySelectHighBitrateForAttendees(o,t,s,n,a),this.trySelectHighBitrateForAttendees(o,r,s,n,a);const d=new DefaultVideoStreamIdSet_1$1.default;for(const e of a.values())d.add(e.streamId);return d}highestQualityStreamFromEachGroupExcludingSelf(e){const t=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex){const i=new Map;for(const t of this.currentIndex.sources)t.attendeeId!==e&&t.mediaType===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(!i.has(t.groupId)||t.maxBitrateKbps>i.get(t.groupId).maxBitrateKbps)&&i.set(t.groupId,t);for(const e of i.values())t.add(e.streamId)}return t}numberOfVideoPublishingParticipantsExcludingSelf(e){return this.highestQualityStreamFromEachGroupExcludingSelf(e).array().length}numberOfParticipants(){return this.currentIndex.numParticipants?this.currentIndex.numParticipants:-1}attendeeIdForTrack(e){const t=this.streamIdForTrack(e);if(void 0===t||!this.subscribeStreamToAttendeeMap)return this.logger.warn(`no attendee found for track ${e}`),"";const i=this.subscribeStreamToAttendeeMap.get(t);return i||(this.logger.info(`track ${e} (stream ${t}) does not correspond to a known attendee`),"")}externalUserIdForTrack(e){const t=this.streamIdForTrack(e);if(void 0===t||!this.subscribeStreamToExternalUserIdMap)return this.logger.warn(`no external user id found for track ${e}`),"";const i=this.subscribeStreamToExternalUserIdMap.get(t);return i||(this.logger.info(`track ${e} (stream ${t}) does not correspond to a known externalUserId`),"")}attendeeIdForStreamId(e){if(!this.streamToAttendeeMap){if(!this.currentIndex)return"";this.streamToAttendeeMap=this.buildStreamToAttendeeMap(this.currentIndex)}const t=this.streamToAttendeeMap.get(e);return t||(this.logger.info(`stream ID ${e} does not correspond to a known attendee`),"")}attendeeIdForGroupId(e){if(!this.groupIdToAttendeeMap){if(!this.currentIndex)return"";this.groupIdToAttendeeMap=this.buildGroupIdToAttendeeMap(this.currentIndex)}const t=this.groupIdToAttendeeMap.get(e);return t||(this.logger.info(`group ID ${e} does not correspond to a known attendee`),"")}groupIdForStreamId(e){if(this.currentIndex&&this.currentIndex.sources){for(const t of this.currentIndex.sources)if(t.streamId===e)return t.groupId;if(this.indexForSubscribe)for(const t of this.indexForSubscribe.sources)if(t.streamId===e)return t.groupId}}StreamIdsInSameGroup(e,t){return this.groupIdForStreamId(e)===this.groupIdForStreamId(t)}streamIdForTrack(e){if(this.subscribeTrackToStreamMap)return this.subscribeTrackToStreamMap.get(e)}streamIdForSSRC(e){if(this.subscribeSsrcToStreamMap)return this.subscribeSsrcToStreamMap.get(e)}overrideStreamIdMappings(e,t){if(this.subscribeTrackToStreamMap)for(const[i,n]of this.subscribeTrackToStreamMap.entries())if(e===n){this.subscribeTrackToStreamMap.set(i,t);break}if(this.subscribeSsrcToStreamMap)for(const[i,n]of this.subscribeSsrcToStreamMap.entries())if(e===n){this.subscribeSsrcToStreamMap.set(i,t);break}}groupIdForSSRC(e){if(this.subscribeSsrcToGroupMap)return this.subscribeSsrcToGroupMap.get(e)}streamsPausedAtSource(){const e=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const t of this.currentIndex.pausedAtSourceIds)e.add(t);return e}sendVideoStreamIdFromRid(e){return this.sendVideoStreamId}buildTrackToStreamMap(e){const t=new Map;this.logger.debug((()=>`trackMap ${JSON.stringify(e.tracks)}`));for(const i of e.tracks)i.trackLabel.length>0&&i.streamId>0&&t.set(i.trackLabel,i.streamId);return t}buildSSRCToStreamMap(e){const t=new Map;this.logger.debug((()=>`ssrcMap ${JSON.stringify(e.tracks)}`));for(const i of e.tracks)i.trackLabel.length>0&&i.streamId>0&&t.set(i.ssrc,i.streamId);return t}buildSSRCToGroupMap(e){const t=new Map;for(const i of e.tracks)i.trackLabel.length>0&&i.streamId>0&&t.set(i.ssrc,this.groupIdForStreamId(i.streamId));return t}buildStreamToAttendeeMap(e){const t=new Map;if(e)for(const i of e.sources)t.set(i.streamId,i.attendeeId);return t}buildGroupIdToAttendeeMap(e){const t=new Map;for(const i of e.sources)t.set(i.groupId,i.attendeeId);return t}buildStreamExternalUserIdMap(e){const t=new Map;if(e)for(const i of e.sources)i.externalUserId&&t.set(i.streamId,i.externalUserId);return t}trySelectHighBitrateForAttendees(e,t,i,n,r){for(const o of t){if(i>=n)break;if(e.has(o)){const t=e.get(o);for(const e of t.reverse())if(i-r.get(o).maxBitrateKbps+e.maxBitrateKbps<n){i=i-r.get(o).maxBitrateKbps+e.maxBitrateKbps,r.set(o,e);break}}}return i}buildAttendeeToSortedStreamDescriptorMapExcludingSelf(e){const t=new Map;if(this.currentIndex)for(const i of this.currentIndex.sources)i.attendeeId!==e&&i.mediaType===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(t.has(i.attendeeId)?t.get(i.attendeeId).push(i):t.set(i.attendeeId,[i]));return t.forEach(((e,t)=>{e.sort(((e,t)=>e.maxBitrateKbps>t.maxBitrateKbps?1:e.maxBitrateKbps<t.maxBitrateKbps?-1:0))})),t}}DefaultVideoStreamIndex$1.default=DefaultVideoStreamIndex;var SimulcastVideoStreamIndex$1={},__importDefault$w=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SimulcastVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1=SignalingProtocol,DefaultVideoStreamIndex_1=__importDefault$w(DefaultVideoStreamIndex$1),VideoStreamDescription_1=__importDefault$w(VideoStreamDescription$1);class SimulcastVideoStreamIndex extends DefaultVideoStreamIndex_1.default{constructor(e){super(e),this.streamIdToBitrateKbpsMap=new Map,this._localStreamInfos=[],this._sendRidToVideoStreamIdMap=new Map,this._lastBitRateMsgTime=Date.now()}localStreamDescriptions(){const e=[];return this._localStreamInfos.forEach((t=>{e.push(t.clone())})),e}integrateUplinkPolicyDecision(e){let t=!0,i=0;for(let n=0;n<e.length;n++){const r=e[n].maxBitrate/1e3,o=e[n].maxFramerate;if(t&&n!==this._localStreamInfos.length)0===this._localStreamInfos[i].maxBitrateKbps&&r>0&&(this._localStreamInfos[i].timeEnabled=Date.now()),this._localStreamInfos[i].maxBitrateKbps=r,this._localStreamInfos[i].maxFrameRate=o,this._localStreamInfos[i].disabledByUplinkPolicy=0===r,!0===this._localStreamInfos[i].disabledByUplinkPolicy&&(this._localStreamInfos[i].disabledByWebRTC=!1),i++;else{t=!1;const a=new VideoStreamDescription_1.default;a.maxBitrateKbps=r,a.maxFrameRate=o,a.disabledByUplinkPolicy=0===r,a.rid=e[n].rid,0!==r&&(a.timeEnabled=Date.now()),this._localStreamInfos.push(a),i++}}t&&this._localStreamInfos.splice(i)}integrateBitratesFrame(e){super.integrateBitratesFrame(e);const t=new Set,i=new Set(this.streamIdToBitrateKbpsMap.keys());for(const i of e.bitrates)t.add(i.sourceStreamId),this.streamIdToBitrateKbpsMap.set(i.sourceStreamId,this.convertBpsToKbps(i.avgBitrateBps));for(const e of i)if(!t.has(e)){this.streamIdToBitrateKbpsMap.get(e)===SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE?this.streamIdToBitrateKbpsMap.set(e,SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE):this.streamIdToBitrateKbpsMap.set(e,SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE)}for(let e=0;e<this._localStreamInfos.length;e++){this._localStreamInfos[e].disabledByWebRTC=!1;const t=this._localStreamInfos[e].streamId;if(!this._localStreamInfos[e].disabledByUplinkPolicy)if(this.streamIdToBitrateKbpsMap.has(t)){this.streamIdToBitrateKbpsMap.get(t)===SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE&&this._lastBitRateMsgTime-this._localStreamInfos[e].timeEnabled>SimulcastVideoStreamIndex.BitratesMsgFrequencyMs&&(this._localStreamInfos[e].disabledByWebRTC=!0)}else this._lastBitRateMsgTime-this._localStreamInfos[e].timeEnabled>SimulcastVideoStreamIndex.BitratesMsgFrequencyMs&&(this._localStreamInfos[e].disabledByWebRTC=!0)}this._lastBitRateMsgTime=Date.now(),this.logLocalStreamDescriptions()}logLocalStreamDescriptions(){let e="";for(const t of this._localStreamInfos)e+=`streamId=${t.streamId} maxBitrate=${t.maxBitrateKbps} disabledByWebRTC=${t.disabledByWebRTC} disabledByUplink=${t.disabledByUplinkPolicy}\n`;this.logger.debug((()=>e))}integrateIndexFrame(e){super.integrateIndexFrame(e);const t=new Set,i=new Set(this.streamIdToBitrateKbpsMap.keys());for(const e of this.currentIndex.sources)e.mediaType===SignalingProtocol_js_1.SdkStreamMediaType.VIDEO&&(t.add(e.streamId),this.streamIdToBitrateKbpsMap.has(e.streamId)||this.streamIdToBitrateKbpsMap.set(e.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE));for(const e of i)t.has(e)||this.streamIdToBitrateKbpsMap.delete(e)}integrateSubscribeAckFrame(e){if(super.integrateSubscribeAckFrame(e),!e.allocations||void 0===e.allocations)return;let t=0;this._sendRidToVideoStreamIdMap.clear();for(const i of e.allocations){if(this._localStreamInfos.length<t+1){this.logger.info("simulcast: allocation has more than number of local streams");break}this._localStreamInfos[t].groupId=i.groupId,this._localStreamInfos[t].streamId=i.streamId,this.streamIdToBitrateKbpsMap.has(i.streamId)||this.streamIdToBitrateKbpsMap.set(i.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE),this._sendRidToVideoStreamIdMap.set(this._localStreamInfos[t].rid,i.streamId),t++}}sendVideoStreamIdFromRid(e){let t=0;return this._sendRidToVideoStreamIdMap.has(e)&&(t=this._sendRidToVideoStreamIdMap.get(e)),t}}SimulcastVideoStreamIndex$1.default=SimulcastVideoStreamIndex,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE=-2,SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE=-1,SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE=0,SimulcastVideoStreamIndex.BitratesMsgFrequencyMs=4e3;var DefaultVideoTileController$1={},DefaultDevicePixelRatioMonitor$1={},__awaiter$n=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(DefaultDevicePixelRatioMonitor$1,"__esModule",{value:!0});class DefaultDevicePixelRatioMonitor{constructor(e,t){if(this.devicePixelRatioSource=e,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach((e=>{e.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}))},"undefined"==typeof window)return;const i=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);"function"==typeof i.addEventListener?(i.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=i):"function"==typeof i.addListener?(i.addListener(this.mediaQueryListener),this.mediaQueryList=i):t.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return __awaiter$n(this,void 0,void 0,(function*(){this.mediaQueryList&&("function"==typeof this.mediaQueryList.addEventListener?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()}))}registerObserver(e){this.observerQueue.add(e),e.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver(e){this.observerQueue.delete(e)}}DefaultDevicePixelRatioMonitor$1.default=DefaultDevicePixelRatioMonitor;var DevicePixelRatioWindowSource$1={};Object.defineProperty(DevicePixelRatioWindowSource$1,"__esModule",{value:!0});class DevicePixelRatioWindowSource{devicePixelRatio(){return"undefined"!=typeof window&&window&&window.devicePixelRatio?window.devicePixelRatio:1}}DevicePixelRatioWindowSource$1.default=DevicePixelRatioWindowSource;var __awaiter$m=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$v=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoTileController$1,"__esModule",{value:!0});const VideoQualitySettings_1$4=__importDefault$v(VideoQualitySettings$1),DefaultDevicePixelRatioMonitor_1=__importDefault$v(DefaultDevicePixelRatioMonitor$1),DevicePixelRatioWindowSource_1=__importDefault$v(DevicePixelRatioWindowSource$1),Types_1$2=Types,DefaultVideoTile_1$1=__importDefault$v(DefaultVideoTile$1);class DefaultVideoTileController{constructor(e,t,i){this.tileFactory=e,this.audioVideoController=t,this.logger=i,this.tileMap=new Map,this.nextTileId=1,this.currentLocalTile=null,this.currentPausedTilesByIds=new Set,this.keepLastFrameWhenPaused=!1,this.keepLastFrameWhenPaused=t.configuration.keepLastFrameWhenPaused}createDevicePixelRatioMonitorIfNeeded(){this.devicePixelRatioMonitor||(this.devicePixelRatioMonitor=new DefaultDevicePixelRatioMonitor_1.default(new DevicePixelRatioWindowSource_1.default,this.logger))}discardDevicePixelRatioMonitorIfNotNeeded(){return __awaiter$m(this,void 0,void 0,(function*(){if(this.tileMap.size||!this.devicePixelRatioMonitor)return;const e=this.devicePixelRatioMonitor;return this.devicePixelRatioMonitor=void 0,e.destroy()}))}bindVideoElement(e,t){const i=this.getVideoTile(e);null!==i?i.bindVideoElement(t):this.logger.warn(`Ignoring video element binding for unknown tile id ${e}`)}unbindVideoElement(e,t=!0){const i=this.getVideoTile(e);if(null===i)return void this.logger.warn(`Ignoring video element unbinding for unknown tile id ${e}`);this.logger.info("Unbinding the video element");const n=i.stateRef().boundVideoElement;i.bindVideoElement(null),t&&(this.logger.info("Cleaning up the video element"),DefaultVideoTile_1$1.default.disconnectVideoStreamFromVideoElement(n,!1))}startLocalVideoTile(){if(this.audioVideoController.configuration.meetingFeatures.videoMaxResolution===VideoQualitySettings_1$4.default.VideoDisabled)return this.logger.warn("Could not start camera video because max video resolution was set to None"),-1;const e=this.findOrCreateLocalVideoTile();return this.currentLocalTile.stateRef().localTileStarted=!0,this.audioVideoController.update({needsRenegotiation:!0}),e.id()}stopLocalVideoTile(){this.currentLocalTile&&(this.currentLocalTile.stateRef().localTileStarted=!1,this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.audioVideoController.update({needsRenegotiation:!0}))}hasStartedLocalVideoTile(){return!(!this.currentLocalTile||!this.currentLocalTile.stateRef().localTileStarted)}removeLocalVideoTile(){this.currentLocalTile&&this.removeVideoTile(this.currentLocalTile.id())}getLocalVideoTile(){return this.currentLocalTile}pauseVideoTile(e){const t=this.getVideoTile(e);t&&(this.currentPausedTilesByIds.has(e)||(this.audioVideoController.pauseReceivingStream(t.stateRef().streamId),this.currentPausedTilesByIds.add(e)),t.pause())}unpauseVideoTile(e){const t=this.getVideoTile(e);t&&(this.currentPausedTilesByIds.has(e)&&(this.audioVideoController.resumeReceivingStream(t.stateRef().streamId),this.currentPausedTilesByIds.delete(e)),t.unpause())}getVideoTile(e){return this.tileMap.has(e)?this.tileMap.get(e):null}getVideoTileArea(e){const t=e.state();let i=0,n=0;return t.boundVideoElement&&(i=t.boundVideoElement.clientHeight*t.devicePixelRatio,n=t.boundVideoElement.clientWidth*t.devicePixelRatio),i*n}getAllRemoteVideoTiles(){const e=new Array;return this.tileMap.forEach(((t,i)=>{this.currentLocalTile&&i===this.currentLocalTile.id()||e.push(t)})),e}getAllVideoTiles(){return Array.from(this.tileMap.values())}addVideoTile(e=!1){const t=this.nextTileId;this.nextTileId+=1,this.createDevicePixelRatioMonitorIfNeeded();const i=this.tileFactory.makeTile(t,e,this,this.devicePixelRatioMonitor);return this.tileMap.set(t,i),i}removeVideoTile(e){if(!this.tileMap.has(e))return;const t=this.tileMap.get(e);this.currentLocalTile===t&&(this.currentLocalTile=null),t.destroy(),this.tileMap.delete(e),this.audioVideoController.forEachObserver((t=>{Types_1$2.Maybe.of(t.videoTileWasRemoved).map((i=>i.bind(t)(e)))})),this.discardDevicePixelRatioMonitorIfNotNeeded()}removeVideoTilesByAttendeeId(e){const t=[];for(const i of this.getAllVideoTiles()){const n=i.state();n.boundAttendeeId===e&&(this.removeVideoTile(n.tileId),t.push(n.tileId))}return t}removeAllVideoTiles(){const e=Array.from(this.tileMap.keys());for(const t of e)this.removeVideoTile(t)}sendTileStateUpdate(e){this.audioVideoController.forEachObserver((t=>{Types_1$2.Maybe.of(t.videoTileDidUpdate).map((i=>i.bind(t)(e)))}))}haveVideoTilesWithStreams(){for(const e of this.getAllVideoTiles())if(e.state().boundVideoStream)return!0;return!1}haveVideoTileForAttendeeId(e){return!!this.getVideoTileForAttendeeId(e)}getVideoTileForAttendeeId(e){for(const t of this.getAllVideoTiles()){if(t.state().boundAttendeeId===e)return t}}captureVideoTile(e){const t=this.getVideoTile(e);return t?t.capture():null}findOrCreateLocalVideoTile(){return this.currentLocalTile||(this.currentLocalTile=this.addVideoTile(!0),this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId)),this.currentLocalTile}}DefaultVideoTileController$1.default=DefaultVideoTileController;var DefaultVideoTileFactory$1={},__importDefault$u=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultVideoTileFactory$1,"__esModule",{value:!0});const DefaultVideoTile_1=__importDefault$u(DefaultVideoTile$1);class DefaultVideoTileFactory{makeTile(e,t,i,n){return new DefaultVideoTile_1.default(e,t,i,n)}}DefaultVideoTileFactory$1.default=DefaultVideoTileFactory;var DefaultSimulcastUplinkPolicy$1={},SimulcastLayers={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SimulcastLayers=void 0,function(e){e[e.Low=0]="Low",e[e.LowAndMedium=1]="LowAndMedium",e[e.LowAndHigh=2]="LowAndHigh",e[e.Medium=3]="Medium",e[e.MediumAndHigh=4]="MediumAndHigh",e[e.High=5]="High"}(t=e.SimulcastLayers||(e.SimulcastLayers={})),e.default=t}(SimulcastLayers);var __importDefault$t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultSimulcastUplinkPolicy$1,"__esModule",{value:!0});const SimulcastLayers_1=__importDefault$t(SimulcastLayers),SimulcastTransceiverController_1=__importDefault$t(SimulcastTransceiverController$1),Types_1$1=Types,DefaultVideoCaptureAndEncodeParameter_1$2=__importDefault$t(DefaultVideoCaptureAndEncodeParameter$1),BitrateParameters_1=__importDefault$t(BitrateParameters$1);class DefaultSimulcastUplinkPolicy{constructor(e,t){this.selfAttendeeId=e,this.logger=t,this.numSenders=0,this.shouldDisableSimulcast=!1,this.newQualityMap=new Map,this.currentQualityMap=new Map,this.newActiveStreams=1,this.currentActiveStreams=1,this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps,this.startTimeMs=0,this.lastUpdatedMs=Date.now(),this.videoIndex=null,this.currLocalDescriptions=[],this.nextLocalDescriptions=[],this.observerQueue=new Set,this.hiDisabledRate=DefaultSimulcastUplinkPolicy.kHiDisabledRateHd,this.midDisabledRate=DefaultSimulcastUplinkPolicy.kMidDisabledRateHd,this.hiTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd,this.enableFhdVideo=!1,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps,this.currentQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps]),this.newQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps])}updateConnectionMetric({uplinkKbps:e=0}){if(isNaN(e))return;0===this.startTimeMs&&(this.startTimeMs=Date.now()),Date.now()-this.startTimeMs<DefaultSimulcastUplinkPolicy.startupDurationMs?this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps:this.lastUplinkBandwidthKbps=e,this.logger.debug((()=>`simulcast: uplink policy update metrics ${this.lastUplinkBandwidthKbps}`));let t=DefaultSimulcastUplinkPolicy.holdDownDurationMs;3===this.currentActiveStreams?t=2*DefaultSimulcastUplinkPolicy.holdDownDurationMs:(2===this.currentActiveStreams&&e<=this.midDisabledRate||1===this.currentActiveStreams&&e<=this.hiDisabledRate)&&(t=DefaultSimulcastUplinkPolicy.holdDownDurationMs/2),Date.now()<this.lastUpdatedMs+t||(this.newQualityMap=this.calculateEncodingParameters(!1))}calculateEncodingParameters(e){const t=[new BitrateParameters_1.default,new BitrateParameters_1.default,new BitrateParameters_1.default];let i=0,n=0;if(0===this.currentActiveStreams?(i=this.lastUplinkBandwidthKbps+1,n=0):1===this.currentActiveStreams?(i=this.enableFhdVideo?4e3:2400,n=this.hiDisabledRate):2===this.currentActiveStreams?(i=this.enableFhdVideo?1600:1e3,n=this.midDisabledRate):(i=this.enableFhdVideo?500:300,n=0),e||this.lastUplinkBandwidthKbps>=i||this.lastUplinkBandwidthKbps<=n){this.shouldDisableSimulcast?(this.newActiveStreams=0,t[0].maxBitrateKbps=0,t[1].maxBitrateKbps=this.hiTargetBitrateKbps,t[2].maxBitrateKbps=0):this.numSenders<=4&&this.lastUplinkBandwidthKbps>=this.hiDisabledRate?(this.newActiveStreams=1,t[0].maxBitrateKbps=this.lowTargetBitrateKbps,t[1].maxBitrateKbps=0,t[2].maxBitrateKbps=this.hiTargetBitrateKbps):this.lastUplinkBandwidthKbps>=this.midDisabledRate?(this.newActiveStreams=2,t[0].maxBitrateKbps=this.lastUplinkBandwidthKbps>=.7*this.midTargetBitrateKbps?2*this.lowTargetBitrateKbps/3:this.lowTargetBitrateKbps/2,t[1].maxBitrateKbps=this.numSenders<=6?this.midTargetBitrateKbps:.6*this.midTargetBitrateKbps,t[2].maxBitrateKbps=0):(this.newActiveStreams=3,t[0].maxBitrateKbps=this.lowTargetBitrateKbps,t[1].maxBitrateKbps=0,t[2].maxBitrateKbps=0);const e=t.map(((e,t,i)=>e.maxBitrateKbps));this.newQualityMap=this.fillEncodingParamWithBitrates(e),this.encodingParametersEqual()||this.logger.info(`simulcast: policy:calculateEncodingParameters bw:${this.lastUplinkBandwidthKbps} numSources:${this.numSenders} shouldDisableSimulcast:${this.shouldDisableSimulcast} newQualityMap: ${this.getQualityMapString(this.newQualityMap)}`)}return this.newQualityMap}chooseMediaTrackConstraints(){return{width:{ideal:this.enableFhdVideo?1920:1280},height:{ideal:this.enableFhdVideo?1080:768},frameRate:{ideal:15}}}chooseEncodingParameters(){return this.currentQualityMap=this.newQualityMap,this.currentActiveStreams=this.newActiveStreams,this.activeStreamsToPublish!==this.newActiveStreams&&(this.activeStreamsToPublish=this.newActiveStreams,this.publishEncodingSimulcastLayer()),this.currentQualityMap}updateIndex(e){const t=e.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+1,i=t!==this.numSenders,n=e.numberOfParticipants(),r=n>=0&&n<=2,o=this.shouldDisableSimulcast!==r;this.numSenders=t,this.shouldDisableSimulcast=r,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1),this.videoIndex=e,this.newQualityMap=this.calculateEncodingParameters(i||o)}wantsResubscribe(){let e=!this.encodingParametersEqual();this.nextLocalDescriptions=this.videoIndex.localStreamDescriptions();for(let t=0;t<this.nextLocalDescriptions.length;t++){const i=this.nextLocalDescriptions[t].streamId;if(0!==i&&i){const n=this.currLocalDescriptions.findIndex((e=>e.streamId===i));-1!==n&&this.nextLocalDescriptions[t].disabledByWebRTC!==this.currLocalDescriptions[n].disabledByWebRTC&&(e=!0)}}return e&&(this.lastUpdatedMs=Date.now()),this.currLocalDescriptions=this.nextLocalDescriptions,e}compareEncodingParameter(e,t){return JSON.stringify(e)===JSON.stringify(t)}encodingParametersEqual(){let e=!1;for(const t of SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING)if(e=e||!this.compareEncodingParameter(this.newQualityMap.get(t),this.currentQualityMap.get(t)),e)break;return!e}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){return this.enableFhdVideo?1920:1280}captureHeight(){return this.enableFhdVideo?1080:768}captureFrameRate(){return 15}maxBandwidthKbps(){return this.enableFhdVideo?2500:1400}setIdealMaxBandwidthKbps(e){}setHasBandwidthPriority(e){}setHighResolutionFeatureEnabled(e){this.enableFhdVideo=e,this.hiDisabledRate=e?DefaultSimulcastUplinkPolicy.kHiDisabledRateFhd:DefaultSimulcastUplinkPolicy.kHiDisabledRateHd,this.midDisabledRate=e?DefaultSimulcastUplinkPolicy.kMidDisabledRateFhd:DefaultSimulcastUplinkPolicy.kMidDisabledRateHd,this.hiTargetBitrateKbps=e?DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=e?DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=e?DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!0}fillEncodingParamWithBitrates(e){const t=new Map,i=SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING,n=e;let r=this.shouldDisableSimulcast?1:4;for(let e=0;e<i.length;e++){const o=i[e];t.set(o,{rid:o,active:n[e]>0,scaleResolutionDownBy:Math.max(r,1),maxBitrate:1e3*n[e]}),r/=2}return t}getQualityMapString(e){let t="";const i=this.videoIndex.localStreamDescriptions();return 3===i.length&&e.forEach((e=>{let n=!1;n="low"===e.rid?i[0].disabledByWebRTC:"mid"===e.rid?i[1].disabledByWebRTC:i[2].disabledByWebRTC,t+=`{ rid: ${e.rid} active:${e.active} disabledByWebRTC: ${n} maxBitrate:${e.maxBitrate}}`})),t}getEncodingSimulcastLayer(e){switch(e){case 0:return SimulcastLayers_1.default.High;case 1:return SimulcastLayers_1.default.LowAndHigh;case 2:return SimulcastLayers_1.default.LowAndMedium;case 3:return SimulcastLayers_1.default.Low}}publishEncodingSimulcastLayer(){const e=this.getEncodingSimulcastLayer(this.activeStreamsToPublish);this.forEachObserver((t=>{Types_1$1.Maybe.of(t.encodingSimulcastLayersDidChange).map((i=>i.bind(t)(e)))}))}addObserver(e){this.logger.info("adding simulcast uplink observer"),this.observerQueue.add(e)}removeObserver(e){this.logger.info("removing simulcast uplink observer"),this.observerQueue.delete(e)}forEachObserver(e){for(const t of this.observerQueue)e(t)}}DefaultSimulcastUplinkPolicy$1.default=DefaultSimulcastUplinkPolicy,DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps=1200,DefaultSimulcastUplinkPolicy.startupDurationMs=6e3,DefaultSimulcastUplinkPolicy.holdDownDurationMs=4e3,DefaultSimulcastUplinkPolicy.defaultMaxFrameRate=15,DefaultSimulcastUplinkPolicy.kHiDisabledRateHd=700,DefaultSimulcastUplinkPolicy.kMidDisabledRateHd=240,DefaultSimulcastUplinkPolicy.kHiDisabledRateFhd=1200,DefaultSimulcastUplinkPolicy.kMidDisabledRateFhd=400,DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd=1200,DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd=600,DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd=300,DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsFhd=2e3,DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsFhd=1e3,DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsFhd=500;var NScaleVideoUplinkBandwidthPolicy$1={},__awaiter$l=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$s=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NScaleVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1$1=__importDefault$s(DefaultVideoCaptureAndEncodeParameter$1);class NScaleVideoUplinkBandwidthPolicy{constructor(e,t=!0,i=undefined,n=undefined){this.selfAttendeeId=e,this.scaleResolution=t,this.logger=i,this.browserBehavior=n,this.numberOfPublishedVideoSources=void 0,this.idealMaxBandwidthKbps=1500,this.hasBandwidthPriority=!1,this.encodingParamMap=new Map,this.enableHighResolutionFeature=!1,this.enableSVC=!1,this.isUsingSVCCodec=!0,this.numParticipants=0,this.reset()}reset(){this.numberOfPublishedVideoSources=void 0,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,{maxBitrate:0})}updateConnectionMetric(e){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(e){var t;let i=!0;this.transceiverController&&(i=this.transceiverController.hasVideoInput());const n=e.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+(i?1:0),r=e.numberOfParticipants();this.numParticipants!==r||this.numberOfPublishedVideoSources!==n?(this.numberOfPublishedVideoSources=n,this.numParticipants=r,this.updateOptimalParameters()):null===(t=this.logger)||void 0===t||t.debug("Skipping update index; Number of participants has not changed")}wantsResubscribe(){return!this.parametersInEffect.equal(this.optimalParameters)}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}updateOptimalParameters(){let e=1;if(this.transceiverController){const t=this.getStreamCaptureSetting();if(t){e=this.calculateEncodingParameters(t).scaleResolutionDownBy}}this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1,e,this.enableSVC&&this.numParticipants>2&&this.isUsingSVCCodec)}captureWidth(){let e=640;return this.getNumberOfPublishedVideoSources()>4&&(e=320),e}captureHeight(){let e=384;return this.getNumberOfPublishedVideoSources()>4&&(e=192),e}captureFrameRate(){return 15}maxBandwidthKbps(){if(this.hasBandwidthPriority)return Math.trunc(this.idealMaxBandwidthKbps);let e=0;return e=this.getNumberOfPublishedVideoSources()<=2?this.idealMaxBandwidthKbps:this.getNumberOfPublishedVideoSources()<=4?2*this.idealMaxBandwidthKbps/3:(544/11+14880/(11*this.getNumberOfPublishedVideoSources()))/600*this.idealMaxBandwidthKbps,Math.trunc(e)}setIdealMaxBandwidthKbps(e){this.idealMaxBandwidthKbps=e}setHasBandwidthPriority(e){this.hasBandwidthPriority=e}setTransceiverController(e){this.transceiverController=e}setSVCEnabled(e){var t;this.enableSVC=e,null===(t=this.logger)||void 0===t||t.info(`setSVCEnabled, enable: ${e}}`)}setHighResolutionFeatureEnabled(e){this.enableHighResolutionFeature=e}updateTransceiverController(){return __awaiter$l(this,void 0,void 0,(function*(){const e=this.getStreamCaptureSetting();if(!e)return;const t=this.calculateEncodingParameters(e);this.shouldUpdateEndcodingParameters(t)&&(this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,t),this.transceiverController.setEncodingParameters(this.encodingParamMap))}))}shouldUpdateEndcodingParameters(e){var t,i;const n=null===(i=null===(t=this.transceiverController.localVideoTransceiver().sender.getParameters())||void 0===t?void 0:t.encodings)||void 0===i?void 0:i[0];return e.maxBitrate!==(null==n?void 0:n.maxBitrate)||e.scaleResolutionDownBy!==(null==n?void 0:n.scaleResolutionDownBy)||(null==e?void 0:e.scalabilityMode)!==(null==n?void 0:n.scalabilityMode)}calculateEncodingParameters(e){var t,i,n;const r=1e3*this.maxBandwidthKbps();let o=1,a=720;if(void 0!==e.height&&void 0!==e.width&&this.scaleResolution&&!this.hasBandwidthPriority&&this.getNumberOfPublishedVideoSources()>2&&(a=NScaleVideoUplinkBandwidthPolicy.targetHeightArray[Math.min(this.getNumberOfPublishedVideoSources(),NScaleVideoUplinkBandwidthPolicy.targetHeightArray.length-1)][this.enableHighResolutionFeature?1:0],480===a&&(null===(t=this.browserBehavior)||void 0===t?void 0:t.disable480pResolutionScaleDown())&&(a=360),o=Math.max(Math.min(e.height,e.width)/a,1),null===(i=this.logger)||void 0===i||i.info(`Resolution scale factor is ${o} for capture resolution ${e.width}x${e.height}. New dimension is ${e.width/o}x${e.height/o}`)),this.enableSVC){let e;return e=this.numParticipants>=0&&this.numParticipants<3||!this.isUsingSVCCodec?"L1T1":a>=720?"L3T3":a>=360?"L2T3":"L1T3",null===(n=this.logger)||void 0===n||n.info(`calculateEncodingParameters: SVC: ${this.enableSVC}    participants: ${this.numParticipants}     publishers: ${this.getNumberOfPublishedVideoSources()}     bitrate: ${r}  targetHeight: ${a}  scalabilityMode: ${e}   isUsingSVCCodec: ${this.isUsingSVCCodec}`),{scaleResolutionDownBy:o,maxBitrate:r,scalabilityMode:e}}return{scaleResolutionDownBy:o,maxBitrate:r}}getStreamCaptureSetting(){var e,t,i,n;return null===(n=null===(i=null===(t=null===(e=this.transceiverController)||void 0===e?void 0:e.localVideoTransceiver())||void 0===t?void 0:t.sender)||void 0===i?void 0:i.track)||void 0===n?void 0:n.getSettings()}getNumberOfPublishedVideoSources(){var e;return null!==(e=this.numberOfPublishedVideoSources)&&void 0!==e?e:0}wantsVideoDependencyDescriptorRtpHeaderExtension(){return this.enableSVC}setMeetingSupportedVideoSendCodecs(e,t){const i=null!=e?e:t,n=i.length>0&&NScaleVideoUplinkBandwidthPolicy.SVCCodecNames.includes(i[0].codecName);n!==this.isUsingSVCCodec&&(this.isUsingSVCCodec=n,this.updateOptimalParameters())}}NScaleVideoUplinkBandwidthPolicy$1.default=NScaleVideoUplinkBandwidthPolicy,NScaleVideoUplinkBandwidthPolicy.encodingMapKey="video",NScaleVideoUplinkBandwidthPolicy.targetHeightArray=[[0,0],[0,0],[0,0],[540,720],[540,720],[480,540],[480,540],[480,540],[480,540],[360,480],[360,480],[360,480],[360,480],[270,360],[270,360],[270,360],[270,360],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270]],NScaleVideoUplinkBandwidthPolicy.SVCCodecNames=["VP9"];var DefaultVolumeIndicatorAdapter$1={},hasRequiredDefaultAudioVideoController;Object.defineProperty(DefaultVolumeIndicatorAdapter$1,"__esModule",{value:!0});class DefaultVolumeIndicatorAdapter{constructor(e,t,i,n,r){this.logger=e,this.realtimeController=t,this.minVolumeDecibels=i,this.maxVolumeDecibels=n,this.selfAttendeeId=r,this.streamIdToAttendeeId={},this.streamIdToExternalUserId={},this.warnedAboutMissingStreamIdMapping={},this.attendeeIdToStreamId={},this.sessionReconnected=!1}onReconnect(){this.sessionReconnected=!0}sendRealtimeUpdatesForAudioStreamIdInfo(e){let t=0;for(const i of e.streams){const n=!!i.attendeeId,r=!!i.externalUserId,o=i.hasOwnProperty("muted"),a=!!i.dropped;if(n){this.attendeeIdToStreamId[i.attendeeId]&&this.attendeeIdToStreamId[i.attendeeId]<i.audioStreamId&&delete this.attendeeIdToStreamId[i.attendeeId],this.streamIdToAttendeeId[i.audioStreamId]=i.attendeeId;const n=r?i.externalUserId:i.attendeeId;this.streamIdToExternalUserId[i.audioStreamId]=n,this.attendeeIdToStreamId[i.attendeeId]=i.audioStreamId,this.realtimeController.realtimeSetAttendeeIdPresence(i.attendeeId,!0,n,!1,{attendeeIndex:t++,attendeesInFrame:e.streams.length})}if(o){const e=this.streamIdToAttendeeId[i.audioStreamId],t=this.streamIdToExternalUserId[i.audioStreamId];this.realtimeController.realtimeUpdateVolumeIndicator(e,null,i.muted,null,t)}if(!n&&!o){const n=this.streamIdToAttendeeId[i.audioStreamId];if(n){const r=this.streamIdToExternalUserId[i.audioStreamId];delete this.streamIdToAttendeeId[i.audioStreamId],delete this.streamIdToExternalUserId[i.audioStreamId],delete this.warnedAboutMissingStreamIdMapping[i.audioStreamId],this.attendeeIdToStreamId[n]===i.audioStreamId&&delete this.attendeeIdToStreamId[n];let o=!1;for(const e of Object.keys(this.streamIdToAttendeeId)){const t=parseInt(e);if(t>i.audioStreamId&&this.streamIdToAttendeeId[t]===n){o=!0;break}}o||this.realtimeController.realtimeSetAttendeeIdPresence(n,!1,r,a,{attendeeIndex:t++,attendeesInFrame:e.streams.length})}}}this.sessionReconnected&&(this.cleanUpState(e),this.sessionReconnected=!1)}cleanUpState(e){const t=Object.values(this.streamIdToAttendeeId),i=e.streams.map((e=>e.attendeeId)),n=t.filter((e=>!i.includes(e)));for(const[e,t]of n.entries()){const i=this.attendeeIdToStreamId[t],n=this.streamIdToExternalUserId[i];delete this.streamIdToAttendeeId[i],delete this.streamIdToExternalUserId[i],delete this.warnedAboutMissingStreamIdMapping[i],delete this.attendeeIdToStreamId[t],t!==this.selfAttendeeId?this.realtimeController.realtimeSetAttendeeIdPresence(t,!1,n,!1,{attendeeIndex:e,attendeesInFrame:t.length}):this.logger.warn("the volume indicator adapter cleans up the current attendee (presence = false) after reconnection")}}sendRealtimeUpdatesForAudioMetadata(e){let t=null,i=null;for(const n of e.attendeeStates){const e=this.attendeeIdForStreamId(n.audioStreamId);n.hasOwnProperty("volume")&&(null===t&&(t={}),null!==e&&(t[e]=this.normalizedVolume(n))),n.hasOwnProperty("signalStrength")&&(null===i&&(i={}),null!==e&&(i[e]=this.normalizedSignalStrength(n)))}this.applyRealtimeUpdatesForAudioMetadata(t,i)}normalizedVolume(e){const t=1-(-e.volume-this.maxVolumeDecibels)/(this.minVolumeDecibels-this.maxVolumeDecibels);return Math.min(Math.max(t,0),1)}normalizedSignalStrength(e){const t=e.signalStrength/DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS;return Math.min(Math.max(t,0),1)}applyRealtimeUpdatesForAudioMetadata(e,t){for(const i in this.streamIdToAttendeeId){const n=this.streamIdToAttendeeId[i],r=this.streamIdToExternalUserId[i];let o=null,a=null;null!==e&&(o=e.hasOwnProperty(n)?e[n]:DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME),null!==t&&(a=t.hasOwnProperty(n)?t[n]:DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH),null===o&&null===a||this.realtimeController.realtimeUpdateVolumeIndicator(n,o,null,a,r)}}attendeeIdForStreamId(e){if(0===e)return null;const t=this.streamIdToAttendeeId[e];return t||(this.warnedAboutMissingStreamIdMapping[e]||(this.warnedAboutMissingStreamIdMapping[e]=!0,this.logger.warn(`volume indicator stream id ${e} seen before being defined`)),null)}}function requireDefaultAudioVideoController(){if(hasRequiredDefaultAudioVideoController)return DefaultAudioVideoController;hasRequiredDefaultAudioVideoController=1;var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=commonjsGlobal&&commonjsGlobal.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n},n=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultAudioVideoController,"__esModule",{value:!0});const o=r(DefaultActiveSpeakerDetector$1),a=r(DefaultAudioMixController$1),s=r(AudioProfile$1),d=r(DefaultBrowserBehavior$1),l=r(ConnectionHealthData$1),c=r(SignalingAndMetricsConnectionMonitor$1),u=r(VideoQualitySettings$1),h=r(MeetingSessionStatus$1),p=r(MeetingSessionStatusCode),m=r(MeetingSessionVideoAvailability$1),f=r(DefaultModality$1),g=r(DefaultPingPong$1),S=r(DefaultRealtimeController$1),v=r(AsyncScheduler$1),b=r(DefaultSessionStateController$1),_=r(SessionStateControllerAction),y=r(SessionStateControllerState),C=r(SessionStateControllerTransitionResult),w=r(DefaultSignalingClient$1),E=i(ServerSideNetworkAdaption),T=r(SignalingClientEventType),k=r(SignalingClientVideoSubscriptionConfiguration$1),M=SignalingProtocol,R=r(StatsCollector$1),A=r(AttachMediaInputTask$1),P=r(CleanRestartedSessionTask$1),I=r(CleanStoppedSessionTask$1),$=r(CreatePeerConnectionTask$1),D=r(CreateSDPTask$1),x=r(FinishGatheringICECandidatesTask$1),O=r(JoinAndReceiveIndexTask$1),F=r(LeaveAndReceiveLeaveAckTask$1),B=r(ListenForVolumeIndicatorsTask$1),N=r(MonitorTask$1),L=r(OpenSignalingConnectionTask$1),V=r(ParallelGroupTask$1),U=r(requirePromoteToPrimaryMeetingTask()),j=r(ReceiveAudioInputTask$1),z=r(ReceiveRemoteVideoPauseResumeTask),H=r(ReceiveTURNCredentialsTask$1),G=r(ReceiveVideoInputTask$1),W=r(ReceiveVideoStreamIndexTask$1),q=r(SendAndReceiveDataMessagesTask$1),K=r(SerialGroupTask$1),J=r(SetLocalDescriptionTask$1),Z=r(SetRemoteDescriptionTask$1),Q=r(SubscribeAndReceiveSubscribeAckTask$1),X=r(TimeoutTask$1),Y=r(WaitForAttendeePresenceTask$1),ee=r(DefaultTransceiverController$1),te=r(SimulcastContentShareTransceiverController$1),ie=r(SimulcastTransceiverController$1),ne=r(VideoOnlyTransceiverController$1),re=Types,oe=r(DefaultVideoCaptureAndEncodeParameter$1),ae=r(AllHighestVideoBandwidthPolicy$1),se=r(VideoAdaptiveProbePolicy$1),de=VideoPreferences$1,le=r(DefaultVideoStreamIdSet$1),ce=r(DefaultVideoStreamIndex$1),ue=r(SimulcastVideoStreamIndex$1),he=r(DefaultVideoTileController$1),pe=r(DefaultVideoTileFactory$1),me=r(DefaultSimulcastUplinkPolicy$1),fe=r(NScaleVideoUplinkBandwidthPolicy$1),ge=r(DefaultVolumeIndicatorAdapter$1),Se=r(AudioVideoControllerState);let ve=class e{constructor(e,t,i,n,r,o){this._audioProfile=new s.default,this.connectionHealthData=new l.default,this.observerQueue=new Set,this.meetingSessionContext=new Se.default,this.enableSimulcast=!1,this.enableSVC=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.promotedToPrimaryMeeting=!1,this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.destroyed=!1,this._logger=t,this.sessionStateController=new b.default(this._logger),this._configuration=e,this._webSocketAdapter=i,this._realtimeController=new S.default(n),this._realtimeController.realtimeSetLocalAttendeeId(e.credentials.attendeeId,e.credentials.externalUserId),this._mediaStreamBroker=n,this._reconnectController=r,this._videoTileController=new he.default(new pe.default,this,this._logger),this._audioMixController=new a.default(this._logger),this._mediaStreamBroker.addMediaStreamBrokerObserver(this._audioMixController),this.meetingSessionContext.logger=this._logger,this._eventController=o}destroy(){return n(this,void 0,void 0,(function*(){this.observerQueue.clear(),this._mediaStreamBroker.removeMediaStreamBrokerObserver(this._audioMixController),this.destroyed=!0}))}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new o.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(e){return this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent||(this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead."),this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!0),this.rtcPeerConnection?this.rtcPeerConnection.getStats(e):null}setAudioProfile(e){this._audioProfile=e}addObserver(e){this.logger.info("adding meeting observer"),this.observerQueue.add(e)}removeObserver(e){this.logger.info("removing meeting observer"),this.observerQueue.delete(e)}forEachObserver(e){for(const t of this.observerQueue)v.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}initSignalingClient(){this.connectionHealthData.reset(),this.meetingSessionContext.signalingClient||(this.meetingSessionContext=new Se.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new d.default,this.meetingSessionContext.videoSendCodecPreferences=this.videoSendCodecPreferences,this.meetingSessionContext.audioProfile=this._audioProfile,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new w.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){this.meetingSessionContext.signalingClient.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then((()=>{const e=()=>n(this,void 0,void 0,(function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()}));this.preStartObserver={handleSignalingClientEvent(t){t.type===T.default.WebSocketClosed&&e()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)})).catch((e=>{this.logger.error(`Signaling task pre-start failed: ${e}`),this.signalingTask=void 0}))}start(e){this.startReturningPromise(e).then((()=>{this.logger.info("start completed")})).catch((e=>{this.logger.error(`start failed: ${e}`)}))}startReturningPromise(e){return!0===(null==e?void 0:e.signalingOnly)?this.prestart():(this.activeSpeakerDetector,new Promise(((e,t)=>{this.sessionStateController.perform(_.default.Connect,(()=>{this.actionConnect(!1).then(e).catch(t)}))})))}connectWithPromises(e){const t=this.meetingSessionContext;this.monitorTask=new N.default(t,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);const i=this.monitorTask.once(),n=new j.default(t).once();this.receiveIndexTask=new W.default(t),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();const r=new K.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new B.default(t),new q.default(t),new O.default(t),new H.default(t),this.receiveIndexTask]).once(),o=new $.default(t).once(r),a=new A.default(t).once(o,n),s=new D.default(t).once(a),d=new J.default(t).once(s),l=new x.default(t).once(d),c=new Q.default(t).once(l),u=new z.default(t).once(c);return new K.default(this.logger,this.wrapTaskName("AudioVideoStart"),[i,((e,t)=>new X.default(this.logger,t,e))(this.configuration.connectionTimeoutMs,new K.default(this.logger,"Peer",[c,u,e?new X.default(this.logger,new V.default(this.logger,"FinalizeConnection",[new Y.default(t),new Z.default(t)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new Z.default(t)]))])}actionConnect(t){var i;return n(this,void 0,void 0,(function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this,this.enableSimulcast=this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(new d.default).hasChromiumWebRTC(),this.enableSimulcast&&this.configuration.enableSVC&&this.logger.warn("SVC cannot be enabled at the same time as simulcast. Disabling SVC, using simulcast."),this.enableSVC=!this.enableSimulcast&&this.configuration.enableSVC&&(new d.default).supportsScalableVideoCoding();const r=!!this.configuration.urls.audioHostURL;if(r?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),new f.default(this.configuration.credentials.attendeeId).hasModality(f.default.MODALITY_CONTENT)?this.meetingSessionContext.transceiverController=new te.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext):this.meetingSessionContext.transceiverController=new ie.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new ee.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new ne.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)),this.meetingSessionContext.volumeIndicatorAdapter=new ge.default(this.logger,this._realtimeController,e.MIN_VOLUME_DECIBELS,e.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.meetingSessionContext.enableSVC=this.enableSVC,this.enableSimulcast){let e=this.meetingSessionContext.videoUplinkBandwidthPolicy;e||(e=new me.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=e),e.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new se.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new ue.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new ce.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new fe.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior),this.meetingSessionContext.videoUplinkBandwidthPolicy.setSVCEnabled(this.enableSVC)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new ae.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;if(new f.default(this.configuration.credentials.attendeeId).hasModality(f.default.MODALITY_CONTENT)){const e=this.configuration.meetingFeatures.contentMaxResolution===u.default.VideoResolutionUHD;e&&this.setVideoMaxBandwidthKbps(2500),this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(e)}else{const e=this.configuration.meetingFeatures.videoMaxResolution===u.default.VideoResolutionFHD;this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(e)}this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver((()=>this.update({needsRenegotiation:!1}))),this.meetingSessionContext.lastKnownVideoAvailability=new m.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new oe.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new le.default,this.meetingSessionContext.videosPaused=new le.default,this.meetingSessionContext.statsCollector=new R.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new c.default(this,this._realtimeController,this.connectionHealthData,new g.default(this.meetingSessionContext.signalingClient,e.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},t||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver((e=>{re.Maybe.of(e.audioVideoDidStartConnecting).map((t=>t.bind(e)(!1)))})),null===(i=this.eventController)||void 0===i||i.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);const o=r&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;this.logger.info("Needs to wait for attendee presence? "+o);const a=this.connectWithPromises(o);try{yield a.run(),this.connectionHealthData.setConnectionStartTime(),this._mediaStreamBroker.addMediaStreamBrokerObserver(this),this.sessionStateController.perform(_.default.FinishConnecting,(()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()}))}catch(e){this.signalingTask=void 0;const t=new h.default(this.getMeetingStatusCode(e)||p.default.TaskFailed);if(this.logger.info(`Start failed: ${t} due to error ${e}.`),this.sessionStateController.state()===y.default.NotConnected)return void this.logger.info("Start failed and not connected. Not cleaning up.");this.sessionStateController.perform(_.default.Fail,(()=>n(this,void 0,void 0,(function*(){yield this.actionDisconnect(t,!0,e),this.handleMeetingSessionStatus(t,e)||this.notifyStop(t,e)}))))}}))}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new X.default(this.logger,new L.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=M.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.forEachObserver((e=>{re.Maybe.of(e.audioVideoDidStart).map((t=>t.bind(e)()))})),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var e;return this.sessionStateController.state()===y.default.NotConnected?(null===(e=this.meetingSessionContext.signalingClient)||void 0===e||e.closeConnection(),this.cleanUpMediaStreamsAfterStop(),Promise.resolve()):new Promise(((e,t)=>{this.sessionStateController.perform(_.default.Disconnect,(()=>{this._reconnectController.disableReconnect(),this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new h.default(p.default.Left),!1,null).then(e).catch(t)}))}))}stop(){this.stopReturningPromise()}actionDisconnect(e,t,i){return n(this,void 0,void 0,(function*(){try{yield new K.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new X.default(this.logger,new F.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch(e){this.logger.info("fail to stop")}try{const e=[new X.default(this.logger,new I.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];this.cleanUpMediaStreamsAfterStop(),yield new K.default(this.logger,this.wrapTaskName("AudioVideoClean"),e).run()}catch(e){this.logger.info("fail to clean")}this.sessionStateController.perform(_.default.FinishDisconnecting,(()=>{t||this.notifyStop(e,i)}))}))}update(e={needsRenegotiation:!0}){let t=e.needsRenegotiation;if(t||(t=void 0===this.meetingSessionContext.peer),t||(t=!this.updateRemoteVideosFromPolicy()),t||(t=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!t)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe");const i=this.sessionStateController.perform(_.default.Update,(()=>{this.actionUpdateWithRenegotiation(!0)}));return i===C.default.Transitioned||i===C.default.DeferredTransition}updateRemoteVideosFromPolicy(){if(this.meetingSessionContext.videoDownlinkBandwidthPolicy&&void 0!==this.meetingSessionContext.videoDownlinkBandwidthPolicy.getVideoPreferences&&void 0!==this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption&&!E.serverSideNetworkAdaptionIsNoneOrDefault(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())){if(!this.sendRemoteVideoUpdate())return!1;if(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption()===E.default.BandwidthProbingAndRemoteVideoQualityAdaption)return this.isNotAddingOrRemovingStreams()}return this.updateRemoteVideosIfNotAddingOrRemovingStreams()}updateRemoteVideosIfNotAddingOrRemovingStreams(){const e=this.detectChangesInVideosToReceive();if(void 0===e)return!1;const t=e.added,i=e.simulcastStreamUpdates,n=e.removed,r=this.meetingSessionContext,o=[];for(const[e,t]of i.entries()){const i=new k.default;if(i.streamId=t,i.attendeeId=r.videoStreamIndex.attendeeIdForStreamId(t),i.mid=r.transceiverController.getMidForStreamId(e),void 0===i.mid)return this.logger.info(`No MID found for stream ID ${e}, cannot update stream without renegotiation`),!1;if(o.push(i),r.transceiverController.setStreamIdForMid(i.mid,t),r.videoStreamIndex.overrideStreamIdMappings(e,t),r.videoTileController.haveVideoTileForAttendeeId(i.attendeeId)){const e=r.videoTileController.getVideoTileForAttendeeId(i.attendeeId);if(!e.setStreamId)return!1;e.setStreamId(t)}}return 0!==o.length&&r.signalingClient.remoteVideoUpdate(o,[]),0===t.length&&0===n.length&&(r.videoStreamIndex.subscribeFrameSent(),!0)}detectChangesInVideosToReceive(){const e=this.meetingSessionContext;if(null===e.videosToReceive)return;if(!(e.transceiverController&&e.transceiverController.getMidForStreamId&&e.transceiverController.setStreamIdForMid&&e.videosToReceive.forEach&&e.signalingClient.remoteVideoUpdate&&e.videoStreamIndex.overrideStreamIdMappings))return;let t=[];const i=new Map;let n=[];if(null===e.lastVideosToReceive)t=e.videosToReceive.array();else{const r=e.videoStreamIndex;e.videosToReceive.forEach((n=>{if(e.lastVideosToReceive.contain(n))return;let o=!1;e.lastVideosToReceive.forEach((e=>{o||r.StreamIdsInSameGroup(e,n)&&(i.set(e,n),o=!0)})),o||t.push(n)})),n=e.lastVideosToReceive.array().filter((t=>{const n=e.videosToReceive.contain(t),r=i.has(t);return!n&&!r}))}return this.logger.info(`Request to update remote videos with added: ${t}, updated: ${[...i.entries()]}, removed: ${n}`),{added:t,removed:n,simulcastStreamUpdates:i}}isNotAddingOrRemovingStreams(){const e=this.detectChangesInVideosToReceive();if(void 0===e)return!1;const t=e.added,i=e.removed;return 0===t.length&&0===i.length}sendRemoteVideoUpdate(){const e=this.meetingSessionContext;if(null===e.videosToReceive)return!1;const t=e.videosToReceive.array().map((t=>e.videoStreamIndex.groupIdForStreamId(t))),i=de.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(e,t,e.videoDownlinkBandwidthPolicy.getVideoPreferences()),n=new Map,r=[];for(const t of i){let i=!1;if(e.lastVideoSubscriptionConfiguration.has(t.groupId)){const n=e.lastVideoSubscriptionConfiguration.get(t.groupId);t.equals(n)||(this.logger.debug(`${JSON.stringify(t)} does not equal ${JSON.stringify(n)}, sending update`),i=!0)}else i=!0;n.set(t.groupId,t),i&&r.push(t)}e.lastVideoSubscriptionConfiguration=n;const o=[];if(null!==e.lastVideosToReceive){const i=new Set(t);for(const t of e.lastVideosToReceive.array()){const n=e.videoStreamIndex.groupIdForStreamId(t);if(!i.has(n)){const t=e.transceiverController.getMidForGroupId(n);if(void 0===t){e.logger.warn(`Could not find MID for group ID to remove: ${n}`);continue}o.push(t)}}}return 0===r.length&&0===o.length||e.signalingClient.remoteVideoUpdate(r,o),!0}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){const e=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(e)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;const e=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!(!e||!e.headerExtensions)&&e.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00"===e.uri))}restartLocalVideo(e){const t=()=>n(this,void 0,void 0,(function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),e()})),i=this.sessionStateController.perform(_.default.Update,(()=>{t()}));return i===C.default.Transitioned||i===C.default.DeferredTransition}replaceLocalVideo(e){return n(this,void 0,void 0,(function*(){if(!e||e.getVideoTracks().length<1)throw new Error("could not acquire video track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");const t=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(t){const i=t.state(),n=e.getVideoTracks()[0].getSettings();t.bindVideoStream(i.boundAttendeeId,!0,e,n.width,n.height,i.streamId,i.boundExternalUserId)}yield this.meetingSessionContext.transceiverController.setVideoInput(e.getVideoTracks()[0]),this.meetingSessionContext.activeVideoInput=e,this.logger.info("Local video input is updated")}))}replaceLocalAudio(e){return n(this,void 0,void 0,(function*(){if(!e||e.getAudioTracks().length<1)throw new Error("could not acquire audio track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime();if(!(yield this.meetingSessionContext.transceiverController.replaceAudioTrack(e.getAudioTracks()[0])))throw new Error("Failed to replace audio track");this.meetingSessionContext.activeAudioInput=e,this.logger.info("Local audio input is updated")}))}actionUpdateWithRenegotiation(e){return n(this,void 0,void 0,(function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new K.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new G.default(this.meetingSessionContext),new X.default(this.logger,new K.default(this.logger,"UpdateSession",[new A.default(this.meetingSessionContext),new D.default(this.meetingSessionContext),new J.default(this.meetingSessionContext),new x.default(this.meetingSessionContext),new Q.default(this.meetingSessionContext),new Z.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),e&&this.sessionStateController.perform(_.default.FinishUpdating,(()=>{this.actionFinishUpdating()}))}catch(e){this.sessionStateController.perform(_.default.FinishUpdating,(()=>{const t=new h.default(this.getMeetingStatusCode(e)||p.default.TaskFailed);t.statusCode()!==p.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(t,e)}))}}))}notifyStop(e,t){var i;if(this.forEachObserver((t=>{re.Maybe.of(t.audioVideoDidStop).map((i=>i.bind(t)(e)))})),this.promotedToPrimaryMeeting&&t&&this.forEachObserver((e=>{this.promotedToPrimaryMeeting=!1,re.Maybe.of(e.audioVideoWasDemotedFromPrimaryMeeting).map((t=>t.bind(e)(new h.default(p.default.SignalingInternalServerError))))})),this.eventController){const{signalingOpenDurationMs:n,poorConnectionCount:r,startTimeMs:o,iceGatheringDurationMs:a,attendeePresenceDurationMs:s,meetingStartDurationMs:d}=this.meetingSessionContext,l={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:null===o?0:Math.round(Date.now()-o),meetingStatus:p.default[e.statusCode()],signalingOpenDurationMs:n,iceGatheringDurationMs:a,attendeePresenceDurationMs:s,poorConnectionCount:r,meetingStartDurationMs:d,retryCount:this.totalRetryCount},c=t&&t.message||(null===(i=e.toString)||void 0===i?void 0:i.call(e))||"";0===l.meetingDurationMs?(l.meetingErrorMessage=c,delete l.meetingDurationMs,delete l.attendeePresenceDurationMs,delete l.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",l)):e.isFailure()||e.isAudioConnectionFailure()?(l.meetingErrorMessage=c,this.eventController.publishEvent("meetingFailed",l)):this.eventController.publishEvent("meetingEnded",l)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{const e=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(e)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(e,t){const i=this._reconnectController.retryWithBackoff((()=>n(this,void 0,void 0,(function*(){this.sessionStateController.state()===y.default.NotConnected?this.sessionStateController.perform(_.default.Connect,(()=>{this.actionConnect(!0)})):this.sessionStateController.perform(_.default.Reconnect,(()=>{this.actionReconnect(e)})),this.totalRetryCount+=1}))),(()=>{this.logger.info("canceled retry")}));return i||this.sessionStateController.perform(_.default.Fail,(()=>{this.actionDisconnect(e,!1,t)})),i}actionReconnect(e){return n(this,void 0,void 0,(function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver((e=>{re.Maybe.of(e.audioVideoDidStartConnecting).map((t=>t.bind(e)(!0)))}))),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset();try{yield new K.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new X.default(this.logger,new K.default(this.logger,"Media",[new P.default(this.meetingSessionContext),new K.default(this.logger,"Signaling",[new L.default(this.meetingSessionContext),new O.default(this.meetingSessionContext),new H.default(this.meetingSessionContext)]),new $.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new G.default(this.meetingSessionContext),new X.default(this.logger,new K.default(this.logger,"UpdateSession",[new A.default(this.meetingSessionContext),new D.default(this.meetingSessionContext),new J.default(this.meetingSessionContext),new x.default(this.meetingSessionContext),new Q.default(this.meetingSessionContext),new Z.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(_.default.FinishConnecting,(()=>{if(this.eventController){const{signalingOpenDurationMs:t,poorConnectionCount:i,startTimeMs:n,iceGatheringDurationMs:r,attendeePresenceDurationMs:o,meetingStartDurationMs:a}=this.meetingSessionContext,s={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-n),meetingStatus:p.default[e.statusCode()],signalingOpenDurationMs:t,iceGatheringDurationMs:r,attendeePresenceDurationMs:o,poorConnectionCount:i,meetingStartDurationMs:a,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",s)}this.actionFinishConnecting()}))}catch(e){this.sessionStateController.perform(_.default.FinishConnecting,(()=>{this.logger.info("failed to reconnect audio-video session");const t=new h.default(this.getMeetingStatusCode(e)||p.default.TaskFailed);this.handleMeetingSessionStatus(t,e)}))}this.connectionHealthData.setConnectionStartTime()}))}wrapTaskName(e){return`${e}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}cleanUpMediaStreamsAfterStop(){this._mediaStreamBroker.removeMediaStreamBrokerObserver(this),this.meetingSessionContext.activeAudioInput=void 0,this.meetingSessionContext.activeVideoInput=void 0}getMeetingStatusCode(e){const t=/the meeting status code: (\d+)/.exec(e&&e.message);return t&&t.length>1?Number.parseInt(t[1],10):null}enforceBandwidthLimitationForSender(e){return n(this,void 0,void 0,(function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(e)}))}handleMeetingSessionStatus(e,t){if(this.logger.info(`handling status: ${p.default[e.statusCode()]}`),e.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(e),e.statusCode()===p.default.IncompatibleSDP)return this.restartLocalVideo((()=>{this.logger.info("handled incompatible SDP by attempting to restart video")})),!0;if(e.statusCode()===p.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver((e=>{re.Maybe.of(e.videoSendDidBecomeUnavailable).map((t=>t.bind(e)()))})),!1;if(e.statusCode()===p.default.AudioVideoWasRemovedFromPrimaryMeeting)return this.forEachObserver((t=>{re.Maybe.of(t.audioVideoWasDemotedFromPrimaryMeeting).map((i=>i.bind(t)(e)))})),!1;if(e.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(e.isFailure()||e.isTerminal())&&this.meetingSessionContext.reconnectController){const i=this.reconnect(e,t);return i?this.logger.warn(`will retry due to status code ${p.default[e.statusCode()]}${t?` and error: ${t.message}`:""}`):this.logger.error(`failed with status code ${p.default[e.statusCode()]}${t?` and error: ${t.message}`:""}`),i}return!1}setVideoMaxBandwidthKbps(e){if(e<=0)throw new Error("Max bandwidth kbps has to be greater than 0");this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${e} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(e)),this.maxUplinkBandwidthKbps=e}handleHasBandwidthPriority(e){return n(this,void 0,void 0,(function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink)return this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(e),void(yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController());const t=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(e);const i=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();t!==i&&(this.logger.info(`video send bandwidth priority ${e} max has changed from ${t} kbps to ${i} kbps`),yield this.enforceBandwidthLimitationForSender(i))}}))}pauseReceivingStream(e){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([e])}resumeReceivingStream(e){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([e])}setVideoCodecSendPreferences(e){this.videoSendCodecPreferences=e,this.meetingSessionContext.videoSendCodecPreferences=e,this.sessionStateController.state()!==y.default.NotConnected&&this.update({needsRenegotiation:!0})}getRemoteVideoSources(){const{videoStreamIndex:e}=this.meetingSessionContext;if(!e)return this.logger.info("meeting has not started"),[];const t=this.configuration.credentials.attendeeId;return e.allVideoSendingSourcesExcludingSelf(t)}encodingSimulcastLayersDidChange(e){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver((t=>{re.Maybe.of(t.encodingSimulcastLayersDidChange).map((i=>i.bind(t)(e)))}))}promoteToPrimaryMeeting(e){return this.actionPromoteToPrimaryMeeting(e)}actionPromoteToPrimaryMeeting(e){return n(this,void 0,void 0,(function*(){let t=new h.default(p.default.SignalingRequestFailed);return yield new K.default(this.logger,this.wrapTaskName("PromoteToPrimaryMeeting"),[new X.default(this.logger,new U.default(this.meetingSessionContext,e,(e=>{t=e})),this.configuration.connectionTimeoutMs)]).run(),this.promotedToPrimaryMeeting=t.statusCode()===p.default.OK,t}))}demoteFromPrimaryMeeting(){this.meetingSessionContext.signalingClient.demoteFromPrimaryMeeting(),this.forEachObserver((e=>{re.Maybe.of(e.audioVideoWasDemotedFromPrimaryMeeting).map((t=>t.bind(e)(new h.default(p.default.OK))))}))}videoInputDidChange(e){return n(this,void 0,void 0,(function*(){this.logger.info("Receive a video input change event"),this.meetingSessionContext&&this.meetingSessionContext.peer?this._videoTileController.hasStartedLocalVideoTile()&&(e?yield this.replaceLocalVideo(e):this._videoTileController.stopLocalVideoTile()):this.logger.info("Skip updating video input because there is no active meeting and peer connection")}))}audioInputDidChange(e){return n(this,void 0,void 0,(function*(){if(this.logger.info("Receive an audio input change event"),this.meetingSessionContext&&this.meetingSessionContext.peer){if(!e)try{e=yield this.mediaStreamBroker.acquireAudioInputStream()}catch(e){return void this.logger.error("Could not acquire audio track from mediaStreamBroker")}yield this.replaceLocalAudio(e)}else this.logger.info("Skip updating audio input because there is no active meeting and peer connection")}))}};return DefaultAudioVideoController.default=ve,ve.MIN_VOLUME_DECIBELS=-42,ve.MAX_VOLUME_DECIBELS=-14,ve.PING_PONG_INTERVAL_MS=1e4,DefaultAudioVideoController}DefaultVolumeIndicatorAdapter$1.default=DefaultVolumeIndicatorAdapter,DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS=2,DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME=0,DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH=1;var DefaultAudioVideoFacade$1={},__awaiter$k=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(DefaultAudioVideoFacade$1,"__esModule",{value:!0});const VideoTransformDevice_1=VideoTransformDevice;class DefaultAudioVideoFacade{constructor(e,t,i,n,r,o){this.audioVideoController=e,this.videoTileController=t,this.realtimeController=i,this.audioMixController=n,this.deviceController=r,this.contentShareController=o}addObserver(e){this.audioVideoController.addObserver(e),this.trace("addObserver")}removeObserver(e){this.audioVideoController.removeObserver(e),this.trace("removeObserver")}setAudioProfile(e){this.trace("setAudioProfile",e),this.audioVideoController.setAudioProfile(e)}start(e){this.audioVideoController.start(e),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats(e){return this.trace("getRTCPeerConnectionStats",e?e.id:null),this.audioVideoController.getRTCPeerConnectionStats(e)}bindAudioElement(e){const t=this.audioMixController.bindAudioElement(e);return this.trace("bindAudioElement",e.id,t),t}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver(e){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver(e)}removeAudioMixObserver(e){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver(e)}bindVideoElement(e,t){this.videoTileController.bindVideoElement(e,t),this.trace("bindVideoElement",{tileId:e,videoElementId:t.id})}unbindVideoElement(e,t=!0){this.videoTileController.unbindVideoElement(e,t),this.trace("unbindVideoElement",{tileId:e,cleanUpVideoElement:t})}startLocalVideoTile(){const e=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,e),e}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){const e=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,e),e}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){const e=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),e}pauseVideoTile(e){this.videoTileController.pauseVideoTile(e),this.trace("pauseVideoTile",e)}unpauseVideoTile(e){this.videoTileController.unpauseVideoTile(e),this.trace("unpauseVideoTile",e)}getVideoTile(e){const t=this.videoTileController.getVideoTile(e);return this.trace("getVideoTile",e),t}getAllRemoteVideoTiles(){const e=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),e}getAllVideoTiles(){const e=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),e}addVideoTile(){const e=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,e.state()),e}removeVideoTile(e){this.videoTileController.removeVideoTile(e),this.trace("removeVideoTile",e)}removeVideoTilesByAttendeeId(e){const t=this.videoTileController.removeVideoTilesByAttendeeId(e);return this.trace("removeVideoTilesByAttendeeId",e,t),t}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile(e){const t=this.videoTileController.captureVideoTile(e);return this.trace("captureVideoTile",e),t}realtimeSubscribeToAttendeeIdPresence(e){this.realtimeController.realtimeSubscribeToAttendeeIdPresence(e),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence(e){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeSetCanUnmuteLocalAudio(e),this.trace("realtimeSetCanUnmuteLocalAudio",e)}realtimeSubscribeToSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio(e),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio(e),this.trace("realtimeUnsubscribeToSetCanUnmuteLocalAudio")}realtimeCanUnmuteLocalAudio(){const e=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,e),e}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){const e=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),e}realtimeSubscribeToMuteAndUnmuteLocalAudio(e){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(e),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(e){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(e),this.trace("realtimeUnsubscribeToMuteAndUnmuteLocalAudio")}realtimeIsLocalAudioMuted(){const e=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),e}realtimeSubscribeToVolumeIndicator(e,t){this.realtimeController.realtimeSubscribeToVolumeIndicator(e,t),this.trace("realtimeSubscribeToVolumeIndicator",e)}realtimeUnsubscribeFromVolumeIndicator(e,t){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator(e,t),this.trace("realtimeUnsubscribeFromVolumeIndicator",e,t)}realtimeSubscribeToLocalSignalStrengthChange(e){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(e),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange(e){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(e),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage(e,t,i){this.realtimeController.realtimeSendDataMessage(e,t,i),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage(e,t){this.realtimeController.realtimeSubscribeToReceiveDataMessage(e,t),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage(e){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(e),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError(e){this.realtimeController.realtimeSubscribeToFatalError(e),this.trace("realtimeSubscribeToFatalError")}realtimeUnsubscribeToFatalError(e){this.realtimeController.realtimeUnsubscribeToFatalError(e),this.trace("realtimeUnsubscribeToFatalError")}subscribeToActiveSpeakerDetector(e,t,i,n){this.audioVideoController.activeSpeakerDetector.subscribe(e,t,i,n),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector(e){this.audioVideoController.activeSpeakerDetector.unsubscribe(e),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices(e=!1){return __awaiter$k(this,void 0,void 0,(function*(){const t=yield this.deviceController.listAudioInputDevices(e);return this.trace("listAudioInputDevices",e,t),t}))}listVideoInputDevices(e=!1){return __awaiter$k(this,void 0,void 0,(function*(){const t=yield this.deviceController.listVideoInputDevices(e);return this.trace("listVideoInputDevices",e,t),t}))}listAudioOutputDevices(e=!1){return __awaiter$k(this,void 0,void 0,(function*(){const t=yield this.deviceController.listAudioOutputDevices(e);return this.trace("listAudioOutputDevices",e,t),t}))}startAudioInput(e){return __awaiter$k(this,void 0,void 0,(function*(){return this.trace("startAudioInput",e),this.deviceController.startAudioInput(e)}))}stopAudioInput(){return __awaiter$k(this,void 0,void 0,(function*(){return this.trace("stopAudioInput"),this.deviceController.stopAudioInput()}))}startVideoInput(e){return __awaiter$k(this,void 0,void 0,(function*(){return VideoTransformDevice_1.isVideoTransformDevice(e)?this.trace("startVideoInput with transform device"):this.trace("startVideoInput",e),this.deviceController.startVideoInput(e)}))}stopVideoInput(){return __awaiter$k(this,void 0,void 0,(function*(){return this.trace("stopVideoInput"),this.deviceController.stopVideoInput()}))}chooseAudioOutput(e){const t=this.deviceController.chooseAudioOutput(e);return this.trace("chooseAudioOutput",e),t}addDeviceChangeObserver(e){this.deviceController.addDeviceChangeObserver(e),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(e){this.deviceController.removeDeviceChangeObserver(e),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){const e=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),e}startVideoPreviewForVideoInput(e){this.deviceController.startVideoPreviewForVideoInput(e),this.trace("startVideoPreviewForVideoInput",e.id)}stopVideoPreviewForVideoInput(e){this.deviceController.stopVideoPreviewForVideoInput(e),this.trace("stopVideoPreviewForVideoInput",e.id)}setDeviceLabelTrigger(e){this.deviceController.setDeviceLabelTrigger(e),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(e){const t=this.deviceController.mixIntoAudioInput(e);return this.trace("mixIntoAudioInput",e.id),t}chooseVideoInputQuality(e,t,i){this.deviceController.chooseVideoInputQuality(e,t,i),this.trace("chooseVideoInputQuality",{width:e,height:t,frameRate:i})}setVideoMaxBandwidthKbps(e){this.audioVideoController.setVideoMaxBandwidthKbps(e),this.trace("setVideoMaxBandwidthKbps",e)}setVideoCodecSendPreferences(e){this.audioVideoController.setVideoCodecSendPreferences(e),this.trace("setVideoCodecSendPreferences",e)}getVideoInputQualitySettings(){const e=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),e}setContentAudioProfile(e){this.trace("setContentAudioProfile",e),this.contentShareController.setContentAudioProfile(e)}enableSimulcastForContentShare(e,t){this.trace("enableSimulcastForContentShare"),this.contentShareController.enableSimulcastForContentShare(e,t)}enableSVCForContentShare(e){this.trace("enableSVCForContentShare"),this.contentShareController.enableSVCForContentShare(e)}startContentShare(e){const t=this.contentShareController.startContentShare(e);return this.trace("startContentShare"),t}startContentShareFromScreenCapture(e,t){const i=this.contentShareController.startContentShareFromScreenCapture(e,t);return this.trace("startContentShareFromScreenCapture"),i}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver(e){this.contentShareController.addContentShareObserver(e),this.trace("addContentShareObserver")}removeContentShareObserver(e){this.contentShareController.removeContentShareObserver(e),this.trace("removeContentShareObserver")}setContentShareVideoCodecPreferences(e){this.contentShareController.setContentShareVideoCodecPreferences(e),this.trace("setContentShareVideoCodecPreferences")}trace(e,t,i){let n=`API/DefaultAudioVideoFacade/${this.audioVideoController.configuration.meetingId}/${this.audioVideoController.configuration.credentials.attendeeId}/${e}`;void 0!==t&&(n+=` ${JSON.stringify(t)}`),void 0!==i&&(n+=` -> ${JSON.stringify(i)}`),this.audioVideoController.logger.info(n)}getRemoteVideoSources(){const e=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,e),e}get transcriptionController(){return this.realtimeController.transcriptionController}promoteToPrimaryMeeting(e){this.audioVideoController.removeObserver(this),this.audioVideoController.addObserver(this);const t=this.audioVideoController.promoteToPrimaryMeeting(e);return this.trace("promoteToPrimaryMeeting",null,t),t}demoteFromPrimaryMeeting(){this.trace("demoteFromPrimaryMeeting"),this.audioVideoController.demoteFromPrimaryMeeting()}audioVideoWasDemotedFromPrimaryMeeting(e){this.contentShareController.stopContentShare(),this.audioVideoController.removeObserver(this)}}DefaultAudioVideoFacade$1.default=DefaultAudioVideoFacade;var DefaultContentShareController$1={},MeetingSessionConfiguration$1={},MeetingFeatures$1={},__importDefault$r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MeetingFeatures$1,"__esModule",{value:!0});const VideoQualitySettings_1$3=__importDefault$r(VideoQualitySettings$1);class MeetingFeatures{constructor(e=VideoQualitySettings_1$3.default.VideoResolutionHD,t=VideoQualitySettings_1$3.default.VideoResolutionFHD){this.videoMaxResolution=e,this.contentMaxResolution=t}clone(){return new MeetingFeatures(this.videoMaxResolution,this.contentMaxResolution)}}MeetingFeatures$1.default=MeetingFeatures;var MeetingSessionCredentials$1={};Object.defineProperty(MeetingSessionCredentials$1,"__esModule",{value:!0});class MeetingSessionCredentials{constructor(){this.attendeeId=null,this.externalUserId=null,this.joinToken=null}toJSON(){return{attendeeId:this.attendeeId,joinToken:null===this.joinToken?null:"<redacted>"}}}MeetingSessionCredentials$1.default=MeetingSessionCredentials;var MeetingSessionURLs$1={};Object.defineProperty(MeetingSessionURLs$1,"__esModule",{value:!0});class MeetingSessionURLs{constructor(){this._audioHostURL=null,this._signalingURL=null,this._turnControlURL=null,this._eventIngestionURL=null,this.urlRewriter=e=>e}get audioHostURL(){return this.urlRewriter(this._audioHostURL)}set audioHostURL(e){this._audioHostURL=e}get signalingURL(){return this.urlRewriter(this._signalingURL)}set signalingURL(e){this._signalingURL=e}get turnControlURL(){return this.urlRewriter(this._turnControlURL)}set turnControlURL(e){this._turnControlURL=e}get eventIngestionURL(){return this.urlRewriter(this._eventIngestionURL)}set eventIngestionURL(e){this._eventIngestionURL=e}}MeetingSessionURLs$1.default=MeetingSessionURLs;var __importDefault$q=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MeetingSessionConfiguration$1,"__esModule",{value:!0});const ConnectionHealthPolicyConfiguration_1=__importDefault$q(ConnectionHealthPolicyConfiguration$1),VideoQualitySettings_1$2=__importDefault$q(VideoQualitySettings$1),Utils_1$3=Utils$1,MeetingFeatures_1=__importDefault$q(MeetingFeatures$1),MeetingSessionCredentials_1$1=__importDefault$q(MeetingSessionCredentials$1),MeetingSessionURLs_1=__importDefault$q(MeetingSessionURLs$1);class MeetingSessionConfiguration{constructor(e,t){var i,n;if(this.meetingId=null,this.externalMeetingId=null,this.credentials=null,this.urls=null,this.connectionTimeoutMs=15e3,this.attendeePresenceTimeoutMs=0,this.connectionHealthPolicyConfiguration=new ConnectionHealthPolicyConfiguration_1.default,this.reconnectTimeoutMs=12e4,this.reconnectFixedWaitMs=0,this.reconnectShortBackOffMs=1e3,this.reconnectLongBackOffMs=5e3,this.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.enableSVC=!1,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.keepLastFrameWhenPaused=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1,this.meetingFeatures=new MeetingFeatures_1.default,e){(e=Utils_1$3.toLowerCasePropertyNames(e)).meeting&&(e=e.meeting),this.meetingId=e.meetingid,this.externalMeetingId=e.externalmeetingid,this.urls=new MeetingSessionURLs_1.default,this.urls.audioHostURL=e.mediaplacement.audiohosturl,this.urls.signalingURL=e.mediaplacement.signalingurl,this.urls.turnControlURL=e.mediaplacement.turncontrolurl,e.mediaplacement.eventingestionurl&&(this.urls.eventIngestionURL=e.mediaplacement.eventingestionurl);const t=(e,t)=>{switch(e){case"None":return VideoQualitySettings_1$2.default.VideoDisabled;case"HD":return VideoQualitySettings_1$2.default.VideoResolutionHD;case"FHD":return VideoQualitySettings_1$2.default.VideoResolutionFHD;case"UHD":return VideoQualitySettings_1$2.default.VideoResolutionUHD;default:return t}};if(void 0!==(null===(i=e.meetingfeatures)||void 0===i?void 0:i.video)||void 0!==(null===(n=e.meetingfeatures)||void 0===n?void 0:n.content)){const i=void 0===e.meetingfeatures.video?"HD":e.meetingfeatures.video.maxresolution,n=void 0===e.meetingfeatures.content?"FHD":e.meetingfeatures.content.maxresolution;this.meetingFeatures=new MeetingFeatures_1.default(t(i,VideoQualitySettings_1$2.default.VideoResolutionHD),t(n,VideoQualitySettings_1$2.default.VideoResolutionFHD))}}t&&((t=Utils_1$3.toLowerCasePropertyNames(t)).attendee&&(t=t.attendee),this.credentials=new MeetingSessionCredentials_1$1.default,this.credentials.attendeeId=t.attendeeid,this.credentials.externalUserId=t.externaluserid,this.credentials.joinToken=t.jointoken)}}MeetingSessionConfiguration$1.default=MeetingSessionConfiguration;var DefaultSimulcastUplinkPolicyForContentShare$1={},__importDefault$p=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultSimulcastUplinkPolicyForContentShare$1,"__esModule",{value:!0});const SimulcastContentShareTransceiverController_1=__importDefault$p(SimulcastContentShareTransceiverController$1);class DefaultSimulcastUplinkPolicyForContentShare{constructor(e,t){this.logger=e,this.encodingParams=t,this.videoIndex=null,this.currLocalDescriptions=[],this.nextLocalDescriptions=[],this.enableUhdContent=!1,this.defaultHiTargetBitrateKbps=1200,this.defaultLowTargetBitrateKbps=300}updateConnectionMetric(e){}chooseMediaTrackConstraints(){}chooseEncodingParameters(){var e,t,i,n,r,o,a,s,d,l,c,u;const h=new Map,p=SimulcastContentShareTransceiverController_1.default.NAME_ARR_ASCENDING;return h.set(p[0],{rid:p[0],active:!0,scaleResolutionDownBy:(null===(t=null===(e=this.encodingParams)||void 0===e?void 0:e.low)||void 0===t?void 0:t.scaleResolutionDownBy)||2,maxBitrate:1e3*((null===(n=null===(i=this.encodingParams)||void 0===i?void 0:i.low)||void 0===n?void 0:n.maxBitrateKbps)||this.defaultLowTargetBitrateKbps),maxFramerate:(null===(o=null===(r=this.encodingParams)||void 0===r?void 0:r.low)||void 0===o?void 0:o.maxFramerate)||5}),h.set(p[1],{rid:p[1],active:!0,scaleResolutionDownBy:(null===(s=null===(a=this.encodingParams)||void 0===a?void 0:a.high)||void 0===s?void 0:s.scaleResolutionDownBy)||1,maxBitrate:1e3*((null===(l=null===(d=this.encodingParams)||void 0===d?void 0:d.high)||void 0===l?void 0:l.maxBitrateKbps)||this.defaultHiTargetBitrateKbps),maxFramerate:null===(u=null===(c=this.encodingParams)||void 0===c?void 0:c.high)||void 0===u?void 0:u.maxFramerate}),this.getQualityMapString(h),h}updateIndex(e){this.videoIndex=e}wantsResubscribe(){var e,t;let i=!1;this.nextLocalDescriptions=null===(e=this.videoIndex)||void 0===e?void 0:e.localStreamDescriptions();for(let e=0;e<(null===(t=this.nextLocalDescriptions)||void 0===t?void 0:t.length);e++){const t=this.nextLocalDescriptions[e].streamId;if(0!==t&&t){const n=this.currLocalDescriptions.findIndex((e=>e.streamId===t));-1!==n&&this.nextLocalDescriptions[e].disabledByWebRTC!==this.currLocalDescriptions[n].disabledByWebRTC&&(i=!0)}}return this.currLocalDescriptions=this.nextLocalDescriptions,i}chooseCaptureAndEncodeParameters(){}maxBandwidthKbps(){return this.enableUhdContent?2e3:1200}setIdealMaxBandwidthKbps(e){}setHasBandwidthPriority(e){}setHighResolutionFeatureEnabled(e){this.enableUhdContent=e,this.defaultHiTargetBitrateKbps=e?2e3:1200,this.defaultLowTargetBitrateKbps=e?500:300}getQualityMapString(e){var t;let i="";const n=null===(t=this.videoIndex)||void 0===t?void 0:t.localStreamDescriptions();(null==n?void 0:n.length)>0&&(e.forEach((e=>{let t=!1;t="low"===e.rid?n[0].disabledByWebRTC:n[1].disabledByWebRTC,i+=`{ rid: ${e.rid} active:${e.active} disabledByWebRTC: ${t} maxBitrate:${e.maxBitrate} scaleResolutionDownBy:${e.scaleResolutionDownBy} maxFrameRate:${e.maxFramerate}`})),this.logger.info(`simulcast: content policy:chooseEncodingParameters newQualityMap: ${i}`))}addObserver(e){}removeObserver(e){}forEachObserver(e){}}DefaultSimulcastUplinkPolicyForContentShare$1.default=DefaultSimulcastUplinkPolicyForContentShare;var __awaiter$j=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$o=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultContentShareController$1,"__esModule",{value:!0});const VideoQualitySettings_1$1=__importDefault$o(VideoQualitySettings$1),MeetingSessionConfiguration_1=__importDefault$o(MeetingSessionConfiguration$1),MeetingSessionCredentials_1=__importDefault$o(MeetingSessionCredentials$1),DefaultModality_1=__importDefault$o(DefaultModality$1),AsyncScheduler_1$2=__importDefault$o(AsyncScheduler$1),Types_1=Types,DefaultSimulcastUplinkPolicyForContentShare_1=__importDefault$o(DefaultSimulcastUplinkPolicyForContentShare$1),ContentShareConstants_1=__importDefault$o(ContentShareConstants$1);class DefaultContentShareController{constructor(e,t,i){this.mediaStreamBroker=e,this.contentAudioVideo=t,this.attendeeAudioVideo=i,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure(e){const t=new MeetingSessionConfiguration_1.default;return t.meetingId=e.meetingId,t.externalMeetingId=e.externalMeetingId,t.urls=e.urls,t.disablePeriodicKeyframeRequestOnContentSender=e.disablePeriodicKeyframeRequestOnContentSender,t.credentials=new MeetingSessionCredentials_1.default,t.credentials.attendeeId=e.credentials.attendeeId+ContentShareConstants_1.default.Modality,t.credentials.externalUserId=e.credentials.externalUserId,t.credentials.joinToken=e.credentials.joinToken+ContentShareConstants_1.default.Modality,t.meetingFeatures=e.meetingFeatures.clone(),t}setContentAudioProfile(e){this.contentAudioVideo.setAudioProfile(e)}enableSimulcastForContentShare(e,t){e?(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=new DefaultSimulcastUplinkPolicyForContentShare_1.default(this.contentAudioVideo.logger,t)):(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=void 0)}enableSVCForContentShare(e){this.contentAudioVideo.configuration.enableSVC=!!e}startContentShare(e){return __awaiter$j(this,void 0,void 0,(function*(){if(e)if(this.contentAudioVideo.configuration.meetingFeatures.contentMaxResolution!==VideoQualitySettings_1$1.default.VideoDisabled){this.mediaStreamBroker.mediaStream=e;for(let e=0;e<this.mediaStreamBroker.mediaStream.getTracks().length;e++)this.mediaStreamBroker.mediaStream.getTracks()[e].addEventListener("ended",(()=>{this.stopContentShare()}));this.contentAudioVideo.start()}else this.contentAudioVideo.logger.info("Could not start content because max content resolution was set to None")}))}startContentShareFromScreenCapture(e,t){return __awaiter$j(this,void 0,void 0,(function*(){const i=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream(e,t);return yield this.startContentShare(i),i}))}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver((e=>{Types_1.Maybe.of(e.contentShareDidPause).map((t=>t.call(e)))}))}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver((e=>{Types_1.Maybe.of(e.contentShareDidUnpause).map((t=>t.call(e)))}))}setContentShareVideoCodecPreferences(e){this.contentAudioVideo.setVideoCodecSendPreferences(e)}destroy(){return __awaiter$j(this,void 0,void 0,(function*(){this.contentAudioVideo&&(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)}))}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver(e){this.observerQueue.add(e)}removeContentShareObserver(e){this.observerQueue.delete(e)}forEachContentShareObserver(e){for(const t of this.observerQueue)AsyncScheduler_1$2.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}audioVideoDidStart(){var e;(null===(e=this.mediaStreamBroker.mediaStream)||void 0===e?void 0:e.getVideoTracks().length)>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}audioVideoDidStop(e){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver((e=>{Types_1.Maybe.of(e.contentShareDidStop).map((t=>t.call(e)))}))}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence(((e,t,i,n)=>{const r=new DefaultModality_1.default(e).hasModality(DefaultModality_1.default.MODALITY_CONTENT),o=new DefaultModality_1.default(e).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!r||!o||!t||this.contentShareTile)return;const a=this.mediaStreamBroker.mediaStream;if(null==a?void 0:a.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();const e=a.getVideoTracks()[0];let t,i;if(e.getSettings){const n=e.getSettings();t=n.width,i=n.height}else{const n=e.getCapabilities();t=n.width,i=n.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,a,t,i,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver((e=>{Types_1.Maybe.of(e.contentShareDidStart).map((t=>t.call(e)))}))}))}}DefaultContentShareController$1.default=DefaultContentShareController;var DefaultEventController$1={},Destroyable={};function isDestroyable(e){return e&&"destroy"in e}Object.defineProperty(Destroyable,"__esModule",{value:!0}),Destroyable.isDestroyable=void 0,Destroyable.isDestroyable=isDestroyable;var EventIngestionConfiguration$1={},EventBufferConfiguration$1={};Object.defineProperty(EventBufferConfiguration$1,"__esModule",{value:!0});class EventBufferConfiguration{constructor(e=5e3,t=2,i=64,n=100,r=15){this.flushIntervalMs=e,this.flushSize=t,this.maxBufferCapacityKb=i,this.totalBufferItems=n,this.retryCountLimit=r}}EventBufferConfiguration$1.default=EventBufferConfiguration;var __importDefault$n=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(EventIngestionConfiguration$1,"__esModule",{value:!0});const EventBufferConfiguration_1=__importDefault$n(EventBufferConfiguration$1);class EventIngestionConfiguration{constructor(e,t,i=new EventBufferConfiguration_1.default){this.eventsClientConfiguration=e,this.ingestionURL=t,this.eventBufferConfiguration=i}}EventIngestionConfiguration$1.default=EventIngestionConfiguration;var DefaultMeetingEventReporter$1={},InMemoryJSONEventBuffer$1={},FullJitterBackoff$1={};Object.defineProperty(FullJitterBackoff$1,"__esModule",{value:!0});class FullJitterBackoff{constructor(e,t,i){this.fixedWaitMs=e,this.shortBackoffMs=t,this.longBackoffMs=i,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){const e=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,e}}FullJitterBackoff$1.default=FullJitterBackoff;var DefaultUserAgentParser$1={},__importDefault$m=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultUserAgentParser$1,"__esModule",{value:!0});const ua_parser_js_1$1=uaParserExports,Versioning_1$5=__importDefault$m(Versioning$1);class DefaultUserAgentParser{constructor(e){var t,i,n,r,o,a,s;try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1$1.UAParser(navigator.userAgent).getResult():void 0}catch(t){e.error(t.message)}this.browserMajorVersion=(null===(n=null===(i=null===(t=this.parserResult)||void 0===t?void 0:t.browser)||void 0===i?void 0:i.version)||void 0===n?void 0:n.split(".")[0])||DefaultUserAgentParser.UNAVAILABLE,this.browserName=(null===(r=this.parserResult)||void 0===r?void 0:r.browser.name)||DefaultUserAgentParser.UNAVAILABLE,this.browserVersion=(null===(o=this.parserResult)||void 0===o?void 0:o.browser.version)||DefaultUserAgentParser.UNAVAILABLE,this.deviceName=[(null===(a=this.parserResult)||void 0===a?void 0:a.device.vendor)||"",(null===(s=this.parserResult)||void 0===s?void 0:s.device.model)||""].join(" ").trim()||DefaultUserAgentParser.UNAVAILABLE}getParserResult(){var e,t;return{browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,osName:(null===(e=this.parserResult)||void 0===e?void 0:e.os.name)||DefaultUserAgentParser.UNAVAILABLE,osVersion:(null===(t=this.parserResult)||void 0===t?void 0:t.os.version)||DefaultUserAgentParser.UNAVAILABLE,sdkVersion:Versioning_1$5.default.sdkVersion,sdkName:Versioning_1$5.default.sdkName}}}DefaultUserAgentParser$1.default=DefaultUserAgentParser,DefaultUserAgentParser.UNAVAILABLE="Unavailable";var __awaiter$i=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__rest$1=commonjsGlobal&&commonjsGlobal.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i},__importDefault$l=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(InMemoryJSONEventBuffer$1,"__esModule",{value:!0});const FullJitterBackoff_1$3=__importDefault$l(FullJitterBackoff$1),IntervalScheduler_1$1=__importDefault$l(IntervalScheduler$1),DefaultUserAgentParser_1=__importDefault$l(DefaultUserAgentParser$1),Utils_1$2=Utils$1;class InMemoryJSONEventBuffer{constructor(e,t,i,n,r){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=e=>({type:e.type,v:e.v,payloads:[...e.payloads]}),this.sendEvents=()=>__awaiter$i(this,void 0,void 0,(function*(){if(this.lock)return;const e=this.getItems(this.flushSize);if(0===e.length)return;this.lock=!0;const t=this.makeRequestBody(e);let i=!1;const n=Date.now();"firefox"===this.metadata.browserName.toLowerCase()&&this.cancellableEvents.set(n,e);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${t}`);const e=yield this.send(t);if(this.cancellableEvents.delete(n),e.ok)try{const i=yield e.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${t} message: ${JSON.stringify(i)}`)}catch(e){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${e} for events ${t}`)}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${t} with response status ${e.status}`),i=!0}catch(e){i=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${t} to the ingestion endpoint ${e}`)}finally{this.lock=!1}i&&(this.cancellableEvents.delete(n),this.failedIngestionEvents.push(...e))}));const o=new DefaultUserAgentParser_1.default(r).getParserResult(),a=__rest$1(o,["browserMajorVersion"]),s=t.toJSON(),{type:d,v:l}=s,c=__rest$1(s,["type","v"]);this.authenticationToken=t.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},a),c),Object.keys(this.metadata).forEach((e=>this.attributesToFilter.push(e))),this.type=d,this.v=l,this.ingestionURL=i,this.logger=r,this.importantEvents=new Set(n);const{maxBufferCapacityKb:u,totalBufferItems:h,flushSize:p,flushIntervalMs:m,retryCountLimit:f}=e;this.maxBufferCapacityBytes=1024*u,this.totalBufferItems=h,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/h),this.flushIntervalMs=m,this.flushSize=p,this.retryCountLimit=f,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=e=>this.beaconEventHandler(e),this.addEventListeners()}addEventListeners(){this.beaconEventListener&&"window"in commonjsGlobal&&window.addEventListener&&"document"in commonjsGlobal&&document.addEventListener&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler(e){("visibilitychange"===e.type&&"hidden"===document.visibilityState||"pagehide"===e.type)&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){this.beaconEventListener&&"window"in commonjsGlobal&&window.removeEventListener&&"document"in commonjsGlobal&&document.removeEventListener&&(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var e;this.removeEventListeners(),this.addEventListeners(),null===(e=this.intervalScheduler)||void 0===e||e.stop(),this.intervalScheduler=new IntervalScheduler_1$1.default(this.flushIntervalMs),this.intervalScheduler.start((()=>this.sendEvents()))}stop(){var e;null===(e=this.intervalScheduler)||void 0===e||e.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem(e){return __awaiter$i(this,void 0,void 0,(function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify(e)}`);const{name:t,ts:i,attributes:n}=e,r=n&&this.filterAttributes(n,this.attributesToFilter),o=Object.assign({name:t,ts:i},r);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(o)}`);const a=this.getSize(o);if(a>InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${a} bytes. Item cannot exceed max item size allowed of ${InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(t))return this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(o)}`),void this.sendEventImmediately({name:t,ts:i,attributes:r});if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(o),this.ingestionEventSize+=a,this.bufferItemThresholdReached(a)){const e=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(e),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}}))}filterAttributes(e,t){const i=new Set(t);return Object.keys(e).filter((e=>i.has(e))).forEach((t=>delete e[t])),e}initializeAndGetCurrentIngestionEvent(){const e={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize(e),e}bufferItemThresholdReached(e){return e+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS}getSize(e){let t=0;if("object"==typeof e)for(const[i,n]of Object.entries(e))t+=this.getPrimitiveSize(i),t+=this.getSize(n);else t+=this.getPrimitiveSize(e);return t}getPrimitiveSize(e){let t=0;return"string"==typeof e?t+=2*e.length:"number"==typeof e&&(t+=8),t}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return 0===this.buffer.length||0===this.bufferSize}getItems(e,t=0){if(this.isEmpty())return[];e=Math.min(this.buffer.length,e+1);return this.buffer.splice(t,e)}makeBeaconRequestBody(e){const t={metadata:this.metadata,events:e,authorization:this.authenticationToken};return JSON.stringify(t)}makeRequestBody(e){const t={metadata:this.metadata,events:e};return JSON.stringify(t)}sendEventImmediately(e){return __awaiter$i(this,void 0,void 0,(function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify(e)}`);const{name:t,ts:i,attributes:n}=e,r={type:this.type,v:this.v,payloads:[Object.assign({name:t,ts:i},n)]};let o=!1,a=null;const s=this.makeRequestBody([r]);try{if(a=yield this.send(s),a.ok){try{const e=yield a.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${s}, message: ${JSON.stringify(e)}`)}catch(e){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${e} for event ${s}`)}return}this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${s} with response status ${a.status}`),o=!0}catch(e){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${s} to the ingestion endpoint ${e}.`),o=!0;try{if("firefox"===this.metadata.browserName.toLowerCase()){const e=this.makeBeaconRequestBody([r]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${e}`),o=!navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,e)}}catch(e){this.logger.warn(`Event Reporting - Error sending beacon for an important event ${s}`),o=!0}}o&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${s}`),this.failedIngestionEvents.push(r))}))}send(e){return __awaiter$i(this,void 0,void 0,(function*(){const t=new FullJitterBackoff_1$3.default(InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS,InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS,InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS);try{let i=0;for(;i<this.retryCountLimit;){const n=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:e});if(n.ok||!InMemoryJSONEventBuffer.SENDING_FAILURE_CODES.has(n.status))return n;if(this.logger.warn(`Will retry sending failure for ${e} due to status code ${n.status}.`),i++,i<this.retryCountLimit){const e=t.nextBackoffAmountMs();yield Utils_1$2.wait(e)}}if(i===this.retryCountLimit)throw new Error(`Retry count limit reached for ${e}`)}catch(e){throw e}}))}sendBeacon(){return __awaiter$i(this,void 0,void 0,(function*(){const e=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify(e)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){const t=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);e.push(t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(t)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){const t=this.failedIngestionEvents.map((e=>this.deepCopyCurrentIngestionEvent(e)));e.push(...t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(t)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach((t=>{e.push(...t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(t)}`)})),this.cancellableEvents.clear()),0===e.length)return;const t=this.makeBeaconRequestBody(e);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${t}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,t)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${t}`)}catch(e){this.logger.warn(`Event Reporting - Sending beacon data ${t} failed with error ${e}`)}}))}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return __awaiter$i(this,void 0,void 0,(function*(){this.stop(),this.reset()}))}}InMemoryJSONEventBuffer$1.default=InMemoryJSONEventBuffer,InMemoryJSONEventBuffer.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]),InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS=0,InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS=1e3,InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS=15e3,InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS=2,InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3;var __awaiter$h=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$k=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultMeetingEventReporter$1,"__esModule",{value:!0});const Destroyable_1$1=Destroyable,InMemoryJSONEventBuffer_1=__importDefault$k(InMemoryJSONEventBuffer$1);class DefaultMeetingEventReporter{constructor(e,t){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded","deviceLabelTriggerFailed"],this.destroyed=!1;const{eventsClientConfiguration:i,ingestionURL:n,eventBufferConfiguration:r}=e,{eventsToIgnore:o}=i;this.eventBuffer=new InMemoryJSONEventBuffer_1.default(r,i,n,this.importantEvents,t),this.logger=t,this.eventsToIgnore=o,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch(e){this.logger.error(`Event Reporting - Error starting the event buffer ${e}`)}}stop(){if(this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch(e){this.logger.error(`Event Reporting - Error stopping the event buffer ${e}`)}}reportEvent(e,t,i){return __awaiter$h(this,void 0,void 0,(function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${e}, ${t}, ${JSON.stringify(i)}`),this.eventsToIgnore.includes(t))this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${t} event will be ignored as it is in events to ignore`);else try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:e,name:t,attributes:i})}catch(e){this.logger.error(`Event Reporting - Error adding event to buffer ${e}`)}}))}destroy(){return __awaiter$h(this,void 0,void 0,(function*(){this.destroyed=!0,this.stop(),Destroyable_1$1.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0}))}}DefaultMeetingEventReporter$1.default=DefaultMeetingEventReporter;var MeetingEventsClientConfiguration$1={};Object.defineProperty(MeetingEventsClientConfiguration$1,"__esModule",{value:!0});class MeetingEventsClientConfiguration{constructor(e,t,i,n=[]){this.type="Meet",this.v=1,this.meetingId=e,this.attendeeId=t,this.eventsToIgnore=n,this.authenticationToken=i}getAuthenticationToken(){return this.authenticationToken}toJSON(){const e={};return e.type=this.type,e.v=this.v,e.meetingId=this.meetingId,e.attendeeId=this.attendeeId,e}}MeetingEventsClientConfiguration$1.default=MeetingEventsClientConfiguration;var flattenEventAttributes$1={};Object.defineProperty(flattenEventAttributes$1,"__esModule",{value:!0});const flattenEventAttributes=e=>{const t={};for(const[i,n]of Object.entries(e))if(null!=n&&""!==n){if("number"!=typeof n&&"string"!=typeof n)throw new TypeError("Unhandled type received while flattening attributes.");t[i]=n}return t};flattenEventAttributes$1.default=flattenEventAttributes;var __awaiter$g=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$j=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultEventController$1,"__esModule",{value:!0});const ua_parser_js_1=uaParserExports,Destroyable_1=Destroyable,EventIngestionConfiguration_1=__importDefault$j(EventIngestionConfiguration$1),DefaultMeetingEventReporter_1=__importDefault$j(DefaultMeetingEventReporter$1),MeetingEventsClientConfiguration_1=__importDefault$j(MeetingEventsClientConfiguration$1),AsyncScheduler_1$1=__importDefault$j(AsyncScheduler$1),Versioning_1$4=__importDefault$j(Versioning$1),flattenEventAttributes_1=__importDefault$j(flattenEventAttributes$1);class DefaultEventController{constructor(e,t,i){var n,r,o,a,s,d,l;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=t,this.configuration=e,this.setupEventReporter(e,t,i);try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1.UAParser(navigator.userAgent).getResult():null}catch(e){this.logger.error(e.message)}this.browserMajorVersion=(null===(o=null===(r=null===(n=this.parserResult)||void 0===n?void 0:n.browser)||void 0===r?void 0:r.version)||void 0===o?void 0:o.split(".")[0])||DefaultEventController.UNAVAILABLE,this.browserName=(null===(a=this.parserResult)||void 0===a?void 0:a.browser.name)||DefaultEventController.UNAVAILABLE,this.browserVersion=(null===(s=this.parserResult)||void 0===s?void 0:s.browser.version)||DefaultEventController.UNAVAILABLE,this.deviceName=[(null===(d=this.parserResult)||void 0===d?void 0:d.device.vendor)||"",(null===(l=this.parserResult)||void 0===l?void 0:l.device.model)||""].join(" ").trim()||DefaultEventController.UNAVAILABLE}addObserver(e){this.observerSet.add(e)}removeObserver(e){this.observerSet.delete(e)}forEachObserver(e){for(const t of this.observerSet)AsyncScheduler_1$1.default.nextTick((()=>{this.observerSet.has(t)&&e(t)}))}publishEvent(e,t){return __awaiter$g(this,void 0,void 0,(function*(){const i=Date.now();this.meetingHistoryStates.push({name:e,timestampMs:i});const n=Object.freeze(Object.assign(this.getAttributes(i),t));this.forEachObserver((t=>{t.eventDidReceive(e,n)})),this.reportEvent(e,i,t)}))}reportEvent(e,t,i){var n;return __awaiter$g(this,void 0,void 0,(function*(){let r;try{i&&(r=flattenEventAttributes_1.default(i)),yield null===(n=this.eventReporter)||void 0===n?void 0:n.reportEvent(t,e,r)}catch(e){this.logger.error(`Error reporting event ${e}`)}}))}setupEventReporter(e,t,i){if(i)this._eventReporter=i;else if(e.urls){const i=e.urls.eventIngestionURL;if(i){this.logger.info("Event ingestion URL is present in the configuration");const{meetingId:n,credentials:{attendeeId:r,joinToken:o}}=e,a=new MeetingEventsClientConfiguration_1.default(n,r,o),s=new EventIngestionConfiguration_1.default(a,i);this._eventReporter=new DefaultMeetingEventReporter_1.default(s,t)}}}getAttributes(e){var t,i;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:"string"==typeof this.configuration.externalMeetingId?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:(null===(t=this.parserResult)||void 0===t?void 0:t.os.name)||DefaultEventController.UNAVAILABLE,osVersion:(null===(i=this.parserResult)||void 0===i?void 0:i.os.version)||DefaultEventController.UNAVAILABLE,sdkVersion:Versioning_1$4.default.sdkVersion,sdkName:Versioning_1$4.default.sdkName,timestampMs:e}}get eventReporter(){return this._eventReporter}destroy(){return __awaiter$g(this,void 0,void 0,(function*(){Destroyable_1.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0}))}}DefaultEventController$1.default=DefaultEventController,DefaultEventController.UNAVAILABLE="Unavailable";var DefaultMeetingReadinessChecker$1={},MeetingReadinessCheckerConfiguration$1={};Object.defineProperty(MeetingReadinessCheckerConfiguration$1,"__esModule",{value:!0});class MeetingReadinessCheckerConfiguration{constructor(){this.timeoutMs=1e4,this.waitDurationMs=3e3,this.audioOutputFrequency=440,this.audioOutputGain=.1}}MeetingReadinessCheckerConfiguration$1.default=MeetingReadinessCheckerConfiguration;var __awaiter$f=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$i=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultMeetingReadinessChecker$1,"__esModule",{value:!0});const DefaultAudioMixController_1=__importDefault$i(DefaultAudioMixController$1),DefaultBrowserBehavior_1$2=__importDefault$i(DefaultBrowserBehavior$1),DefaultDeviceController_1=__importDefault$i(DefaultDeviceController$1),PermissionDeniedError_1=__importDefault$i(PermissionDeniedError$1),BaseTask_1$1=__importDefault$i(BaseTask$1),TimeoutTask_1=__importDefault$i(TimeoutTask$1),CheckAudioConnectivityFeedback_1=__importDefault$i(CheckAudioConnectivityFeedback),CheckAudioInputFeedback_1=__importDefault$i(CheckAudioInputFeedback),CheckAudioOutputFeedback_1=__importDefault$i(CheckAudioOutputFeedback),CheckCameraResolutionFeedback_1=__importDefault$i(CheckCameraResolutionFeedback),CheckContentShareConnectivityFeedback_1=__importDefault$i(CheckContentShareConnectivityFeedback),CheckNetworkTCPConnectivityFeedback_1=__importDefault$i(CheckNetworkTCPConnectivityFeedback),CheckNetworkUDPConnectivityFeedback_1=__importDefault$i(CheckNetworkUDPConnectivityFeedback),CheckVideoConnectivityFeedback_1=__importDefault$i(CheckVideoConnectivityFeedback),CheckVideoInputFeedback_1=__importDefault$i(CheckVideoInputFeedback),MeetingReadinessCheckerConfiguration_1=__importDefault$i(MeetingReadinessCheckerConfiguration$1);class DefaultMeetingReadinessChecker{constructor(e,t,i=new MeetingReadinessCheckerConfiguration_1.default){this.logger=e,this.meetingSession=t,this.configuration=i,this.browserBehavior=new DefaultBrowserBehavior_1$2.default}static delay(e){return __awaiter$f(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}checkAudioInput(e){return __awaiter$f(this,void 0,void 0,(function*(){try{return yield this.meetingSession.audioVideo.startAudioInput(e),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioInputFeedback_1.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Audio input check failed with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckAudioInputFeedback_1.default.PermissionDenied:CheckAudioInputFeedback_1.default.Failed}}))}checkAudioOutput(e,t,i=null){return __awaiter$f(this,void 0,void 0,(function*(){try{const n=e?DefaultDeviceController_1.default.getIntrinsicDeviceId(e):"";yield this.playTone(n,this.configuration.audioOutputFrequency,i);return(yield t())?CheckAudioOutputFeedback_1.default.Succeeded:CheckAudioOutputFeedback_1.default.Failed}catch(e){return this.logger.error(`MeetingReadinessChecker: Audio output check failed with error: ${e}`),CheckAudioOutputFeedback_1.default.Failed}finally{this.stopTone()}}))}playTone(e,t,i){return __awaiter$f(this,void 0,void 0,(function*(){const n=this.configuration.audioOutputGain;this.oscillatorNode&&this.stopTone(),this.audioContext=DefaultDeviceController_1.default.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.oscillatorNode=this.audioContext.createOscillator(),this.oscillatorNode.frequency.value=t,this.oscillatorNode.connect(this.gainNode),this.destinationStream=this.audioContext.createMediaStreamDestination(),this.gainNode.connect(this.destinationStream);const r=this.audioContext.currentTime+.1;this.gainNode.gain.linearRampToValueAtTime(0,r),this.gainNode.gain.linearRampToValueAtTime(n,r+.1),this.oscillatorNode.start();const o=new DefaultAudioMixController_1.default(this.logger);try{this.browserBehavior.supportsSetSinkId()&&(yield o.bindAudioDevice({deviceId:e}))}catch(e){this.logger.error(`Failed to bind audio device: ${e}`)}try{yield o.bindAudioElement(i||new Audio)}catch(e){this.logger.error(`Failed to bind audio element: ${e}`)}yield o.bindAudioStream(this.destinationStream.stream)}))}stopTone(){if(!(this.audioContext&&this.gainNode&&this.oscillatorNode&&this.destinationStream))return;const e=this.configuration.audioOutputGain,t=this.audioContext.currentTime;this.gainNode.gain.linearRampToValueAtTime(e,t+.1+1),this.gainNode.gain.linearRampToValueAtTime(0,t+.2+1),this.oscillatorNode.stop(),this.oscillatorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.destinationStream),this.oscillatorNode=null,this.gainNode=null,this.destinationStream=null}checkVideoInput(e){return __awaiter$f(this,void 0,void 0,(function*(){try{return yield this.meetingSession.audioVideo.startVideoInput(e),yield this.meetingSession.audioVideo.stopVideoInput(),CheckVideoInputFeedback_1.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Video check failed with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckVideoInputFeedback_1.default.PermissionDenied:CheckVideoInputFeedback_1.default.Failed}}))}checkCameraResolution(e,t,i){return __awaiter$f(this,void 0,void 0,(function*(){let n;try{const r=DefaultDeviceController_1.default.getIntrinsicDeviceId(e),o={video:this.calculateVideoConstraint(r,t,i)};n=yield navigator.mediaDevices.getUserMedia(o)}catch(e){return this.logger.error(`MeetingReadinessChecker: Camera resolution check with width: ${t} height ${i} failed with error ${e}`),e&&"OverconstrainedError"===e.name?CheckCameraResolutionFeedback_1.default.ResolutionNotSupported:e&&"NotAllowedError"===e.name?CheckCameraResolutionFeedback_1.default.PermissionDenied:CheckCameraResolutionFeedback_1.default.Failed}finally{n&&n.getTracks().forEach((function(e){e.stop()}))}return CheckCameraResolutionFeedback_1.default.Succeeded}))}calculateVideoConstraint(e,t,i){const n=this.browserBehavior.requiresResolutionAlignment(t,i),r={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?(r.deviceId=e,r.width=t,r.height=i):(r.deviceId={exact:e},r.width={exact:n[0]},r.height={exact:n[1]}),r}checkContentShareConnectivity(e){return __awaiter$f(this,void 0,void 0,(function*(){let t=!1,i=!1;const n={contentShareDidStart:()=>{t=!0}},r={audioVideoDidStart:()=>{i=!0}};try{return this.meetingSession.audioVideo.addObserver(r),this.meetingSession.audioVideo.start(),this.meetingSession.audioVideo.addContentShareObserver(n),yield this.meetingSession.audioVideo.startContentShareFromScreenCapture(e),yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return i&&t})))),i?(yield this.stopMeeting(),t?CheckContentShareConnectivityFeedback_1.default.Succeeded:CheckContentShareConnectivityFeedback_1.default.TimedOut):CheckContentShareConnectivityFeedback_1.default.ConnectionFailed}catch(e){return this.logger.error(`MeetingReadinessChecker: Content share check failed with error ${e}`),"NotAllowedError"===e.name?CheckContentShareConnectivityFeedback_1.default.PermissionDenied:CheckContentShareConnectivityFeedback_1.default.Failed}finally{this.meetingSession.audioVideo.removeObserver(r),this.meetingSession.audioVideo.stopContentShare(),this.meetingSession.audioVideo.removeContentShareObserver(n)}}))}checkAudioConnectivity(e){return __awaiter$f(this,void 0,void 0,(function*(){let t=!1;const i={packetsReceived:0},n=this.meetingSession.audioVideo,r={metricsDidReceive(e){e.getRTCStatsReport().forEach((e=>{"inbound-rtp"===e.type&&"audio"===e.mediaType&&(i.packetsReceived=e.packetsReceived)}))}},o=(e,i,n,r)=>{e===this.meetingSession.configuration.credentials.attendeeId&&i&&(t=!0)};try{yield n.startAudioInput(e)}catch(e){return this.logger.error(`MeetingReadinessChecker: Failed to get audio input device with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckAudioConnectivityFeedback_1.default.AudioInputPermissionDenied:CheckAudioConnectivityFeedback_1.default.AudioInputRequestFailed}return n.realtimeSubscribeToAttendeeIdPresence(o),n.addObserver(r),(yield this.startMeeting())?(yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return this.isAudioConnectionSuccessful(t,i)})))),n.removeObserver(r),n.realtimeUnsubscribeToAttendeeIdPresence(o),yield this.stopMeeting(),yield this.meetingSession.audioVideo.stopAudioInput(),this.isAudioConnectionSuccessful(t,i)?CheckAudioConnectivityFeedback_1.default.Succeeded:CheckAudioConnectivityFeedback_1.default.AudioNotReceived):(n.removeObserver(r),n.realtimeUnsubscribeToAttendeeIdPresence(o),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioConnectivityFeedback_1.default.ConnectionFailed)}))}checkVideoConnectivity(e){return __awaiter$f(this,void 0,void 0,(function*(){const t=this.meetingSession.audioVideo;let i=0;const n={metricsDidReceive(e){e.getRTCStatsReport().forEach((e=>{"outbound-rtp"===e.type&&"video"===e.mediaType&&(i=e.packetsSent)}))}};try{yield t.startVideoInput(e)}catch(e){return this.logger.error(`MeetingReadinessChecker: Failed to get video input device with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckVideoConnectivityFeedback_1.default.VideoInputPermissionDenied:CheckVideoConnectivityFeedback_1.default.VideoInputRequestFailed}return t.addObserver(n),(yield this.startMeeting())?(t.startLocalVideoTile(),yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return i>0})))),yield t.stopVideoInput(),yield this.stopMeeting(),t.removeObserver(n),i<=0?CheckVideoConnectivityFeedback_1.default.VideoNotSent:CheckVideoConnectivityFeedback_1.default.Succeeded):CheckVideoConnectivityFeedback_1.default.ConnectionFailed}))}checkNetworkUDPConnectivity(){return __awaiter$f(this,void 0,void 0,(function*(){let e=!1;const t={metricsDidReceive(t){t.getRTCStatsReport().forEach((t=>{"candidate-pair"===t.type&&"succeeded"===t.state&&(e=!0)}))}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(e){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${e}`),CheckNetworkUDPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=e=>{const t=this.originalURLRewriter(e);return t.includes("transport=tcp")?"":t};const i=this.meetingSession.audioVideo;return i.addObserver(t),(yield this.startMeeting())?(yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return e})))),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),i.removeObserver(t),e?CheckNetworkUDPConnectivityFeedback_1.default.Succeeded:CheckNetworkUDPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkUDPConnectivityFeedback_1.default.ConnectionFailed)}))}checkNetworkTCPConnectivity(){return __awaiter$f(this,void 0,void 0,(function*(){let e=!1;const t={metricsDidReceive(t){t.getRTCStatsReport().forEach((t=>{"candidate-pair"===t.type&&"succeeded"===t.state&&(e=!0)}))}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(e){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${e}`),CheckNetworkTCPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=e=>{const t=this.originalURLRewriter(e);return t.includes("transport=udp")?"":t};const i=this.meetingSession.audioVideo;return i.addObserver(t),(yield this.startMeeting())?(yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return e})))),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),i.removeObserver(t),e?CheckNetworkTCPConnectivityFeedback_1.default.Succeeded:CheckNetworkTCPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkTCPConnectivityFeedback_1.default.ConnectionFailed)}))}startMeeting(){return __awaiter$f(this,void 0,void 0,(function*(){let e=!1;const t={audioVideoDidStart:()=>{e=!0}};return this.meetingSession.audioVideo.addObserver(t),this.meetingSession.audioVideo.start(),yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return e})))),this.meetingSession.audioVideo.removeObserver(t),e}))}stopMeeting(){return __awaiter$f(this,void 0,void 0,(function*(){let e=!1;const t={audioVideoDidStop:t=>{e=!0}};return this.meetingSession.audioVideo.addObserver(t),this.meetingSession.audioVideo.stop(),yield this.executeTimeoutTask((()=>__awaiter$f(this,void 0,void 0,(function*(){return e})))),this.meetingSession.audioVideo.removeObserver(t),e}))}executeTimeoutTask(e){return __awaiter$f(this,void 0,void 0,(function*(){let t=!1;class i extends BaseTask_1$1.default{constructor(e,t){super(e),this.waitDurationMs=t,this.isCancelled=!1}cancel(){this.isCancelled=!0}run(){return __awaiter$f(this,void 0,void 0,(function*(){for(;!this.isCancelled;){if(yield e()){t=!0;break}yield DefaultMeetingReadinessChecker.delay(this.waitDurationMs)}}))}}const n=new TimeoutTask_1.default(this.logger,new i(this.logger,this.configuration.waitDurationMs),this.configuration.timeoutMs);return yield n.run(),t}))}isAudioConnectionSuccessful(e,t){return e&&t.packetsReceived>0}}DefaultMeetingReadinessChecker$1.default=DefaultMeetingReadinessChecker;var DefaultMeetingSession={},DefaultReconnectController$1={},__importDefault$h=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultReconnectController$1,"__esModule",{value:!0});const TimeoutScheduler_1=__importDefault$h(TimeoutScheduler$1);class DefaultReconnectController{constructor(e,t){this.reconnectTimeoutMs=e,this.backoffPolicy=t,this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this._isFirstConnection=!0,this.backoffTimer=null,this.backoffCancel=null,this.reset()}timeSpentReconnectingMs(){return this.firstConnectionAttempted?Date.now()-this.firstConnectionAttemptTimestampMs:0}hasPastReconnectDeadline(){return Date.now()-this.lastActiveTimestampMs>=this.reconnectTimeoutMs||this.timeSpentReconnectingMs()>=this.reconnectTimeoutMs}reset(){this.cancel(),this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this.backoffPolicy.reset()}startedConnectionAttempt(e){this._isFirstConnection=e,this.firstConnectionAttempted||(this.firstConnectionAttempted=!0,this.firstConnectionAttemptTimestampMs=Date.now())}hasStartedConnectionAttempt(){return this.firstConnectionAttempted}isFirstConnection(){return this._isFirstConnection}disableReconnect(){this.shouldReconnect=!1}enableRestartPeerConnection(){this.onlyRestartPeerConnection=!0}cancel(){this.disableReconnect(),this.backoffTimer&&(this.backoffTimer.stop(),this.backoffCancel&&(this.backoffCancel(),this.backoffCancel=null))}retryWithBackoff(e,t){const i=this.shouldReconnect&&!this.hasPastReconnectDeadline();return i&&(this.backoffCancel=t,this.backoffTimer=new TimeoutScheduler_1.default(this.backoffPolicy.nextBackoffAmountMs()),this.backoffTimer.start((()=>{this.backoffCancel=null,e()}))),i}shouldOnlyRestartPeerConnection(){return this.onlyRestartPeerConnection}clone(){return new DefaultReconnectController(this.reconnectTimeoutMs,this.backoffPolicy)}setLastActiveTimestampMs(e){this.lastActiveTimestampMs=e}}DefaultReconnectController$1.default=DefaultReconnectController;var DefaultWebSocketAdapter$1={},__importDefault$g=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultWebSocketAdapter$1,"__esModule",{value:!0});const Versioning_1$3=__importDefault$g(Versioning$1),WebSocketReadyState_1$1=__importDefault$g(WebSocketReadyState);class DefaultWebSocketAdapter{constructor(e){this.logger=e}create(e,t,i){this.connection=new WebSocket(i?e:Versioning_1$3.default.urlWithVersion(e),t),this.connection.binaryType="arraybuffer"}send(e){if(!this.connection)return this.logger.error("WebSocket not yet created or already destroyed."),!1;try{return e instanceof Uint8Array?this.connection.send(e.buffer):this.connection.send(e),!0}catch(e){return this.logger.debug((()=>`send error: ${e.message}, websocket state=${WebSocketReadyState_1$1.default[this.readyState()]}`)),!1}}close(e,t){var i;null===(i=this.connection)||void 0===i||i.close(e,t)}destroy(){this.connection=void 0}addEventListener(e,t){this.connection?this.connection.addEventListener(e,t):this.logger.warn("Cannot add event listener with no WebSocket connection.")}removeEventListener(e,t){var i;null===(i=this.connection)||void 0===i||i.removeEventListener(e,t)}readyState(){if(!this.connection)return WebSocketReadyState_1$1.default.None;switch(this.connection.readyState){case WebSocket.CONNECTING:return WebSocketReadyState_1$1.default.Connecting;case WebSocket.OPEN:return WebSocketReadyState_1$1.default.Open;case WebSocket.CLOSING:return WebSocketReadyState_1$1.default.Closing;case WebSocket.CLOSED:return WebSocketReadyState_1$1.default.Closed}}}var hasRequiredDefaultMeetingSession;function requireDefaultMeetingSession(){if(hasRequiredDefaultMeetingSession)return DefaultMeetingSession;hasRequiredDefaultMeetingSession=1;var e=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultMeetingSession,"__esModule",{value:!0});const i=t(requireDefaultAudioVideoController()),n=t(DefaultAudioVideoFacade$1),r=t(FullJitterBackoff$1),o=t(DefaultBrowserBehavior$1),a=t(ContentShareMediaStreamBroker$1),s=t(DefaultContentShareController$1),d=t(CSPMonitor$1),l=Destroyable,c=t(DefaultEventController$1),u=t(DefaultReconnectController$1),h=t(DefaultWebSocketAdapter$1);return DefaultMeetingSession.default=class{constructor(e,t,o,l){this._eventController=l,this._configuration=e,this._logger=t,this.checkBrowserSupportAndFeatureConfiguration(),d.default.addLogger(this._logger),d.default.register(),this._eventController||(this._eventController=new c.default(e,t)),o.eventController||(o.eventController=this.eventController),this.audioVideoController=new i.default(this._configuration,this._logger,new h.default(this._logger),o,new u.default(this._configuration.reconnectTimeoutMs,new r.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs)),this.eventController),this._deviceController=o,this.logger.info(`MeetingFeatures: ${JSON.stringify(e.meetingFeatures)}`);const p=new a.default(this._logger);this.contentShareController=new s.default(p,new i.default(s.default.createContentShareMeetingSessionConfigure(this._configuration),this._logger,new h.default(this._logger),p,new u.default(this._configuration.reconnectTimeoutMs,new r.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs))),this.audioVideoController),this.audioVideoFacade=new n.default(this.audioVideoController,this.audioVideoController.videoTileController,this.audioVideoController.realtimeController,this.audioVideoController.audioMixController,this._deviceController,this.contentShareController)}get configuration(){return this._configuration}get logger(){return this._logger}get audioVideo(){return this.audioVideoFacade}get contentShare(){return this.contentShareController}get deviceController(){return this._deviceController}get eventController(){return this._eventController}destroy(){return e(this,void 0,void 0,(function*(){l.isDestroyable(this.contentShareController)&&(yield this.contentShareController.destroy()),l.isDestroyable(this.audioVideoController)&&(yield this.audioVideoController.destroy()),l.isDestroyable(this.eventController)&&(yield this.eventController.destroy()),d.default.removeLogger(this._logger),this._logger=void 0,this._configuration=void 0,this._deviceController=void 0,this.audioVideoFacade=void 0,this.audioVideoController=void 0,this.contentShareController=void 0,this._eventController=void 0}))}checkBrowserSupportAndFeatureConfiguration(){const e=new o.default,t=`${e.name()} ${e.majorVersion()} (${e.version()})`;if(this.logger.info(`browser is ${t}`),e.isSupported()||this.logger.warn(`this browser is not currently supported. Stability may suffer. Supported browsers are: ${e.supportString()}.`),this._configuration.videoUplinkBandwidthPolicy)if(this.isSimulcastUplinkPolicy(this._configuration.videoUplinkBandwidthPolicy)){if(!e.hasChromiumWebRTC())throw new Error("Simulcast is only supported on Chromium-based browsers");this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0}else this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1;this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(e.hasChromiumWebRTC()?this.logger.info(`Simulcast is enabled for ${e.name()}`):(this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.logger.info("Simulcast is only supported on Chromium-based browsers")),this._configuration.enableSVC&&(this._configuration.enableSVC=!1,this.logger.info("SVC is not successfully enabled since simulcast is enabled"))),this._configuration.enableSVC&&!e.supportsScalableVideoCoding()&&(this._configuration.enableSVC=!1,this.logger.info("SVC is only supported on Chromium-based browsers with version 111 or above"))}isSimulcastUplinkPolicy(e){return!(!e||!e.addObserver)}},DefaultMeetingSession}DefaultWebSocketAdapter$1.default=DefaultWebSocketAdapter;var DefaultMessagingSession$1={};const getHttpHandlerExtensionConfiguration=e=>{let t=e.httpHandler;return{setHttpHandler(e){t=e},httpHandler:()=>t,updateHttpClientConfig(e,i){t.updateHttpClientConfig(e,i)},httpHandlerConfigs:()=>t.httpHandlerConfigs()}},resolveHttpHandlerRuntimeConfig=e=>({httpHandler:e.httpHandler()});var HttpAuthLocation,HttpApiKeyAuthLocation,EndpointURLScheme,AlgorithmId,FieldPosition;!function(e){e.HEADER="header",e.QUERY="query"}(HttpAuthLocation||(HttpAuthLocation={})),function(e){e.HEADER="header",e.QUERY="query"}(HttpApiKeyAuthLocation||(HttpApiKeyAuthLocation={})),function(e){e.HTTP="http",e.HTTPS="https"}(EndpointURLScheme||(EndpointURLScheme={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(AlgorithmId||(AlgorithmId={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(FieldPosition||(FieldPosition={}));const SMITHY_CONTEXT_KEY="__smithy_context";var IniSectionType,RequestHandlerProtocol;!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(IniSectionType||(IniSectionType={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(RequestHandlerProtocol||(RequestHandlerProtocol={}));class HttpRequest{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){const e=new HttpRequest({...this,headers:{...this.headers}});return e.query&&(e.query=cloneQuery$1(e.query)),e}}function cloneQuery$1(e){return Object.keys(e).reduce(((t,i)=>{const n=e[i];return{...t,[i]:Array.isArray(n)?[...n]:n}}),{})}class HttpResponse{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}function resolveHostHeaderConfig(e){return e}const hostHeaderMiddleware=e=>t=>async i=>{if(!HttpRequest.isInstance(i.request))return t(i);const{request:n}=i,{handlerProtocol:r=""}=e.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let e=n.hostname;null!=n.port&&(e+=`:${n.port}`),n.headers.host=e}return t(i)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=e=>({applyToStack:t=>{t.add(hostHeaderMiddleware(e),hostHeaderMiddlewareOptions)}}),loggerMiddleware=()=>(e,t)=>async i=>{try{const n=await e(i),{clientName:r,commandName:o,logger:a,dynamoDbDocumentClientOptions:s={}}=t,{overrideInputFilterSensitiveLog:d,overrideOutputFilterSensitiveLog:l}=s,c=d??t.inputFilterSensitiveLog,u=l??t.outputFilterSensitiveLog,{$metadata:h,...p}=n.output;return a?.info?.({clientName:r,commandName:o,input:c(i.input),output:u(p),metadata:h}),n}catch(e){const{clientName:n,commandName:r,logger:o,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:s}=a,d=s??t.inputFilterSensitiveLog;throw o?.error?.({clientName:n,commandName:r,input:d(i.input),error:e,metadata:e.$metadata}),e}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=e=>({applyToStack:e=>{e.add(loggerMiddleware(),loggerMiddlewareOptions)}}),TRACE_ID_HEADER_NAME="X-Amzn-Trace-Id",ENV_LAMBDA_FUNCTION_NAME="AWS_LAMBDA_FUNCTION_NAME",ENV_TRACE_ID="_X_AMZN_TRACE_ID",recursionDetectionMiddleware=e=>t=>async i=>{const{request:n}=i;if(!HttpRequest.isInstance(n)||"node"!==e.runtime||n.headers.hasOwnProperty(TRACE_ID_HEADER_NAME))return t(i);const r=process.env[ENV_LAMBDA_FUNCTION_NAME],o=process.env[ENV_TRACE_ID],a=e=>"string"==typeof e&&e.length>0;return a(r)&&a(o)&&(n.headers[TRACE_ID_HEADER_NAME]=o),t({...i,request:n})},addRecursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},getRecursionDetectionPlugin=e=>({applyToStack:t=>{t.add(recursionDetectionMiddleware(e),addRecursionDetectionMiddlewareOptions)}}),memoize=(e,t,i)=>{let n,r,o,a=!1;const s=async()=>{r||(r=e());try{n=await r,o=!0,a=!1}finally{r=void 0}return n};return void 0===t?async e=>(o&&!e?.forceRefresh||(n=await s()),n):async e=>(o&&!e?.forceRefresh||(n=await s()),a?n:i&&!i(n)?(a=!0,n):t(n)?(await s(),n):n)};var build$8={},extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},extendStatics(e,t)};
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */function __extends(e,t){function i(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)};function __rest(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}function __decorate(e,t,i,n){var r,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a}function __param(e,t){return function(i,n){t(i,n,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter$e(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))}function __generator(e,t){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function __createBinding(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}function __exportStar(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||(t[i]=e[i])}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __spreadArrays(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){r[e]&&(n[e]=function(t){return new Promise((function(i,n){o.push([e,t,i,n])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof __await?Promise.resolve(e.value.v).then(d,l):c(o[0][2],e)}(r[e](t))}catch(e){c(o[0][3],e)}}function d(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function __asyncDelegator(e){var t,i;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,r){t[n]=e[n]?function(t){return(i=!i)?{value:__await(e[n](t)),done:"return"===n}:r?r(t):t}:r}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=e[i]&&function(t){return new Promise((function(n,r){(function(e,t,i,n){Promise.resolve(n).then((function(t){e({value:t,done:i})}),t)})(n,r,(t=e[i](t)).done,t.value)}))}}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function __importDefault$f(e){return e&&e.__esModule?e:{default:e}}function __classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function __classPrivateFieldSet(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i}var tslib_es6=Object.freeze({__proto__:null,get __assign(){return __assign},__asyncDelegator:__asyncDelegator,__asyncGenerator:__asyncGenerator,__asyncValues:__asyncValues,__await:__await,__awaiter:__awaiter$e,__classPrivateFieldGet:__classPrivateFieldGet,__classPrivateFieldSet:__classPrivateFieldSet,__createBinding:__createBinding,__decorate:__decorate,__exportStar:__exportStar,__extends:__extends,__generator:__generator,__importDefault:__importDefault$f,__importStar:__importStar,__makeTemplateObject:__makeTemplateObject,__metadata:__metadata,__param:__param,__read:__read,__rest:__rest,__spread:__spread,__spreadArrays:__spreadArrays,__values:__values}),require$$0$2=getAugmentedNamespace(tslib_es6),build$7={},convertToBuffer$3={};const fromUtf8$4=e=>{const t=[];for(let i=0,n=e.length;i<n;i++){const n=e.charCodeAt(i);if(n<128)t.push(n);else if(n<2048)t.push(n>>6|192,63&n|128);else if(i+1<e.length&&55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))){const r=65536+((1023&n)<<10)+(1023&e.charCodeAt(++i));t.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else t.push(n>>12|224,n>>6&63|128,63&n|128)}return Uint8Array.from(t)},toUtf8$3=e=>{let t="";for(let i=0,n=e.length;i<n;i++){const n=e[i];if(n<128)t+=String.fromCharCode(n);else if(192<=n&&n<224){const r=e[++i];t+=String.fromCharCode((31&n)<<6|63&r)}else if(240<=n&&n<365){const r="%"+[n,e[++i],e[++i],e[++i]].map((e=>e.toString(16))).join("%");t+=decodeURIComponent(r)}else t+=String.fromCharCode((15&n)<<12|(63&e[++i])<<6|63&e[++i])}return t};function fromUtf8$3(e){return(new TextEncoder).encode(e)}function toUtf8$2(e){return new TextDecoder("utf-8").decode(e)}const fromUtf8$2=e=>"function"==typeof TextEncoder?fromUtf8$3(e):fromUtf8$4(e),toUtf8$1=e=>"function"==typeof TextDecoder?toUtf8$2(e):toUtf8$3(e);var distEs$3=Object.freeze({__proto__:null,fromUtf8:fromUtf8$2,toUtf8:toUtf8$1}),require$$0$1=getAugmentedNamespace(distEs$3);Object.defineProperty(convertToBuffer$3,"__esModule",{value:!0}),convertToBuffer$3.convertToBuffer=void 0;var util_utf8_browser_1=require$$0$1,fromUtf8$1="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:util_utf8_browser_1.fromUtf8;function convertToBuffer$2(e){return e instanceof Uint8Array?e:"string"==typeof e?fromUtf8$1(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}convertToBuffer$3.convertToBuffer=convertToBuffer$2;var isEmptyData$4={};function isEmptyData$3(e){return"string"==typeof e?0===e.length:0===e.byteLength}Object.defineProperty(isEmptyData$4,"__esModule",{value:!0}),isEmptyData$4.isEmptyData=void 0,isEmptyData$4.isEmptyData=isEmptyData$3;var numToUint8$3={};function numToUint8$2(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])}Object.defineProperty(numToUint8$3,"__esModule",{value:!0}),numToUint8$3.numToUint8=void 0,numToUint8$3.numToUint8=numToUint8$2;var uint32ArrayFrom$3={};function uint32ArrayFrom$2(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),i=0;i<e.length;)t[i]=e[i],i+=1;return t}return Uint32Array.from(e)}Object.defineProperty(uint32ArrayFrom$3,"__esModule",{value:!0}),uint32ArrayFrom$3.uint32ArrayFrom=void 0,uint32ArrayFrom$3.uint32ArrayFrom=uint32ArrayFrom$2,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=convertToBuffer$3;Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var i=isEmptyData$4;Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return i.isEmptyData}});var n=numToUint8$3;Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var r=uint32ArrayFrom$3;Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return r.uint32ArrayFrom}})}(build$7);var aws_crc32={},hasRequiredAws_crc32,hasRequiredBuild$6;function requireAws_crc32(){if(hasRequiredAws_crc32)return aws_crc32;hasRequiredAws_crc32=1,Object.defineProperty(aws_crc32,"__esModule",{value:!0}),aws_crc32.AwsCrc32=void 0;var e=require$$0$2,t=build$7,i=requireBuild$6(),n=function(){function n(){this.crc32=new i.Crc32}return n.prototype.update=function(e){(0,t.isEmptyData)(e)||this.crc32.update((0,t.convertToBuffer)(e))},n.prototype.digest=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,(0,t.numToUint8)(this.crc32.digest())]}))}))},n.prototype.reset=function(){this.crc32=new i.Crc32},n}();return aws_crc32.AwsCrc32=n,aws_crc32}function requireBuild$6(){return hasRequiredBuild$6||(hasRequiredBuild$6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwsCrc32=e.Crc32=e.crc32=void 0;var t=require$$0$2,i=build$7;e.crc32=function(e){return(new n).update(e).digest()};var n=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var i,n;try{for(var o=t.__values(e),a=o.next();!a.done;a=o.next()){var s=a.value;this.checksum=this.checksum>>>8^r[255&(this.checksum^s)]}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}();e.Crc32=n;var r=(0,i.uint32ArrayFrom)([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),o=requireAws_crc32();Object.defineProperty(e,"AwsCrc32",{enumerable:!0,get:function(){return o.AwsCrc32}})}(build$8)),build$8}requireBuild$6();const SHORT_TO_HEX$1={},HEX_TO_SHORT$1={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),SHORT_TO_HEX$1[e]=t,HEX_TO_SHORT$1[t]=e}function fromHex$1(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2){const n=e.slice(i,i+2).toLowerCase();if(!(n in HEX_TO_SHORT$1))throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`);t[i/2]=HEX_TO_SHORT$1[n]}return t}function toHex$1(e){let t="";for(let i=0;i<e.byteLength;i++)t+=SHORT_TO_HEX$1[e[i]];return t}class Int64{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const t=new Uint8Array(8);for(let i=7,n=Math.abs(Math.round(e));i>-1&&n>0;i--,n/=256)t[i]=n;return e<0&&negate(t),new Int64(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&negate(e),parseInt(toHex$1(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function negate(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class HeaderMarshaller{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const i of Object.keys(e)){const n=this.fromUtf8(i);t.push(Uint8Array.from([n.byteLength]),n,this.formatHeaderValue(e[i]))}const i=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let n=0;for(const e of t)i.set(e,n),n+=e.byteLength;return i}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const i=new DataView(new ArrayBuffer(5));return i.setUint8(0,4),i.setInt32(1,e.value,!1),new Uint8Array(i.buffer);case"long":const n=new Uint8Array(9);return n[0]=5,n.set(e.value.bytes,1),n;case"binary":const r=new DataView(new ArrayBuffer(3+e.value.byteLength));r.setUint8(0,6),r.setUint16(1,e.value.byteLength,!1);const o=new Uint8Array(r.buffer);return o.set(e.value,3),o;case"string":const a=this.fromUtf8(e.value),s=new DataView(new ArrayBuffer(3+a.byteLength));s.setUint8(0,7),s.setUint16(1,a.byteLength,!1);const d=new Uint8Array(s.buffer);return d.set(a,3),d;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(Int64.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!UUID_PATTERN.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const c=new Uint8Array(17);return c[0]=9,c.set(fromHex$1(e.value.replace(/\-/g,"")),1),c}}parse(e){const t={};let i=0;for(;i<e.byteLength;){const n=e.getUint8(i++),r=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+i,n));switch(i+=n,e.getUint8(i++)){case 0:t[r]={type:BOOLEAN_TAG,value:!0};break;case 1:t[r]={type:BOOLEAN_TAG,value:!1};break;case 2:t[r]={type:BYTE_TAG,value:e.getInt8(i++)};break;case 3:t[r]={type:SHORT_TAG,value:e.getInt16(i,!1)},i+=2;break;case 4:t[r]={type:INT_TAG,value:e.getInt32(i,!1)},i+=4;break;case 5:t[r]={type:LONG_TAG,value:new Int64(new Uint8Array(e.buffer,e.byteOffset+i,8))},i+=8;break;case 6:const n=e.getUint16(i,!1);i+=2,t[r]={type:BINARY_TAG,value:new Uint8Array(e.buffer,e.byteOffset+i,n)},i+=n;break;case 7:const o=e.getUint16(i,!1);i+=2,t[r]={type:STRING_TAG,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+i,o))},i+=o;break;case 8:t[r]={type:TIMESTAMP_TAG,value:new Date(new Int64(new Uint8Array(e.buffer,e.byteOffset+i,8)).valueOf())},i+=8;break;case 9:const a=new Uint8Array(e.buffer,e.byteOffset+i,16);i+=16,t[r]={type:UUID_TAG,value:`${toHex$1(a.subarray(0,4))}-${toHex$1(a.subarray(4,6))}-${toHex$1(a.subarray(6,8))}-${toHex$1(a.subarray(8,10))}-${toHex$1(a.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}}var HEADER_VALUE_TYPE;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));const BOOLEAN_TAG="boolean",BYTE_TAG="byte",SHORT_TAG="short",INT_TAG="integer",LONG_TAG="long",BINARY_TAG="binary",STRING_TAG="string",TIMESTAMP_TAG="timestamp",UUID_TAG="uuid",UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,getSmithyContext=e=>e[SMITHY_CONTEXT_KEY]||(e[SMITHY_CONTEXT_KEY]={}),normalizeProvider=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},fromUtf8=e=>(new TextEncoder).encode(e),toUint8Array=e=>"string"==typeof e?fromUtf8(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),toUtf8=e=>new TextDecoder("utf-8").decode(e),ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=604800,signingKeyCache={},cacheQueue=[],createScope=(e,t,i)=>`${e}/${t}/${i}/${KEY_TYPE_IDENTIFIER}`,getSigningKey=async(e,t,i,n,r)=>{const o=`${i}:${n}:${r}:${toHex$1(await hmac(e,t.secretAccessKey,t.accessKeyId))}:${t.sessionToken}`;if(o in signingKeyCache)return signingKeyCache[o];for(cacheQueue.push(o);cacheQueue.length>MAX_CACHE_SIZE;)delete signingKeyCache[cacheQueue.shift()];let a=`AWS4${t.secretAccessKey}`;for(const t of[i,n,r,KEY_TYPE_IDENTIFIER])a=await hmac(e,a,t);return signingKeyCache[o]=a},hmac=(e,t,i)=>{const n=new e(t);return n.update(toUint8Array(i)),n.digest()},getCanonicalHeaders=({headers:e},t,i)=>{const n={};for(const r of Object.keys(e).sort()){if(null==e[r])continue;const o=r.toLowerCase();(o in ALWAYS_UNSIGNABLE_HEADERS||t?.has(o)||PROXY_HEADER_PATTERN.test(o)||SEC_HEADER_PATTERN.test(o))&&(!i||i&&!i.has(o))||(n[o]=e[r].trim().replace(/\s+/g," "))}return n},escapeUri=e=>encodeURIComponent(e).replace(/[!'()*]/g,hexEncode),hexEncode=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,getCanonicalQuery=({query:e={}})=>{const t=[],i={};for(const n of Object.keys(e).sort()){if(n.toLowerCase()===SIGNATURE_HEADER)continue;t.push(n);const r=e[n];"string"==typeof r?i[n]=`${escapeUri(n)}=${escapeUri(r)}`:Array.isArray(r)&&(i[n]=r.slice(0).reduce(((e,t)=>e.concat([`${escapeUri(n)}=${escapeUri(t)}`])),[]).sort().join("&"))}return t.map((e=>i[e])).filter((e=>e)).join("&")},isArrayBuffer=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),getPayloadHash=async({headers:e,body:t},i)=>{for(const t of Object.keys(e))if(t.toLowerCase()===SHA256_HEADER)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||isArrayBuffer(t)){const e=new i;return e.update(toUint8Array(t)),toHex$1(await e.digest())}return UNSIGNED_PAYLOAD},hasHeader=(e,t)=>{e=e.toLowerCase();for(const i of Object.keys(t))if(e===i.toLowerCase())return!0;return!1},cloneRequest=({headers:e,query:t,...i})=>({...i,headers:{...e},query:t?cloneQuery(t):void 0}),cloneQuery=e=>Object.keys(e).reduce(((t,i)=>{const n=e[i];return{...t,[i]:Array.isArray(n)?[...n]:n}}),{}),moveHeadersToQuery=(e,t={})=>{const{headers:i,query:n={}}="function"==typeof e.clone?e.clone():cloneRequest(e);for(const e of Object.keys(i)){const r=e.toLowerCase();"x-amz-"!==r.slice(0,6)||t.unhoistableHeaders?.has(r)||(n[e]=i[e],delete i[e])}return{...e,headers:i,query:n}},prepareRequest=e=>{e="function"==typeof e.clone?e.clone():cloneRequest(e);for(const t of Object.keys(e.headers))GENERATED_HEADERS.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},iso8601=e=>toDate(e).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class SignatureV4{constructor({applyChecksum:e,credentials:t,region:i,service:n,sha256:r,uriEscapePath:o=!0}){this.headerMarshaller=new HeaderMarshaller(toUtf8,fromUtf8),this.service=n,this.sha256=r,this.uriEscapePath=o,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=normalizeProvider(i),this.credentialProvider=normalizeProvider(t)}async presign(e,t={}){const{signingDate:i=new Date,expiresIn:n=3600,unsignableHeaders:r,unhoistableHeaders:o,signableHeaders:a,signingRegion:s,signingService:d}=t,l=await this.credentialProvider();this.validateResolvedCredentials(l);const c=s??await this.regionProvider(),{longDate:u,shortDate:h}=formatDate(i);if(n>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const p=createScope(h,c,d??this.service),m=moveHeadersToQuery(prepareRequest(e),{unhoistableHeaders:o});l.sessionToken&&(m.query[TOKEN_QUERY_PARAM]=l.sessionToken),m.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,m.query[CREDENTIAL_QUERY_PARAM]=`${l.accessKeyId}/${p}`,m.query[AMZ_DATE_QUERY_PARAM]=u,m.query[EXPIRES_QUERY_PARAM]=n.toString(10);const f=getCanonicalHeaders(m,r,a);return m.query[SIGNED_HEADERS_QUERY_PARAM]=getCanonicalHeaderList(f),m.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(u,p,this.getSigningKey(l,c,h,d),this.createCanonicalRequest(m,f,await getPayloadHash(e,this.sha256))),m}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:i=new Date,priorSignature:n,signingRegion:r,signingService:o}){const a=r??await this.regionProvider(),{shortDate:s,longDate:d}=formatDate(i),l=createScope(s,a,o??this.service),c=await getPayloadHash({headers:{},body:t},this.sha256),u=new this.sha256;u.update(e);const h=toHex$1(await u.digest()),p=[EVENT_ALGORITHM_IDENTIFIER,d,l,n,h,c].join("\n");return this.signString(p,{signingDate:i,signingRegion:a,signingService:o})}async signMessage(e,{signingDate:t=new Date,signingRegion:i,signingService:n}){return this.signEvent({headers:this.headerMarshaller.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:i,signingService:n,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}async signString(e,{signingDate:t=new Date,signingRegion:i,signingService:n}={}){const r=await this.credentialProvider();this.validateResolvedCredentials(r);const o=i??await this.regionProvider(),{shortDate:a}=formatDate(t),s=new this.sha256(await this.getSigningKey(r,o,a,n));return s.update(toUint8Array(e)),toHex$1(await s.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:i,unsignableHeaders:n,signingRegion:r,signingService:o}={}){const a=await this.credentialProvider();this.validateResolvedCredentials(a);const s=r??await this.regionProvider(),d=prepareRequest(e),{longDate:l,shortDate:c}=formatDate(t),u=createScope(c,s,o??this.service);d.headers[AMZ_DATE_HEADER]=l,a.sessionToken&&(d.headers[TOKEN_HEADER]=a.sessionToken);const h=await getPayloadHash(d,this.sha256);!hasHeader(SHA256_HEADER,d.headers)&&this.applyChecksum&&(d.headers[SHA256_HEADER]=h);const p=getCanonicalHeaders(d,n,i),m=await this.getSignature(l,u,this.getSigningKey(a,s,c,o),this.createCanonicalRequest(d,p,h));return d.headers[AUTH_HEADER]=`${ALGORITHM_IDENTIFIER} Credential=${a.accessKeyId}/${u}, SignedHeaders=${getCanonicalHeaderList(p)}, Signature=${m}`,d}createCanonicalRequest(e,t,i){const n=Object.keys(t).sort();return`${e.method}\n${this.getCanonicalPath(e)}\n${getCanonicalQuery(e)}\n${n.map((e=>`${e}:${t[e]}`)).join("\n")}\n\n${n.join(";")}\n${i}`}async createStringToSign(e,t,i){const n=new this.sha256;n.update(toUint8Array(i));const r=await n.digest();return`${ALGORITHM_IDENTIFIER}\n${e}\n${t}\n${toHex$1(r)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const i of e.split("/"))0!==i?.length&&"."!==i&&(".."===i?t.pop():t.push(i));const i=`${e?.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&e?.endsWith("/")?"/":""}`;return encodeURIComponent(i).replace(/%2F/g,"/")}return e}async getSignature(e,t,i,n){const r=await this.createStringToSign(e,t,n),o=new this.sha256(await i);return o.update(toUint8Array(r)),toHex$1(await o.digest())}getSigningKey(e,t,i,n){return getSigningKey(this.sha256,e,i,t,n||this.service)}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}const formatDate=e=>{const t=iso8601(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.slice(0,8)}},getCanonicalHeaderList=e=>Object.keys(e).sort().join(";"),CREDENTIAL_EXPIRE_WINDOW=3e5,resolveAwsAuthConfig=e=>{const t=e.credentials?normalizeCredentialProvider(e.credentials):e.credentialDefaultProvider(e),{signingEscapePath:i=!0,systemClockOffset:n=e.systemClockOffset||0,sha256:r}=e;let o;return o=e.signer?normalizeProvider(e.signer):e.regionInfoProvider?()=>normalizeProvider(e.region)().then((async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t])).then((([n,o])=>{const{signingRegion:a,signingService:s}=n;e.signingRegion=e.signingRegion||a||o,e.signingName=e.signingName||s||e.serviceId;const d={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:i};return new(e.signerConstructor||SignatureV4)(d)})):async n=>{const o=(n=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await normalizeProvider(e.region)(),properties:{}},n)).signingRegion,a=n.signingName;e.signingRegion=e.signingRegion||o,e.signingName=e.signingName||a||e.serviceId;const s={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:i};return new(e.signerConstructor||SignatureV4)(s)},{...e,systemClockOffset:n,signingEscapePath:i,credentials:t,signer:o}},normalizeCredentialProvider=e=>"function"==typeof e?memoize(e,(e=>void 0!==e.expiration&&e.expiration.getTime()-Date.now()<CREDENTIAL_EXPIRE_WINDOW),(e=>void 0!==e.expiration)):normalizeProvider(e),getSkewCorrectedDate=e=>new Date(Date.now()+e),isClockSkewed=(e,t)=>Math.abs(getSkewCorrectedDate(t).getTime()-e)>=3e5,getUpdatedSystemClockOffset=(e,t)=>{const i=Date.parse(e);return isClockSkewed(i,t)?i-Date.now():t},awsAuthMiddleware=e=>(t,i)=>async function(n){if(!HttpRequest.isInstance(n.request))return t(n);const r=i.endpointV2?.properties?.authSchemes?.[0],o="sigv4a"===r?.name?r?.signingRegionSet?.join(","):void 0,a=await e.signer(r);let s;const d={signingDate:getSkewCorrectedDate(e.systemClockOffset),signingRegion:o||i.signing_region,signingService:i.signing_service};if(i.s3ExpressIdentity){const e=a;if(s=await e.signWithCredentials(n.request,i.s3ExpressIdentity,d),s.headers["X-Amz-Security-Token"]||s.headers["x-amz-security-token"])throw new Error("X-Amz-Security-Token must not be set for s3-express requests.")}else s=await a.sign(n.request,d);const l=await t({...n,request:s}).catch((t=>{const i=t.ServerTime??getDateHeader(t.$response);throw i&&(e.systemClockOffset=getUpdatedSystemClockOffset(i,e.systemClockOffset)),t})),c=getDateHeader(l.response);return c&&(e.systemClockOffset=getUpdatedSystemClockOffset(c,e.systemClockOffset)),l},getDateHeader=e=>HttpResponse.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,awsAuthMiddlewareOptions={name:"awsAuthMiddleware",tags:["SIGNATURE","AWSAUTH"],relation:"after",toMiddleware:"retryMiddleware",override:!0},getAwsAuthPlugin=e=>({applyToStack:t=>{t.addRelativeTo(awsAuthMiddleware(e),awsAuthMiddlewareOptions)}});function resolveUserAgentConfig(e){return{...e,customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent}}const IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=e=>IP_V4_REGEX.test(e)||e.startsWith("[")&&e.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(e,t=!1)=>{if(!t)return VALID_HOST_LABEL_REGEX.test(e);const i=e.split(".");for(const e of i)if(!isValidHostLabel(e))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(e){return"object"!=typeof e||null==e?e:"ref"in e?`$${toDebugString(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map(toDebugString).join(", ")})`:JSON.stringify(e,null,2)}class EndpointError extends Error{constructor(e){super(e),this.name="EndpointError"}}const booleanEquals=(e,t)=>e===t,getAttrPathList=e=>{const t=e.split("."),i=[];for(const n of t){const t=n.indexOf("[");if(-1!==t){if(n.indexOf("]")!==n.length-1)throw new EndpointError(`Path: '${e}' does not end with ']'`);const r=n.slice(t+1,-1);if(Number.isNaN(parseInt(r)))throw new EndpointError(`Invalid array index: '${r}' in path: '${e}'`);0!==t&&i.push(n.slice(0,t)),i.push(r)}else i.push(n)}return i},getAttr=(e,t)=>getAttrPathList(t).reduce(((i,n)=>{if("object"!=typeof i)throw new EndpointError(`Index '${n}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(i)?i[parseInt(n)]:i[n]}),e),isSet=e=>null!=e,not=e=>!e,DEFAULT_PORTS={[EndpointURLScheme.HTTP]:80,[EndpointURLScheme.HTTPS]:443},parseURL=e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:i,protocol:n="",path:r="",query:o={}}=e,a=new URL(`${n}//${t}${i?`:${i}`:""}${r}`);return a.search=Object.entries(o).map((([e,t])=>`${e}=${t}`)).join("&"),a}return new URL(e)}catch(e){return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;const i=t.href,{host:n,hostname:r,pathname:o,protocol:a,search:s}=t;if(s)return null;const d=a.slice(0,-1);if(!Object.values(EndpointURLScheme).includes(d))return null;const l=isIpAddress(r);return{scheme:d,authority:`${n}${i.includes(`${n}:${DEFAULT_PORTS[d]}`)||"string"==typeof e&&e.includes(`${n}:${DEFAULT_PORTS[d]}`)?`:${DEFAULT_PORTS[d]}`:""}`,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:l}},stringEquals=(e,t)=>e===t,substring=(e,t,i,n)=>t>=i||e.length<i?null:n?e.substring(e.length-i,e.length-t):e.substring(t,i),uriEncode=e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)),endpointFunctions={booleanEquals:booleanEquals,getAttr:getAttr,isSet:isSet,isValidHostLabel:isValidHostLabel,not:not,parseURL:parseURL,stringEquals:stringEquals,substring:substring,uriEncode:uriEncode},evaluateTemplate=(e,t)=>{const i=[],n={...t.endpointParams,...t.referenceRecord};let r=0;for(;r<e.length;){const t=e.indexOf("{",r);if(-1===t){i.push(e.slice(r));break}i.push(e.slice(r,t));const o=e.indexOf("}",t);if(-1===o){i.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[o+1]&&(i.push(e.slice(t+1,o)),r=o+2);const a=e.substring(t+1,o);if(a.includes("#")){const[e,t]=a.split("#");i.push(getAttr(n[e],t))}else i.push(n[a]);r=o+1}return i.join("")},getReferenceValue=({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]),evaluateExpression=(e,t,i)=>{if("string"==typeof e)return evaluateTemplate(e,i);if(e.fn)return callFunction(e,i);if(e.ref)return getReferenceValue(e,i);throw new EndpointError(`'${t}': ${String(e)} is not a string, function or reference.`)},callFunction=({fn:e,argv:t},i)=>{const n=t.map((e=>["boolean","number"].includes(typeof e)?e:evaluateExpression(e,"arg",i))),r=e.split(".");return r[0]in customEndpointFunctions&&null!=r[1]?customEndpointFunctions[r[0]][r[1]](...n):endpointFunctions[e](...n)},evaluateCondition=({assign:e,...t},i)=>{if(e&&e in i.referenceRecord)throw new EndpointError(`'${e}' is already defined in Reference Record.`);const n=callFunction(t,i);return i.logger?.debug?.(debugId,`evaluateCondition: ${toDebugString(t)} = ${toDebugString(n)}`),{result:""===n||!!n,...null!=e&&{toAssign:{name:e,value:n}}}},evaluateConditions=(e=[],t)=>{const i={};for(const n of e){const{result:e,toAssign:r}=evaluateCondition(n,{...t,referenceRecord:{...t.referenceRecord,...i}});if(!e)return{result:e};r&&(i[r.name]=r.value,t.logger?.debug?.(debugId,`assign: ${r.name} := ${toDebugString(r.value)}`))}return{result:!0,referenceRecord:i}},getEndpointHeaders=(e,t)=>Object.entries(e).reduce(((e,[i,n])=>({...e,[i]:n.map((e=>{const n=evaluateExpression(e,"Header value entry",t);if("string"!=typeof n)throw new EndpointError(`Header '${i}' value '${n}' is not a string`);return n}))})),{}),getEndpointProperty=(e,t)=>{if(Array.isArray(e))return e.map((e=>getEndpointProperty(e,t)));switch(typeof e){case"string":return evaluateTemplate(e,t);case"object":if(null===e)throw new EndpointError(`Unexpected endpoint property: ${e}`);return getEndpointProperties(e,t);case"boolean":return e;default:throw new EndpointError("Unexpected endpoint property type: "+typeof e)}},getEndpointProperties=(e,t)=>Object.entries(e).reduce(((e,[i,n])=>({...e,[i]:getEndpointProperty(n,t)})),{}),getEndpointUrl=(e,t)=>{const i=evaluateExpression(e,"Endpoint URL",t);if("string"==typeof i)try{return new URL(i)}catch(e){throw console.error(`Failed to construct URL with ${i}`,e),e}throw new EndpointError("Endpoint URL must be a string, got "+typeof i)},evaluateEndpointRule=(e,t)=>{const{conditions:i,endpoint:n}=e,{result:r,referenceRecord:o}=evaluateConditions(i,t);if(!r)return;const a={...t,referenceRecord:{...t.referenceRecord,...o}},{url:s,properties:d,headers:l}=n;return t.logger?.debug?.(debugId,`Resolving endpoint from template: ${toDebugString(n)}`),{...null!=l&&{headers:getEndpointHeaders(l,a)},...null!=d&&{properties:getEndpointProperties(d,a)},url:getEndpointUrl(s,a)}},evaluateErrorRule=(e,t)=>{const{conditions:i,error:n}=e,{result:r,referenceRecord:o}=evaluateConditions(i,t);if(r)throw new EndpointError(evaluateExpression(n,"Error",{...t,referenceRecord:{...t.referenceRecord,...o}}))},evaluateTreeRule=(e,t)=>{const{conditions:i,rules:n}=e,{result:r,referenceRecord:o}=evaluateConditions(i,t);if(r)return evaluateRules(n,{...t,referenceRecord:{...t.referenceRecord,...o}})},evaluateRules=(e,t)=>{for(const i of e)if("endpoint"===i.type){const e=evaluateEndpointRule(i,t);if(e)return e}else if("error"===i.type)evaluateErrorRule(i,t);else{if("tree"!==i.type)throw new EndpointError(`Unknown endpoint rule: ${i}`);{const e=evaluateTreeRule(i,t);if(e)return e}}throw new EndpointError("Rules evaluation failed")},resolveEndpoint=(e,t)=>{const{endpointParams:i,logger:n}=t,{parameters:r,rules:o}=e;t.logger?.debug?.(`${debugId} Initial EndpointParams: ${toDebugString(i)}`);const a=Object.entries(r).filter((([,e])=>null!=e.default)).map((([e,t])=>[e,t.default]));if(a.length>0)for(const[e,t]of a)i[e]=i[e]??t;const s=Object.entries(r).filter((([,e])=>e.required)).map((([e])=>e));for(const e of s)if(null==i[e])throw new EndpointError(`Missing required parameter: '${e}'`);const d=evaluateRules(o,{endpointParams:i,logger:n,referenceRecord:{}});if(t.endpointParams?.Endpoint)try{const e=new URL(t.endpointParams.Endpoint),{protocol:i,port:n}=e;d.url.protocol=i,d.url.port=n}catch(e){}return t.logger?.debug?.(`${debugId} Resolved endpoint: ${toDebugString(d)}`),d},isVirtualHostableS3Bucket=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!isVirtualHostableS3Bucket(t))return!1;return!0}return!!isValidHostLabel(e)&&(!(e.length<3||e.length>63)&&(e===e.toLowerCase()&&!isIpAddress(e)))},parseArn=e=>{const t=e.split(":");if(t.length<6)return null;const[i,n,r,o,a,...s]=t;return"arn"!==i||""===n||""===r||""===s[0]?null:{partition:n,service:r,region:o,accountId:a,resourceId:s[0].includes("/")?s[0].split("/"):s}};var partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],version$1="1.1",partitionsInfo={partitions:partitions,version:version$1};let selectedPartitionsInfo=partitionsInfo;const partition=e=>{const{partitions:t}=selectedPartitionsInfo;for(const i of t){const{regions:t,outputs:n}=i;for(const[i,r]of Object.entries(t))if(i===e)return{...n,...r}}for(const i of t){const{regionRegex:t,outputs:n}=i;if(new RegExp(t).test(e))return{...n}}const i=t.find((e=>"aws"===e.id));if(!i)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...i.outputs}},awsEndpointFunctions={isVirtualHostableS3Bucket:isVirtualHostableS3Bucket,parseArn:parseArn,partition:partition};customEndpointFunctions.aws=awsEndpointFunctions;const USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,UA_VALUE_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,UA_ESCAPE_CHAR="-",userAgentMiddleware=e=>(t,i)=>async n=>{const{request:r}=n;if(!HttpRequest.isInstance(r))return t(n);const{headers:o}=r,a=i?.userAgent?.map(escapeUserAgent)||[],s=(await e.defaultUserAgentProvider()).map(escapeUserAgent),d=e?.customUserAgent?.map(escapeUserAgent)||[],l=[].concat([...s,...a,...d]).join(SPACE),c=[...s.filter((e=>e.startsWith("aws-sdk-"))),...d].join(SPACE);return"browser"!==e.runtime?(c&&(o[X_AMZ_USER_AGENT]=o[X_AMZ_USER_AGENT]?`${o[USER_AGENT]} ${c}`:c),o[USER_AGENT]=l):o[X_AMZ_USER_AGENT]=l,t({...n,request:r})},escapeUserAgent=e=>{const t=e[0].split(UA_NAME_SEPARATOR).map((e=>e.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR))).join(UA_NAME_SEPARATOR),i=e[1]?.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),n=t.indexOf(UA_NAME_SEPARATOR),r=t.substring(0,n);let o=t.substring(n+1);return"api"===r&&(o=o.toLowerCase()),[r,o,i].filter((e=>e&&e.length>0)).reduce(((e,t,i)=>{switch(i){case 0:return t;case 1:return`${e}/${t}`;default:return`${e}#${t}`}}),"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=e=>({applyToStack:t=>{t.add(userAgentMiddleware(e),getUserAgentMiddlewareOptions)}});var SelectorType;!function(e){e.ENV="env",e.CONFIG="shared config entry"}(SelectorType||(SelectorType={}));const DEFAULT_USE_DUALSTACK_ENDPOINT=!1,DEFAULT_USE_FIPS_ENDPOINT=!1,isFipsRegion=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),getRealRegion=e=>isFipsRegion(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,resolveRegionConfig=e=>{const{region:t,useFipsEndpoint:i}=e;if(!t)throw new Error("Region is missing");return{...e,region:async()=>{if("string"==typeof t)return getRealRegion(t);const e=await t();return getRealRegion(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!isFipsRegion(e)||("function"!=typeof i?Promise.resolve(!!i):i())}}},CONTENT_LENGTH_HEADER="content-length";function contentLengthMiddleware(e){return t=>async i=>{const n=i.request;if(HttpRequest.isInstance(n)){const{body:t,headers:i}=n;if(t&&-1===Object.keys(i).map((e=>e.toLowerCase())).indexOf(CONTENT_LENGTH_HEADER))try{const i=e(t);n.headers={...n.headers,[CONTENT_LENGTH_HEADER]:String(i)}}catch(e){}}return t({...i,request:n})}}const contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=e=>({applyToStack:t=>{t.add(contentLengthMiddleware(e.bodyLengthChecker),contentLengthMiddlewareOptions)}}),resolveParamsForS3=async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),isArnBucketName(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!isDnsCompatibleBucketName(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=e=>DOMAIN_PATTERN.test(e)&&!IP_ADDRESS_PATTERN.test(e)&&!DOTS_PATTERN.test(e),isArnBucketName=e=>{const[t,i,n,r,o,a]=e.split(":"),s="arn"===t&&e.split(":").length>=6,d=5===[t,i,n,o,a].filter(Boolean).length;if(s&&!d)throw new Error(`Invalid ARN: ${e} was an invalid ARN.`);return!!("arn"===t&&i&&n&&o&&a)},createConfigValueProvider=(e,t,i)=>{const n=async()=>{const n=i[e]??i[t];return"function"==typeof n?n():n};return"credentialScope"===e||"CredentialScope"===t?async()=>{const e="function"==typeof i.credentials?await i.credentials():i.credentials;return e?.credentialScope??e?.CredentialScope}:"endpoint"===e||"endpoint"===t?async()=>{const e=await n();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:i,port:n,path:r}=e;return`${t}//${i}${n?":"+n:""}${r}`}}return e}:n},getEndpointFromConfig=async e=>{};function parseQueryString(e){const t={};if(e=e.replace(/^\?/,""))for(const i of e.split("&")){let[e,n=null]=i.split("=");e=decodeURIComponent(e),n&&(n=decodeURIComponent(n)),e in t?Array.isArray(t[e])?t[e].push(n):t[e]=[t[e],n]:t[e]=n}return t}const parseUrl=e=>{if("string"==typeof e)return parseUrl(new URL(e));const{hostname:t,pathname:i,port:n,protocol:r,search:o}=e;let a;return o&&(a=parseQueryString(o)),{hostname:t,port:n?parseInt(n):void 0,protocol:r,path:i,query:a}},toEndpointV1=e=>"object"==typeof e?"url"in e?parseUrl(e.url):e:parseUrl(e),getEndpointFromInstructions=async(e,t,i,n)=>{if(!i.endpoint){const e=await getEndpointFromConfig(i.serviceId||"");e&&(i.endpoint=()=>Promise.resolve(toEndpointV1(e)))}const r=await resolveParams(e,t,i);if("function"!=typeof i.endpointProvider)throw new Error("config.endpointProvider is not set.");return i.endpointProvider(r,n)},resolveParams=async(e,t,i)=>{const n={},r=t?.getEndpointParameterInstructions?.()||{};for(const[t,o]of Object.entries(r))switch(o.type){case"staticContextParams":n[t]=o.value;break;case"contextParams":n[t]=e[o.name];break;case"clientContextParams":case"builtInParams":n[t]=await createConfigValueProvider(o.name,t,i)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(o))}return 0===Object.keys(r).length&&Object.assign(n,i),"s3"===String(i.serviceId).toLowerCase()&&await resolveParamsForS3(n),n},endpointMiddleware=({config:e,instructions:t})=>(i,n)=>async r=>{const o=await getEndpointFromInstructions(r.input,{getEndpointParameterInstructions:()=>t},{...e},n);n.endpointV2=o,n.authSchemes=o.properties?.authSchemes;const a=n.authSchemes?.[0];if(a){n.signing_region=a.signingRegion,n.signing_service=a.signingName;const e=getSmithyContext(n),t=e?.selectedHttpAuthScheme?.httpAuthOption;t&&(t.signingProperties=Object.assign(t.signingProperties||{},{signing_region:a.signingRegion,signingRegion:a.signingRegion,signing_service:a.signingName,signingName:a.signingName,signingRegionSet:a.signingRegionSet},a.properties))}return i({...r})},deserializerMiddleware=(e,t)=>(i,n)=>async n=>{const{response:r}=await i(n);try{return{response:r,output:await t(r,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:r}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";e.message+="\n  "+t}throw e}},serializerMiddleware=(e,t)=>(i,n)=>async r=>{const o=n.endpointV2?.url&&e.urlParser?async()=>e.urlParser(n.endpointV2.url):e.endpoint;if(!o)throw new Error("No valid endpoint provider available.");const a=await t(r.input,{...e,endpoint:o});return i({...r,request:a})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSerdePlugin(e,t,i){return{applyToStack:n=>{n.add(deserializerMiddleware(e,i),deserializerMiddlewareOption),n.add(serializerMiddleware(e,t),serializerMiddlewareOption)}}}const endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:serializerMiddlewareOption.name},getEndpointPlugin=(e,t)=>({applyToStack:i=>{i.addRelativeTo(endpointMiddleware({config:e,instructions:t}),endpointMiddlewareOptions)}}),resolveEndpointConfig=e=>{const t=e.tls??!0,{endpoint:i}=e,n=null!=i?async()=>toEndpointV1(await normalizeProvider(i)()):void 0,r=!!i;return{...e,endpoint:n,tls:t,isCustomEndpoint:r,useDualstackEndpoint:normalizeProvider(e.useDualstackEndpoint??!1),useFipsEndpoint:normalizeProvider(e.useFipsEndpoint??!1)}};var RETRY_MODES;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(RETRY_MODES||(RETRY_MODES={}));const DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=RETRY_MODES.STANDARD,THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],isThrottlingError=e=>429===e.$metadata?.httpStatusCode||THROTTLING_ERROR_CODES.includes(e.name)||1==e.$retryable?.throttling,isTransientError=e=>TRANSIENT_ERROR_CODES.includes(e.name)||NODEJS_TIMEOUT_ERROR_CODES.includes(e?.code||"")||TRANSIENT_ERROR_STATUS_CODES.includes(e.$metadata?.httpStatusCode||0),isServerError=e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!isTransientError(e)}return!1};class DefaultRateLimiter{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise((e=>setTimeout(e,t)))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),isThrottlingError(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const i=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(i)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}const DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=2e4,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let e=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:t=>Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}},createDefaultRetryToken=({retryDelay:e,retryCount:t,retryCost:i})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,e),getRetryCost:()=>i});class StandardRetryStrategy{constructor(e){this.maxAttempts=e,this.mode=RETRY_MODES.STANDARD,this.capacity=INITIAL_RETRY_TOKENS,this.retryBackoffStrategy=getDefaultRetryBackoffStrategy(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry(e,t){const i=await this.getMaxAttempts();if(this.shouldRetry(e,t,i)){const i=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===i?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);const n=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),r=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,n):n,o=this.getCapacityCost(i);return this.capacity-=o,createDefaultRetryToken({retryDelay:r,retryCount:e.getRetryCount()+1,retryCost:o})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+(e.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn(`Max attempts provider could not resolve. Using default of ${DEFAULT_MAX_ATTEMPTS}`),DEFAULT_MAX_ATTEMPTS}}shouldRetry(e,t,i){return e.getRetryCount()+1<i&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class AdaptiveRetryStrategy{constructor(e,t){this.maxAttemptsProvider=e,this.mode=RETRY_MODES.ADAPTIVE;const{rateLimiter:i}=t??{};this.rateLimiter=i??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return"string"==typeof e&&REGEX.test(e)}for(var byteToHex=[],i$1=0;i$1<256;++i$1)byteToHex.push((i$1+256).toString(16).substr(1));function stringify$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(!validate(i))throw TypeError("Stringified UUID is invalid");return i}function v4(e,t,i){var n=(e=e||{}).random||(e.rng||rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return stringify$1(n)}const asSdkError=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):"string"==typeof e?new Error(e):new Error(`AWS SDK error wrapper for ${e}`),resolveRetryConfig=e=>{const{retryStrategy:t}=e,i=normalizeProvider(e.maxAttempts??DEFAULT_MAX_ATTEMPTS);return{...e,maxAttempts:i,retryStrategy:async()=>{if(t)return t;return await normalizeProvider(e.retryMode)()===RETRY_MODES.ADAPTIVE?new AdaptiveRetryStrategy(i):new StandardRetryStrategy(i)}}};let NoOpLogger$2=class{trace(){}debug(){}info(){}warn(){}error(){}};const getAllAliases=(e,t)=>{const i=[];if(e&&i.push(e),t)for(const e of t)i.push(e);return i},getMiddlewareNameWithAliases=(e,t)=>`${e||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,constructStack=()=>{let e=[],t=[],i=!1;const n=new Set,r=i=>(e.forEach((e=>{i.add(e.middleware,{...e})})),t.forEach((e=>{i.addRelativeTo(e.middleware,{...e})})),i.identifyOnResolve?.(s.identifyOnResolve()),i),o=e=>{const t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t},a=(i=!1)=>{const n=[],r=[],a={};e.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))a[e]=t;n.push(t)})),t.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))a[e]=t;r.push(t)})),r.forEach((e=>{if(e.toMiddleware){const t=a[e.toMiddleware];if(void 0===t){if(i)return;throw new Error(`${e.toMiddleware} is not found when adding ${getMiddlewareNameWithAliases(e.name,e.aliases)} middleware ${e.relation} ${e.toMiddleware}`)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));const s=(d=n,d.sort(((e,t)=>stepWeights[t.step]-stepWeights[e.step]||priorityWeights[t.priority||"normal"]-priorityWeights[e.priority||"normal"]))).map(o).reduce(((e,t)=>(e.push(...t),e)),[]);var d;return s},s={add:(t,i={})=>{const{name:r,override:o,aliases:a}=i,s={step:"initialize",priority:"normal",middleware:t,...i},d=getAllAliases(r,a);if(d.length>0){if(d.some((e=>n.has(e)))){if(!o)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(r,a)}'`);for(const t of d){const i=e.findIndex((e=>e.name===t||e.aliases?.some((e=>e===t))));if(-1===i)continue;const n=e[i];if(n.step!==s.step||s.priority!==n.priority)throw new Error(`"${getMiddlewareNameWithAliases(n.name,n.aliases)}" middleware with ${n.priority} priority in ${n.step} step cannot be overridden by "${getMiddlewareNameWithAliases(r,a)}" middleware with ${s.priority} priority in ${s.step} step.`);e.splice(i,1)}}for(const e of d)n.add(e)}e.push(s)},addRelativeTo:(e,i)=>{const{name:r,override:o,aliases:a}=i,s={middleware:e,...i},d=getAllAliases(r,a);if(d.length>0){if(d.some((e=>n.has(e)))){if(!o)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(r,a)}'`);for(const e of d){const i=t.findIndex((t=>t.name===e||t.aliases?.some((t=>t===e))));if(-1===i)continue;const n=t[i];if(n.toMiddleware!==s.toMiddleware||n.relation!==s.relation)throw new Error(`"${getMiddlewareNameWithAliases(n.name,n.aliases)}" middleware ${n.relation} "${n.toMiddleware}" middleware cannot be overridden by "${getMiddlewareNameWithAliases(r,a)}" middleware ${s.relation} "${s.toMiddleware}" middleware.`);t.splice(i,1)}}for(const e of d)n.add(e)}t.push(s)},clone:()=>r(constructStack()),use:e=>{e.applyToStack(s)},remove:i=>"string"==typeof i?(i=>{let r=!1;const o=e=>{const t=getAllAliases(e.name,e.aliases);if(t.includes(i)){r=!0;for(const e of t)n.delete(e);return!1}return!0};return e=e.filter(o),t=t.filter(o),r})(i):(i=>{let r=!1;const o=e=>{if(e.middleware===i){r=!0;for(const t of getAllAliases(e.name,e.aliases))n.delete(t);return!1}return!0};return e=e.filter(o),t=t.filter(o),r})(i),removeByTag:i=>{let r=!1;const o=e=>{const{tags:t,name:o,aliases:a}=e;if(t&&t.includes(i)){const e=getAllAliases(o,a);for(const t of e)n.delete(t);return r=!0,!1}return!0};return e=e.filter(o),t=t.filter(o),r},concat:e=>{const t=r(constructStack());return t.use(e),t.identifyOnResolve(i||t.identifyOnResolve()||(e.identifyOnResolve?.()??!1)),t},applyToStack:r,identify:()=>a(!0).map((e=>{const t=e.step??e.relation+" "+e.toMiddleware;return getMiddlewareNameWithAliases(e.name,e.aliases)+" - "+t})),identifyOnResolve:e=>("boolean"==typeof e&&(i=e),i),resolve:(e,t)=>{for(const i of a().map((e=>e.middleware)).reverse())e=i(e,t);return i&&console.log(s.identify()),e}};return s},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};class Client{constructor(e){this.middlewareStack=constructStack(),this.config=e}send(e,t,i){const n="function"!=typeof t?t:void 0,r="function"==typeof t?t:i,o=e.resolveMiddleware(this.middlewareStack,this.config,n);if(!r)return o(e).then((e=>e.output));o(e).then((e=>r(null,e.output)),(e=>r(e))).catch((()=>{}))}destroy(){this.config.requestHandler.destroy&&this.config.requestHandler.destroy()}}const alphabetByEncoding={},alphabetByValue=new Array(64);for(let e=0,t="A".charCodeAt(0),i="Z".charCodeAt(0);e+t<=i;e++){const i=String.fromCharCode(e+t);alphabetByEncoding[i]=e,alphabetByValue[e]=i}for(let e=0,t="a".charCodeAt(0),i="z".charCodeAt(0);e+t<=i;e++){const i=String.fromCharCode(e+t),n=e+26;alphabetByEncoding[i]=n,alphabetByValue[n]=i}for(let e=0;e<10;e++){alphabetByEncoding[e.toString(10)]=e+52;const t=e.toString(10),i=e+52;alphabetByEncoding[t]=i,alphabetByValue[i]=t}alphabetByEncoding["+"]=62,alphabetByValue[62]="+",alphabetByEncoding["/"]=63,alphabetByValue[63]="/";const bitsPerLetter=6,bitsPerByte=8,maxLetterValue=63,fromBase64=e=>{let t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;const i=new ArrayBuffer(t),n=new DataView(i);for(let t=0;t<e.length;t+=4){let i=0,r=0;for(let n=t,o=t+3;n<=o;n++)if("="!==e[n]){if(!(e[n]in alphabetByEncoding))throw new TypeError(`Invalid character ${e[n]} in base64 string.`);i|=alphabetByEncoding[e[n]]<<(o-n)*bitsPerLetter,r+=bitsPerLetter}else i>>=bitsPerLetter;const o=t/4*3;i>>=r%bitsPerByte;const a=Math.floor(r/bitsPerByte);for(let e=0;e<a;e++){const t=(a-e-1)*bitsPerByte;n.setUint8(o+e,(i&255<<t)>>t)}}return new Uint8Array(i)};function toBase64(e){let t="";for(let i=0;i<e.length;i+=3){let n=0,r=0;for(let t=i,o=Math.min(i+3,e.length);t<o;t++)n|=e[t]<<(o-t-1)*bitsPerByte,r+=bitsPerByte;const o=Math.ceil(r/bitsPerLetter);n<<=o*bitsPerLetter-r;for(let e=1;e<=o;e++){const i=(o-e)*bitsPerLetter;t+=alphabetByValue[(n&maxLetterValue<<i)>>i]}t+="==".slice(0,4-o)}return t}function transformToString(e,t="utf-8"){return"base64"===t?toBase64(e):toUtf8(e)}function transformFromString(e,t){return"base64"===t?Uint8ArrayBlobAdapter.mutate(fromBase64(e)):Uint8ArrayBlobAdapter.mutate(fromUtf8(e))}class Uint8ArrayBlobAdapter extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return transformFromString(e,t);throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,Uint8ArrayBlobAdapter.prototype),e}transformToString(e="utf-8"){return transformToString(this,e)}}function buildQueryString(e){const t=[];for(let i of Object.keys(e).sort()){const n=e[i];if(i=escapeUri(i),Array.isArray(n))for(let e=0,r=n.length;e<r;e++)t.push(`${i}=${escapeUri(n[e])}`);else{let e=i;(n||"string"==typeof n)&&(e+=`=${escapeUri(n)}`),t.push(e)}}return t.join("&")}function requestTimeout(e=0){return new Promise(((t,i)=>{e&&setTimeout((()=>{const t=new Error(`Request did not complete within ${e} ms`);t.name="TimeoutError",i(t)}),e)}))}const keepAliveSupport={supported:Boolean("undefined"!=typeof Request&&"keepalive"in new Request("https://[::1]"))};class FetchHttpHandler{static create(e){return"function"==typeof e?.handle?e:new FetchHttpHandler(e)}constructor(e){"function"==typeof e?this.configProvider=e().then((e=>e||{})):(this.config=e??{},this.configProvider=Promise.resolve(this.config))}destroy(){}async handle(e,{abortSignal:t}={}){this.config||(this.config=await this.configProvider);const i=this.config.requestTimeout,n=!0===this.config.keepAlive;if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",Promise.reject(e)}let r=e.path;const o=buildQueryString(e.query||{});o&&(r+=`?${o}`),e.fragment&&(r+=`#${e.fragment}`);let a="";if(null!=e.username||null!=e.password){a=`${e.username??""}:${e.password??""}@`}const{port:s,method:d}=e,l=`${e.protocol}//${a}${e.hostname}${s?`:${s}`:""}${r}`,c={body:"GET"===d||"HEAD"===d?void 0:e.body,headers:new Headers(e.headers),method:d};"undefined"!=typeof AbortController&&(c.signal=t),keepAliveSupport.supported&&(c.keepalive=n);const u=new Request(l,c),h=[fetch(u).then((e=>{const t=e.headers,i={};for(const e of t.entries())i[e[0]]=e[1];return null!=e.body?{response:new HttpResponse({headers:i,reason:e.statusText,statusCode:e.status,body:e.body})}:e.blob().then((t=>({response:new HttpResponse({headers:i,reason:e.statusText,statusCode:e.status,body:t})})))})),requestTimeout(i)];return t&&h.push(new Promise(((e,i)=>{t.onabort=()=>{const e=new Error("Request aborted");e.name="AbortError",i(e)}}))),Promise.race(h)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then((i=>(i[e]=t,i)))}httpHandlerConfigs(){return this.config??{}}}const streamCollector=e=>"function"==typeof Blob&&e instanceof Blob?collectBlob(e):collectStream(e);async function collectBlob(e){const t=await readToBase64(e),i=fromBase64(t);return new Uint8Array(i)}async function collectStream(e){let t=new Uint8Array(0);const i=e.getReader();let n=!1;for(;!n;){const{done:e,value:r}=await i.read();if(r){const e=t;t=new Uint8Array(e.length+r.length),t.set(e),t.set(r,e.length)}n=e}return t}function readToBase64(e){return new Promise(((t,i)=>{const n=new FileReader;n.onloadend=()=>{if(2!==n.readyState)return i(new Error("Reader aborted too early"));const e=n.result??"",r=e.indexOf(","),o=r>-1?r+1:e.length;t(e.substring(o))},n.onabort=()=>i(new Error("Read aborted")),n.onerror=()=>i(n.error),n.readAsDataURL(e)}))}const collectBody=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Uint8ArrayBlobAdapter.mutate(e);if(!e)return Uint8ArrayBlobAdapter.mutate(new Uint8Array);const i=t.streamCollector(e);return Uint8ArrayBlobAdapter.mutate(await i)};class Command{constructor(){this.middlewareStack=constructStack()}static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext(e,t,i,{middlewareFn:n,clientName:r,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:s,smithyContext:d,additionalContext:l,CommandCtor:c}){for(const r of n.bind(this)(c,e,t,i))this.middlewareStack.use(r);const u=e.concat(this.middlewareStack),{logger:h}=t,p={logger:h,clientName:r,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:s,[SMITHY_CONTEXT_KEY]:{...d},...l},{requestHandler:m}=t;return u.resolve((e=>m.handle(e.request,i||{})),p)}}class ClassBuilder{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,i={}){return this._smithyContext={service:e,operation:t,...i},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=(e=>e),t=(e=>e)){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){const e=this;let t;return t=class extends Command{static getEndpointParameterInstructions(){return e._ep}constructor(t){super(),this.input=t,this.serialize=e._serializer,this.deserialize=e._deserializer,e._init(this)}resolveMiddleware(i,n,r){return this.resolveMiddlewareWithContext(i,n,r,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const SENSITIVE_STRING="***SensitiveInformation***",createAggregatedClient=(e,t)=>{for(const i of Object.keys(e)){const n=e[i],r=async function(e,t,i){const r=new n(e);if("function"==typeof t)this.send(r,t);else{if("function"!=typeof i)return this.send(r,t);if("object"!=typeof t)throw new Error("Expected http options but got "+typeof t);this.send(r,t||{},i)}},o=(i[0].toLowerCase()+i.slice(1)).replace(/Command$/,"");t.prototype[o]=r}},expectBoolean=e=>{if(null!=e){if("number"==typeof e){if(0!==e&&1!==e||logger.warn(stackTraceWarning(`Expected boolean, got ${typeof e}: ${e}`)),0===e)return!1;if(1===e)return!0}if("string"==typeof e){const t=e.toLowerCase();if("false"!==t&&"true"!==t||logger.warn(stackTraceWarning(`Expected boolean, got ${typeof e}: ${e}`)),"false"===t)return!1;if("true"===t)return!0}if("boolean"==typeof e)return e;throw new TypeError(`Expected boolean, got ${typeof e}: ${e}`)}},expectNumber=e=>{if(null!=e){if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&logger.warn(stackTraceWarning(`Expected number but observed string: ${e}`)),t}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}},expectNonNull=(e,t)=>{if(null==e){if(t)throw new TypeError(`Expected a non-null value for ${t}`);throw new TypeError("Expected a non-null value")}return e},expectObject=e=>{if(null==e)return;if("object"==typeof e&&!Array.isArray(e))return e;const t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},expectString=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return logger.warn(stackTraceWarning(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},strictParseDouble=e=>expectNumber("string"==typeof e?parseNumber(e):e),NUMBER_REGEX=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,parseNumber=e=>{const t=e.match(NUMBER_REGEX);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},stackTraceWarning=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),logger={warn:console.warn},parseEpochTimestamp=e=>{if(null==e)return;let t;if("number"==typeof e)t=e;else{if("string"!=typeof e)throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");t=strictParseDouble(e)}if(Number.isNaN(t)||t===1/0||t===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(1e3*t))};class ServiceException extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,ServiceException.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}}const decorateServiceException=(e,t={})=>{Object.entries(t).filter((([,e])=>void 0!==e)).forEach((([t,i])=>{null!=e[t]&&""!==e[t]||(e[t]=i)}));const i=e.message||e.Message||"UnknownError";return e.message=i,delete e.Message,e},throwDefaultError$1=({output:e,parsedBody:t,exceptionCtor:i,errorCode:n})=>{const r=deserializeMetadata$1(e),o=r.httpStatusCode?r.httpStatusCode+"":void 0,a=new i({name:t?.code||t?.Code||n||o||"UnknownError",$fault:"client",$metadata:r});throw decorateServiceException(a,t)},withBaseException=e=>({output:t,parsedBody:i,errorCode:n})=>{throwDefaultError$1({output:t,parsedBody:i,exceptionCtor:e,errorCode:n})},deserializeMetadata$1=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),loadConfigsForDefaultMode=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},getChecksumConfiguration=e=>{const t=[];for(const i in AlgorithmId){const n=AlgorithmId[i];void 0!==e[n]&&t.push({algorithmId:()=>n,checksumConstructor:()=>e[n]})}return{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},resolveChecksumRuntimeConfig=e=>{const t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t},getRetryConfiguration=e=>{let t=e.retryStrategy;return{setRetryStrategy(e){t=e},retryStrategy:()=>t}},resolveRetryRuntimeConfig=e=>{const t={};return t.retryStrategy=e.retryStrategy(),t},getDefaultExtensionConfiguration=e=>({...getChecksumConfiguration(e),...getRetryConfiguration(e)}),resolveDefaultRuntimeConfig=e=>({...resolveChecksumRuntimeConfig(e),...resolveRetryRuntimeConfig(e)});function extendedEncodeURIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}const StringWrapper=function(){const e=Object.getPrototypeOf(this).constructor,t=new(Function.bind.apply(String,[null,...arguments]));return Object.setPrototypeOf(t,e.prototype),t};function map(e,t,i){let n,r,o;if(void 0===t&&void 0===i)n={},o=e;else{if(n=e,"function"==typeof t)return r=t,o=i,mapWithFilter(n,r,o);o=t}for(const e of Object.keys(o))Array.isArray(o[e])?applyInstruction(n,null,o,e):n[e]=o[e];return n}StringWrapper.prototype=Object.create(String.prototype,{constructor:{value:StringWrapper,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf(StringWrapper,String);const take=(e,t)=>{const i={};for(const n in t)applyInstruction(i,e,t,n);return i},mapWithFilter=(e,t,i)=>map(e,Object.entries(i).reduce(((e,[i,n])=>(Array.isArray(n)?e[i]=n:e[i]="function"==typeof n?[t,n()]:[t,n],e)),{})),applyInstruction=(e,t,i,n)=>{if(null!==t){let r=i[n];"function"==typeof r&&(r=[,r]);const[o=nonNullish,a=pass,s=n]=r;return void(("function"==typeof o&&o(t[s])||"function"!=typeof o&&o)&&(e[n]=a(t[s])))}let[r,o]=i[n];if("function"==typeof o){let t;const i=void 0===r&&null!=(t=o()),a="function"==typeof r&&!!r(void 0)||"function"!=typeof r&&!!r;i?e[n]=t:a&&(e[n]=o())}else{const t=void 0===r&&null!=o,i="function"==typeof r&&!!r(o)||"function"!=typeof r&&!!r;(t||i)&&(e[n]=o)}},nonNullish=e=>null!=e,pass=e=>e,resolvedPath=(e,t,i,n,r,o)=>{if(null==t||void 0===t[i])throw new Error("No value provided for input HTTP label: "+i+".");{const t=n();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+i+".");e=e.replace(r,o?t.split("/").map((e=>extendedEncodeURIComponent(e))).join("/"):extendedEncodeURIComponent(t))}return e},_json=e=>{if(null==e)return{};if(Array.isArray(e))return e.filter((e=>null!=e)).map(_json);if("object"==typeof e){const t={};for(const i of Object.keys(e))null!=e[i]&&(t[i]=_json(e[i]));return t}return e},isStreamingPayload=e=>e?.body instanceof ReadableStream,retryMiddleware=e=>(t,i)=>async n=>{let r=await e.retryStrategy();const o=await e.maxAttempts();if(!isRetryStrategyV2(r))return r?.mode&&(i.userAgent=[...i.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(t,n);{let e=await r.acquireInitialRetryToken(i.partition_id),a=new Error,s=0,d=0;const{request:l}=n,c=HttpRequest.isInstance(l);for(c&&(l.headers[INVOCATION_ID_HEADER]=v4());;)try{c&&(l.headers[REQUEST_HEADER]=`attempt=${s+1}; max=${o}`);const{response:i,output:a}=await t(n);return r.recordSuccess(e),a.$metadata.attempts=s+1,a.$metadata.totalRetryDelay=d,{response:i,output:a}}catch(t){const n=getRetryErrorInfo(t);if(a=asSdkError(t),c&&isStreamingPayload(l))throw(i.logger instanceof NoOpLogger$2?console:i.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{e=await r.refreshRetryTokenForRetry(e,n)}catch(e){throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=s+1,a.$metadata.totalRetryDelay=d,a}s=e.getRetryCount();const o=e.getRetryDelay();d+=o,await new Promise((e=>setTimeout(e,o)))}}},isRetryStrategyV2=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,getRetryErrorInfo=e=>{const t={errorType:getRetryErrorType(e)},i=getRetryAfterHint(e.$response);return i&&(t.retryAfterHint=i),t},getRetryErrorType=e=>isThrottlingError(e)?"THROTTLING":isTransientError(e)?"TRANSIENT":isServerError(e)?"SERVER_ERROR":"CLIENT_ERROR",retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=e=>({applyToStack:t=>{t.add(retryMiddleware(e),retryMiddlewareOptions)}}),getRetryAfterHint=e=>{if(!HttpResponse.isInstance(e))return;const t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(!t)return;const i=e.headers[t],n=Number(i);if(!Number.isNaN(n))return new Date(1e3*n);return new Date(i)},resolveClientEndpointParameters=e=>({...e,useDualstackEndpoint:e.useDualstackEndpoint??!1,useFipsEndpoint:e.useFipsEndpoint??!1,defaultSigningName:"chime"}),commonParams={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var name="@aws-sdk/client-chime-sdk-messaging",description="AWS SDK for JavaScript Chime Sdk Messaging Client for Node.js, Browser and React Native",version="3.496.0",scripts={build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-chime-sdk-messaging","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo chime-sdk-messaging"},main="./dist-cjs/index.js",types$1="./dist-types/index.d.ts",module="./dist-es/index.js",sideEffects=!1,dependencies={"@aws-crypto/sha256-browser":"3.0.0","@aws-crypto/sha256-js":"3.0.0","@aws-sdk/client-sts":"3.496.0","@aws-sdk/core":"3.496.0","@aws-sdk/credential-provider-node":"3.496.0","@aws-sdk/middleware-host-header":"3.496.0","@aws-sdk/middleware-logger":"3.496.0","@aws-sdk/middleware-recursion-detection":"3.496.0","@aws-sdk/middleware-signing":"3.496.0","@aws-sdk/middleware-user-agent":"3.496.0","@aws-sdk/region-config-resolver":"3.496.0","@aws-sdk/types":"3.496.0","@aws-sdk/util-endpoints":"3.496.0","@aws-sdk/util-user-agent-browser":"3.496.0","@aws-sdk/util-user-agent-node":"3.496.0","@smithy/config-resolver":"^2.1.1","@smithy/core":"^1.3.1","@smithy/fetch-http-handler":"^2.4.1","@smithy/hash-node":"^2.1.1","@smithy/invalid-dependency":"^2.1.1","@smithy/middleware-content-length":"^2.1.1","@smithy/middleware-endpoint":"^2.4.1","@smithy/middleware-retry":"^2.1.1","@smithy/middleware-serde":"^2.1.1","@smithy/middleware-stack":"^2.1.1","@smithy/node-config-provider":"^2.2.1","@smithy/node-http-handler":"^2.3.1","@smithy/protocol-http":"^3.1.1","@smithy/smithy-client":"^2.3.1","@smithy/types":"^2.9.1","@smithy/url-parser":"^2.1.1","@smithy/util-base64":"^2.1.1","@smithy/util-body-length-browser":"^2.1.1","@smithy/util-body-length-node":"^2.2.1","@smithy/util-defaults-mode-browser":"^2.1.1","@smithy/util-defaults-mode-node":"^2.1.1","@smithy/util-endpoints":"^1.1.1","@smithy/util-retry":"^2.1.1","@smithy/util-utf8":"^2.1.1",tslib:"^2.5.0",uuid:"^8.3.2"},devDependencies={"@smithy/service-client-documentation-generator":"^2.1.1","@tsconfig/node14":"1.0.3","@types/node":"^14.14.31","@types/uuid":"^8.3.0",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~4.9.5"},engines={node:">=14.0.0"},typesVersions={"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files=["dist-*/**"],author={name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license="Apache-2.0",browser={"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},homepage="https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-chime-sdk-messaging",repository={type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-chime-sdk-messaging"},packageInfo={name:name,description:description,version:version,scripts:scripts,main:main,types:types$1,module:module,sideEffects:sideEffects,dependencies:dependencies,devDependencies:devDependencies,engines:engines,typesVersions:typesVersions,files:files,author:author,license:license,browser:browser,"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:homepage,repository:repository},build$6={},crossPlatformSha256={},ie11Sha256={},isEmptyData$2={},hasRequiredIsEmptyData$2;function requireIsEmptyData$2(){if(hasRequiredIsEmptyData$2)return isEmptyData$2;return hasRequiredIsEmptyData$2=1,Object.defineProperty(isEmptyData$2,"__esModule",{value:!0}),isEmptyData$2.isEmptyData=void 0,isEmptyData$2.isEmptyData=function(e){return"string"==typeof e?0===e.length:0===e.byteLength},isEmptyData$2}var constants$2={},hasRequiredConstants$2;function requireConstants$2(){return hasRequiredConstants$2||(hasRequiredConstants$2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EMPTY_DATA_SHA_256=e.SHA_256_HMAC_ALGO=e.SHA_256_HASH=void 0,e.SHA_256_HASH={name:"SHA-256"},e.SHA_256_HMAC_ALGO={name:"HMAC",hash:e.SHA_256_HASH},e.EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85])}(constants$2)),constants$2}const fallbackWindow={};function locateWindow(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:fallbackWindow}var distEs$2=Object.freeze({__proto__:null,locateWindow:locateWindow}),require$$5=getAugmentedNamespace(distEs$2),hasRequiredIe11Sha256;function requireIe11Sha256(){if(hasRequiredIe11Sha256)return ie11Sha256;hasRequiredIe11Sha256=1,Object.defineProperty(ie11Sha256,"__esModule",{value:!0}),ie11Sha256.Sha256=void 0;var e=requireIsEmptyData$2(),t=requireConstants$2(),i=require$$0$1,n=require$$5,r=function(){function i(e){this.secret=e,this.reset()}return i.prototype.update=function(t){var i=this;(0,e.isEmptyData)(t)||(this.operation=this.operation.then((function(e){return e.onerror=function(){i.operation=Promise.reject(new Error("Error encountered updating hash"))},e.process(o(t)),e})),this.operation.catch((function(){})))},i.prototype.digest=function(){return this.operation.then((function(e){return new Promise((function(t,i){e.onerror=function(){i(new Error("Error encountered finalizing hash"))},e.oncomplete=function(){e.result&&t(new Uint8Array(e.result)),i(new Error("Error encountered finalizing hash"))},e.finish()}))}))},i.prototype.reset=function(){var e;this.secret?(this.operation=(e=this.secret,new Promise((function(i,r){var a=(0,n.locateWindow)().msCrypto.subtle.importKey("raw",o(e),t.SHA_256_HMAC_ALGO,!1,["sign"]);a.oncomplete=function(){a.result&&i(a.result),r(new Error("ImportKey completed without importing key."))},a.onerror=function(){r(new Error("ImportKey failed to import key."))}}))).then((function(e){return(0,n.locateWindow)().msCrypto.subtle.sign(t.SHA_256_HMAC_ALGO,e)})),this.operation.catch((function(){}))):this.operation=Promise.resolve((0,n.locateWindow)().msCrypto.subtle.digest("SHA-256"))},i}();function o(e){return"string"==typeof e?(0,i.fromUtf8)(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}return ie11Sha256.Sha256=r,ie11Sha256}var webCryptoSha256={},build$5={},convertToBuffer$1={},hasRequiredConvertToBuffer$1;function requireConvertToBuffer$1(){if(hasRequiredConvertToBuffer$1)return convertToBuffer$1;hasRequiredConvertToBuffer$1=1,Object.defineProperty(convertToBuffer$1,"__esModule",{value:!0}),convertToBuffer$1.convertToBuffer=void 0;var e=require$$0$1,t="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e.fromUtf8;return convertToBuffer$1.convertToBuffer=function(e){return e instanceof Uint8Array?e:"string"==typeof e?t(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)},convertToBuffer$1}var isEmptyData$1={},hasRequiredIsEmptyData$1;function requireIsEmptyData$1(){if(hasRequiredIsEmptyData$1)return isEmptyData$1;return hasRequiredIsEmptyData$1=1,Object.defineProperty(isEmptyData$1,"__esModule",{value:!0}),isEmptyData$1.isEmptyData=void 0,isEmptyData$1.isEmptyData=function(e){return"string"==typeof e?0===e.length:0===e.byteLength},isEmptyData$1}var numToUint8$1={},hasRequiredNumToUint8$1;function requireNumToUint8$1(){if(hasRequiredNumToUint8$1)return numToUint8$1;return hasRequiredNumToUint8$1=1,Object.defineProperty(numToUint8$1,"__esModule",{value:!0}),numToUint8$1.numToUint8=void 0,numToUint8$1.numToUint8=function(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])},numToUint8$1}var uint32ArrayFrom$1={},hasRequiredUint32ArrayFrom$1,hasRequiredBuild$5,hasRequiredWebCryptoSha256;function requireUint32ArrayFrom$1(){if(hasRequiredUint32ArrayFrom$1)return uint32ArrayFrom$1;return hasRequiredUint32ArrayFrom$1=1,Object.defineProperty(uint32ArrayFrom$1,"__esModule",{value:!0}),uint32ArrayFrom$1.uint32ArrayFrom=void 0,uint32ArrayFrom$1.uint32ArrayFrom=function(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),i=0;i<e.length;)t[i]=e[i],i+=1;return t}return Uint32Array.from(e)},uint32ArrayFrom$1}function requireBuild$5(){return hasRequiredBuild$5||(hasRequiredBuild$5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=requireConvertToBuffer$1();Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var i=requireIsEmptyData$1();Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return i.isEmptyData}});var n=requireNumToUint8$1();Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var r=requireUint32ArrayFrom$1();Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return r.uint32ArrayFrom}})}(build$5)),build$5}function requireWebCryptoSha256(){if(hasRequiredWebCryptoSha256)return webCryptoSha256;hasRequiredWebCryptoSha256=1,Object.defineProperty(webCryptoSha256,"__esModule",{value:!0}),webCryptoSha256.Sha256=void 0;var e=requireBuild$5(),t=requireConstants$2(),i=require$$5,n=function(){function n(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return n.prototype.update=function(t){if(!(0,e.isEmptyData)(t)){var i=(0,e.convertToBuffer)(t),n=new Uint8Array(this.toHash.byteLength+i.byteLength);n.set(this.toHash,0),n.set(i,this.toHash.byteLength),this.toHash=n}},n.prototype.digest=function(){var n=this;return this.key?this.key.then((function(e){return(0,i.locateWindow)().crypto.subtle.sign(t.SHA_256_HMAC_ALGO,e,n.toHash).then((function(e){return new Uint8Array(e)}))})):(0,e.isEmptyData)(this.toHash)?Promise.resolve(t.EMPTY_DATA_SHA_256):Promise.resolve().then((function(){return(0,i.locateWindow)().crypto.subtle.digest(t.SHA_256_HASH,n.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},n.prototype.reset=function(){var n=this;this.toHash=new Uint8Array(0),this.secret&&void 0!==this.secret&&(this.key=new Promise((function(r,o){(0,i.locateWindow)().crypto.subtle.importKey("raw",(0,e.convertToBuffer)(n.secret),t.SHA_256_HMAC_ALGO,!1,["sign"]).then(r,o)})),this.key.catch((function(){})))},n}();return webCryptoSha256.Sha256=n,webCryptoSha256}var build$4={},jsSha256$1={},constants$1={},hasRequiredConstants$1;function requireConstants$1(){return hasRequiredConstants$1||(hasRequiredConstants$1=1,Object.defineProperty(constants$1,"__esModule",{value:!0}),constants$1.MAX_HASHABLE_LENGTH=constants$1.INIT=constants$1.KEY=constants$1.DIGEST_LENGTH=constants$1.BLOCK_SIZE=void 0,constants$1.BLOCK_SIZE=64,constants$1.DIGEST_LENGTH=32,constants$1.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),constants$1.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],constants$1.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),constants$1}var RawSha256$1={},hasRequiredRawSha256$1,hasRequiredJsSha256$1,hasRequiredBuild$4;function requireRawSha256$1(){if(hasRequiredRawSha256$1)return RawSha256$1;hasRequiredRawSha256$1=1,Object.defineProperty(RawSha256$1,"__esModule",{value:!0}),RawSha256$1.RawSha256=void 0;var e=requireConstants$1(),t=function(){function t(){this.state=Int32Array.from(e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var i=0,n=t.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=t[i++],n--,this.bufferLength===e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var t=8*this.bytesHashed,i=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(i.setUint8(this.bufferLength++,128),n%e.BLOCK_SIZE>=e.BLOCK_SIZE-8){for(var r=this.bufferLength;r<e.BLOCK_SIZE;r++)i.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<e.BLOCK_SIZE-8;r++)i.setUint8(r,0);i.setUint32(e.BLOCK_SIZE-8,Math.floor(t/4294967296),!0),i.setUint32(e.BLOCK_SIZE-4,t),this.hashBuffer(),this.finished=!0}var o=new Uint8Array(e.DIGEST_LENGTH);for(r=0;r<8;r++)o[4*r]=this.state[r]>>>24&255,o[4*r+1]=this.state[r]>>>16&255,o[4*r+2]=this.state[r]>>>8&255,o[4*r+3]=this.state[r]>>>0&255;return o},t.prototype.hashBuffer=function(){for(var t=this.buffer,i=this.state,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],d=i[5],l=i[6],c=i[7],u=0;u<e.BLOCK_SIZE;u++){if(u<16)this.temp[u]=(255&t[4*u])<<24|(255&t[4*u+1])<<16|(255&t[4*u+2])<<8|255&t[4*u+3];else{var h=this.temp[u-2],p=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,m=((h=this.temp[u-15])>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[u]=(p+this.temp[u-7]|0)+(m+this.temp[u-16]|0)}var f=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&d^~s&l)|0)+(c+(e.KEY[u]+this.temp[u]|0)|0)|0,g=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&o^r&o)|0;c=l,l=d,d=s,s=a+f|0,a=o,o=r,r=n,n=f+g|0}i[0]+=n,i[1]+=r,i[2]+=o,i[3]+=a,i[4]+=s,i[5]+=d,i[6]+=l,i[7]+=c},t}();return RawSha256$1.RawSha256=t,RawSha256$1}function requireJsSha256$1(){if(hasRequiredJsSha256$1)return jsSha256$1;hasRequiredJsSha256$1=1,Object.defineProperty(jsSha256$1,"__esModule",{value:!0}),jsSha256$1.Sha256=void 0;var e=require$$0$2,t=requireConstants$1(),i=requireRawSha256$1(),n=requireBuild$5(),r=function(){function r(e){this.secret=e,this.hash=new i.RawSha256,this.reset()}return r.prototype.update=function(e){if(!(0,n.isEmptyData)(e)&&!this.error)try{this.hash.update((0,n.convertToBuffer)(e))}catch(e){this.error=e}},r.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},r.prototype.digest=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.digestSync()]}))}))},r.prototype.reset=function(){if(this.hash=new i.RawSha256,this.secret){this.outer=new i.RawSha256;var e=function(e){var r=(0,n.convertToBuffer)(e);if(r.byteLength>t.BLOCK_SIZE){var o=new i.RawSha256;o.update(r),r=o.digest()}var a=new Uint8Array(t.BLOCK_SIZE);return a.set(r),a}(this.secret),r=new Uint8Array(t.BLOCK_SIZE);r.set(e);for(var o=0;o<t.BLOCK_SIZE;o++)e[o]^=54,r[o]^=92;this.hash.update(e),this.outer.update(r);for(o=0;o<e.byteLength;o++)e[o]=0}},r}();return jsSha256$1.Sha256=r,jsSha256$1}function requireBuild$4(){return hasRequiredBuild$4||(hasRequiredBuild$4=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),require$$0$2.__exportStar(requireJsSha256$1(),e)}(build$4)),build$4}var build$3={},supportsWebCrypto={},hasRequiredSupportsWebCrypto,hasRequiredBuild$3;function requireSupportsWebCrypto(){if(hasRequiredSupportsWebCrypto)return supportsWebCrypto;hasRequiredSupportsWebCrypto=1,Object.defineProperty(supportsWebCrypto,"__esModule",{value:!0}),supportsWebCrypto.supportsZeroByteGCM=supportsWebCrypto.supportsSubtleCrypto=supportsWebCrypto.supportsSecureRandom=supportsWebCrypto.supportsWebCrypto=void 0;var e=require$$0$2,t=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function i(e){return"object"==typeof e&&"object"==typeof e.crypto&&"function"==typeof e.crypto.getRandomValues}function n(e){return e&&t.every((function(t){return"function"==typeof e[t]}))}return supportsWebCrypto.supportsWebCrypto=function(e){return!(!i(e)||"object"!=typeof e.crypto.subtle)&&n(e.crypto.subtle)},supportsWebCrypto.supportsSecureRandom=i,supportsWebCrypto.supportsSubtleCrypto=n,supportsWebCrypto.supportsZeroByteGCM=function(t){return e.__awaiter(this,void 0,void 0,(function(){var i;return e.__generator(this,(function(e){switch(e.label){case 0:if(!n(t))return[2,!1];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,t.generateKey({name:"AES-GCM",length:128},!1,["encrypt"])];case 2:return i=e.sent(),[4,t.encrypt({name:"AES-GCM",iv:new Uint8Array(Array(12)),additionalData:new Uint8Array(Array(16)),tagLength:128},i,new Uint8Array(0))];case 3:return[2,16===e.sent().byteLength];case 4:return e.sent(),[2,!1];case 5:return[2]}}))}))},supportsWebCrypto}function requireBuild$3(){return hasRequiredBuild$3||(hasRequiredBuild$3=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),require$$0$2.__exportStar(requireSupportsWebCrypto(),e)}(build$3)),build$3}var build$2={},CryptoOperation={},hasRequiredCryptoOperation;function requireCryptoOperation(){return hasRequiredCryptoOperation||(hasRequiredCryptoOperation=1,Object.defineProperty(CryptoOperation,"__esModule",{value:!0})),CryptoOperation}var Key={},hasRequiredKey;function requireKey(){return hasRequiredKey||(hasRequiredKey=1,Object.defineProperty(Key,"__esModule",{value:!0})),Key}var KeyOperation={},hasRequiredKeyOperation;function requireKeyOperation(){return hasRequiredKeyOperation||(hasRequiredKeyOperation=1,Object.defineProperty(KeyOperation,"__esModule",{value:!0})),KeyOperation}var MsSubtleCrypto={},hasRequiredMsSubtleCrypto;function requireMsSubtleCrypto(){return hasRequiredMsSubtleCrypto||(hasRequiredMsSubtleCrypto=1,Object.defineProperty(MsSubtleCrypto,"__esModule",{value:!0})),MsSubtleCrypto}var MsWindow={},hasRequiredMsWindow,hasRequiredBuild$2,hasRequiredCrossPlatformSha256;function requireMsWindow(){if(hasRequiredMsWindow)return MsWindow;hasRequiredMsWindow=1,Object.defineProperty(MsWindow,"__esModule",{value:!0}),MsWindow.isMsWindow=void 0;var e=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];return MsWindow.isMsWindow=function(t){if(function(e){return"MSInputMethodContext"in e&&"msCrypto"in e}(t)&&void 0!==t.msCrypto.subtle){var i=t.msCrypto,n=i.getRandomValues,r=i.subtle;return e.map((function(e){return r[e]})).concat(n).every((function(e){return"function"==typeof e}))}return!1},MsWindow}function requireBuild$2(){return hasRequiredBuild$2||(hasRequiredBuild$2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=require$$0$2;t.__exportStar(requireCryptoOperation(),e),t.__exportStar(requireKey(),e),t.__exportStar(requireKeyOperation(),e),t.__exportStar(requireMsSubtleCrypto(),e),t.__exportStar(requireMsWindow(),e)}(build$2)),build$2}function requireCrossPlatformSha256(){if(hasRequiredCrossPlatformSha256)return crossPlatformSha256;hasRequiredCrossPlatformSha256=1,Object.defineProperty(crossPlatformSha256,"__esModule",{value:!0}),crossPlatformSha256.Sha256=void 0;var e=requireIe11Sha256(),t=requireWebCryptoSha256(),i=requireBuild$4(),n=requireBuild$3(),r=requireBuild$2(),o=require$$5,a=requireBuild$5(),s=function(){function s(a){(0,n.supportsWebCrypto)((0,o.locateWindow)())?this.hash=new t.Sha256(a):(0,r.isMsWindow)((0,o.locateWindow)())?this.hash=new e.Sha256(a):this.hash=new i.Sha256(a)}return s.prototype.update=function(e,t){this.hash.update((0,a.convertToBuffer)(e))},s.prototype.digest=function(){return this.hash.digest()},s.prototype.reset=function(){this.hash.reset()},s}();return crossPlatformSha256.Sha256=s,crossPlatformSha256}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WebCryptoSha256=e.Ie11Sha256=void 0,require$$0$2.__exportStar(requireCrossPlatformSha256(),e);var t=requireIe11Sha256();Object.defineProperty(e,"Ie11Sha256",{enumerable:!0,get:function(){return t.Sha256}});var i=requireWebCryptoSha256();Object.defineProperty(e,"WebCryptoSha256",{enumerable:!0,get:function(){return i.Sha256}})}(build$6);const BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class Utils{static getFirstMatch(e,t){const i=t.match(e);return i&&i.length>0&&i[1]||""}static getSecondMatch(e,t){const i=t.match(e);return i&&i.length>1&&i[2]||""}static matchAndReturnConst(e,t,i){if(e.test(t))return i}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map((e=>parseInt(e,10)||0));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map((e=>parseInt(e,10)||0));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,i=!1){const n=Utils.getVersionPrecision(e),r=Utils.getVersionPrecision(t);let o=Math.max(n,r),a=0;const s=Utils.map([e,t],(e=>{const t=o-Utils.getVersionPrecision(e),i=e+new Array(t+1).join(".0");return Utils.map(i.split("."),(e=>new Array(20-e.length).join("0")+e)).reverse()}));for(i&&(a=o-Math.min(n,r)),o-=1;o>=a;){if(s[0][o]>s[1][o])return 1;if(s[0][o]===s[1][o]){if(o===a)return 0;o-=1}else if(s[0][o]<s[1][o])return-1}}static map(e,t){const i=[];let n;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)i.push(t(e[n]));return i}static find(e,t){let i,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(i=0,n=e.length;i<n;i+=1){const n=e[i];if(t(n,i))return n}}static assign(e,...t){const i=e;let n,r;if(Object.assign)return Object.assign(e,...t);for(n=0,r=t.length;n<r;n+=1){const e=t[n];if("object"==typeof e&&null!==e){Object.keys(e).forEach((t=>{i[t]=e[t]}))}}return e}static getBrowserAlias(e){return BROWSER_ALIASES_MAP[e]}static getBrowserTypeByAlias(e){return BROWSER_MAP[e]||""}}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i,browsersList=[{test:[/googlebot/i],describe(e){const t={name:"Googlebot"},i=Utils.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/opera/i],describe(e){const t={name:"Opera"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opr\/|opios/i],describe(e){const t={name:"Opera"},i=Utils.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/SamsungBrowser/i],describe(e){const t={name:"Samsung Internet for Android"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Whale/i],describe(e){const t={name:"NAVER Whale Browser"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MZBrowser/i],describe(e){const t={name:"MZ Browser"},i=Utils.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/focus/i],describe(e){const t={name:"Focus"},i=Utils.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/swing/i],describe(e){const t={name:"Swing"},i=Utils.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/coast/i],describe(e){const t={name:"Opera Coast"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(e){const t={name:"Opera Touch"},i=Utils.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/yabrowser/i],describe(e){const t={name:"Yandex Browser"},i=Utils.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/ucbrowser/i],describe(e){const t={name:"UC Browser"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Maxthon|mxios/i],describe(e){const t={name:"Maxthon"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/epiphany/i],describe(e){const t={name:"Epiphany"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/puffin/i],describe(e){const t={name:"Puffin"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sleipnir/i],describe(e){const t={name:"Sleipnir"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/k-meleon/i],describe(e){const t={name:"K-Meleon"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/micromessenger/i],describe(e){const t={name:"WeChat"},i=Utils.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/qqbrowser/i],describe(e){const t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},i=Utils.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/msie|trident/i],describe(e){const t={name:"Internet Explorer"},i=Utils.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/\sedg\//i],describe(e){const t={name:"Microsoft Edge"},i=Utils.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/edg([ea]|ios)/i],describe(e){const t={name:"Microsoft Edge"},i=Utils.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/vivaldi/i],describe(e){const t={name:"Vivaldi"},i=Utils.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/seamonkey/i],describe(e){const t={name:"SeaMonkey"},i=Utils.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sailfish/i],describe(e){const t={name:"Sailfish"},i=Utils.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return i&&(t.version=i),t}},{test:[/silk/i],describe(e){const t={name:"Amazon Silk"},i=Utils.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/phantom/i],describe(e){const t={name:"PhantomJS"},i=Utils.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/slimerjs/i],describe(e){const t={name:"SlimerJS"},i=Utils.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(e){const t={name:"BlackBerry"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(web|hpw)[o0]s/i],describe(e){const t={name:"WebOS Browser"},i=Utils.getFirstMatch(commonVersionIdentifier,e)||Utils.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/bada/i],describe(e){const t={name:"Bada"},i=Utils.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/tizen/i],describe(e){const t={name:"Tizen"},i=Utils.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/qupzilla/i],describe(e){const t={name:"QupZilla"},i=Utils.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/firefox|iceweasel|fxios/i],describe(e){const t={name:"Firefox"},i=Utils.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/electron/i],describe(e){const t={name:"Electron"},i=Utils.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MiuiBrowser/i],describe(e){const t={name:"Miui"},i=Utils.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/chromium/i],describe(e){const t={name:"Chromium"},i=Utils.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/chrome|crios|crmo/i],describe(e){const t={name:"Chrome"},i=Utils.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/GSA/i],describe(e){const t={name:"Google Search"},i=Utils.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test(e){const t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe(e){const t={name:"Android Browser"},i=Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/playstation 4/i],describe(e){const t={name:"PlayStation 4"},i=Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/safari|applewebkit/i],describe(e){const t={name:"Safari"},i=Utils.getFirstMatch(commonVersionIdentifier,e);return i&&(t.version=i),t}},{test:[/.*/i],describe(e){const t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:Utils.getFirstMatch(t,e),version:Utils.getSecondMatch(t,e)}}}];var osParsersList=[{test:[/Roku\/DVP/],describe(e){const t=Utils.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe(e){const t=Utils.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe(e){const t=Utils.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),i=Utils.getWindowsVersionName(t);return{name:OS_MAP.Windows,version:t,versionName:i}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(e){const t={name:OS_MAP.iOS},i=Utils.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return i&&(t.version=i),t}},{test:[/macintosh/i],describe(e){const t=Utils.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),i=Utils.getMacOSVersionName(t),n={name:OS_MAP.MacOS,version:t};return i&&(n.versionName=i),n}},{test:[/(ipod|iphone|ipad)/i],describe(e){const t=Utils.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:OS_MAP.iOS,version:t}}},{test(e){const t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe(e){const t=Utils.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),i=Utils.getAndroidVersionName(t),n={name:OS_MAP.Android,version:t};return i&&(n.versionName=i),n}},{test:[/(web|hpw)[o0]s/i],describe(e){const t=Utils.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),i={name:OS_MAP.WebOS};return t&&t.length&&(i.version=t),i}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(e){const t=Utils.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||Utils.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||Utils.getFirstMatch(/\bbb(\d+)/i,e);return{name:OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe(e){const t=Utils.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe(e){const t=Utils.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:()=>({name:OS_MAP.Linux})},{test:[/CrOS/],describe:()=>({name:OS_MAP.ChromeOS})},{test:[/PlayStation 4/],describe(e){const t=Utils.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:OS_MAP.PlayStation4,version:t}}}],platformParsersList=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(e){const t=Utils.getFirstMatch(/(can-l01)/i,e)&&"Nova",i={type:PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(i.model=t),i}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:PLATFORMS_MAP.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:PLATFORMS_MAP.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:PLATFORMS_MAP.tablet})},{test(e){const t=e.test(/ipod|iphone/i),i=e.test(/like (ipod|iphone)/i);return t&&!i},describe(e){const t=Utils.getFirstMatch(/(ipod|iphone)/i,e);return{type:PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:PLATFORMS_MAP.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:PLATFORMS_MAP.mobile})},{test:e=>"blackberry"===e.getBrowserName(!0),describe:()=>({type:PLATFORMS_MAP.mobile,vendor:"BlackBerry"})},{test:e=>"bada"===e.getBrowserName(!0),describe:()=>({type:PLATFORMS_MAP.mobile})},{test:e=>"windows phone"===e.getBrowserName(),describe:()=>({type:PLATFORMS_MAP.mobile,vendor:"Microsoft"})},{test(e){const t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:()=>({type:PLATFORMS_MAP.tablet})},{test:e=>"android"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.mobile})},{test:e=>"macos"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.desktop,vendor:"Apple"})},{test:e=>"windows"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.desktop})},{test:e=>"linux"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.desktop})},{test:e=>"playstation 4"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.tv})},{test:e=>"roku"===e.getOSName(!0),describe:()=>({type:PLATFORMS_MAP.tv})}],enginesParsersList=[{test:e=>"microsoft edge"===e.getBrowserName(!0),describe(e){if(/\sedg\//i.test(e))return{name:ENGINE_MAP.Blink};const t=Utils.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe(e){const t={name:ENGINE_MAP.Trident},i=Utils.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:e=>e.test(/presto/i),describe(e){const t={name:ENGINE_MAP.Presto},i=Utils.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test(e){const t=e.test(/gecko/i),i=e.test(/like gecko/i);return t&&!i},describe(e){const t={name:ENGINE_MAP.Gecko},i=Utils.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:ENGINE_MAP.Blink})},{test:[/(apple)?webkit/i],describe(e){const t={name:ENGINE_MAP.WebKit},i=Utils.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}}];class Parser{constructor(e,t=!1){if(null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=Utils.find(browsersList,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=Utils.find(osParsersList,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=Utils.find(platformParsersList,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=Utils.find(enginesParsersList,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return Utils.assign({},this.parsedResult)}satisfies(e){const t={};let i=0;const n={};let r=0;if(Object.keys(e).forEach((o=>{const a=e[o];"string"==typeof a?(n[o]=a,r+=1):"object"==typeof a&&(t[o]=a,i+=1)})),i>0){const e=Object.keys(t),i=Utils.find(e,(e=>this.isOS(e)));if(i){const e=this.satisfies(t[i]);if(void 0!==e)return e}const n=Utils.find(e,(e=>this.isPlatform(e)));if(n){const e=this.satisfies(t[n]);if(void 0!==e)return e}}if(r>0){const e=Object.keys(n),t=Utils.find(e,(e=>this.isBrowser(e,!0)));if(void 0!==t)return this.compareVersion(n[t])}}isBrowser(e,t=!1){const i=this.getBrowserName().toLowerCase();let n=e.toLowerCase();const r=Utils.getBrowserTypeByAlias(n);return t&&r&&(n=r.toLowerCase()),n===i}compareVersion(e){let t=[0],i=e,n=!1;const r=this.getBrowserVersion();if("string"==typeof r)return">"===e[0]||"<"===e[0]?(i=e.substr(1),"="===e[1]?(n=!0,i=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?i=e.substr(1):"~"===e[0]&&(n=!0,i=e.substr(1)),t.indexOf(Utils.compareVersions(r,i,n))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some((e=>this.is(e)))}}
/*!
	 * Bowser - a browser detector
	 * https://github.com/lancedikson/bowser
	 * MIT License | (c) Dustin Diaz 2012-2015
	 * MIT License | (c) Denis Demchenko 2015-2019
	 */class Bowser{static getParser(e,t=!1){if("string"!=typeof e)throw new Error("UserAgent should be a string");return new Parser(e,t)}static parse(e){return new Parser(e).getResult()}static get BROWSER_MAP(){return BROWSER_MAP}static get ENGINE_MAP(){return ENGINE_MAP}static get OS_MAP(){return OS_MAP}static get PLATFORMS_MAP(){return PLATFORMS_MAP}}const defaultUserAgent=({serviceId:e,clientVersion:t})=>async()=>{const i="undefined"!=typeof window&&window?.navigator?.userAgent?Bowser.parse(window.navigator.userAgent):void 0,n=[["aws-sdk-js",t],["ua","2.0"],[`os/${i?.os?.name||"other"}`,i?.os?.version],["lang/js"],["md/browser",`${i?.browser?.name??"unknown"}_${i?.browser?.version??"unknown"}`]];return e&&n.push([`api/${e}`,t]),n},invalidProvider=e=>()=>Promise.reject(e),TEXT_ENCODER="function"==typeof TextEncoder?new TextEncoder:null,calculateBodyLength=e=>{if("string"==typeof e){if(TEXT_ENCODER)return TEXT_ENCODER.encode(e).byteLength;let t=e.length;for(let i=t-1;i>=0;i--){const n=e.charCodeAt(i);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&i--}return t}if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;throw new Error(`Body Length computation failed for ${e}`)},s="required",t="fn",u="argv",v="ref",a=!0,b="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h={[s]:!1,type:"String"},i={[s]:!0,default:!1,type:"Boolean"},j={[v]:"Endpoint"},k={[t]:c,[u]:[{[v]:"UseFIPS"},!0]},l={[t]:c,[u]:[{[v]:"UseDualStack"},!0]},m={},n={[t]:"getAttr",[u]:[{[v]:g},"supportsFIPS"]},o={[t]:c,[u]:[!0,{[t]:"getAttr",[u]:[{[v]:g},"supportsDualStack"]}]},p=[k],q=[l],r=[{[v]:"Region"}],_data={version:"1.0",parameters:{Region:h,UseDualStack:i,UseFIPS:i,Endpoint:h},rules:[{conditions:[{[t]:b,[u]:[j]}],rules:[{conditions:p,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{conditions:q,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:j,properties:m,headers:m},type:e}],type:f},{conditions:[{[t]:b,[u]:r}],rules:[{conditions:[{[t]:"aws.partition",[u]:r,assign:g}],rules:[{conditions:[k,l],rules:[{conditions:[{[t]:c,[u]:[a,n]},o],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:p,rules:[{conditions:[{[t]:c,[u]:[n,a]}],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:q,rules:[{conditions:[o],rules:[{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}]},ruleSet=_data,defaultEndpointResolver=(e,t={})=>resolveEndpoint(ruleSet,{endpointParams:e,logger:t.logger}),getRuntimeConfig$1=e=>({apiVersion:"2021-05-15",base64Decoder:e?.base64Decoder??fromBase64,base64Encoder:e?.base64Encoder??toBase64,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??defaultEndpointResolver,extensions:e?.extensions??[],logger:e?.logger??new NoOpLogger$2,serviceId:e?.serviceId??"Chime SDK Messaging",urlParser:e?.urlParser??parseUrl,utf8Decoder:e?.utf8Decoder??fromUtf8,utf8Encoder:e?.utf8Encoder??toUtf8}),DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],resolveDefaultsModeConfig=({defaultsMode:e}={})=>memoize((async()=>{const t="function"==typeof e?await e():e;switch(t?.toLowerCase()){case"auto":return Promise.resolve(isMobileBrowser()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${DEFAULTS_MODE_OPTIONS.join(", ")}, got ${t}`)}})),isMobileBrowser=()=>{const e="undefined"!=typeof window&&window?.navigator?.userAgent?Bowser.parse(window.navigator.userAgent):void 0,t=e?.platform?.type;return"tablet"===t||"mobile"===t},getRuntimeConfig=e=>{const t=resolveDefaultsModeConfig(e),i=()=>t().then(loadConfigsForDefaultMode),n=getRuntimeConfig$1(e);return{...n,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??calculateBodyLength,credentialDefaultProvider:e?.credentialDefaultProvider??(e=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:e?.defaultUserAgentProvider??defaultUserAgent({serviceId:n.serviceId,clientVersion:packageInfo.version}),maxAttempts:e?.maxAttempts??DEFAULT_MAX_ATTEMPTS,region:e?.region??invalidProvider("Region is missing"),requestHandler:e?.requestHandler??new FetchHttpHandler(i),retryMode:e?.retryMode??(async()=>(await i()).retryMode||DEFAULT_RETRY_MODE),sha256:e?.sha256??build$6.Sha256,streamCollector:e?.streamCollector??streamCollector,useDualstackEndpoint:e?.useDualstackEndpoint??(()=>Promise.resolve(DEFAULT_USE_DUALSTACK_ENDPOINT)),useFipsEndpoint:e?.useFipsEndpoint??(()=>Promise.resolve(DEFAULT_USE_FIPS_ENDPOINT))}},getAwsRegionExtensionConfiguration=e=>{let t=async()=>{if(void 0===e.region)throw new Error("Region is missing from runtimeConfig");const t=e.region;return"string"==typeof t?t:t()};return{setRegion(e){t=e},region:()=>t}},resolveAwsRegionExtensionConfiguration=e=>({region:e.region()}),asPartial=e=>e,resolveRuntimeExtensions=(e,t)=>{const i={...asPartial(getAwsRegionExtensionConfiguration(e)),...asPartial(getDefaultExtensionConfiguration(e)),...asPartial(getHttpHandlerExtensionConfiguration(e))};return t.forEach((e=>e.configure(i))),{...e,...resolveAwsRegionExtensionConfiguration(i),...resolveDefaultRuntimeConfig(i),...resolveHttpHandlerRuntimeConfig(i)}};class ChimeSDKMessagingClient extends Client{constructor(...[e]){const t=getRuntimeConfig(e||{}),i=resolveClientEndpointParameters(t),n=resolveRegionConfig(i),r=resolveEndpointConfig(n),o=resolveHostHeaderConfig(resolveRetryConfig(r)),a=resolveUserAgentConfig(resolveAwsAuthConfig(o)),s=resolveRuntimeExtensions(a,e?.extensions||[]);super(s),this.config=s,this.middlewareStack.use(getRetryPlugin(this.config)),this.middlewareStack.use(getContentLengthPlugin(this.config)),this.middlewareStack.use(getHostHeaderPlugin(this.config)),this.middlewareStack.use(getLoggerPlugin(this.config)),this.middlewareStack.use(getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(getAwsAuthPlugin(this.config)),this.middlewareStack.use(getUserAgentPlugin(this.config))}destroy(){super.destroy()}}function requestBuilder(e,t){return new RequestBuilder(e,t)}endpointMiddlewareOptions.name,serializerMiddlewareOption.name,retryMiddlewareOptions.name;class RequestBuilder{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:t="https",port:i,path:n}=await this.context.endpoint();this.path=n;for(const e of this.resolvePathStack)e(this.path);return new HttpRequest({protocol:t,hostname:this.hostname||e,port:i,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push((t=>{this.path=`${t?.endsWith("/")?t.slice(0,-1):t||""}`+e})),this}p(e,t,i,n){return this.resolvePathStack.push((r=>{this.path=resolvedPath(r,this.input,e,t,i,n)})),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}const makePagedClientRequest=async(e,t,i,...n)=>await t.send(new e(i),...n);function createPaginator(e,t,i,n,r){return async function*(o,a,...s){let d,l=o.startingToken||void 0,c=!0;for(;c;){if(a[i]=l,r&&(a[r]=a[r]??o.pageSize),!(o.client instanceof e))throw new Error(`Invalid client, expected instance of ${e.name}`);d=await makePagedClientRequest(t,o.client,a,...s),yield d;const u=l;l=d[n],c=!(!l||o.stopOnSameToken&&l===u)}}}class ChimeSDKMessagingServiceException extends ServiceException{constructor(e){super(e),Object.setPrototypeOf(this,ChimeSDKMessagingServiceException.prototype)}}const AllowNotifications={ALL:"ALL",FILTERED:"FILTERED",NONE:"NONE"},ChannelMembershipType={DEFAULT:"DEFAULT",HIDDEN:"HIDDEN"},ErrorCode={AccessDenied:"AccessDenied",BadRequest:"BadRequest",Conflict:"Conflict",Forbidden:"Forbidden",NotFound:"NotFound",PhoneNumberAssociationsExist:"PhoneNumberAssociationsExist",PreconditionFailed:"PreconditionFailed",ResourceLimitExceeded:"ResourceLimitExceeded",ServiceFailure:"ServiceFailure",ServiceUnavailable:"ServiceUnavailable",Throttled:"Throttled",Throttling:"Throttling",Unauthorized:"Unauthorized",Unprocessable:"Unprocessable",VoiceConnectorGroupAssociationsExist:"VoiceConnectorGroupAssociationsExist"};class BadRequestException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"BadRequestException",$fault:"client",...e}),this.name="BadRequestException",this.$fault="client",Object.setPrototypeOf(this,BadRequestException.prototype),this.Code=e.Code,this.Message=e.Message}}class ConflictException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ConflictException",$fault:"client",...e}),this.name="ConflictException",this.$fault="client",Object.setPrototypeOf(this,ConflictException.prototype),this.Code=e.Code,this.Message=e.Message}}class ForbiddenException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ForbiddenException",$fault:"client",...e}),this.name="ForbiddenException",this.$fault="client",Object.setPrototypeOf(this,ForbiddenException.prototype),this.Code=e.Code,this.Message=e.Message}}class NotFoundException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"NotFoundException",$fault:"client",...e}),this.name="NotFoundException",this.$fault="client",Object.setPrototypeOf(this,NotFoundException.prototype),this.Code=e.Code,this.Message=e.Message}}class ServiceFailureException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ServiceFailureException",$fault:"server",...e}),this.name="ServiceFailureException",this.$fault="server",Object.setPrototypeOf(this,ServiceFailureException.prototype),this.Code=e.Code,this.Message=e.Message}}class ServiceUnavailableException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),this.name="ServiceUnavailableException",this.$fault="server",Object.setPrototypeOf(this,ServiceUnavailableException.prototype),this.Code=e.Code,this.Message=e.Message}}class ThrottledClientException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ThrottledClientException",$fault:"client",...e}),this.name="ThrottledClientException",this.$fault="client",Object.setPrototypeOf(this,ThrottledClientException.prototype),this.Code=e.Code,this.Message=e.Message}}class UnauthorizedClientException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"UnauthorizedClientException",$fault:"client",...e}),this.name="UnauthorizedClientException",this.$fault="client",Object.setPrototypeOf(this,UnauthorizedClientException.prototype),this.Code=e.Code,this.Message=e.Message}}class ResourceLimitExceededException extends ChimeSDKMessagingServiceException{constructor(e){super({name:"ResourceLimitExceededException",$fault:"client",...e}),this.name="ResourceLimitExceededException",this.$fault="client",Object.setPrototypeOf(this,ResourceLimitExceededException.prototype),this.Code=e.Code,this.Message=e.Message}}const ExpirationCriterion={CREATED_TIMESTAMP:"CREATED_TIMESTAMP",LAST_MESSAGE_TIMESTAMP:"LAST_MESSAGE_TIMESTAMP"},ChannelMode={RESTRICTED:"RESTRICTED",UNRESTRICTED:"UNRESTRICTED"},ChannelPrivacy={PRIVATE:"PRIVATE",PUBLIC:"PUBLIC"},InvocationType={ASYNC:"ASYNC"},FallbackAction={ABORT:"ABORT",CONTINUE:"CONTINUE"},PushNotificationType={DEFAULT:"DEFAULT",VOIP:"VOIP"},ChannelMessagePersistenceType={NON_PERSISTENT:"NON_PERSISTENT",PERSISTENT:"PERSISTENT"},ChannelMessageStatus={DENIED:"DENIED",FAILED:"FAILED",PENDING:"PENDING",SENT:"SENT"},ChannelMessageType={CONTROL:"CONTROL",STANDARD:"STANDARD"},MessagingDataType={Channel:"Channel",ChannelMessage:"ChannelMessage"},SortOrder={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},SearchFieldKey={MEMBERS:"MEMBERS"},SearchFieldOperator={EQUALS:"EQUALS",INCLUDES:"INCLUDES"},IdentityFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING}}),BatchChannelMembershipsFilterSensitiveLog=e=>({...e,...e.InvitedBy&&{InvitedBy:IdentityFilterSensitiveLog(e.InvitedBy)},...e.Members&&{Members:e.Members.map((e=>IdentityFilterSensitiveLog(e)))}}),BatchCreateChannelMembershipResponseFilterSensitiveLog=e=>({...e,...e.BatchChannelMemberships&&{BatchChannelMemberships:BatchChannelMembershipsFilterSensitiveLog(e.BatchChannelMemberships)}}),ChannelFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.CreatedBy&&{CreatedBy:IdentityFilterSensitiveLog(e.CreatedBy)}}),ChannelAssociatedWithFlowSummaryFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING}}),ChannelBanFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)},...e.CreatedBy&&{CreatedBy:IdentityFilterSensitiveLog(e.CreatedBy)}}),ChannelBanSummaryFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)}}),ProcessorFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING}}),ChannelFlowFilterSensitiveLog=e=>({...e,...e.Processors&&{Processors:e.Processors.map((e=>ProcessorFilterSensitiveLog(e)))},...e.Name&&{Name:SENSITIVE_STRING}}),MessageAttributeValueFilterSensitiveLog=e=>({...e,...e.StringValues&&{StringValues:SENSITIVE_STRING}}),PushNotificationConfigurationFilterSensitiveLog=e=>({...e,...e.Title&&{Title:SENSITIVE_STRING},...e.Body&&{Body:SENSITIVE_STRING}}),ChannelMessageCallbackFilterSensitiveLog=e=>({...e,...e.Content&&{Content:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.PushNotification&&{PushNotification:PushNotificationConfigurationFilterSensitiveLog(e.PushNotification)},...e.MessageAttributes&&{MessageAttributes:Object.entries(e.MessageAttributes).reduce(((e,[t,i])=>(e[t]=MessageAttributeValueFilterSensitiveLog(i),e)),{})},...e.ContentType&&{ContentType:SENSITIVE_STRING}}),ChannelFlowCallbackRequestFilterSensitiveLog=e=>({...e,...e.ChannelMessage&&{ChannelMessage:ChannelMessageCallbackFilterSensitiveLog(e.ChannelMessage)}}),ChannelFlowSummaryFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Processors&&{Processors:e.Processors.map((e=>ProcessorFilterSensitiveLog(e)))}}),ChannelMembershipFilterSensitiveLog=e=>({...e,...e.InvitedBy&&{InvitedBy:IdentityFilterSensitiveLog(e.InvitedBy)},...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)}}),ChannelSummaryFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING}}),ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog=e=>({...e,...e.ChannelSummary&&{ChannelSummary:ChannelSummaryFilterSensitiveLog(e.ChannelSummary)}}),PushNotificationPreferencesFilterSensitiveLog=e=>({...e,...e.FilterRule&&{FilterRule:SENSITIVE_STRING}}),ChannelMembershipPreferencesFilterSensitiveLog=e=>({...e,...e.PushNotifications&&{PushNotifications:PushNotificationPreferencesFilterSensitiveLog(e.PushNotifications)}}),ChannelMembershipSummaryFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)}}),ChannelMessageFilterSensitiveLog=e=>({...e,...e.Content&&{Content:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.Sender&&{Sender:IdentityFilterSensitiveLog(e.Sender)},...e.MessageAttributes&&{MessageAttributes:Object.entries(e.MessageAttributes).reduce(((e,[t,i])=>(e[t]=MessageAttributeValueFilterSensitiveLog(i),e)),{})},...e.ContentType&&{ContentType:SENSITIVE_STRING}}),ChannelMessageSummaryFilterSensitiveLog=e=>({...e,...e.Content&&{Content:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.Sender&&{Sender:IdentityFilterSensitiveLog(e.Sender)},...e.MessageAttributes&&{MessageAttributes:Object.entries(e.MessageAttributes).reduce(((e,[t,i])=>(e[t]=MessageAttributeValueFilterSensitiveLog(i),e)),{})},...e.ContentType&&{ContentType:SENSITIVE_STRING}}),ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog=e=>({...e,...e.ChannelSummary&&{ChannelSummary:ChannelSummaryFilterSensitiveLog(e.ChannelSummary)}}),ChannelModeratorFilterSensitiveLog=e=>({...e,...e.Moderator&&{Moderator:IdentityFilterSensitiveLog(e.Moderator)},...e.CreatedBy&&{CreatedBy:IdentityFilterSensitiveLog(e.CreatedBy)}}),ChannelModeratorSummaryFilterSensitiveLog=e=>({...e,...e.Moderator&&{Moderator:IdentityFilterSensitiveLog(e.Moderator)}}),TagFilterSensitiveLog=e=>({...e,...e.Key&&{Key:SENSITIVE_STRING},...e.Value&&{Value:SENSITIVE_STRING}}),CreateChannelRequestFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.ClientRequestToken&&{ClientRequestToken:SENSITIVE_STRING},...e.Tags&&{Tags:e.Tags.map((e=>TagFilterSensitiveLog(e)))},...e.ChannelId&&{ChannelId:SENSITIVE_STRING}}),CreateChannelBanResponseFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)}}),CreateChannelFlowRequestFilterSensitiveLog=e=>({...e,...e.Processors&&{Processors:e.Processors.map((e=>ProcessorFilterSensitiveLog(e)))},...e.Name&&{Name:SENSITIVE_STRING},...e.Tags&&{Tags:e.Tags.map((e=>TagFilterSensitiveLog(e)))},...e.ClientRequestToken&&{ClientRequestToken:SENSITIVE_STRING}}),CreateChannelMembershipResponseFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)}}),CreateChannelModeratorResponseFilterSensitiveLog=e=>({...e,...e.ChannelModerator&&{ChannelModerator:IdentityFilterSensitiveLog(e.ChannelModerator)}}),DescribeChannelResponseFilterSensitiveLog=e=>({...e,...e.Channel&&{Channel:ChannelFilterSensitiveLog(e.Channel)}}),DescribeChannelBanResponseFilterSensitiveLog=e=>({...e,...e.ChannelBan&&{ChannelBan:ChannelBanFilterSensitiveLog(e.ChannelBan)}}),DescribeChannelFlowResponseFilterSensitiveLog=e=>({...e,...e.ChannelFlow&&{ChannelFlow:ChannelFlowFilterSensitiveLog(e.ChannelFlow)}}),DescribeChannelMembershipResponseFilterSensitiveLog=e=>({...e,...e.ChannelMembership&&{ChannelMembership:ChannelMembershipFilterSensitiveLog(e.ChannelMembership)}}),DescribeChannelMembershipForAppInstanceUserResponseFilterSensitiveLog=e=>({...e,...e.ChannelMembership&&{ChannelMembership:ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog(e.ChannelMembership)}}),DescribeChannelModeratedByAppInstanceUserResponseFilterSensitiveLog=e=>({...e,...e.Channel&&{Channel:ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog(e.Channel)}}),DescribeChannelModeratorResponseFilterSensitiveLog=e=>({...e,...e.ChannelModerator&&{ChannelModerator:ChannelModeratorFilterSensitiveLog(e.ChannelModerator)}}),GetChannelMembershipPreferencesResponseFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)},...e.Preferences&&{Preferences:ChannelMembershipPreferencesFilterSensitiveLog(e.Preferences)}}),GetChannelMessageResponseFilterSensitiveLog=e=>({...e,...e.ChannelMessage&&{ChannelMessage:ChannelMessageFilterSensitiveLog(e.ChannelMessage)}}),ListChannelBansRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelBansResponseFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING},...e.ChannelBans&&{ChannelBans:e.ChannelBans.map((e=>ChannelBanSummaryFilterSensitiveLog(e)))}}),ListChannelFlowsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelFlowsResponseFilterSensitiveLog=e=>({...e,...e.ChannelFlows&&{ChannelFlows:e.ChannelFlows.map((e=>ChannelFlowSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMembershipsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMembershipsResponseFilterSensitiveLog=e=>({...e,...e.ChannelMemberships&&{ChannelMemberships:e.ChannelMemberships.map((e=>ChannelMembershipSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMembershipsForAppInstanceUserRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMembershipsForAppInstanceUserResponseFilterSensitiveLog=e=>({...e,...e.ChannelMemberships&&{ChannelMemberships:e.ChannelMemberships.map((e=>ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMessagesRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelMessagesResponseFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING},...e.ChannelMessages&&{ChannelMessages:e.ChannelMessages.map((e=>ChannelMessageSummaryFilterSensitiveLog(e)))}}),ListChannelModeratorsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelModeratorsResponseFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING},...e.ChannelModerators&&{ChannelModerators:e.ChannelModerators.map((e=>ChannelModeratorSummaryFilterSensitiveLog(e)))}}),ListChannelsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelsResponseFilterSensitiveLog=e=>({...e,...e.Channels&&{Channels:e.Channels.map((e=>ChannelSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelsAssociatedWithChannelFlowRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelsAssociatedWithChannelFlowResponseFilterSensitiveLog=e=>({...e,...e.Channels&&{Channels:e.Channels.map((e=>ChannelAssociatedWithFlowSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelsModeratedByAppInstanceUserRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListChannelsModeratedByAppInstanceUserResponseFilterSensitiveLog=e=>({...e,...e.Channels&&{Channels:e.Channels.map((e=>ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListSubChannelsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListSubChannelsResponseFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),ListTagsForResourceResponseFilterSensitiveLog=e=>({...e,...e.Tags&&{Tags:e.Tags.map((e=>TagFilterSensitiveLog(e)))}}),PutChannelMembershipPreferencesRequestFilterSensitiveLog=e=>({...e,...e.Preferences&&{Preferences:ChannelMembershipPreferencesFilterSensitiveLog(e.Preferences)}}),PutChannelMembershipPreferencesResponseFilterSensitiveLog=e=>({...e,...e.Member&&{Member:IdentityFilterSensitiveLog(e.Member)},...e.Preferences&&{Preferences:ChannelMembershipPreferencesFilterSensitiveLog(e.Preferences)}}),SearchChannelsRequestFilterSensitiveLog=e=>({...e,...e.NextToken&&{NextToken:SENSITIVE_STRING}}),SearchChannelsResponseFilterSensitiveLog=e=>({...e,...e.Channels&&{Channels:e.Channels.map((e=>ChannelSummaryFilterSensitiveLog(e)))},...e.NextToken&&{NextToken:SENSITIVE_STRING}}),SendChannelMessageRequestFilterSensitiveLog=e=>({...e,...e.Content&&{Content:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.ClientRequestToken&&{ClientRequestToken:SENSITIVE_STRING},...e.PushNotification&&{PushNotification:PushNotificationConfigurationFilterSensitiveLog(e.PushNotification)},...e.MessageAttributes&&{MessageAttributes:Object.entries(e.MessageAttributes).reduce(((e,[t,i])=>(e[t]=MessageAttributeValueFilterSensitiveLog(i),e)),{})},...e.ContentType&&{ContentType:SENSITIVE_STRING}}),TagResourceRequestFilterSensitiveLog=e=>({...e,...e.Tags&&{Tags:e.Tags.map((e=>TagFilterSensitiveLog(e)))}}),UntagResourceRequestFilterSensitiveLog=e=>({...e,...e.TagKeys&&{TagKeys:SENSITIVE_STRING}}),UpdateChannelRequestFilterSensitiveLog=e=>({...e,...e.Name&&{Name:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING}}),UpdateChannelFlowRequestFilterSensitiveLog=e=>({...e,...e.Processors&&{Processors:e.Processors.map((e=>ProcessorFilterSensitiveLog(e)))},...e.Name&&{Name:SENSITIVE_STRING}}),UpdateChannelMessageRequestFilterSensitiveLog=e=>({...e,...e.Content&&{Content:SENSITIVE_STRING},...e.Metadata&&{Metadata:SENSITIVE_STRING},...e.ContentType&&{ContentType:SENSITIVE_STRING}}),se_AssociateChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/channel-flow"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{ChannelFlowArn:[]})),i.m("PUT").h(n).b(r),i.build()},se_BatchCreateChannelMembershipCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/memberships"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_o]:[,"batch-create"]});let o;return o=JSON.stringify(take(e,{MemberArns:e=>_json(e),SubChannelId:[],Type:[]})),i.m("POST").h(n).q(r).b(o),i.build()},se_ChannelFlowCallbackCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const n=map({[_o]:[,"channel-flow-callback"]});let r;return r=JSON.stringify(take(e,{CallbackId:[!0,e=>e??v4()],ChannelMessage:e=>_json(e),DeleteResource:[]})),i.m("POST").h({"content-type":"application/json"}).q(n).b(r),i.build()},se_CreateChannelCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels"),r=JSON.stringify(take(e,{AppInstanceArn:[],ChannelId:[],ClientRequestToken:[!0,e=>e??v4()],ElasticChannelConfiguration:e=>_json(e),ExpirationSettings:e=>_json(e),MemberArns:e=>_json(e),Metadata:[],Mode:[],ModeratorArns:e=>_json(e),Name:[],Privacy:[],Tags:e=>_json(e)})),i.m("POST").h(n).b(r),i.build()},se_CreateChannelBanCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/bans"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{MemberArn:[]})),i.m("POST").h(n).b(r),i.build()},se_CreateChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t);let n;return i.bp("/channel-flows"),n=JSON.stringify(take(e,{AppInstanceArn:[],ClientRequestToken:[!0,e=>e??v4()],Name:[],Processors:e=>_json(e),Tags:e=>_json(e)})),i.m("POST").h({"content-type":"application/json"}).b(n),i.build()},se_CreateChannelMembershipCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/memberships"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{MemberArn:[],SubChannelId:[],Type:[]})),i.m("POST").h(n).b(r),i.build()},se_CreateChannelModeratorCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/moderators"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{ChannelModeratorArn:[]})),i.m("POST").h(n).b(r),i.build()},se_DeleteChannelCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.m("DELETE").h(n).b(undefined),i.build()},se_DeleteChannelBanCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/bans/{MemberArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1),i.m("DELETE").h(n).b(undefined),i.build()},se_DeleteChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t);return i.bp("/channel-flows/{ChannelFlowArn}"),i.p("ChannelFlowArn",(()=>e.ChannelFlowArn),"{ChannelFlowArn}",!1),i.m("DELETE").h({}).b(undefined),i.build()},se_DeleteChannelMembershipCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/memberships/{MemberArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1);const r=map({[_sci]:[,e[_SCI]]});return i.m("DELETE").h(n).q(r).b(undefined),i.build()},se_DeleteChannelMessageCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/messages/{MessageId}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MessageId",(()=>e.MessageId),"{MessageId}",!1);const r=map({[_sci]:[,e[_SCI]]});return i.m("DELETE").h(n).q(r).b(undefined),i.build()},se_DeleteChannelModeratorCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/moderators/{ChannelModeratorArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("ChannelModeratorArn",(()=>e.ChannelModeratorArn),"{ChannelModeratorArn}",!1),i.m("DELETE").h(n).b(undefined),i.build()},se_DeleteMessagingStreamingConfigurationsCommand=async(e,t)=>{const i=requestBuilder(e,t);return i.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),i.p("AppInstanceArn",(()=>e.AppInstanceArn),"{AppInstanceArn}",!1),i.m("DELETE").h({}).b(undefined),i.build()},se_DescribeChannelCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.m("GET").h(n).b(undefined),i.build()},se_DescribeChannelBanCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/bans/{MemberArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1),i.m("GET").h(n).b(undefined),i.build()},se_DescribeChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t);return i.bp("/channel-flows/{ChannelFlowArn}"),i.p("ChannelFlowArn",(()=>e.ChannelFlowArn),"{ChannelFlowArn}",!1),i.m("GET").h({}).b(undefined),i.build()},se_DescribeChannelMembershipCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/memberships/{MemberArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1);const r=map({[_sci]:[,e[_SCI]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_DescribeChannelMembershipForAppInstanceUserCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_s]:[,"app-instance-user-membership"],[_aiua]:[,expectNonNull(e[_AIUA],"AppInstanceUserArn")]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_DescribeChannelModeratedByAppInstanceUserCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_s]:[,"app-instance-user-moderated-channel"],[_aiua]:[,expectNonNull(e[_AIUA],"AppInstanceUserArn")]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_DescribeChannelModeratorCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/moderators/{ChannelModeratorArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("ChannelModeratorArn",(()=>e.ChannelModeratorArn),"{ChannelModeratorArn}",!1),i.m("GET").h(n).b(undefined),i.build()},se_DisassociateChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/channel-flow/{ChannelFlowArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("ChannelFlowArn",(()=>e.ChannelFlowArn),"{ChannelFlowArn}",!1),i.m("DELETE").h(n).b(undefined),i.build()},se_GetChannelMembershipPreferencesCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/memberships/{MemberArn}/preferences"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1),i.m("GET").h(n).b(undefined),i.build()},se_GetChannelMessageCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/messages/{MessageId}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MessageId",(()=>e.MessageId),"{MessageId}",!1);const r=map({[_sci]:[,e[_SCI]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_GetChannelMessageStatusCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/messages/{MessageId}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MessageId",(()=>e.MessageId),"{MessageId}",!1);const r=map({[_s]:[,"message-status"],[_sci]:[,e[_SCI]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_GetMessagingSessionEndpointCommand=async(e,t)=>{const i=requestBuilder(e,t);let n;return i.bp("/endpoints/messaging-session"),n="",i.m("GET").h({"content-type":"application/json"}).b(""),i.build()},se_GetMessagingStreamingConfigurationsCommand=async(e,t)=>{const i=requestBuilder(e,t);return i.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),i.p("AppInstanceArn",(()=>e.AppInstanceArn),"{AppInstanceArn}",!1),i.m("GET").h({}).b(undefined),i.build()},se_ListChannelBansCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/bans"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelFlowsCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/channel-flows");const n=map({[_aia]:[,expectNonNull(e[_AIA],"AppInstanceArn")],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h({}).q(n).b(undefined),i.build()},se_ListChannelMembershipsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/memberships"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_t]:[,e[_T]],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]],[_sci]:[,e[_SCI]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelMembershipsForAppInstanceUserCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels");const r=map({[_s]:[,"app-instance-user-memberships"],[_aiua]:[,e[_AIUA]],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelMessagesCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/messages"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_so]:[,e[_SO]],[_nb]:[()=>void 0!==e.NotBefore,()=>(e[_NB].toISOString().split(".")[0]+"Z").toString()],[_na]:[()=>void 0!==e.NotAfter,()=>(e[_NA].toISOString().split(".")[0]+"Z").toString()],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]],[_sci]:[,e[_SCI]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelModeratorsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/moderators"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels");const r=map({[_aia]:[,expectNonNull(e[_AIA],"AppInstanceArn")],[_p]:[,e[_P]],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListChannelsAssociatedWithChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/channels");const n=map({[_s]:[,"channel-flow-associations"],[_cfa]:[,expectNonNull(e[_CFA],"ChannelFlowArn")],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h({}).q(n).b(undefined),i.build()},se_ListChannelsModeratedByAppInstanceUserCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels");const r=map({[_s]:[,"app-instance-user-moderated-channels"],[_aiua]:[,e[_AIUA]],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListSubChannelsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/subchannels"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1);const r=map({[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});return i.m("GET").h(n).q(r).b(undefined),i.build()},se_ListTagsForResourceCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/tags");const n=map({[_a]:[,expectNonNull(e[_RARN],"ResourceARN")]});return i.m("GET").h({}).q(n).b(undefined),i.build()},se_PutChannelExpirationSettingsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/expiration-settings"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{ExpirationSettings:e=>_json(e)})),i.m("PUT").h(n).b(r),i.build()},se_PutChannelMembershipPreferencesCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/memberships/{MemberArn}/preferences"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MemberArn",(()=>e.MemberArn),"{MemberArn}",!1),r=JSON.stringify(take(e,{Preferences:e=>_json(e)})),i.m("PUT").h(n).b(r),i.build()},se_PutMessagingStreamingConfigurationsCommand=async(e,t)=>{const i=requestBuilder(e,t);let n;return i.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),i.p("AppInstanceArn",(()=>e.AppInstanceArn),"{AppInstanceArn}",!1),n=JSON.stringify(take(e,{StreamingConfigurations:e=>_json(e)})),i.m("PUT").h({"content-type":"application/json"}).b(n),i.build()},se_RedactChannelMessageCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});i.bp("/channels/{ChannelArn}/messages/{MessageId}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MessageId",(()=>e.MessageId),"{MessageId}",!1);const r=map({[_o]:[,"redact"]});let o;return o=JSON.stringify(take(e,{SubChannelId:[]})),i.m("POST").h(n).q(r).b(o),i.build()},se_SearchChannelsCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});i.bp("/channels");const r=map({[_o]:[,"search"],[_mr]:[()=>void 0!==e.MaxResults,()=>e[_MR].toString()],[_nt]:[,e[_NT]]});let o;return o=JSON.stringify(take(e,{Fields:e=>_json(e)})),i.m("POST").h(n).q(r).b(o),i.build()},se_SendChannelMessageCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/messages"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{ClientRequestToken:[!0,e=>e??v4()],Content:[],ContentType:[],MessageAttributes:e=>_json(e),Metadata:[],Persistence:[],PushNotification:e=>_json(e),SubChannelId:[],Target:e=>_json(e),Type:[]})),i.m("POST").h(n).b(r),i.build()},se_TagResourceCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/tags");const n=map({[_o]:[,"tag-resource"]});let r;return r=JSON.stringify(take(e,{ResourceARN:[],Tags:e=>_json(e)})),i.m("POST").h({"content-type":"application/json"}).q(n).b(r),i.build()},se_UntagResourceCommand=async(e,t)=>{const i=requestBuilder(e,t);i.bp("/tags");const n=map({[_o]:[,"untag-resource"]});let r;return r=JSON.stringify(take(e,{ResourceARN:[],TagKeys:e=>_json(e)})),i.m("POST").h({"content-type":"application/json"}).q(n).b(r),i.build()},se_UpdateChannelCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),r=JSON.stringify(take(e,{Metadata:[],Mode:[],Name:[]})),i.m("PUT").h(n).b(r),i.build()},se_UpdateChannelFlowCommand=async(e,t)=>{const i=requestBuilder(e,t);let n;return i.bp("/channel-flows/{ChannelFlowArn}"),i.p("ChannelFlowArn",(()=>e.ChannelFlowArn),"{ChannelFlowArn}",!1),n=JSON.stringify(take(e,{Name:[],Processors:e=>_json(e)})),i.m("PUT").h({"content-type":"application/json"}).b(n),i.build()},se_UpdateChannelMessageCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{"content-type":"application/json",[_xacb]:e[_CB]});let r;return i.bp("/channels/{ChannelArn}/messages/{MessageId}"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.p("MessageId",(()=>e.MessageId),"{MessageId}",!1),r=JSON.stringify(take(e,{Content:[],ContentType:[],Metadata:[],SubChannelId:[]})),i.m("PUT").h(n).b(r),i.build()},se_UpdateChannelReadMarkerCommand=async(e,t)=>{const i=requestBuilder(e,t),n=map({},isSerializableHeaderValue,{[_xacb]:e[_CB]});return i.bp("/channels/{ChannelArn}/readMarker"),i.p("ChannelArn",(()=>e.ChannelArn),"{ChannelArn}",!1),i.m("PUT").h(n).b(undefined),i.build()},de_AssociateChannelFlowCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_AssociateChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_AssociateChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_BatchCreateChannelMembershipCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_BatchCreateChannelMembershipCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{BatchChannelMemberships:_json,Errors:_json});return Object.assign(i,r),i},de_BatchCreateChannelMembershipCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ChannelFlowCallbackCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ChannelFlowCallbackCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{CallbackId:expectString,ChannelArn:expectString});return Object.assign(i,r),i},de_ChannelFlowCallbackCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_CreateChannelCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_CreateChannelCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString});return Object.assign(i,r),i},de_CreateChannelCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_CreateChannelBanCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_CreateChannelBanCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,Member:_json});return Object.assign(i,r),i},de_CreateChannelBanCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_CreateChannelFlowCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_CreateChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelFlowArn:expectString});return Object.assign(i,r),i},de_CreateChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_CreateChannelMembershipCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_CreateChannelMembershipCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,Member:_json,SubChannelId:expectString});return Object.assign(i,r),i},de_CreateChannelMembershipCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_CreateChannelModeratorCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_CreateChannelModeratorCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ChannelModerator:_json});return Object.assign(i,r),i},de_CreateChannelModeratorCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelBanCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelBanCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelBanCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelFlowCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelMembershipCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelMembershipCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelMembershipCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelMessageCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelMessageCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelMessageCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteChannelModeratorCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteChannelModeratorCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteChannelModeratorCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DeleteMessagingStreamingConfigurationsCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DeleteMessagingStreamingConfigurationsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DeleteMessagingStreamingConfigurationsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channel:e=>de_Channel(e)});return Object.assign(i,r),i},de_DescribeChannelCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelBanCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelBanCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelBan:e=>de_ChannelBan(e)});return Object.assign(i,r),i},de_DescribeChannelBanCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelFlowCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelFlow:e=>de_ChannelFlow(e)});return Object.assign(i,r),i},de_DescribeChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelMembershipCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelMembershipCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelMembership:e=>de_ChannelMembership(e)});return Object.assign(i,r),i},de_DescribeChannelMembershipCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelMembershipForAppInstanceUserCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelMembershipForAppInstanceUserCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelMembership:e=>de_ChannelMembershipForAppInstanceUserSummary(e)});return Object.assign(i,r),i},de_DescribeChannelMembershipForAppInstanceUserCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelModeratedByAppInstanceUserCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelModeratedByAppInstanceUserCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channel:e=>de_ChannelModeratedByAppInstanceUserSummary(e)});return Object.assign(i,r),i},de_DescribeChannelModeratedByAppInstanceUserCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DescribeChannelModeratorCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_DescribeChannelModeratorCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelModerator:e=>de_ChannelModerator(e)});return Object.assign(i,r),i},de_DescribeChannelModeratorCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_DisassociateChannelFlowCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_DisassociateChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_DisassociateChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_GetChannelMembershipPreferencesCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_GetChannelMembershipPreferencesCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,Member:_json,Preferences:_json});return Object.assign(i,r),i},de_GetChannelMembershipPreferencesCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_GetChannelMessageCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_GetChannelMessageCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelMessage:e=>de_ChannelMessage(e)});return Object.assign(i,r),i},de_GetChannelMessageCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_GetChannelMessageStatusCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_GetChannelMessageStatusCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Status:_json});return Object.assign(i,r),i},de_GetChannelMessageStatusCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_GetMessagingSessionEndpointCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_GetMessagingSessionEndpointCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Endpoint:_json});return Object.assign(i,r),i},de_GetMessagingSessionEndpointCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_GetMessagingStreamingConfigurationsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_GetMessagingStreamingConfigurationsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{StreamingConfigurations:_json});return Object.assign(i,r),i},de_GetMessagingStreamingConfigurationsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelBansCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelBansCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ChannelBans:_json,NextToken:expectString});return Object.assign(i,r),i},de_ListChannelBansCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelFlowsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelFlowsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelFlows:_json,NextToken:expectString});return Object.assign(i,r),i},de_ListChannelFlowsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelMembershipsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelMembershipsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ChannelMemberships:_json,NextToken:expectString});return Object.assign(i,r),i},de_ListChannelMembershipsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelMembershipsForAppInstanceUserCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelMembershipsForAppInstanceUserCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelMemberships:e=>de_ChannelMembershipForAppInstanceUserSummaryList(e),NextToken:expectString});return Object.assign(i,r),i},de_ListChannelMembershipsForAppInstanceUserCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelMessagesCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelMessagesCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ChannelMessages:e=>de_ChannelMessageSummaryList(e),NextToken:expectString,SubChannelId:expectString});return Object.assign(i,r),i},de_ListChannelMessagesCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelModeratorsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelModeratorsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ChannelModerators:_json,NextToken:expectString});return Object.assign(i,r),i},de_ListChannelModeratorsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channels:e=>de_ChannelSummaryList(e),NextToken:expectString});return Object.assign(i,r),i},de_ListChannelsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelsAssociatedWithChannelFlowCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelsAssociatedWithChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channels:_json,NextToken:expectString});return Object.assign(i,r),i},de_ListChannelsAssociatedWithChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListChannelsModeratedByAppInstanceUserCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListChannelsModeratedByAppInstanceUserCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channels:e=>de_ChannelModeratedByAppInstanceUserSummaryList(e),NextToken:expectString});return Object.assign(i,r),i},de_ListChannelsModeratedByAppInstanceUserCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListSubChannelsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListSubChannelsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,NextToken:expectString,SubChannels:_json});return Object.assign(i,r),i},de_ListSubChannelsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_ListTagsForResourceCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_ListTagsForResourceCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Tags:_json});return Object.assign(i,r),i},de_ListTagsForResourceCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_PutChannelExpirationSettingsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_PutChannelExpirationSettingsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,ExpirationSettings:_json});return Object.assign(i,r),i},de_PutChannelExpirationSettingsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_PutChannelMembershipPreferencesCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_PutChannelMembershipPreferencesCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,Member:_json,Preferences:_json});return Object.assign(i,r),i},de_PutChannelMembershipPreferencesCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_PutMessagingStreamingConfigurationsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_PutMessagingStreamingConfigurationsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{StreamingConfigurations:_json});return Object.assign(i,r),i},de_PutMessagingStreamingConfigurationsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await de_NotFoundExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_RedactChannelMessageCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_RedactChannelMessageCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,MessageId:expectString,SubChannelId:expectString});return Object.assign(i,r),i},de_RedactChannelMessageCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_SearchChannelsCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_SearchChannelsCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{Channels:e=>de_ChannelSummaryList(e),NextToken:expectString});return Object.assign(i,r),i},de_SearchChannelsCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_SendChannelMessageCommand=async(e,t)=>{if(201!==e.statusCode&&e.statusCode>=300)return de_SendChannelMessageCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,MessageId:expectString,Status:_json,SubChannelId:expectString});return Object.assign(i,r),i},de_SendChannelMessageCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_TagResourceCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_TagResourceCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_TagResourceCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await de_ResourceLimitExceededExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_UntagResourceCommand=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return de_UntagResourceCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)});return await collectBody(e.body,t),i},de_UntagResourceCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_UpdateChannelCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_UpdateChannelCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString});return Object.assign(i,r),i},de_UpdateChannelCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_UpdateChannelFlowCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_UpdateChannelFlowCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelFlowArn:expectString});return Object.assign(i,r),i},de_UpdateChannelFlowCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_UpdateChannelMessageCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_UpdateChannelMessageCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString,MessageId:expectString,Status:_json,SubChannelId:expectString});return Object.assign(i,r),i},de_UpdateChannelMessageCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},de_UpdateChannelReadMarkerCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_UpdateChannelReadMarkerCommandError(e,t);const i=map({$metadata:deserializeMetadata(e)}),n=expectNonNull(expectObject(await parseBody(e.body,t)),"body"),r=take(n,{ChannelArn:expectString});return Object.assign(i,r),i},de_UpdateChannelReadMarkerCommandError=async(e,t)=>{const i={...e,body:await parseErrorBody(e.body,t)},n=loadRestJsonErrorCode(e,i.body);switch(n){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await de_BadRequestExceptionRes(i);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await de_ConflictExceptionRes(i);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await de_ForbiddenExceptionRes(i);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await de_ServiceFailureExceptionRes(i);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(i);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await de_ThrottledClientExceptionRes(i);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await de_UnauthorizedClientExceptionRes(i);default:const t=i.body;return throwDefaultError({output:e,parsedBody:t,errorCode:n})}},throwDefaultError=withBaseException(ChimeSDKMessagingServiceException),de_BadRequestExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new BadRequestException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ConflictExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ConflictException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ForbiddenExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ForbiddenException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_NotFoundExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new NotFoundException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ResourceLimitExceededExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ResourceLimitExceededException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ServiceFailureExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ServiceFailureException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ServiceUnavailableExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ServiceUnavailableException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_ThrottledClientExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new ThrottledClientException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_UnauthorizedClientExceptionRes=async(e,t)=>{const i=map({}),n=e.body,r=take(n,{Code:expectString,Message:expectString});Object.assign(i,r);const o=new UnauthorizedClientException({$metadata:deserializeMetadata(e),...i});return decorateServiceException(o,e.body)},de_AppInstanceUserMembershipSummary=(e,t)=>take(e,{ReadMarkerTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),SubChannelId:expectString,Type:expectString}),de_Channel=(e,t)=>take(e,{ChannelArn:expectString,ChannelFlowArn:expectString,CreatedBy:_json,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),ElasticChannelConfiguration:_json,ExpirationSettings:_json,LastMessageTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastUpdatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Metadata:expectString,Mode:expectString,Name:expectString,Privacy:expectString}),de_ChannelBan=(e,t)=>take(e,{ChannelArn:expectString,CreatedBy:_json,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Member:_json}),de_ChannelFlow=(e,t)=>take(e,{ChannelFlowArn:expectString,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastUpdatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Name:expectString,Processors:_json}),de_ChannelMembership=(e,t)=>take(e,{ChannelArn:expectString,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),InvitedBy:_json,LastUpdatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Member:_json,SubChannelId:expectString,Type:expectString}),de_ChannelMembershipForAppInstanceUserSummary=(e,t)=>take(e,{AppInstanceUserMembershipSummary:e=>de_AppInstanceUserMembershipSummary(e),ChannelSummary:e=>de_ChannelSummary(e)}),de_ChannelMembershipForAppInstanceUserSummaryList=(e,t)=>{const i=(e||[]).filter((e=>null!=e)).map((e=>de_ChannelMembershipForAppInstanceUserSummary(e)));return i},de_ChannelMessage=(e,t)=>take(e,{ChannelArn:expectString,Content:expectString,ContentType:expectString,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastEditedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastUpdatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),MessageAttributes:_json,MessageId:expectString,Metadata:expectString,Persistence:expectString,Redacted:expectBoolean,Sender:_json,Status:_json,SubChannelId:expectString,Target:_json,Type:expectString}),de_ChannelMessageSummary=(e,t)=>take(e,{Content:expectString,ContentType:expectString,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastEditedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),LastUpdatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),MessageAttributes:_json,MessageId:expectString,Metadata:expectString,Redacted:expectBoolean,Sender:_json,Status:_json,Target:_json,Type:expectString}),de_ChannelMessageSummaryList=(e,t)=>{const i=(e||[]).filter((e=>null!=e)).map((e=>de_ChannelMessageSummary(e)));return i},de_ChannelModeratedByAppInstanceUserSummary=(e,t)=>take(e,{ChannelSummary:e=>de_ChannelSummary(e)}),de_ChannelModeratedByAppInstanceUserSummaryList=(e,t)=>{const i=(e||[]).filter((e=>null!=e)).map((e=>de_ChannelModeratedByAppInstanceUserSummary(e)));return i},de_ChannelModerator=(e,t)=>take(e,{ChannelArn:expectString,CreatedBy:_json,CreatedTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Moderator:_json}),de_ChannelSummary=(e,t)=>take(e,{ChannelArn:expectString,LastMessageTimestamp:e=>expectNonNull(parseEpochTimestamp(expectNumber(e))),Metadata:expectString,Mode:expectString,Name:expectString,Privacy:expectString}),de_ChannelSummaryList=(e,t)=>{const i=(e||[]).filter((e=>null!=e)).map((e=>de_ChannelSummary(e)));return i},deserializeMetadata=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),collectBodyString=(e,t)=>collectBody(e,t).then((e=>t.utf8Encoder(e))),isSerializableHeaderValue=e=>!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size),_AIA="AppInstanceArn",_AIUA="AppInstanceUserArn",_CB="ChimeBearer",_CFA="ChannelFlowArn",_MR="MaxResults",_NA="NotAfter",_NB="NotBefore",_NT="NextToken",_P="Privacy",_RARN="ResourceARN",_SCI="SubChannelId",_SO="SortOrder",_T="Type",_a="arn",_aia="app-instance-arn",_aiua="app-instance-user-arn",_cfa="channel-flow-arn",_mr="max-results",_na="not-after",_nb="not-before",_nt="next-token",_o="operation",_p="privacy",_s="scope",_sci="sub-channel-id",_so="sort-order",_t="type",_xacb="x-amz-chime-bearer",parseBody=(e,t)=>collectBodyString(e,t).then((e=>e.length?JSON.parse(e):{})),parseErrorBody=async(e,t)=>{const i=await parseBody(e,t);return i.message=i.message??i.Message,i},loadRestJsonErrorCode=(e,t)=>{const i=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},n=(r=e.headers,o="x-amzn-errortype",Object.keys(r).find((e=>e.toLowerCase()===o.toLowerCase())));var r,o;return void 0!==n?i(e.headers[n]):void 0!==t.code?i(t.code):void 0!==t.__type?i(t.__type):void 0};class AssociateChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","AssociateChannelFlow",{}).n("ChimeSDKMessagingClient","AssociateChannelFlowCommand").f(void 0,void 0).ser(se_AssociateChannelFlowCommand).de(de_AssociateChannelFlowCommand).build()){}class BatchCreateChannelMembershipCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","BatchCreateChannelMembership",{}).n("ChimeSDKMessagingClient","BatchCreateChannelMembershipCommand").f(void 0,BatchCreateChannelMembershipResponseFilterSensitiveLog).ser(se_BatchCreateChannelMembershipCommand).de(de_BatchCreateChannelMembershipCommand).build()){}class ChannelFlowCallbackCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ChannelFlowCallback",{}).n("ChimeSDKMessagingClient","ChannelFlowCallbackCommand").f(ChannelFlowCallbackRequestFilterSensitiveLog,void 0).ser(se_ChannelFlowCallbackCommand).de(de_ChannelFlowCallbackCommand).build()){}class CreateChannelBanCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","CreateChannelBan",{}).n("ChimeSDKMessagingClient","CreateChannelBanCommand").f(void 0,CreateChannelBanResponseFilterSensitiveLog).ser(se_CreateChannelBanCommand).de(de_CreateChannelBanCommand).build()){}class CreateChannelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","CreateChannel",{}).n("ChimeSDKMessagingClient","CreateChannelCommand").f(CreateChannelRequestFilterSensitiveLog,void 0).ser(se_CreateChannelCommand).de(de_CreateChannelCommand).build()){}class CreateChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","CreateChannelFlow",{}).n("ChimeSDKMessagingClient","CreateChannelFlowCommand").f(CreateChannelFlowRequestFilterSensitiveLog,void 0).ser(se_CreateChannelFlowCommand).de(de_CreateChannelFlowCommand).build()){}class CreateChannelMembershipCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","CreateChannelMembership",{}).n("ChimeSDKMessagingClient","CreateChannelMembershipCommand").f(void 0,CreateChannelMembershipResponseFilterSensitiveLog).ser(se_CreateChannelMembershipCommand).de(de_CreateChannelMembershipCommand).build()){}class CreateChannelModeratorCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","CreateChannelModerator",{}).n("ChimeSDKMessagingClient","CreateChannelModeratorCommand").f(void 0,CreateChannelModeratorResponseFilterSensitiveLog).ser(se_CreateChannelModeratorCommand).de(de_CreateChannelModeratorCommand).build()){}class DeleteChannelBanCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannelBan",{}).n("ChimeSDKMessagingClient","DeleteChannelBanCommand").f(void 0,void 0).ser(se_DeleteChannelBanCommand).de(de_DeleteChannelBanCommand).build()){}class DeleteChannelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannel",{}).n("ChimeSDKMessagingClient","DeleteChannelCommand").f(void 0,void 0).ser(se_DeleteChannelCommand).de(de_DeleteChannelCommand).build()){}class DeleteChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannelFlow",{}).n("ChimeSDKMessagingClient","DeleteChannelFlowCommand").f(void 0,void 0).ser(se_DeleteChannelFlowCommand).de(de_DeleteChannelFlowCommand).build()){}class DeleteChannelMembershipCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannelMembership",{}).n("ChimeSDKMessagingClient","DeleteChannelMembershipCommand").f(void 0,void 0).ser(se_DeleteChannelMembershipCommand).de(de_DeleteChannelMembershipCommand).build()){}class DeleteChannelMessageCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannelMessage",{}).n("ChimeSDKMessagingClient","DeleteChannelMessageCommand").f(void 0,void 0).ser(se_DeleteChannelMessageCommand).de(de_DeleteChannelMessageCommand).build()){}class DeleteChannelModeratorCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteChannelModerator",{}).n("ChimeSDKMessagingClient","DeleteChannelModeratorCommand").f(void 0,void 0).ser(se_DeleteChannelModeratorCommand).de(de_DeleteChannelModeratorCommand).build()){}class DeleteMessagingStreamingConfigurationsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DeleteMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","DeleteMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(se_DeleteMessagingStreamingConfigurationsCommand).de(de_DeleteMessagingStreamingConfigurationsCommand).build()){}class DescribeChannelBanCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelBan",{}).n("ChimeSDKMessagingClient","DescribeChannelBanCommand").f(void 0,DescribeChannelBanResponseFilterSensitiveLog).ser(se_DescribeChannelBanCommand).de(de_DescribeChannelBanCommand).build()){}class DescribeChannelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannel",{}).n("ChimeSDKMessagingClient","DescribeChannelCommand").f(void 0,DescribeChannelResponseFilterSensitiveLog).ser(se_DescribeChannelCommand).de(de_DescribeChannelCommand).build()){}class DescribeChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelFlow",{}).n("ChimeSDKMessagingClient","DescribeChannelFlowCommand").f(void 0,DescribeChannelFlowResponseFilterSensitiveLog).ser(se_DescribeChannelFlowCommand).de(de_DescribeChannelFlowCommand).build()){}class DescribeChannelMembershipCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelMembership",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipCommand").f(void 0,DescribeChannelMembershipResponseFilterSensitiveLog).ser(se_DescribeChannelMembershipCommand).de(de_DescribeChannelMembershipCommand).build()){}class DescribeChannelMembershipForAppInstanceUserCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelMembershipForAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipForAppInstanceUserCommand").f(void 0,DescribeChannelMembershipForAppInstanceUserResponseFilterSensitiveLog).ser(se_DescribeChannelMembershipForAppInstanceUserCommand).de(de_DescribeChannelMembershipForAppInstanceUserCommand).build()){}class DescribeChannelModeratedByAppInstanceUserCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratedByAppInstanceUserCommand").f(void 0,DescribeChannelModeratedByAppInstanceUserResponseFilterSensitiveLog).ser(se_DescribeChannelModeratedByAppInstanceUserCommand).de(de_DescribeChannelModeratedByAppInstanceUserCommand).build()){}class DescribeChannelModeratorCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DescribeChannelModerator",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratorCommand").f(void 0,DescribeChannelModeratorResponseFilterSensitiveLog).ser(se_DescribeChannelModeratorCommand).de(de_DescribeChannelModeratorCommand).build()){}class DisassociateChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","DisassociateChannelFlow",{}).n("ChimeSDKMessagingClient","DisassociateChannelFlowCommand").f(void 0,void 0).ser(se_DisassociateChannelFlowCommand).de(de_DisassociateChannelFlowCommand).build()){}class GetChannelMembershipPreferencesCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","GetChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","GetChannelMembershipPreferencesCommand").f(void 0,GetChannelMembershipPreferencesResponseFilterSensitiveLog).ser(se_GetChannelMembershipPreferencesCommand).de(de_GetChannelMembershipPreferencesCommand).build()){}class GetChannelMessageCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","GetChannelMessage",{}).n("ChimeSDKMessagingClient","GetChannelMessageCommand").f(void 0,GetChannelMessageResponseFilterSensitiveLog).ser(se_GetChannelMessageCommand).de(de_GetChannelMessageCommand).build()){}class GetChannelMessageStatusCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","GetChannelMessageStatus",{}).n("ChimeSDKMessagingClient","GetChannelMessageStatusCommand").f(void 0,void 0).ser(se_GetChannelMessageStatusCommand).de(de_GetChannelMessageStatusCommand).build()){}class GetMessagingSessionEndpointCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","GetMessagingSessionEndpoint",{}).n("ChimeSDKMessagingClient","GetMessagingSessionEndpointCommand").f(void 0,void 0).ser(se_GetMessagingSessionEndpointCommand).de(de_GetMessagingSessionEndpointCommand).build()){}class GetMessagingStreamingConfigurationsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","GetMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","GetMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(se_GetMessagingStreamingConfigurationsCommand).de(de_GetMessagingStreamingConfigurationsCommand).build()){}class ListChannelBansCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelBans",{}).n("ChimeSDKMessagingClient","ListChannelBansCommand").f(ListChannelBansRequestFilterSensitiveLog,ListChannelBansResponseFilterSensitiveLog).ser(se_ListChannelBansCommand).de(de_ListChannelBansCommand).build()){}class ListChannelFlowsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelFlows",{}).n("ChimeSDKMessagingClient","ListChannelFlowsCommand").f(ListChannelFlowsRequestFilterSensitiveLog,ListChannelFlowsResponseFilterSensitiveLog).ser(se_ListChannelFlowsCommand).de(de_ListChannelFlowsCommand).build()){}class ListChannelMembershipsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelMemberships",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsCommand").f(ListChannelMembershipsRequestFilterSensitiveLog,ListChannelMembershipsResponseFilterSensitiveLog).ser(se_ListChannelMembershipsCommand).de(de_ListChannelMembershipsCommand).build()){}class ListChannelMembershipsForAppInstanceUserCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelMembershipsForAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsForAppInstanceUserCommand").f(ListChannelMembershipsForAppInstanceUserRequestFilterSensitiveLog,ListChannelMembershipsForAppInstanceUserResponseFilterSensitiveLog).ser(se_ListChannelMembershipsForAppInstanceUserCommand).de(de_ListChannelMembershipsForAppInstanceUserCommand).build()){}class ListChannelMessagesCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelMessages",{}).n("ChimeSDKMessagingClient","ListChannelMessagesCommand").f(ListChannelMessagesRequestFilterSensitiveLog,ListChannelMessagesResponseFilterSensitiveLog).ser(se_ListChannelMessagesCommand).de(de_ListChannelMessagesCommand).build()){}class ListChannelModeratorsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelModerators",{}).n("ChimeSDKMessagingClient","ListChannelModeratorsCommand").f(ListChannelModeratorsRequestFilterSensitiveLog,ListChannelModeratorsResponseFilterSensitiveLog).ser(se_ListChannelModeratorsCommand).de(de_ListChannelModeratorsCommand).build()){}class ListChannelsAssociatedWithChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelsAssociatedWithChannelFlow",{}).n("ChimeSDKMessagingClient","ListChannelsAssociatedWithChannelFlowCommand").f(ListChannelsAssociatedWithChannelFlowRequestFilterSensitiveLog,ListChannelsAssociatedWithChannelFlowResponseFilterSensitiveLog).ser(se_ListChannelsAssociatedWithChannelFlowCommand).de(de_ListChannelsAssociatedWithChannelFlowCommand).build()){}class ListChannelsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannels",{}).n("ChimeSDKMessagingClient","ListChannelsCommand").f(ListChannelsRequestFilterSensitiveLog,ListChannelsResponseFilterSensitiveLog).ser(se_ListChannelsCommand).de(de_ListChannelsCommand).build()){}class ListChannelsModeratedByAppInstanceUserCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListChannelsModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelsModeratedByAppInstanceUserCommand").f(ListChannelsModeratedByAppInstanceUserRequestFilterSensitiveLog,ListChannelsModeratedByAppInstanceUserResponseFilterSensitiveLog).ser(se_ListChannelsModeratedByAppInstanceUserCommand).de(de_ListChannelsModeratedByAppInstanceUserCommand).build()){}class ListSubChannelsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListSubChannels",{}).n("ChimeSDKMessagingClient","ListSubChannelsCommand").f(ListSubChannelsRequestFilterSensitiveLog,ListSubChannelsResponseFilterSensitiveLog).ser(se_ListSubChannelsCommand).de(de_ListSubChannelsCommand).build()){}class ListTagsForResourceCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","ListTagsForResource",{}).n("ChimeSDKMessagingClient","ListTagsForResourceCommand").f(void 0,ListTagsForResourceResponseFilterSensitiveLog).ser(se_ListTagsForResourceCommand).de(de_ListTagsForResourceCommand).build()){}class PutChannelExpirationSettingsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","PutChannelExpirationSettings",{}).n("ChimeSDKMessagingClient","PutChannelExpirationSettingsCommand").f(void 0,void 0).ser(se_PutChannelExpirationSettingsCommand).de(de_PutChannelExpirationSettingsCommand).build()){}class PutChannelMembershipPreferencesCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","PutChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","PutChannelMembershipPreferencesCommand").f(PutChannelMembershipPreferencesRequestFilterSensitiveLog,PutChannelMembershipPreferencesResponseFilterSensitiveLog).ser(se_PutChannelMembershipPreferencesCommand).de(de_PutChannelMembershipPreferencesCommand).build()){}class PutMessagingStreamingConfigurationsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","PutMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","PutMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(se_PutMessagingStreamingConfigurationsCommand).de(de_PutMessagingStreamingConfigurationsCommand).build()){}class RedactChannelMessageCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","RedactChannelMessage",{}).n("ChimeSDKMessagingClient","RedactChannelMessageCommand").f(void 0,void 0).ser(se_RedactChannelMessageCommand).de(de_RedactChannelMessageCommand).build()){}class SearchChannelsCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","SearchChannels",{}).n("ChimeSDKMessagingClient","SearchChannelsCommand").f(SearchChannelsRequestFilterSensitiveLog,SearchChannelsResponseFilterSensitiveLog).ser(se_SearchChannelsCommand).de(de_SearchChannelsCommand).build()){}class SendChannelMessageCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","SendChannelMessage",{}).n("ChimeSDKMessagingClient","SendChannelMessageCommand").f(SendChannelMessageRequestFilterSensitiveLog,void 0).ser(se_SendChannelMessageCommand).de(de_SendChannelMessageCommand).build()){}class TagResourceCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","TagResource",{}).n("ChimeSDKMessagingClient","TagResourceCommand").f(TagResourceRequestFilterSensitiveLog,void 0).ser(se_TagResourceCommand).de(de_TagResourceCommand).build()){}class UntagResourceCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","UntagResource",{}).n("ChimeSDKMessagingClient","UntagResourceCommand").f(UntagResourceRequestFilterSensitiveLog,void 0).ser(se_UntagResourceCommand).de(de_UntagResourceCommand).build()){}class UpdateChannelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","UpdateChannel",{}).n("ChimeSDKMessagingClient","UpdateChannelCommand").f(UpdateChannelRequestFilterSensitiveLog,void 0).ser(se_UpdateChannelCommand).de(de_UpdateChannelCommand).build()){}class UpdateChannelFlowCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","UpdateChannelFlow",{}).n("ChimeSDKMessagingClient","UpdateChannelFlowCommand").f(UpdateChannelFlowRequestFilterSensitiveLog,void 0).ser(se_UpdateChannelFlowCommand).de(de_UpdateChannelFlowCommand).build()){}class UpdateChannelMessageCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","UpdateChannelMessage",{}).n("ChimeSDKMessagingClient","UpdateChannelMessageCommand").f(UpdateChannelMessageRequestFilterSensitiveLog,void 0).ser(se_UpdateChannelMessageCommand).de(de_UpdateChannelMessageCommand).build()){}class UpdateChannelReadMarkerCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,i,n){return[getSerdePlugin(i,this.serialize,this.deserialize),getEndpointPlugin(i,e.getEndpointParameterInstructions())]})).s("ChimeMessagingService","UpdateChannelReadMarker",{}).n("ChimeSDKMessagingClient","UpdateChannelReadMarkerCommand").f(void 0,void 0).ser(se_UpdateChannelReadMarkerCommand).de(de_UpdateChannelReadMarkerCommand).build()){}const commands={AssociateChannelFlowCommand:AssociateChannelFlowCommand,BatchCreateChannelMembershipCommand:BatchCreateChannelMembershipCommand,ChannelFlowCallbackCommand:ChannelFlowCallbackCommand,CreateChannelCommand:CreateChannelCommand,CreateChannelBanCommand:CreateChannelBanCommand,CreateChannelFlowCommand:CreateChannelFlowCommand,CreateChannelMembershipCommand:CreateChannelMembershipCommand,CreateChannelModeratorCommand:CreateChannelModeratorCommand,DeleteChannelCommand:DeleteChannelCommand,DeleteChannelBanCommand:DeleteChannelBanCommand,DeleteChannelFlowCommand:DeleteChannelFlowCommand,DeleteChannelMembershipCommand:DeleteChannelMembershipCommand,DeleteChannelMessageCommand:DeleteChannelMessageCommand,DeleteChannelModeratorCommand:DeleteChannelModeratorCommand,DeleteMessagingStreamingConfigurationsCommand:DeleteMessagingStreamingConfigurationsCommand,DescribeChannelCommand:DescribeChannelCommand,DescribeChannelBanCommand:DescribeChannelBanCommand,DescribeChannelFlowCommand:DescribeChannelFlowCommand,DescribeChannelMembershipCommand:DescribeChannelMembershipCommand,DescribeChannelMembershipForAppInstanceUserCommand:DescribeChannelMembershipForAppInstanceUserCommand,DescribeChannelModeratedByAppInstanceUserCommand:DescribeChannelModeratedByAppInstanceUserCommand,DescribeChannelModeratorCommand:DescribeChannelModeratorCommand,DisassociateChannelFlowCommand:DisassociateChannelFlowCommand,GetChannelMembershipPreferencesCommand:GetChannelMembershipPreferencesCommand,GetChannelMessageCommand:GetChannelMessageCommand,GetChannelMessageStatusCommand:GetChannelMessageStatusCommand,GetMessagingSessionEndpointCommand:GetMessagingSessionEndpointCommand,GetMessagingStreamingConfigurationsCommand:GetMessagingStreamingConfigurationsCommand,ListChannelBansCommand:ListChannelBansCommand,ListChannelFlowsCommand:ListChannelFlowsCommand,ListChannelMembershipsCommand:ListChannelMembershipsCommand,ListChannelMembershipsForAppInstanceUserCommand:ListChannelMembershipsForAppInstanceUserCommand,ListChannelMessagesCommand:ListChannelMessagesCommand,ListChannelModeratorsCommand:ListChannelModeratorsCommand,ListChannelsCommand:ListChannelsCommand,ListChannelsAssociatedWithChannelFlowCommand:ListChannelsAssociatedWithChannelFlowCommand,ListChannelsModeratedByAppInstanceUserCommand:ListChannelsModeratedByAppInstanceUserCommand,ListSubChannelsCommand:ListSubChannelsCommand,ListTagsForResourceCommand:ListTagsForResourceCommand,PutChannelExpirationSettingsCommand:PutChannelExpirationSettingsCommand,PutChannelMembershipPreferencesCommand:PutChannelMembershipPreferencesCommand,PutMessagingStreamingConfigurationsCommand:PutMessagingStreamingConfigurationsCommand,RedactChannelMessageCommand:RedactChannelMessageCommand,SearchChannelsCommand:SearchChannelsCommand,SendChannelMessageCommand:SendChannelMessageCommand,TagResourceCommand:TagResourceCommand,UntagResourceCommand:UntagResourceCommand,UpdateChannelCommand:UpdateChannelCommand,UpdateChannelFlowCommand:UpdateChannelFlowCommand,UpdateChannelMessageCommand:UpdateChannelMessageCommand,UpdateChannelReadMarkerCommand:UpdateChannelReadMarkerCommand};class ChimeSDKMessaging extends ChimeSDKMessagingClient{}createAggregatedClient(commands,ChimeSDKMessaging);const paginateListChannelBans=createPaginator(ChimeSDKMessagingClient,ListChannelBansCommand,"NextToken","NextToken","MaxResults"),paginateListChannelFlows=createPaginator(ChimeSDKMessagingClient,ListChannelFlowsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMembershipsForAppInstanceUser=createPaginator(ChimeSDKMessagingClient,ListChannelMembershipsForAppInstanceUserCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMemberships=createPaginator(ChimeSDKMessagingClient,ListChannelMembershipsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMessages=createPaginator(ChimeSDKMessagingClient,ListChannelMessagesCommand,"NextToken","NextToken","MaxResults"),paginateListChannelModerators=createPaginator(ChimeSDKMessagingClient,ListChannelModeratorsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelsAssociatedWithChannelFlow=createPaginator(ChimeSDKMessagingClient,ListChannelsAssociatedWithChannelFlowCommand,"NextToken","NextToken","MaxResults"),paginateListChannelsModeratedByAppInstanceUser=createPaginator(ChimeSDKMessagingClient,ListChannelsModeratedByAppInstanceUserCommand,"NextToken","NextToken","MaxResults"),paginateListChannels=createPaginator(ChimeSDKMessagingClient,ListChannelsCommand,"NextToken","NextToken","MaxResults"),paginateListSubChannels=createPaginator(ChimeSDKMessagingClient,ListSubChannelsCommand,"NextToken","NextToken","MaxResults"),paginateSearchChannels=createPaginator(ChimeSDKMessagingClient,SearchChannelsCommand,"NextToken","NextToken","MaxResults");var distEs$1=Object.freeze({__proto__:null,$Command:Command,AllowNotifications:AllowNotifications,AssociateChannelFlowCommand:AssociateChannelFlowCommand,BadRequestException:BadRequestException,BatchChannelMembershipsFilterSensitiveLog:BatchChannelMembershipsFilterSensitiveLog,BatchCreateChannelMembershipCommand:BatchCreateChannelMembershipCommand,BatchCreateChannelMembershipResponseFilterSensitiveLog:BatchCreateChannelMembershipResponseFilterSensitiveLog,ChannelAssociatedWithFlowSummaryFilterSensitiveLog:ChannelAssociatedWithFlowSummaryFilterSensitiveLog,ChannelBanFilterSensitiveLog:ChannelBanFilterSensitiveLog,ChannelBanSummaryFilterSensitiveLog:ChannelBanSummaryFilterSensitiveLog,ChannelFilterSensitiveLog:ChannelFilterSensitiveLog,ChannelFlowCallbackCommand:ChannelFlowCallbackCommand,ChannelFlowCallbackRequestFilterSensitiveLog:ChannelFlowCallbackRequestFilterSensitiveLog,ChannelFlowFilterSensitiveLog:ChannelFlowFilterSensitiveLog,ChannelFlowSummaryFilterSensitiveLog:ChannelFlowSummaryFilterSensitiveLog,ChannelMembershipFilterSensitiveLog:ChannelMembershipFilterSensitiveLog,ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog:ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog,ChannelMembershipPreferencesFilterSensitiveLog:ChannelMembershipPreferencesFilterSensitiveLog,ChannelMembershipSummaryFilterSensitiveLog:ChannelMembershipSummaryFilterSensitiveLog,ChannelMembershipType:ChannelMembershipType,ChannelMessageCallbackFilterSensitiveLog:ChannelMessageCallbackFilterSensitiveLog,ChannelMessageFilterSensitiveLog:ChannelMessageFilterSensitiveLog,ChannelMessagePersistenceType:ChannelMessagePersistenceType,ChannelMessageStatus:ChannelMessageStatus,ChannelMessageSummaryFilterSensitiveLog:ChannelMessageSummaryFilterSensitiveLog,ChannelMessageType:ChannelMessageType,ChannelMode:ChannelMode,ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog:ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog,ChannelModeratorFilterSensitiveLog:ChannelModeratorFilterSensitiveLog,ChannelModeratorSummaryFilterSensitiveLog:ChannelModeratorSummaryFilterSensitiveLog,ChannelPrivacy:ChannelPrivacy,ChannelSummaryFilterSensitiveLog:ChannelSummaryFilterSensitiveLog,ChimeSDKMessaging:ChimeSDKMessaging,ChimeSDKMessagingClient:ChimeSDKMessagingClient,ChimeSDKMessagingServiceException:ChimeSDKMessagingServiceException,ConflictException:ConflictException,CreateChannelBanCommand:CreateChannelBanCommand,CreateChannelBanResponseFilterSensitiveLog:CreateChannelBanResponseFilterSensitiveLog,CreateChannelCommand:CreateChannelCommand,CreateChannelFlowCommand:CreateChannelFlowCommand,CreateChannelFlowRequestFilterSensitiveLog:CreateChannelFlowRequestFilterSensitiveLog,CreateChannelMembershipCommand:CreateChannelMembershipCommand,CreateChannelMembershipResponseFilterSensitiveLog:CreateChannelMembershipResponseFilterSensitiveLog,CreateChannelModeratorCommand:CreateChannelModeratorCommand,CreateChannelModeratorResponseFilterSensitiveLog:CreateChannelModeratorResponseFilterSensitiveLog,CreateChannelRequestFilterSensitiveLog:CreateChannelRequestFilterSensitiveLog,DeleteChannelBanCommand:DeleteChannelBanCommand,DeleteChannelCommand:DeleteChannelCommand,DeleteChannelFlowCommand:DeleteChannelFlowCommand,DeleteChannelMembershipCommand:DeleteChannelMembershipCommand,DeleteChannelMessageCommand:DeleteChannelMessageCommand,DeleteChannelModeratorCommand:DeleteChannelModeratorCommand,DeleteMessagingStreamingConfigurationsCommand:DeleteMessagingStreamingConfigurationsCommand,DescribeChannelBanCommand:DescribeChannelBanCommand,DescribeChannelBanResponseFilterSensitiveLog:DescribeChannelBanResponseFilterSensitiveLog,DescribeChannelCommand:DescribeChannelCommand,DescribeChannelFlowCommand:DescribeChannelFlowCommand,DescribeChannelFlowResponseFilterSensitiveLog:DescribeChannelFlowResponseFilterSensitiveLog,DescribeChannelMembershipCommand:DescribeChannelMembershipCommand,DescribeChannelMembershipForAppInstanceUserCommand:DescribeChannelMembershipForAppInstanceUserCommand,DescribeChannelMembershipForAppInstanceUserResponseFilterSensitiveLog:DescribeChannelMembershipForAppInstanceUserResponseFilterSensitiveLog,DescribeChannelMembershipResponseFilterSensitiveLog:DescribeChannelMembershipResponseFilterSensitiveLog,DescribeChannelModeratedByAppInstanceUserCommand:DescribeChannelModeratedByAppInstanceUserCommand,DescribeChannelModeratedByAppInstanceUserResponseFilterSensitiveLog:DescribeChannelModeratedByAppInstanceUserResponseFilterSensitiveLog,DescribeChannelModeratorCommand:DescribeChannelModeratorCommand,DescribeChannelModeratorResponseFilterSensitiveLog:DescribeChannelModeratorResponseFilterSensitiveLog,DescribeChannelResponseFilterSensitiveLog:DescribeChannelResponseFilterSensitiveLog,DisassociateChannelFlowCommand:DisassociateChannelFlowCommand,ErrorCode:ErrorCode,ExpirationCriterion:ExpirationCriterion,FallbackAction:FallbackAction,ForbiddenException:ForbiddenException,GetChannelMembershipPreferencesCommand:GetChannelMembershipPreferencesCommand,GetChannelMembershipPreferencesResponseFilterSensitiveLog:GetChannelMembershipPreferencesResponseFilterSensitiveLog,GetChannelMessageCommand:GetChannelMessageCommand,GetChannelMessageResponseFilterSensitiveLog:GetChannelMessageResponseFilterSensitiveLog,GetChannelMessageStatusCommand:GetChannelMessageStatusCommand,GetMessagingSessionEndpointCommand:GetMessagingSessionEndpointCommand,GetMessagingStreamingConfigurationsCommand:GetMessagingStreamingConfigurationsCommand,IdentityFilterSensitiveLog:IdentityFilterSensitiveLog,InvocationType:InvocationType,ListChannelBansCommand:ListChannelBansCommand,ListChannelBansRequestFilterSensitiveLog:ListChannelBansRequestFilterSensitiveLog,ListChannelBansResponseFilterSensitiveLog:ListChannelBansResponseFilterSensitiveLog,ListChannelFlowsCommand:ListChannelFlowsCommand,ListChannelFlowsRequestFilterSensitiveLog:ListChannelFlowsRequestFilterSensitiveLog,ListChannelFlowsResponseFilterSensitiveLog:ListChannelFlowsResponseFilterSensitiveLog,ListChannelMembershipsCommand:ListChannelMembershipsCommand,ListChannelMembershipsForAppInstanceUserCommand:ListChannelMembershipsForAppInstanceUserCommand,ListChannelMembershipsForAppInstanceUserRequestFilterSensitiveLog:ListChannelMembershipsForAppInstanceUserRequestFilterSensitiveLog,ListChannelMembershipsForAppInstanceUserResponseFilterSensitiveLog:ListChannelMembershipsForAppInstanceUserResponseFilterSensitiveLog,ListChannelMembershipsRequestFilterSensitiveLog:ListChannelMembershipsRequestFilterSensitiveLog,ListChannelMembershipsResponseFilterSensitiveLog:ListChannelMembershipsResponseFilterSensitiveLog,ListChannelMessagesCommand:ListChannelMessagesCommand,ListChannelMessagesRequestFilterSensitiveLog:ListChannelMessagesRequestFilterSensitiveLog,ListChannelMessagesResponseFilterSensitiveLog:ListChannelMessagesResponseFilterSensitiveLog,ListChannelModeratorsCommand:ListChannelModeratorsCommand,ListChannelModeratorsRequestFilterSensitiveLog:ListChannelModeratorsRequestFilterSensitiveLog,ListChannelModeratorsResponseFilterSensitiveLog:ListChannelModeratorsResponseFilterSensitiveLog,ListChannelsAssociatedWithChannelFlowCommand:ListChannelsAssociatedWithChannelFlowCommand,ListChannelsAssociatedWithChannelFlowRequestFilterSensitiveLog:ListChannelsAssociatedWithChannelFlowRequestFilterSensitiveLog,ListChannelsAssociatedWithChannelFlowResponseFilterSensitiveLog:ListChannelsAssociatedWithChannelFlowResponseFilterSensitiveLog,ListChannelsCommand:ListChannelsCommand,ListChannelsModeratedByAppInstanceUserCommand:ListChannelsModeratedByAppInstanceUserCommand,ListChannelsModeratedByAppInstanceUserRequestFilterSensitiveLog:ListChannelsModeratedByAppInstanceUserRequestFilterSensitiveLog,ListChannelsModeratedByAppInstanceUserResponseFilterSensitiveLog:ListChannelsModeratedByAppInstanceUserResponseFilterSensitiveLog,ListChannelsRequestFilterSensitiveLog:ListChannelsRequestFilterSensitiveLog,ListChannelsResponseFilterSensitiveLog:ListChannelsResponseFilterSensitiveLog,ListSubChannelsCommand:ListSubChannelsCommand,ListSubChannelsRequestFilterSensitiveLog:ListSubChannelsRequestFilterSensitiveLog,ListSubChannelsResponseFilterSensitiveLog:ListSubChannelsResponseFilterSensitiveLog,ListTagsForResourceCommand:ListTagsForResourceCommand,ListTagsForResourceResponseFilterSensitiveLog:ListTagsForResourceResponseFilterSensitiveLog,MessageAttributeValueFilterSensitiveLog:MessageAttributeValueFilterSensitiveLog,MessagingDataType:MessagingDataType,NotFoundException:NotFoundException,ProcessorFilterSensitiveLog:ProcessorFilterSensitiveLog,PushNotificationConfigurationFilterSensitiveLog:PushNotificationConfigurationFilterSensitiveLog,PushNotificationPreferencesFilterSensitiveLog:PushNotificationPreferencesFilterSensitiveLog,PushNotificationType:PushNotificationType,PutChannelExpirationSettingsCommand:PutChannelExpirationSettingsCommand,PutChannelMembershipPreferencesCommand:PutChannelMembershipPreferencesCommand,PutChannelMembershipPreferencesRequestFilterSensitiveLog:PutChannelMembershipPreferencesRequestFilterSensitiveLog,PutChannelMembershipPreferencesResponseFilterSensitiveLog:PutChannelMembershipPreferencesResponseFilterSensitiveLog,PutMessagingStreamingConfigurationsCommand:PutMessagingStreamingConfigurationsCommand,RedactChannelMessageCommand:RedactChannelMessageCommand,ResourceLimitExceededException:ResourceLimitExceededException,SearchChannelsCommand:SearchChannelsCommand,SearchChannelsRequestFilterSensitiveLog:SearchChannelsRequestFilterSensitiveLog,SearchChannelsResponseFilterSensitiveLog:SearchChannelsResponseFilterSensitiveLog,SearchFieldKey:SearchFieldKey,SearchFieldOperator:SearchFieldOperator,SendChannelMessageCommand:SendChannelMessageCommand,SendChannelMessageRequestFilterSensitiveLog:SendChannelMessageRequestFilterSensitiveLog,ServiceFailureException:ServiceFailureException,ServiceUnavailableException:ServiceUnavailableException,SortOrder:SortOrder,TagFilterSensitiveLog:TagFilterSensitiveLog,TagResourceCommand:TagResourceCommand,TagResourceRequestFilterSensitiveLog:TagResourceRequestFilterSensitiveLog,ThrottledClientException:ThrottledClientException,UnauthorizedClientException:UnauthorizedClientException,UntagResourceCommand:UntagResourceCommand,UntagResourceRequestFilterSensitiveLog:UntagResourceRequestFilterSensitiveLog,UpdateChannelCommand:UpdateChannelCommand,UpdateChannelFlowCommand:UpdateChannelFlowCommand,UpdateChannelFlowRequestFilterSensitiveLog:UpdateChannelFlowRequestFilterSensitiveLog,UpdateChannelMessageCommand:UpdateChannelMessageCommand,UpdateChannelMessageRequestFilterSensitiveLog:UpdateChannelMessageRequestFilterSensitiveLog,UpdateChannelReadMarkerCommand:UpdateChannelReadMarkerCommand,UpdateChannelRequestFilterSensitiveLog:UpdateChannelRequestFilterSensitiveLog,__Client:Client,paginateListChannelBans:paginateListChannelBans,paginateListChannelFlows:paginateListChannelFlows,paginateListChannelMemberships:paginateListChannelMemberships,paginateListChannelMembershipsForAppInstanceUser:paginateListChannelMembershipsForAppInstanceUser,paginateListChannelMessages:paginateListChannelMessages,paginateListChannelModerators:paginateListChannelModerators,paginateListChannels:paginateListChannels,paginateListChannelsAssociatedWithChannelFlow:paginateListChannelsAssociatedWithChannelFlow,paginateListChannelsModeratedByAppInstanceUser:paginateListChannelsModeratedByAppInstanceUser,paginateListSubChannels:paginateListSubChannels,paginateSearchChannels:paginateSearchChannels}),require$$0=getAugmentedNamespace(distEs$1),Message$1={};Object.defineProperty(Message$1,"__esModule",{value:!0});class Message{constructor(e,t,i){this.type=e,this.headers=t,this.payload=i}}Message$1.default=Message;var DefaultSigV4$1={},build$1={},jsSha256={},constants={},hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,Object.defineProperty(constants,"__esModule",{value:!0}),constants.MAX_HASHABLE_LENGTH=constants.INIT=constants.KEY=constants.DIGEST_LENGTH=constants.BLOCK_SIZE=void 0,constants.BLOCK_SIZE=64,constants.DIGEST_LENGTH=32,constants.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),constants.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],constants.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),constants}var RawSha256={},hasRequiredRawSha256;function requireRawSha256(){if(hasRequiredRawSha256)return RawSha256;hasRequiredRawSha256=1,Object.defineProperty(RawSha256,"__esModule",{value:!0}),RawSha256.RawSha256=void 0;var e=requireConstants(),t=function(){function t(){this.state=Int32Array.from(e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var i=0,n=t.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=t[i++],n--,this.bufferLength===e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var t=8*this.bytesHashed,i=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(i.setUint8(this.bufferLength++,128),n%e.BLOCK_SIZE>=e.BLOCK_SIZE-8){for(var r=this.bufferLength;r<e.BLOCK_SIZE;r++)i.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<e.BLOCK_SIZE-8;r++)i.setUint8(r,0);i.setUint32(e.BLOCK_SIZE-8,Math.floor(t/4294967296),!0),i.setUint32(e.BLOCK_SIZE-4,t),this.hashBuffer(),this.finished=!0}var o=new Uint8Array(e.DIGEST_LENGTH);for(r=0;r<8;r++)o[4*r]=this.state[r]>>>24&255,o[4*r+1]=this.state[r]>>>16&255,o[4*r+2]=this.state[r]>>>8&255,o[4*r+3]=this.state[r]>>>0&255;return o},t.prototype.hashBuffer=function(){for(var t=this.buffer,i=this.state,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],d=i[5],l=i[6],c=i[7],u=0;u<e.BLOCK_SIZE;u++){if(u<16)this.temp[u]=(255&t[4*u])<<24|(255&t[4*u+1])<<16|(255&t[4*u+2])<<8|255&t[4*u+3];else{var h=this.temp[u-2],p=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,m=((h=this.temp[u-15])>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[u]=(p+this.temp[u-7]|0)+(m+this.temp[u-16]|0)}var f=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&d^~s&l)|0)+(c+(e.KEY[u]+this.temp[u]|0)|0)|0,g=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&o^r&o)|0;c=l,l=d,d=s,s=a+f|0,a=o,o=r,r=n,n=f+g|0}i[0]+=n,i[1]+=r,i[2]+=o,i[3]+=a,i[4]+=s,i[5]+=d,i[6]+=l,i[7]+=c},t}();return RawSha256.RawSha256=t,RawSha256}var build={},convertToBuffer={},hasRequiredConvertToBuffer;function requireConvertToBuffer(){if(hasRequiredConvertToBuffer)return convertToBuffer;hasRequiredConvertToBuffer=1,Object.defineProperty(convertToBuffer,"__esModule",{value:!0}),convertToBuffer.convertToBuffer=void 0;var e=require$$0$1,t="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e.fromUtf8;return convertToBuffer.convertToBuffer=function(e){return e instanceof Uint8Array?e:"string"==typeof e?t(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)},convertToBuffer}var isEmptyData={},hasRequiredIsEmptyData;function requireIsEmptyData(){if(hasRequiredIsEmptyData)return isEmptyData;return hasRequiredIsEmptyData=1,Object.defineProperty(isEmptyData,"__esModule",{value:!0}),isEmptyData.isEmptyData=void 0,isEmptyData.isEmptyData=function(e){return"string"==typeof e?0===e.length:0===e.byteLength},isEmptyData}var numToUint8={},hasRequiredNumToUint8;function requireNumToUint8(){if(hasRequiredNumToUint8)return numToUint8;return hasRequiredNumToUint8=1,Object.defineProperty(numToUint8,"__esModule",{value:!0}),numToUint8.numToUint8=void 0,numToUint8.numToUint8=function(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])},numToUint8}var uint32ArrayFrom={},hasRequiredUint32ArrayFrom,hasRequiredBuild$1,hasRequiredJsSha256;function requireUint32ArrayFrom(){if(hasRequiredUint32ArrayFrom)return uint32ArrayFrom;return hasRequiredUint32ArrayFrom=1,Object.defineProperty(uint32ArrayFrom,"__esModule",{value:!0}),uint32ArrayFrom.uint32ArrayFrom=void 0,uint32ArrayFrom.uint32ArrayFrom=function(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),i=0;i<e.length;)t[i]=e[i],i+=1;return t}return Uint32Array.from(e)},uint32ArrayFrom}function requireBuild$1(){return hasRequiredBuild$1||(hasRequiredBuild$1=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=requireConvertToBuffer();Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var i=requireIsEmptyData();Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return i.isEmptyData}});var n=requireNumToUint8();Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var r=requireUint32ArrayFrom();Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return r.uint32ArrayFrom}})}(build)),build}function requireJsSha256(){if(hasRequiredJsSha256)return jsSha256;hasRequiredJsSha256=1,Object.defineProperty(jsSha256,"__esModule",{value:!0}),jsSha256.Sha256=void 0;var e=require$$0$2,t=requireConstants(),i=requireRawSha256(),n=requireBuild$1(),r=function(){function r(e){if(this.hash=new i.RawSha256,e){this.outer=new i.RawSha256;var r=function(e){var r=(0,n.convertToBuffer)(e);if(r.byteLength>t.BLOCK_SIZE){var o=new i.RawSha256;o.update(r),r=o.digest()}var a=new Uint8Array(t.BLOCK_SIZE);return a.set(r),a}(e),o=new Uint8Array(t.BLOCK_SIZE);o.set(r);for(var a=0;a<t.BLOCK_SIZE;a++)r[a]^=54,o[a]^=92;this.hash.update(r),this.outer.update(o);for(a=0;a<r.byteLength;a++)r[a]=0}}return r.prototype.update=function(e){if(!(0,n.isEmptyData)(e)&&!this.error)try{this.hash.update((0,n.convertToBuffer)(e))}catch(e){this.error=e}},r.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},r.prototype.digest=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.digestSync()]}))}))},r}();return jsSha256.Sha256=r,jsSha256}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),require$$0$2.__exportStar(requireJsSha256(),e)}(build$1);const SHORT_TO_HEX={},HEX_TO_SHORT={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),SHORT_TO_HEX[e]=t,HEX_TO_SHORT[t]=e}function fromHex(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2){const n=e.slice(i,i+2).toLowerCase();if(!(n in HEX_TO_SHORT))throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`);t[i/2]=HEX_TO_SHORT[n]}return t}function toHex(e){let t="";for(let i=0;i<e.byteLength;i++)t+=SHORT_TO_HEX[e[i]];return t}var distEs=Object.freeze({__proto__:null,fromHex:fromHex,toHex:toHex}),require$$1=getAugmentedNamespace(distEs),__awaiter$d=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$e=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultSigV4$1,"__esModule",{value:!0});const sha256_js_1=build$1,util_hex_encoding_1=require$$1,Versioning_1$2=__importDefault$e(Versioning$1);class DefaultSigV4{constructor(e){this.chimeClient=e}makeTwoDigits(e){return e>9?e.toString():"0"+e.toString()}hmac(e,t){const i=new sha256_js_1.Sha256(t);return i.update(e),i.digest()}getDateTimeString(){const e=new Date;return e.getUTCFullYear()+this.makeTwoDigits(e.getUTCMonth()+1)+this.makeTwoDigits(e.getUTCDate())+"T"+this.makeTwoDigits(e.getUTCHours())+this.makeTwoDigits(e.getUTCMinutes())+this.makeTwoDigits(e.getUTCSeconds())+"Z"}getDateString(e){return e.substring(0,e.indexOf("T"))}getSignatureKey(e,t,i,n){return __awaiter$d(this,void 0,void 0,(function*(){const r=yield this.hmac(t,"AWS4"+e),o=yield this.hmac(i,r),a=yield this.hmac(n,o);return yield this.hmac("aws4_request",a)}))}signURL(e,t,i,n,r,o,a){return __awaiter$d(this,void 0,void 0,(function*(){const s=this.getDateTimeString(),d=this.getDateString(s);let l="";l=this.chimeClient.config.region instanceof Function?yield this.chimeClient.config.region():this.chimeClient.config.region;const c="host:"+n.toLowerCase()+"\n",u=d+"/"+l+"/"+i+"/aws4_request";let h;h=this.chimeClient.config.credentials instanceof Function?yield this.chimeClient.config.credentials():this.chimeClient.config.credentials;let p=new Map;p.set("X-Amz-Algorithm",["AWS4-HMAC-SHA256"]),p.set("X-Amz-Credential",[encodeURIComponent(h.accessKeyId+"/"+u)]),p.set("X-Amz-Date",[s]),p.set("X-Amz-Expires",["10"]),p.set("X-Amz-SignedHeaders",["host"]),h.sessionToken&&p.set("X-Amz-Security-Token",[encodeURIComponent(h.sessionToken)]),p.set(Versioning_1$2.default.X_AMZN_VERSION,[encodeURIComponent(Versioning_1$2.default.sdkVersion)]),p.set(Versioning_1$2.default.X_AMZN_USER_AGENT,[encodeURIComponent(Versioning_1$2.default.sdkUserAgentLowResolution)]),null==a||a.forEach(((e,t)=>{const i=encodeURIComponent(t);e.sort().forEach((e=>{p.has(i)||p.set(i,[]),p.get(i).push(encodeURIComponent(e))}))}));let m="";p=new Map([...p.entries()].sort()),p.forEach(((e,t)=>{e.forEach((e=>{m.length&&(m+="&"),m+=t+"="+e}))}));const f=e+"\n"+r+"\n"+m+"\n"+c+"\nhost\n"+util_hex_encoding_1.toHex(yield this.hmac(o)),g=util_hex_encoding_1.toHex(yield this.hmac(f)),S="AWS4-HMAC-SHA256\n"+s+"\n"+d+"/"+l+"/"+i+"/aws4_request\n"+g,v=yield this.getSignatureKey(h.secretAccessKey,d,l,i),b=util_hex_encoding_1.toHex(yield this.hmac(S,v));return t+"://"+n+r+"?"+(m+"&X-Amz-Signature="+b)}))}}DefaultSigV4$1.default=DefaultSigV4;var PrefetchOn$1={},PrefetchOn;Object.defineProperty(PrefetchOn$1,"__esModule",{value:!0}),function(e){e.Connect="connect"}(PrefetchOn||(PrefetchOn={})),PrefetchOn$1.default=PrefetchOn;var __awaiter$c=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$d=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DefaultMessagingSession$1,"__esModule",{value:!0});const client_chime_sdk_messaging_1=require$$0,FullJitterBackoff_1$2=__importDefault$d(FullJitterBackoff$1),CSPMonitor_1=__importDefault$d(CSPMonitor$1),Message_1=__importDefault$d(Message$1),DefaultReconnectController_1=__importDefault$d(DefaultReconnectController$1),AsyncScheduler_1=__importDefault$d(AsyncScheduler$1),DefaultSigV4_1=__importDefault$d(DefaultSigV4$1),DefaultWebSocketAdapter_1=__importDefault$d(DefaultWebSocketAdapter$1),WebSocketReadyState_1=__importDefault$d(WebSocketReadyState),PrefetchOn_1=__importDefault$d(PrefetchOn$1);class DefaultMessagingSession{constructor(e,t,i,n,r){this.configuration=e,this.logger=t,this.webSocket=i,this.reconnectController=n,this.sigV4=r,this.observerQueue=new Set,this.webSocket||(this.webSocket=new DefaultWebSocketAdapter_1.default(this.logger)),this.reconnectController||(this.reconnectController=new DefaultReconnectController_1.default(e.reconnectTimeoutMs,new FullJitterBackoff_1$2.default(e.reconnectFixedWaitMs,e.reconnectShortBackoffMs,e.reconnectLongBackoffMs))),this.sigV4||(this.sigV4=new DefaultSigV4_1.default(this.configuration.chimeClient)),CSPMonitor_1.default.addLogger(this.logger),CSPMonitor_1.default.register(),this.preBootstrapMessages=[]}addObserver(e){this.logger.info("adding messaging observer"),this.observerQueue.add(e)}removeObserver(e){this.logger.info("removing messaging observer"),this.observerQueue.delete(e)}start(){return __awaiter$c(this,void 0,void 0,(function*(){this.isClosed()?yield this.startConnecting(!1):this.logger.info("messaging session already started")}))}stop(){this.isClosed()?this.logger.info("no existing messaging session needs closing"):(this.isClosing=!0,this.webSocket.close(),CSPMonitor_1.default.removeLogger(this.logger))}forEachObserver(e){for(const t of this.observerQueue)AsyncScheduler_1.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}setUpEventListeners(){this.webSocket.addEventListener("open",(()=>{this.openEventHandler()})),this.webSocket.addEventListener("message",(e=>{this.receiveMessageHandler(e.data)})),this.webSocket.addEventListener("close",(e=>{this.closeEventHandler(e)})),this.webSocket.addEventListener("error",(()=>{this.logger.error("WebSocket error")}))}startConnecting(e){return __awaiter$c(this,void 0,void 0,(function*(){return yield this.startConnectingInternal(e),yield new Promise(((e,t)=>{this.bootstrapResolved=e,this.bootstrapRejected=t}))}))}startConnectingInternal(e){var t;return __awaiter$c(this,void 0,void 0,(function*(){let i=this.configuration.endpointUrl;if(e||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),e||void 0===i)try{if(this.configuration.chimeClient.getMessagingSessionEndpoint instanceof Function){const e=yield this.configuration.chimeClient.getMessagingSessionEndpoint();if(null===(t=e.Endpoint)||void 0===t?void 0:t.Url)i=e.Endpoint.Url;else{i=(yield this.configuration.chimeClient.getMessagingSessionEndpoint().promise()).Endpoint.Url}}else i=(yield this.configuration.chimeClient.send(new client_chime_sdk_messaging_1.GetMessagingSessionEndpointCommand({}))).Endpoint.Url;this.logger.debug(`Messaging endpoint resolved to: ${i}`)}catch(e){this.logger.error(`Messaging Session failed to resolve endpoint: ${e}`);const t=new CloseEvent("close",{wasClean:!1,code:4999,reason:"Failed to get messaging session endpoint URL",bubbles:!1});return void this.closeEventHandler(t)}const n=yield this.prepareWebSocketUrl(i);this.logger.info(`opening connection to ${n}`),e||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),this.webSocket.create(n,[],!0),this.forEachObserver((t=>{t.messagingSessionDidStartConnecting&&t.messagingSessionDidStartConnecting(e)})),this.setUpEventListeners()}))}prepareWebSocketUrl(e){return __awaiter$c(this,void 0,void 0,(function*(){const t=new Map;return t.set("userArn",[this.configuration.userArn]),t.set("sessionId",[this.configuration.messagingSessionId]),this.configuration.prefetchOn===PrefetchOn_1.default.Connect&&t.set("prefetch-on",[PrefetchOn_1.default.Connect]),this.configuration.prefetchSortBy&&t.set("prefetch-sort-by",[this.configuration.prefetchSortBy]),yield this.sigV4.signURL("GET","wss","chime",e,"/connect","",t)}))}isClosed(){return this.webSocket.readyState()===WebSocketReadyState_1.default.None||this.webSocket.readyState()===WebSocketReadyState_1.default.Closed}openEventHandler(){this.reconnectController.reset(),this.isSessionEstablished=!1}receiveMessageHandler(e){try{const t=JSON.parse(e),i=t.Headers["x-amz-chime-event-type"],n=new Message_1.default(i,t.Headers,t.Payload||null);if(this.isSessionEstablished||"SESSION_ESTABLISHED"!==i){if(!this.isSessionEstablished)return void this.preBootstrapMessages.push(n)}else{this.forEachObserver((e=>{e.messagingSessionDidStart&&e.messagingSessionDidStart()})),this.bootstrapResolved(),this.isSessionEstablished=!0;const e=this.preBootstrapMessages.length;for(let t=0;t<e;t++){const e=this.preBootstrapMessages.shift();this.forEachObserver((t=>{this.sendMessageToObserver(t,e)}))}}this.forEachObserver((e=>{this.sendMessageToObserver(e,n)}))}catch(e){this.logger.error(`Messaging parsing failed: ${e}`)}}sendMessageToObserver(e,t){e.messagingSessionDidReceiveMessage&&e.messagingSessionDidReceiveMessage(t)}retryConnection(){return this.reconnectController.retryWithBackoff((()=>__awaiter$c(this,void 0,void 0,(function*(){yield this.startConnecting(!0)}))),null)}closeEventHandler(e){this.logger.info(`WebSocket close: ${e.code} ${e.reason}`),4999!==e.code&&this.webSocket.destroy(),!this.isClosing&&this.canReconnect(e.code)&&this.retryConnection()||(this.isClosing=!1,this.isSessionEstablished?this.forEachObserver((t=>{t.messagingSessionDidStop&&t.messagingSessionDidStop(e)})):this.bootstrapRejected(e))}canReconnect(e){return 1001===e||1006===e||e>=1011&&e<=1014||e>4e3&&4002!==e&&4003!==e&&4401!==e}}DefaultMessagingSession$1.default=DefaultMessagingSession;var FullJitterBackoffFactory$1={},FullJitterLimitedBackoff$1={},__importDefault$c=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(FullJitterLimitedBackoff$1,"__esModule",{value:!0});const FullJitterBackoff_1$1=__importDefault$c(FullJitterBackoff$1);class FullJitterLimitedBackoff extends FullJitterBackoff_1$1.default{constructor(e,t,i,n){super(e,t,i),this.limit=n,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}}FullJitterLimitedBackoff$1.default=FullJitterLimitedBackoff;var __importDefault$b=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(FullJitterBackoffFactory$1,"__esModule",{value:!0});const FullJitterBackoff_1=__importDefault$b(FullJitterBackoff$1),FullJitterLimitedBackoff_1=__importDefault$b(FullJitterLimitedBackoff$1);class FullJitterBackoffFactory{constructor(e,t,i){this.fixedWaitMs=e,this.shortBackoffMs=t,this.longBackoffMs=i}create(){return new FullJitterBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit(e){return new FullJitterLimitedBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,e)}}FullJitterBackoffFactory$1.default=FullJitterBackoffFactory;var Log$1={};Object.defineProperty(Log$1,"__esModule",{value:!0});class Log{constructor(e,t,i,n){this.sequenceNumber=e,this.message=t,this.timestampMs=i,this.logLevel=n}}Log$1.default=Log;var MessagingSessionConfiguration$1={};Object.defineProperty(MessagingSessionConfiguration$1,"__esModule",{value:!0});class MessagingSessionConfiguration{constructor(e,t,i,n){this.userArn=e,this.messagingSessionId=t,this.endpointUrl=i,this.chimeClient=n,this.reconnectTimeoutMs=1e4,this.reconnectFixedWaitMs=0,this.reconnectShortBackoffMs=1e3,this.reconnectLongBackoffMs=5e3,this.prefetchOn=void 0,this.prefetchSortBy=void 0,this.messagingSessionId||(this.messagingSessionId=this.generateSessionId())}generateSessionId(){const e=new Uint32Array(1);return window.crypto.getRandomValues(e)[0].toString()}}MessagingSessionConfiguration$1.default=MessagingSessionConfiguration;var MultiLogger$1={},__importDefault$a=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(MultiLogger$1,"__esModule",{value:!0});const LogLevel_1$3=__importDefault$a(LogLevel);class MultiLogger{constructor(...e){this._loggers=e}info(e){for(const t of this._loggers)t.info(e)}warn(e){for(const t of this._loggers)t.warn(e)}error(e){for(const t of this._loggers)t.error(e)}debug(e){let t,i;i="string"==typeof e?e:e?()=>(t||(t=e()),t):""+e;for(const e of this._loggers)e.debug(i)}setLogLevel(e){for(const t of this._loggers)t.setLogLevel(e)}getLogLevel(){for(const e of this._loggers)return e.getLogLevel();return LogLevel_1$3.default.OFF}}MultiLogger$1.default=MultiLogger;var NoOpAudioVideoController={},NoOpDebugLogger$1={},NoOpLogger$1={},__importDefault$9=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoOpLogger$1,"__esModule",{value:!0});const LogLevel_1$2=__importDefault$9(LogLevel);class NoOpLogger{constructor(e=LogLevel_1$2.default.OFF){this.level=e}info(e){}warn(e){}error(e){}debug(e){LogLevel_1$2.default.DEBUG<this.level||"string"!=typeof e&&e()}setLogLevel(e){this.level=e}getLogLevel(){return this.level}}NoOpLogger$1.default=NoOpLogger;var __importDefault$8=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoOpDebugLogger$1,"__esModule",{value:!0});const LogLevel_1$1=__importDefault$8(LogLevel),NoOpLogger_1$1=__importDefault$8(NoOpLogger$1);class NoOpDebugLogger extends NoOpLogger_1$1.default{constructor(){super(LogLevel_1$1.default.DEBUG)}}NoOpDebugLogger$1.default=NoOpDebugLogger;var NoOpMediaStreamBroker$1={},hasRequiredNoOpAudioVideoController;Object.defineProperty(NoOpMediaStreamBroker$1,"__esModule",{value:!0});class NoOpMediaStreamBroker{acquireAudioInputStream(){return Promise.reject()}acquireVideoInputStream(){return Promise.reject()}acquireDisplayInputStream(e){return Promise.reject()}muteLocalAudioInputStream(){}unmuteLocalAudioInputStream(){}addMediaStreamBrokerObserver(e){}removeMediaStreamBrokerObserver(e){}}function requireNoOpAudioVideoController(){if(hasRequiredNoOpAudioVideoController)return NoOpAudioVideoController;hasRequiredNoOpAudioVideoController=1;var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoOpAudioVideoController,"__esModule",{value:!0});const t=e(FullJitterBackoff$1),i=e(DefaultEventController$1),n=e(NoOpDebugLogger$1),r=e(NoOpMediaStreamBroker$1),o=e(MeetingSessionConfiguration$1),a=e(MeetingSessionCredentials$1),s=e(MeetingSessionStatus$1),d=e(MeetingSessionStatusCode),l=e(MeetingSessionURLs$1),c=e(DefaultReconnectController$1),u=e(DefaultWebSocketAdapter$1),h=e(requireDefaultAudioVideoController());let p=class extends h.default{constructor(e){const s=new o.default;s.meetingId="",s.externalMeetingId="",s.credentials=new a.default,s.credentials.attendeeId="",s.credentials.joinToken="",s.urls=new l.default,s.urls.turnControlURL="",s.urls.audioHostURL="",s.urls.signalingURL="wss://localhost/";const d=new n.default;super(e||s,d,new u.default(new n.default),new r.default,new c.default(0,new t.default(0,0,0)),new i.default(e||s,d))}setAudioProfile(e){}start(){}stop(){}promoteToPrimaryMeeting(e){return Promise.resolve(new s.default(d.default.OK))}demoteFromPrimaryMeeting(){}};return NoOpAudioVideoController.default=p,NoOpAudioVideoController}NoOpMediaStreamBroker$1.default=NoOpMediaStreamBroker;var NoOpDeviceController$1={},__awaiter$b=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$7=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoOpDeviceController$1,"__esModule",{value:!0}),NoOpDeviceController$1.NoOpDeviceControllerWithEventController=void 0;const NoOpMediaStreamBroker_1=__importDefault$7(NoOpMediaStreamBroker$1),VideoQualitySettings_1=__importDefault$7(VideoQualitySettings$1);class NoOpDeviceController extends NoOpMediaStreamBroker_1.default{constructor(e){super(),this.destroyed=!1}destroy(){return __awaiter$b(this,void 0,void 0,(function*(){this.destroyed=!0}))}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}startAudioInput(e){return Promise.reject()}stopAudioInput(){return Promise.resolve()}startVideoInput(e){return Promise.reject()}stopVideoInput(){return Promise.resolve()}chooseAudioOutput(e){return Promise.reject()}addDeviceChangeObserver(e){}removeDeviceChangeObserver(e){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput(e){}stopVideoPreviewForVideoInput(e){}setDeviceLabelTrigger(e){}mixIntoAudioInput(e){return null}chooseVideoInputQuality(e,t,i){}getVideoInputQualitySettings(){return VideoQualitySettings_1.default.VideoDisabled}}NoOpDeviceController$1.default=NoOpDeviceController;class NoOpDeviceControllerWithEventController extends NoOpDeviceController{constructor(e){super(),this.eventController=e}}NoOpDeviceController$1.NoOpDeviceControllerWithEventController=NoOpDeviceControllerWithEventController;var NoOpEventReporter$1={};Object.defineProperty(NoOpEventReporter$1,"__esModule",{value:!0});class NoOpEventReporter{constructor(){}reportEvent(e,t,i){}start(){}stop(){}}NoOpEventReporter$1.default=NoOpEventReporter;var NoOpTask$1={};Object.defineProperty(NoOpTask$1,"__esModule",{value:!0});class NoOpTask{cancel(){}name(){return"NoOpTask"}run(){return Promise.resolve()}setParent(e){}}NoOpTask$1.default=NoOpTask;var NoOpVideoElementFactory$1={};Object.defineProperty(NoOpVideoElementFactory$1,"__esModule",{value:!0});class NoOpVideoElementFactory{create(){const e={clientWidth:400,clientHeight:300,width:400,height:300,videoWidth:400,videoHeight:300,style:{transform:""},hasAttribute:()=>!1,removeAttribute:()=>{},setAttribute:()=>{},srcObject:!1,paused:!0,pause:()=>{e.paused=!0},play:()=>(e.paused=!1,Promise.resolve())};return e}}NoOpVideoElementFactory$1.default=NoOpVideoElementFactory;var NoVideoDownlinkBandwidthPolicy$1={},__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoVideoDownlinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1=__importDefault$6(DefaultVideoStreamIdSet$1);class NoVideoDownlinkBandwidthPolicy{reset(){}updateIndex(e){}updateMetrics(e){}wantsResubscribe(){return!1}chooseSubscriptions(){return new DefaultVideoStreamIdSet_1.default}}NoVideoDownlinkBandwidthPolicy$1.default=NoVideoDownlinkBandwidthPolicy;var NoVideoUplinkBandwidthPolicy$1={},__importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(NoVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1=__importDefault$5(DefaultVideoCaptureAndEncodeParameter$1);class NoVideoUplinkBandwidthPolicy{constructor(){}updateConnectionMetric(e){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(e){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){return new DefaultVideoCaptureAndEncodeParameter_1.default(0,0,0,0,!1)}maxBandwidthKbps(){return 0}setIdealMaxBandwidthKbps(e){}setHasBandwidthPriority(e){}setHighResolutionFeatureEnabled(e){}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!1}}NoVideoUplinkBandwidthPolicy$1.default=NoVideoUplinkBandwidthPolicy;var POSTLogger$1={},__awaiter$a=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(POSTLogger$1,"__esModule",{value:!0});const IntervalScheduler_1=__importDefault$4(IntervalScheduler$1),Log_1=__importDefault$4(Log$1),LogLevel_1=__importDefault$4(LogLevel);class POSTLogger{constructor(e){this.logCapture=[],this.lock=!1,this.sequenceNumber=0;const{url:t,batchSize:i=POSTLogger.BATCH_SIZE,intervalMs:n=POSTLogger.INTERVAL_MS,logLevel:r=LogLevel_1.default.WARN,metadata:o,headers:a}=e;this.url=t,this.batchSize=i,this.intervalMs=n,this.logLevel=r,this.metadata=o,this.headers=a,this.start(),this.eventListener=()=>{this.stop()},this.addEventListener()}addEventListener(){this.eventListener&&"window"in commonjsGlobal&&window.addEventListener&&window.addEventListener("unload",this.eventListener)}removeEventListener(){this.eventListener&&"window"in commonjsGlobal&&window.removeEventListener&&window.removeEventListener("unload",this.eventListener)}debug(e){LogLevel_1.default.DEBUG<this.logLevel||("string"==typeof e?this.log(LogLevel_1.default.DEBUG,e):e?this.log(LogLevel_1.default.DEBUG,e()):this.log(LogLevel_1.default.DEBUG,""+e))}info(e){this.log(LogLevel_1.default.INFO,e)}warn(e){this.log(LogLevel_1.default.WARN,e)}error(e){this.log(LogLevel_1.default.ERROR,e)}setLogLevel(e){this.logLevel=e}getLogLevel(){return this.logLevel}getLogCaptureSize(){return this.logCapture.length}start(){this.addEventListener(),this.intervalScheduler=new IntervalScheduler_1.default(this.intervalMs),this.intervalScheduler.start((()=>__awaiter$a(this,void 0,void 0,(function*(){if(!0===this.lock||0===this.getLogCaptureSize())return;this.lock=!0;const e=this.logCapture.slice(0,this.batchSize),t=this.makeRequestBody(e);try{200===(yield fetch(this.url,Object.assign({method:"POST",body:t},this.headers?{headers:this.headers}:{}))).status&&(this.logCapture=this.logCapture.slice(e.length))}catch(e){console.warn("[POSTLogger] "+e.message)}finally{this.lock=!1}}))))}stop(){var e;null===(e=this.intervalScheduler)||void 0===e||e.stop(),this.intervalScheduler=void 0,this.removeEventListener();const t=this.makeRequestBody(this.logCapture);navigator.sendBeacon(this.url,t)}destroy(){return __awaiter$a(this,void 0,void 0,(function*(){this.stop(),this.metadata=void 0,this.headers=void 0,this.logCapture=[],this.sequenceNumber=0,this.lock=!1,this.batchSize=0,this.intervalMs=0,this.url=void 0}))}makeRequestBody(e){return JSON.stringify(Object.assign(Object.assign({},this.metadata),{logs:e}))}log(e,t){if(e<this.logLevel)return;const i=Date.now();this.logCapture.push(new Log_1.default(this.sequenceNumber,t,i,LogLevel_1.default[e])),this.sequenceNumber+=1}}POSTLogger$1.default=POSTLogger,POSTLogger.BATCH_SIZE=85,POSTLogger.INTERVAL_MS=2e3;var PrefetchSortBy$1={},PrefetchSortBy;Object.defineProperty(PrefetchSortBy$1,"__esModule",{value:!0}),function(e){e.Unread="unread",e.LastMessageTimestamp="last-message-timestamp"}(PrefetchSortBy||(PrefetchSortBy={})),PrefetchSortBy$1.default=PrefetchSortBy;var RealtimeAttendeePositionInFrame$1={};Object.defineProperty(RealtimeAttendeePositionInFrame$1,"__esModule",{value:!0});class RealtimeAttendeePositionInFrame{constructor(){this.attendeeIndex=null,this.attendeesInFrame=null}}RealtimeAttendeePositionInFrame$1.default=RealtimeAttendeePositionInFrame;var RunnableTask$1={},__importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(RunnableTask$1,"__esModule",{value:!0});const BaseTask_1=__importDefault$3(BaseTask$1);class RunnableTask extends BaseTask_1.default{constructor(e,t,i="RunnableTask"){super(e),this.fn=t,this.taskName=i}run(){return this.fn().then((()=>{}))}}RunnableTask$1.default=RunnableTask;var SingleNodeAudioTransformDevice$1={},__awaiter$9=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(SingleNodeAudioTransformDevice$1,"__esModule",{value:!0});class SingleNodeAudioTransformDevice{constructor(e){this.inner=e}mute(e){return __awaiter$9(this,void 0,void 0,(function*(){}))}stop(){var e;return __awaiter$9(this,void 0,void 0,(function*(){null===(e=this.node)||void 0===e||e.disconnect()}))}intrinsicDevice(){return __awaiter$9(this,void 0,void 0,(function*(){return this.inner}))}createAudioNode(e){var t;return __awaiter$9(this,void 0,void 0,(function*(){return null===(t=this.node)||void 0===t||t.disconnect(),this.node=yield this.createSingleAudioNode(e),{start:this.node,end:this.node}}))}}SingleNodeAudioTransformDevice$1.default=SingleNodeAudioTransformDevice;var TranscriptAlternative$1={};Object.defineProperty(TranscriptAlternative$1,"__esModule",{value:!0});class TranscriptAlternative{}TranscriptAlternative$1.default=TranscriptAlternative;var TranscriptEntity$1={};Object.defineProperty(TranscriptEntity$1,"__esModule",{value:!0});class TranscriptEntity{}TranscriptEntity$1.default=TranscriptEntity;var TranscriptItem$1={};Object.defineProperty(TranscriptItem$1,"__esModule",{value:!0});class TranscriptItem{}TranscriptItem$1.default=TranscriptItem;var TranscriptLanguageWithScore$1={};Object.defineProperty(TranscriptLanguageWithScore$1,"__esModule",{value:!0});class TranscriptLanguageWithScore{}TranscriptLanguageWithScore$1.default=TranscriptLanguageWithScore;var TranscriptResult$1={};Object.defineProperty(TranscriptResult$1,"__esModule",{value:!0});class TranscriptResult{}TranscriptResult$1.default=TranscriptResult;var VideoFxProcessor$1={},DeferredPromise$1={};Object.defineProperty(DeferredPromise$1,"__esModule",{value:!0}),DeferredPromise$1.DeferredPromise=void 0;class DeferredPromise{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}getPromise(){return this.promise}resolvePromise(e){this.resolve(e)}resolveAndReplacePromise(e){this.resolve(e),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}rejectPromise(e){this.reject(e)}rejectAndReplacePromise(e){this.reject(e),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}DeferredPromise$1.DeferredPromise=DeferredPromise;var VideoFxCanvasOpsManager$1={},VideoFxConstants={};Object.defineProperty(VideoFxConstants,"__esModule",{value:!0}),VideoFxConstants.FXLIB_PATH=VideoFxConstants.WORKER_PATH=VideoFxConstants.CDN_BASE_PATH=VideoFxConstants.RESOURCE_CONSTRAINTS=VideoFxConstants.SEGMENTATION_MODEL=VideoFxConstants.DEFAULT_STREAM_PARAMETERS=VideoFxConstants.WORKER_MSG=void 0,VideoFxConstants.WORKER_MSG={BUILD_ENGINE_REQUEST:"BuildEngineRequest",BUILD_ENGINE_RESPONSE:"BuildEngineResponse",PERFORM_SEGMENTATION_REQUEST:"PerformSegmentationRequest",PERFORM_SEGMENTATION_RESPONSE:"PerformSegmentationResponse",PERFORM_SEGMENTATION_SAB_REQUEST:"PerformSegmentationSABRequest",PERFORM_SEGMENTATION_SAB_RESPONSE:"PerformSegmentationSABResponse",DESTROY_ASSETS_REQUEST:"DestroyAssetsRequest",DESTROY_ASSETS_RESPONSE:"DestroyAssetsResponse",CLOSE_WORKER_REQUEST:"CloseWorkerRequest"},VideoFxConstants.DEFAULT_STREAM_PARAMETERS={FRAMES_PER_SECOND:15,WIDTH_IN_PIXEL:960,HEIGHT_IN_PIXEL:540,CHANNEL_COUNT:4},VideoFxConstants.SEGMENTATION_MODEL={LOAD_SUCCESS:2,WIDTH_IN_PIXELS:176,HEIGHT_IN_PIXELS:160},VideoFxConstants.RESOURCE_CONSTRAINTS={DEFAULT_PROCESSING_BUDGET_PER_FRAME:50,SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION:1,SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT:500,BLUR_DEFAULT_CYCLE_PERCENTAGE:10,BLUR_SAMPLING_PERIOD_FRAME_COUNT:1e3,MIN_PROCESSING_BUDGET:0,MAX_PROCESSING_BUDGET:100},VideoFxConstants.CDN_BASE_PATH="https://static.sdkassets.chime.aws";const MFX_ASSET_PATH="/ml_media_fx/otherassets";VideoFxConstants.WORKER_PATH=`${MFX_ASSET_PATH}/worker.js`,VideoFxConstants.FXLIB_PATH=`${MFX_ASSET_PATH}/fxlib.js`;var __awaiter$8=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(VideoFxCanvasOpsManager$1,"__esModule",{value:!0}),VideoFxCanvasOpsManager$1.VideoFxCanvasOpsManager=void 0;const VideoFxConstants_1$2=VideoFxConstants;class VideoFxCanvasOpsManager{constructor(e,t){this.streamParameters=e,this.outputCanvas=t,this.configureCanvasPipeline()}getInferenceInputData(e){this.inferenceCtx.save(),this.inferenceCtx.scale(this.horizontalResizeScalar,this.verticalResizeScalar),this.inferenceCtx.drawImage(e,0,0),this.inferenceCtx.restore();return this.inferenceCtx.getImageData(0,0,VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS)}configureForStreamParameters(e){return __awaiter$8(this,void 0,void 0,(function*(){if(this.streamParameters=e,this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.backgroundReplacementCanvas){const e=document.createElement("canvas");e.width=this.streamParameters.width,e.height=this.streamParameters.height,e.getContext("2d").drawImage(this.backgroundReplacementCanvas,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}this.configureCanvasPipeline()}))}configureCanvasPipeline(){this.inferenceCanvas=document.createElement("canvas"),this.inferenceCtx=this.inferenceCanvas.getContext("2d",{willReadFrequently:!0}),this.inferenceCanvas.width=VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,this.inferenceCanvas.height=VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.horizontalResizeScalar=VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS/this.streamParameters.width,this.verticalResizeScalar=VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS/this.streamParameters.height}getBackgroundReplacementCanvas(){return this.backgroundReplacementCanvas}loadReplacementBackground(e){return __awaiter$8(this,void 0,void 0,(function*(){const t=e.backgroundReplacement.backgroundImageURL,i=e.backgroundReplacement.defaultColor;if(t)try{const e=yield this.loadImage(t);this.backgroundReplacementImage=e,this.resizeAndSetReplacementImage(this.backgroundReplacementImage)}catch(e){throw this.logger.error(e),new Error("Failed to set the replacement image.")}else this.resizeAndSetReplacementColor(i)}))}resizeAndSetReplacementImage(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=this.streamParameters.width,t.height=this.streamParameters.height,i.drawImage(e,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=t}resizeAndSetReplacementColor(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=this.streamParameters.width,t.height=this.streamParameters.height,i.fillStyle=e,i.fillRect(0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=t}loadImage(e){return __awaiter$8(this,void 0,void 0,(function*(){const t=yield fetch(e).catch((e=>{throw this.logger.error(e.toString()),new Error("Failed to fetch image.")})),i=yield t.blob(),n=new Image;return n.src=URL.createObjectURL(i),new Promise(((e,t)=>{n.onload=()=>{e(n)},n.onerror=e=>{t(e)}}))}))}}VideoFxCanvasOpsManager$1.VideoFxCanvasOpsManager=VideoFxCanvasOpsManager;var VideoFxSegmentationRateManager$1={};Object.defineProperty(VideoFxSegmentationRateManager$1,"__esModule",{value:!0}),VideoFxSegmentationRateManager$1.VideoFxSegmentationRateManager=void 0;const VideoFxConstants_1$1=VideoFxConstants;class VideoFxSegmentationRateManager{constructor(e,t){this.logger=e,this.targetSegmentationCyclePercentage=t/100,this.frameCountOverSamplingPeriod=0,this.totalSegmentationDurationOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now(),this.framesPerSegmentation=VideoFxConstants_1$1.RESOURCE_CONSTRAINTS.SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION}submitFrame(){this.frameCountOverSamplingPeriod++}shouldApplySegmentation(){return this.frameCountOverSamplingPeriod%this.framesPerSegmentation==0}startSegmentation(){this.frameSegmentationStartTime=performance.now()}completeSegmentation(){this.totalSegmentationDurationOverSamplingPeriod+=performance.now()-this.frameSegmentationStartTime,this.frameCountOverSamplingPeriod>=VideoFxConstants_1$1.RESOURCE_CONSTRAINTS.SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT&&this.adjustFramesPerSegmentation(this.totalSegmentationDurationOverSamplingPeriod/(performance.now()-this.samplingPeriodStartTime))}adjustFramesPerSegmentation(e){e>this.targetSegmentationCyclePercentage?(this.framesPerSegmentation++,this.logger.info(`Segmentation cycle percentage above the configured maximal value. Decreasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)):this.framesPerSegmentation>1&&e<this.targetSegmentationCyclePercentage&&(this.framesPerSegmentation--,this.logger.info(`Segmentation cycle percentage below the configured maximal value. Increasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)),this.totalSegmentationDurationOverSamplingPeriod=0,this.frameCountOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now()}}VideoFxSegmentationRateManager$1.VideoFxSegmentationRateManager=VideoFxSegmentationRateManager;var __awaiter$7=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VideoFxProcessor$1,"__esModule",{value:!0});const fetch_1=fetch$1,loader_1=loader,support_1=support,DefaultBrowserBehavior_1$1=__importDefault$2(DefaultBrowserBehavior$1),NoOpLogger_1=__importDefault$2(NoOpLogger$1),Utils_1$1=Utils$1,Versioning_1$1=__importDefault$2(Versioning$1),CanvasVideoFrameBuffer_1=__importDefault$2(CanvasVideoFrameBuffer$1),DeferredPromise_1=DeferredPromise$1,VideoFxCanvasOpsManager_1=VideoFxCanvasOpsManager$1,VideoFxConstants_1=VideoFxConstants,VideoFxSegmentationRateManager_1=VideoFxSegmentationRateManager$1;class VideoFxProcessor{constructor(e,t=VideoFxConstants_1.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,i){this.logger=e,this.outputCanvas=document.createElement("canvas"),this.canvasVideoFrameBuffer=new CanvasVideoFrameBuffer_1.default(this.outputCanvas);try{this.validateProcessingBudgetPerFrame(t)}catch(e){throw this.logger.error(e),new Error(`Cannot instantiate VideoFxProcessor due to invalid processingBudgetPerFrame of ${t}`)}i&&(this.eventController=i),this.effectConfig={backgroundBlur:{isEnabled:!1,strength:"low"},backgroundReplacement:{isEnabled:!1,backgroundImageURL:null,defaultColor:"black"}},this.segmentationRequestPromise=new DeferredPromise_1.DeferredPromise,this.segmentationRateManager=new VideoFxSegmentationRateManager_1.VideoFxSegmentationRateManager(this.logger,t),this.streamParameters={framerate:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.FRAMES_PER_SECOND,width:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.WIDTH_IN_PIXEL,height:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.HEIGHT_IN_PIXEL,channels:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.CHANNEL_COUNT},VideoFxProcessor.isSharedArrayBufferSupported&&(this.sharedImageBuffer=new SharedArrayBuffer(VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS*VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS*this.streamParameters.channels),this.sharedImageData=new Uint8ClampedArray(this.sharedImageBuffer)),this.logger.info(`VideoFx supports Shared Array Buffer: ${VideoFxProcessor.isSharedArrayBufferSupported}`),this.canvasOpsManager=new VideoFxCanvasOpsManager_1.VideoFxCanvasOpsManager(this.streamParameters,this.outputCanvas),this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.segmentationMask=new ImageData(this.streamParameters.width,this.streamParameters.height),this.logger.info(`VideoFxProcessor instantiated with a processingBudgetPerFrame of ${t}`)}process(e){return __awaiter$7(this,void 0,void 0,(function*(){return e}))}fxProcess(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=e[0].asCanvasElement();this.didStreamParametersChange(t)&&(yield this.adjustProcessorForNewStreamParameters(t));try{yield this.manageSegmentationMask(t)}catch(e){throw this.logger.error(e),new Error("Video stream could not be processed")}return yield this.renderer.render(t,this.segmentationMask),e[0]=this.canvasVideoFrameBuffer,e}))}noOpProcess(e){return __awaiter$7(this,void 0,void 0,(function*(){return e}))}didStreamParametersChange(e){return e.width!==this.streamParameters.width||e.height!==this.streamParameters.height}adjustProcessorForNewStreamParameters(e){return __awaiter$7(this,void 0,void 0,(function*(){this.streamParameters.width=e.width,this.streamParameters.height=e.height,yield this.canvasOpsManager.configureForStreamParameters(this.streamParameters),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,this.effectConfig)}))}destroy(){return __awaiter$7(this,void 0,void 0,(function*(){this.canvasVideoFrameBuffer.destroy(),this.fxLibScript&&this.fxLibScript.parentNode&&this.fxLibScript.parentNode.removeChild(this.fxLibScript),this.engineWorker&&(this.destroyedAssetsPromise=new DeferredPromise_1.DeferredPromise,this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.DESTROY_ASSETS_REQUEST}),yield this.destroyedAssetsPromise.getPromise(),this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.CLOSE_WORKER_REQUEST})),this.logger.info("VideoFxProcessor destroyed.")}))}manageSegmentationMask(e){return __awaiter$7(this,void 0,void 0,(function*(){try{if(this.segmentationRateManager.submitFrame(),this.segmentationRateManager.shouldApplySegmentation()){this.segmentationRateManager.startSegmentation();const t=this.canvasOpsManager.getInferenceInputData(e);this.segmentationMask=yield this.generateSegmentationMask(t),this.segmentationRateManager.completeSegmentation()}}catch(e){throw this.logger.error(e.toString()),new Error("Can not properly manage the returned segmentation mask")}}))}generateSegmentationMask(e){return __awaiter$7(this,void 0,void 0,(function*(){VideoFxProcessor.isSharedArrayBufferSupported?(this.sharedImageData.set(e.data),this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_SAB_REQUEST,payload:this.sharedImageBuffer})):this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_REQUEST,payload:e},[e.data.buffer]);try{return yield this.segmentationRequestPromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Segmentation mask could not be generated")}}))}cloneConfigFrom(e){return{backgroundBlur:{isEnabled:e.backgroundBlur.isEnabled,strength:e.backgroundBlur.strength},backgroundReplacement:{isEnabled:e.backgroundReplacement.isEnabled,backgroundImageURL:e.backgroundReplacement.backgroundImageURL,defaultColor:e.backgroundReplacement.defaultColor}}}setEffectConfig(e){return __awaiter$7(this,void 0,void 0,(function*(){if(this.sameVideoFxConfig(e,this.effectConfig))return;const t=this.cloneConfigFrom(e);try{yield this.validateEffectConfig(t)}catch(e){throw this.logger.error(e.toString()),new Error("Provided effect config is invalid, not updating VideoFxProcessor")}t.backgroundReplacement.isEnabled&&(yield this.canvasOpsManager.loadReplacementBackground(t),yield this.renderer.setBackgroundReplacementCanvas(this.canvasOpsManager.getBackgroundReplacementCanvas())),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,t),this.effectConfig=t,this.effectConfig.backgroundBlur.isEnabled||this.effectConfig.backgroundReplacement.isEnabled?this.process=this.fxProcess:this.process=this.noOpProcess,this.logger.info(`VideoFxProcessor effect configuration updated to: ${JSON.stringify(this.effectConfig)}`),this.eventController&&this.publishVideoFxConfigEvent()}))}validateEffectConfig(e){return __awaiter$7(this,void 0,void 0,(function*(){if(e.backgroundBlur.isEnabled&&e.backgroundReplacement.isEnabled)throw new Error("Invalid VideoFx configuration: Background Blur and Background Replacement can not both be enabled");e.backgroundReplacement.isEnabled&&(yield this.validateReplacementConfig(e))}))}validateReplacementConfig(e){return __awaiter$7(this,void 0,void 0,(function*(){if(e.backgroundReplacement.backgroundImageURL&&e.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement can not have both an image URL and default color");if(!e.backgroundReplacement.backgroundImageURL&&!e.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement image URL and default can not both be null/undefined");try{e.backgroundReplacement.backgroundImageURL&&(yield this.canvasOpsManager.loadImage(e.backgroundReplacement.backgroundImageURL))}catch(e){throw this.logger.error(e.toString()),new Error("Invalid VideoFx configuration: backgroundImageURL failed to load")}const t=e.backgroundReplacement.defaultColor;if(t&&"black"!==t&&"#000000"!==t&&"#000"!==t){if(t.includes("#")){if(!new RegExp(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/).test(t))throw new Error(`Invalid hexadecimal color code for default replacement background: ${t}`)}const e=document.createElement("canvas").getContext("2d"),i=e.fillStyle;if(e.fillStyle=t,e.fillStyle===i)throw new Error(`Invalid color for default replacement background: ${t}`)}}))}validateProcessingBudgetPerFrame(e){if(e<VideoFxConstants_1.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET||e>VideoFxConstants_1.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET)throw new Error(`Invalid resource constraint: cycle percentage must be within range of ${VideoFxConstants_1.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET} and ${VideoFxConstants_1.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET}`)}loadAssets(){return __awaiter$7(this,void 0,void 0,(function*(){this.logger.info("Loading required assets for the VideoFxProcessor");try{const e=this.getVideoFxAssetParams();yield this.loadEngineWorker(e),yield this.buildEngine(e),yield this.loadFxLib(e),this.renderer=constructRenderer(VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.effectConfig,this.outputCanvas)}catch(e){throw this.logger.error(e.toString()),new Error("Failed to load necessary assets for the VideoFxProcessor")}this.logger.info("Finished loading of essential VideoFxProcessor assets.")}))}getVideoFxAssetParams(){const e=Utils_1$1.getDefaultAssetSpec();return{assetGroup:e.assetGroup,revisionID:e.revisionID,sdk:encodeURIComponent(Versioning_1$1.default.sdkVersion),ua:encodeURIComponent(Versioning_1$1.default.sdkUserAgentLowResolution)}}getPathFromVideoFxAssetParams(e,t){const i=new URL(e);for(const[e,n]of Object.entries(t))if(void 0!==n){const t=encodeURIComponent(e),r=encodeURIComponent(n);i.searchParams.set(t,r)}return i.toString()}loadEngineWorker(e){return __awaiter$7(this,void 0,void 0,(function*(){try{const t=this.getPathFromVideoFxAssetParams(VideoFxConstants_1.CDN_BASE_PATH+VideoFxConstants_1.WORKER_PATH,e);this.engineWorker=yield loader_1.loadWorker(t,"VideoFxEngineWorker",{},null),this.logger.info("Successfully loaded the VideoFxProcessor's engine worker"),this.engineWorker.addEventListener("message",(e=>this.engineWorkerReceiver(e)))}catch(e){throw this.logger.error(e.toString()),new Error("Failed to load the VideoFxProcessor's engine worker")}}))}buildEngine(e){return __awaiter$7(this,void 0,void 0,(function*(){this.buildEnginePromise=new DeferredPromise_1.DeferredPromise,this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.BUILD_ENGINE_REQUEST,payload:{cdnBasePath:VideoFxConstants_1.CDN_BASE_PATH,sdkVersioningParams:e}});try{yield this.buildEnginePromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Failed to instantiate the VideoFxEngine")}}))}loadFxLib(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=this.getPathFromVideoFxAssetParams(VideoFxConstants_1.CDN_BASE_PATH+VideoFxConstants_1.FXLIB_PATH,e),i={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"};try{const e=yield fetch_1.fetchWithBehavior(t,i,{});if(!e.ok)throw new Error("Fetch failed.");const n=window.URL.createObjectURL(yield e.blob());yield new Promise(((e,t)=>{this.fxLibScript=document.createElement("script"),this.fxLibScript.setAttribute("src",n),this.fxLibScript.setAttribute("type","module"),this.fxLibScript.setAttribute("async","false"),this.fxLibScript.addEventListener("load",e),this.fxLibScript.addEventListener("error",t),document.body.appendChild(this.fxLibScript)}))}catch(e){throw this.logger.error(e.toString()),new Error("Failed to load the fxlib")}}))}getEffectConfig(){return this.cloneConfigFrom(this.effectConfig)}engineWorkerReceiver(e){const t=e.data;switch(t.msg){case VideoFxConstants_1.WORKER_MSG.BUILD_ENGINE_RESPONSE:this.settleEngineBuildPromise(t.payload);break;case VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_RESPONSE:this.settleSegmentationPromise(t.payload.output);break;case VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_SAB_RESPONSE:this.settleSegmentationPromiseSAB();break;case VideoFxConstants_1.WORKER_MSG.DESTROY_ASSETS_RESPONSE:this.destroyedAssetsPromise.resolvePromise();break;default:this.logger.info(`VideoFx worker received unknown event msg: ${JSON.stringify(t)}`)}}settleEngineBuildPromise(e){e!==VideoFxConstants_1.SEGMENTATION_MODEL.LOAD_SUCCESS?this.buildEnginePromise.rejectPromise(new Error("Failed to build VideoFxProcessor's engine")):(this.logger.info("Successfully built the VideoFxEngine"),this.buildEnginePromise.resolvePromise())}settleSegmentationPromise(e){e?this.segmentationRequestPromise.resolveAndReplacePromise(e):this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation on the input image"))}settleSegmentationPromiseSAB(){try{const e=new ImageData(new Uint8ClampedArray(this.sharedImageData),VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS);this.segmentationRequestPromise.resolveAndReplacePromise(e)}catch(e){this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation with a shared array buffer on the input image"))}}setToNoOpProcess(){this.process=this.noOpProcess}static isSupported(e=new NoOpLogger_1.default,t=!0){return __awaiter$7(this,void 0,void 0,(function*(){let i=!0;const n=(t,n)=>{t&&(e.info(n),i=!1)};n("undefined"==typeof globalThis,"Browser does not have globalThis."),n(!support_1.supportsWorker(globalThis,e),"Browser does not support web workers."),n(!support_1.supportsWASM(globalThis,e),"Browser does not support wasm."),n(!document.createElement("canvas").getContext("webgl2"),"Browser does not support webgl.");n(!(new DefaultBrowserBehavior_1$1.default).isVideoFxSupportedBrowser(),"Browser is unsupported for VideoFxProcessor");return Promise.resolve(!!i&&(yield(()=>__awaiter$7(this,void 0,void 0,(function*(){if(t)try{const t=new VideoFxProcessor(e);yield t.loadAssets(),yield t.destroy()}catch(t){return e.info("Browser environment is unable to access the required external assets."),Promise.resolve(!1)}return Promise.resolve(!0)})))()))}))}static create(e,t,i=VideoFxConstants_1.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME){return __awaiter$7(this,void 0,void 0,(function*(){const n=new VideoFxProcessor(e,i);try{return yield n.loadAssets(),yield n.setEffectConfig(t),n}catch(t){throw e.error(t.toString()),n.setToNoOpProcess(),new Error("VideoFxProcessor built with support for only NoOp processing")}}))}setEventController(e){this.eventController?this.eventController=e:(this.eventController=e,this.publishVideoFxConfigEvent())}publishVideoFxConfigEvent(){const e={backgroundBlurEnabled:this.effectConfig.backgroundBlur.isEnabled.toString(),backgroundBlurStrength:this.effectConfig.backgroundBlur.strength,backgroundReplacementEnabled:this.effectConfig.backgroundReplacement.isEnabled.toString(),backgroundFilterVersion:2};this.eventController.publishEvent("backgroundFilterConfigSelected",e)}sameVideoFxConfig(e,t){return e.backgroundBlur.isEnabled===t.backgroundBlur.isEnabled&&e.backgroundBlur.strength===t.backgroundBlur.strength&&e.backgroundReplacement.backgroundImageURL===t.backgroundReplacement.backgroundImageURL&&e.backgroundReplacement.defaultColor===t.backgroundReplacement.defaultColor&&e.backgroundReplacement.isEnabled===t.backgroundReplacement.isEnabled}}VideoFxProcessor$1.default=VideoFxProcessor,VideoFxProcessor.isSharedArrayBufferSupported="undefined"!=typeof SharedArrayBuffer;var VoiceFocusDeviceTransformer$1={},voicefocus={},decider={},__awaiter$6=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(decider,"__esModule",{value:!0}),decider.decideModel=decider.measureAndDecideExecutionApproach=void 0;const loader_js_1$1=loader,support_js_1$4=support,DEFAULT_EXECUTION_QUANTA=3,SIMD_SCORE_FIXED_POINT=2.5,WASM_SCORE_FIXED_POINT=2.63,SINGLE_INLINE_SCORE_MULTIPLIER=.6,QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.65,INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.5,WORKER_SCORE_MULTIPLIER=.7,PERFORMANCE_THRESHOLDS={wasm:{noSupport:.07,inline:{c100:1,c50:.36,c20:.16,c10:.07},worker:{c100:.5,c50:.18,c20:.08,c10:.06}},simd:{noSupport:.1,inline:{c100:1,c50:.43,c20:.3,c10:.2},worker:{c100:.5,c50:.21,c20:.15,c10:.1}}};class Estimator{constructor(e,t){this.fetchConfig=e,this.logger=t;const i=`${e.paths.workers}estimator-v1.js`;this.fetchBehavior={headers:e.headers,escapedQueryString:e.escapedQueryString},this.worker=loader_js_1$1.loadWorker(i,"VoiceFocusEstimator",this.fetchBehavior,t)}roundtrip(e,t,i){return new Promise(((n,r)=>{this.worker.then((r=>{let o;o=e=>{const{message:a,key:s}=e.data;a===t&&s===i&&(r.removeEventListener("message",o),n(e.data))},r.addEventListener("message",o),r.postMessage(e)})).catch((e=>{var t;null===(t=this.logger)||void 0===t||t.error("Failed to load worker.",e),r(e)}))}))}supportsSIMD(e){const t="simd",i=e||`${this.fetchConfig.paths.wasm}simd-v1.wasm`,n={message:"supports-simd",fetchBehavior:this.fetchBehavior,path:i,key:t};return this.roundtrip(n,"simd-support",t).then((e=>e.supports))}measure(e,t){const i=`${this.fetchConfig.paths.wasm}bench-v1.wasm`,n=`${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`,r=e?n:i,o=`bench:${e}`,a={message:"measure",fetchBehavior:this.fetchBehavior,budget:t,path:r,key:o};return this.roundtrip(a,"measurement",o).then((e=>{if(e.measurement)return e.measurement;throw new Error("Failed to measure.")}))}stop(){this.worker.then((e=>{var t;null===(t=this.logger)||void 0===t||t.debug("Stopping estimator worker."),e.terminate()})).catch((e=>{}))}}const inlineScoreMultiplier=(e,t)=>1===e?SINGLE_INLINE_SCORE_MULTIPLIER:"quality"===t?QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*e:INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*e,decideExecutionApproach=({supportsSIMD:e,supportsSAB:t,duration:i,executionPreference:n="auto",simdPreference:r,variantPreference:o="auto",namePreference:a="default",usagePreference:s,executionQuantaPreference:d=DEFAULT_EXECUTION_QUANTA},l=PERFORMANCE_THRESHOLDS,c)=>{const u="force"===r||"disable"!==r&&e,h=-1!==i,p=h?(u?SIMD_SCORE_FIXED_POINT:WASM_SCORE_FIXED_POINT)/i:0,m=u?l.simd:l.wasm,f=h?inlineScoreMultiplier(d,s)*p:0,g=h?WORKER_SCORE_MULTIPLIER*p:0,S=a,v=e=>({supported:!1,reason:e});if(h){if(p<m.noSupport)return v(`Performance score ${p} worse than threshold ${m.noSupport}.`)}else if("auto"===n||"auto"===o)return v(`Missing explicit execution (${n}) or variant (${o}) preference, but no scoring performed.`);null==c||c.debug(`Bench duration ${i} yields inline score ${f} and worker score ${g}.`);const b=(e,t,i)=>({supported:!0,useSIMD:u,processor:e,executionApproach:t,variant:i,executionQuanta:"inline"===t?d:void 0,name:S}),_=(e,t,i)=>"auto"!==t?!h||e>i[t]?t:"failed":e>i.c100?"c100":e>i.c50?"c50":e>i.c20?"c20":e>i.c10?"c10":"failed",y=e=>{switch(e||"auto"){case"auto":{let e=y("inline"),t=y("worker");return null==c||c.debug(`Reducing auto preference: ${JSON.stringify(e)} vs ${JSON.stringify(t)}`),!1===e.supported||!1===t.supported?t:e.variant===t.variant||"c50"===e.variant?e:t}case"worker":return support_js_1$4.supportsSharedArrayBuffer(globalThis,window,c)?y("worker-sab"):y("worker-postMessage");case"inline":{const e=_(f,o,m.inline);return"failed"===e?v(`Performance score ${f} not sufficient for inline use with variant preference ${o}.`):b("voicefocus-inline-processor","inline",e)}case"worker-sab":{if(!t){const e="Requested worker-sab but no SharedArrayBuffer support.";return null==c||c.warn(e),{supported:!1,reason:e}}const e=_(g,o,m.worker);return"failed"===e?v(`Performance score ${g} not sufficient for worker use with variant preference ${o}.`):b("voicefocus-worker-sab-processor","worker-sab",e)}case"worker-postMessage":{const e=_(g,o,m.worker);if("failed"===e)return v(`Performance score ${g} not sufficient for worker use.`);if("ns_es"===S){const e="Requested echo suppression but postMessage executor does not support it.";return null==c||c.warn(e),{supported:!1,reason:e}}return b("voicefocus-worker-postMessage-processor","worker-postMessage",e)}}};return y(n)},featureCheck=(e,t,i,n)=>__awaiter$6(void 0,void 0,void 0,(function*(){const r={supportsSIMD:e,supportsSAB:support_js_1$4.supportsSharedArrayBuffer(globalThis,window,i),duration:-1};if(e)return null==i||i.info("Supports SIMD: true (force)"),r;const o=!n,a=n||new Estimator(t,i);try{const t=!support_js_1$4.isOldChrome(window,i)&&(yield a.supportsSIMD());return null==i||i.info(`Supports SIMD: ${t} (force: ${e})`),r.supportsSIMD=t,r}finally{o&&a.stop()}})),estimateAndFeatureCheck=(e,t,i,n)=>__awaiter$6(void 0,void 0,void 0,(function*(){const r=new Estimator(t,n);try{const o=yield featureCheck(e,t,n,r);if(o.supportsSIMD)try{return o.duration=yield r.measure(!0,i),null==n||n.info("SIMD timing:",o.duration),o}catch(e){null==n||n.warn("Failed SIMD estimation; falling back to non-SIMD."),o.supportsSIMD=!1}return o.duration=yield r.measure(!1,i),null==n||n.info("No-SIMD timing:",o.duration),o}catch(e){throw null==n||n.error("Could not feature check.",e),e}finally{r.stop()}})),measureAndDecideExecutionApproach=(e,t,i,n=PERFORMANCE_THRESHOLDS)=>__awaiter$6(void 0,void 0,void 0,(function*(){let r=e.executionPreference;const{usagePreference:o,variantPreference:a,namePreference:s,simdPreference:d,estimatorBudget:l,executionQuantaPreference:c}=e;"interactivity"===o&&"inline"!==r&&(null==i||i.debug(`Overriding execution preference ${r} to reflect interactivity preference.`),r="inline");const u="force"===d,h="auto"!==a,p="auto"!==r;let m;try{m=h&&p?yield featureCheck(u,t,i):yield estimateAndFeatureCheck(u,t,l,i)}catch(e){throw null==i||i.error("Could not load estimator.",e),new Error("Could not load Voice Focus estimator.")}return decideExecutionApproach(Object.assign(Object.assign({},m),{simdPreference:d,executionPreference:r,variantPreference:a,namePreference:s,usagePreference:o,executionQuantaPreference:c}),n,i)}));decider.measureAndDecideExecutionApproach=measureAndDecideExecutionApproach;const decideModel=({category:e,name:t,variant:i,simd:n,url:r})=>`${e}-${t}-${i}-v1${n?"_simd":""}`;decider.decideModel=decideModel;var workletInlineNode={},types={};Object.defineProperty(types,"__esModule",{value:!0}),types.VoiceFocusAudioWorkletNode=void 0;class VoiceFocusAudioWorkletNode extends("undefined"!=typeof globalThis&&globalThis.AudioWorkletNode||class{}){}types.VoiceFocusAudioWorkletNode=VoiceFocusAudioWorkletNode;var __awaiter$5=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(workletInlineNode,"__esModule",{value:!0});const support_js_1$3=support,types_js_1$2=types,CPU_WARNING_MAX_INTERVAL_MS=5e3;class VoiceFocusInlineNode extends types_js_1$2.VoiceFocusAudioWorkletNode{constructor(e,t){super(e,t.processor,t),this.cpuWarningCount=0,this.channelCountMode="explicit",this.channelCount=1;const{modelURL:i,worker:n,fetchBehavior:r,logger:o,delegate:a}=t;this.logger=o,this.port.onmessage=this.onProcessorMessage.bind(this),this.delegate=a,o&&o.debug("VoiceFocusInlineNode:",i),this.worker=n,this.worker.onmessage=this.onWorkerMessage.bind(this);const s=support_js_1$3.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:s,key:"model",fetchBehavior:r,path:i})}onModuleBufferLoaded(e,t){this.port.postMessage({message:"module-buffer",buffer:e,key:t})}onModuleLoaded(e,t){this.port.postMessage({message:"module",module:e,key:t})}enable(){return __awaiter$5(this,void 0,void 0,(function*(){this.port.postMessage({message:"enable"})}))}disable(){return __awaiter$5(this,void 0,void 0,(function*(){this.port.postMessage({message:"disable"})}))}stop(){var e;return __awaiter$5(this,void 0,void 0,(function*(){this.port.postMessage({message:"stop"});try{null===(e=this.worker)||void 0===e||e.terminate()}catch(e){console.error("failed to terminate worker:",e)}this.disconnect()}))}onProcessorMessage(e){var t,i,n;const r=e.data;if("cpu"===r.message){this.cpuWarningCount++;const e=Date.now(),n=this.cpuWarningLastTriggered||e,o=Math.abs(e-n);(!this.cpuWarningLastTriggered||o>CPU_WARNING_MAX_INTERVAL_MS)&&(null===(t=this.logger)||void 0===t||t.warn(`CPU warning (count: ${this.cpuWarningCount}):`,r.message),this.cpuWarningCount=0,this.cpuWarningLastTriggered=e),null===(i=this.delegate)||void 0===i||i.onCPUWarning()}else null===(n=this.logger)||void 0===n||n.debug("Ignoring processor message.")}onWorkerMessage(e){const t=e.data;switch(t.message){case"module-buffer":if(!t.buffer||!t.key)return;this.onModuleBufferLoaded(t.buffer,t.key);break;case"module":if(!t.module||!t.key)return;this.onModuleLoaded(t.module,t.key);break;case"stopped":this.worker&&this.worker.terminate();break;default:return}}}workletInlineNode.default=VoiceFocusInlineNode;var workletWorkerSabNode={},__awaiter$4=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(workletWorkerSabNode,"__esModule",{value:!0});const support_js_1$2=support,types_js_1$1=types,INDICES={ready:0,enabled:1},STATES={disabled:0,enabled:1,stopped:2};class VoiceFocusWorkerBufferNode extends types_js_1$1.VoiceFocusAudioWorkletNode{constructor(e,t){super(e,t.processor,t),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:i,resamplerURL:n,worker:r,fetchBehavior:o,delegate:a}=t;this.delegate=a,this.worker=r,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:s,supportFarendStream:d}=t.processorOptions;this.worker.postMessage({message:"init",approach:"sab",frames:16e3===e.sampleRate?160:480,enabled:s,model:i,supportFarendStream:d});const l=support_js_1$2.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:l,key:"resampler",fetchBehavior:o,path:n})}enable(){return __awaiter$4(this,void 0,void 0,(function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.enabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"enable"})}))}disable(){return __awaiter$4(this,void 0,void 0,(function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.disabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"disable"})}))}stop(){return __awaiter$4(this,void 0,void 0,(function*(){if(this.state)Atomics.store(this.state,INDICES.enabled,STATES.stopped),Atomics.notify(this.state,INDICES.ready,1);else try{this.worker.postMessage({message:"stop"})}catch(e){}this.disconnect()}))}onWorkerMessage(e){var t;const i=e.data;switch(i.message){case"ready":if(!i.shared)throw new Error("No shared state.");this.state=new Int32Array(i.shared.state),this.port.postMessage(i);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":case"processing":this.port.postMessage(i);break;case"cpu":null===(t=this.delegate)||void 0===t||t.onCPUWarning();break;default:return}}onProcessorMessage(e){var t;const i=e.data;switch(i.message){case"cpu":null===(t=this.delegate)||void 0===t||t.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(i)}}}workletWorkerSabNode.default=VoiceFocusWorkerBufferNode;var workletWorkerPostMessageNode={},__awaiter$3=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(workletWorkerPostMessageNode,"__esModule",{value:!0});const support_js_1$1=support,types_js_1=types;class VoiceFocusWorkerPostMessageNode extends types_js_1.VoiceFocusAudioWorkletNode{constructor(e,t){super(e,t.processor,t),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:i,audioBufferURL:n,worker:r,fetchBehavior:o,delegate:a}=t;this.delegate=a,this.worker=r,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:s,agc:d,supportFarendStream:l}=t.processorOptions;this.worker.postMessage({message:"init",approach:"postMessage",frames:16e3===e.sampleRate?160:480,enabled:s,agc:d,fetchBehavior:o,model:i,supportFarendStream:l});const c=support_js_1$1.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:c,key:"buffer",fetchBehavior:o,path:n})}enable(){return __awaiter$3(this,void 0,void 0,(function*(){this.worker.postMessage({message:"enable"})}))}disable(){return __awaiter$3(this,void 0,void 0,(function*(){this.worker.postMessage({message:"disable"})}))}stop(){return __awaiter$3(this,void 0,void 0,(function*(){try{this.worker.postMessage({message:"stop"})}catch(e){}this.disconnect()}))}onWorkerMessage(e){var t;const i=e.data;switch(i.message){case"ready":this.port.postMessage({message:"ready",shared:i.shared},i.shared?Object.values(i.shared):[]);break;case"data":if(!i.buffer)return;this.port.postMessage({message:"data",buffer:i.buffer},[i.buffer]);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":case"processing":this.port.postMessage(i);break;case"cpu":null===(t=this.delegate)||void 0===t||t.onCPUWarning();break;default:return}}onProcessorMessage(e){var t;const i=e.data;switch(i.message){case"data":if(!i.buffer)return;this.worker.postMessage({message:"data",buffer:i.buffer},[i.buffer]);break;case"cpu":null===(t=this.delegate)||void 0===t||t.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(i);break;default:return}}}workletWorkerPostMessageNode.default=VoiceFocusWorkerPostMessageNode;var __awaiter$2=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(voicefocus,"__esModule",{value:!0}),voicefocus.getAudioInput=voicefocus.createAudioContext=voicefocus.VoiceFocus=void 0;const decider_js_1=decider,fetch_js_1=fetch$1,loader_js_1=loader,support_js_1=support,worklet_inline_node_js_1=workletInlineNode,worklet_worker_sab_node_js_1=workletWorkerSabNode,worklet_worker_postMessage_node_js_1=workletWorkerPostMessageNode,DEFAULT_AGC_DISABLED_SETTING={useVoiceFocusAGC:!1,useBuiltInAGC:!0},DEFAULT_AGC_SETTING=DEFAULT_AGC_DISABLED_SETTING,DEFAULT_ASSET_GROUP="stable-v1",DEFAULT_CDN="https://static.sdkassets.chime.aws",DEFAULT_PATHS={processors:`${DEFAULT_CDN}/processors/`,workers:`${DEFAULT_CDN}/workers/`,wasm:`${DEFAULT_CDN}/wasm/`,models:`${DEFAULT_CDN}/wasm/`},DEFAULT_CONTEXT_HINT={latencyHint:0},BASE_AUDIO_CONSTRAINTS={channelCount:1,echoCancellation:!0,googEchoCancellation:!0,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!0,googAutoGainControl:!0,googAutoGainControl2:!0}),DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!1,googAutoGainControl:!1,googAutoGainControl2:!1}),PROCESSORS={"voicefocus-worker-sab-processor":{file:"worklet-worker-sab-processor-v1.js",node:worklet_worker_sab_node_js_1.default},"voicefocus-worker-postMessage-processor":{file:"worklet-worker-postMessage-processor-v1.js",node:worklet_worker_postMessage_node_js_1.default},"voicefocus-inline-processor":{file:"worklet-inline-processor-v1.js",node:worklet_inline_node_js_1.default}},validateAssetSpec=(e,t)=>{if(void 0!==e&&!fetch_js_1.isValidAssetGroup(e))throw new Error(`Invalid asset group ${e}`);if(void 0!==t&&!fetch_js_1.isValidRevisionID(t))throw new Error(`Invalid revision ID ${t}`)},mungeConstraints=(e,t)=>{let i;if(i=t.useBuiltInAGC?DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC:DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC,!e)return{audio:i};if(!e.audio)return e;if(e.video)throw new Error("Not adding Voice Focus to multi-device getUserMedia call.");return Object.assign(Object.assign({},e),{audio:!0===e.audio?i:Object.assign(Object.assign({},e.audio),i)})},urlForModel=(e,t)=>`${t.models}${decider_js_1.decideModel(e)}.wasm`;class VoiceFocus{constructor(e,t,i,n,r){this.processorURL=t,this.nodeConstructor=i,this.nodeOptions=n,this.executionQuanta=r,this.internal={worker:e,nodeOptions:n,isDestroyed:!1}}static isSupported(e,t){const{fetchBehavior:i,logger:n}=t||{};if("undefined"==typeof globalThis)return null==n||n.debug("Browser does not have globalThis."),Promise.resolve(!1);if(!support_js_1.supportsAudioWorklet(globalThis,n))return null==n||n.debug("Browser does not support Audio Worklet."),Promise.resolve(!1);if(!support_js_1.supportsWASM(globalThis,n))return null==n||n.debug("Browser does not support WASM."),Promise.resolve(!1);support_js_1.supportsWASMStreaming(globalThis,n)||null==n||n.debug("Browser does not support streaming WASM compilation.");const{assetGroup:r=DEFAULT_ASSET_GROUP,revisionID:o,paths:a=DEFAULT_PATHS}=e||{};validateAssetSpec(r,o);const s=o?{revisionID:o}:{assetGroup:r},d=fetch_js_1.addQueryParams(i,s),l=Object.assign(Object.assign({},d),{paths:a});return support_js_1.supportsVoiceFocusWorker(globalThis,l,n)}static mungeExecutionPreference(e,t){const i=void 0===e||"auto"===e;if(support_js_1.isSafari(globalThis)){if(i||"inline"===e)return"inline";if(!i)throw new Error(`Unsupported execution preference ${e}`)}if("worker-sab"===e&&!support_js_1.supportsSharedArrayBuffer(globalThis,globalThis,t))throw new Error(`Unsupported execution preference ${e}`);return e||"auto"}static configure(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const{fetchBehavior:i,preResolve:n,logger:r}=t||{},{category:o="voicefocus",name:a="default",variant:s="auto",assetGroup:d=DEFAULT_ASSET_GROUP,revisionID:l,simd:c="detect",executionPreference:u="auto",executionQuantaPreference:h,usagePreference:p="interactivity",estimatorBudget:m=100,paths:f=DEFAULT_PATHS,thresholds:g}=e||{};if(null==r||r.debug("Configuring Voice Focus with spec",e),void 0!==o&&"voicefocus"!==o)throw new Error(`Unrecognized category ${o}`);if(void 0!==a&&"default"!==a&&"ns_es"!==a)throw new Error(`Unrecognized feature name ${a}`);if(void 0!==s&&!["auto","c100","c50","c20","c10"].includes(s))throw new Error(`Unrecognized feature variant ${s}`);if(void 0!==h&&![1,2,3].includes(h))throw new Error(`Unrecognized execution quanta preference ${h}`);if(validateAssetSpec(d,l),void 0!==c&&!["detect","force","disable"].includes(c))throw new Error(`Unrecognized SIMD option ${c}`);if(void 0!==u&&!["auto","inline","worker","worker-sab","worker-postMessage"].includes(u))throw new Error(`Unrecognized execution preference ${u}`);if(void 0!==p&&!["quality","interactivity"].includes(p))throw new Error(`Unrecognized usage preference ${p}`);const S={executionPreference:this.mungeExecutionPreference(u,r),usagePreference:p,executionQuantaPreference:h,variantPreference:s,namePreference:a,simdPreference:c,estimatorBudget:m},v=l?{revisionID:l}:{assetGroup:d},b=fetch_js_1.addQueryParams(i,v),_=Object.assign({paths:f},b),y=yield decider_js_1.measureAndDecideExecutionApproach(S,_,r,g);if(!1===y.supported)return{supported:!1,reason:y.reason};null==r||r.info("Decided execution approach",y);const{useSIMD:C,processor:w,variant:E,executionQuanta:T}=y,k={category:o||"voicefocus",name:a||"default",variant:E,simd:C};if(n){const e=urlForModel(k,f);k.url=yield fetch_js_1.resolveURL(e,b)}return{fetchConfig:_,model:k,processor:w,executionQuanta:T,supported:!0}}))}static init(e,{delegate:t,preload:i=!0,logger:n}){return __awaiter$2(this,void 0,void 0,(function*(){if(!1===e.supported)throw new Error("Voice Focus not supported. Reason: "+e.reason);const{model:r,processor:o,fetchConfig:a,executionQuanta:s}=e,{simd:d,name:l}=r,{paths:c}=a;if("voicefocus-inline-processor"!==o&&"voicefocus-worker-postMessage-processor"!==o&&"voicefocus-worker-sab-processor"!==o)throw new Error(`Unknown processor ${o}`);const u=r.url||urlForModel(r,c);null==n||n.debug(`Using model URL ${u}.`);const h=`${c.wasm}audio_buffer-v1${d?"_simd":""}.wasm`,p=`${c.wasm}resampler-v1${d?"_simd":""}.wasm`,m=`${c.workers}worker-v1.js`,{file:f,node:g}=PROCESSORS[o],S=`${c.processors}${f}`,v=yield loader_js_1.loadWorker(m,"VoiceFocusWorker",a,n);if(i){null==n||n.debug("Preloading",u);let e=support_js_1.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";v.postMessage({message:e,preload:!0,key:"model",fetchBehavior:a,path:u})}const b=new VoiceFocus(v,S,g,{processor:o,worker:v,audioBufferURL:h,resamplerURL:p,fetchBehavior:a,modelURL:u,delegate:t,logger:n,numberOfInputs:"ns_es"===l?2:1},s);return Promise.resolve(b)}))}createNode(e,t){var i;if(this.internal.isDestroyed)throw new Error("Unable to create node because VoiceFocus worker has been destroyed.");const{voiceFocusSampleRate:n=(16e3===e.sampleRate?16e3:48e3),enabled:r=!0,agc:o=DEFAULT_AGC_SETTING}=t||{},a=null==t?void 0:t.es,s={voiceFocusSampleRate:n,enabled:r,sendBufferCount:10,prefill:6,agc:o,executionQuanta:this.executionQuanta,supportFarendStream:a},d=fetch_js_1.withQueryString(this.processorURL,null===(i=this.nodeOptions)||void 0===i?void 0:i.fetchBehavior);return e.audioWorklet.addModule(d).then((()=>new this.nodeConstructor(e,Object.assign(Object.assign({},this.nodeOptions),{processorOptions:s}))))}applyToStream(e,t,i){return __awaiter$2(this,void 0,void 0,(function*(){if(this.internal.isDestroyed)throw new Error("Unable to apply stream because VoiceFocus worker has been destroyed");const n=t.createMediaStreamSource(e),r=yield this.applyToSourceNode(n,t,i),o=t.createMediaStreamDestination();return r.connect(o),{node:r,source:n,destination:o,stream:o.stream}}))}applyToSourceNode(e,t,i){return __awaiter$2(this,void 0,void 0,(function*(){const n=yield this.createNode(t,i);return e.connect(n),n}))}destroy(){this.internal.worker&&this.internal.worker.terminate(),this.internal.isDestroyed=!0}}voicefocus.VoiceFocus=VoiceFocus;const createAudioContext=(e=DEFAULT_CONTEXT_HINT)=>new(window.AudioContext||window.webkitAudioContext)(e);voicefocus.createAudioContext=createAudioContext;const getAudioInput=(e,t,i)=>__awaiter$2(void 0,void 0,void 0,(function*(){var n,r;const{constraints:o,spec:a,delegate:s,preload:d=!0,options:l}=t,{logger:c}=i,u=yield VoiceFocus.configure(a,i);if(!u.supported)return null===(n=i.logger)||void 0===n||n.warn("Voice Focus not supported; returning standard stream."),window.navigator.mediaDevices.getUserMedia(o);const h=yield VoiceFocus.init(u,{delegate:s,preload:d,logger:c}),p=(null===(r=t.options)||void 0===r?void 0:r.agc)||DEFAULT_AGC_SETTING,m=yield window.navigator.mediaDevices.getUserMedia(mungeConstraints(o,p));return h.applyToStream(m,e,l).then((e=>e.stream))}));voicefocus.getAudioInput=getAudioInput;var LoggerAdapter$1={};function stringify(e){return e.map((e=>"object"==typeof e?JSON.stringify(e):`${e}`)).join(" ")}Object.defineProperty(LoggerAdapter$1,"__esModule",{value:!0});class LoggerAdapter{constructor(e){this.base=e}debug(...e){this.base.debug(stringify(e))}info(...e){this.base.info(stringify(e))}warn(...e){this.base.warn(stringify(e))}error(...e){this.base.error(stringify(e))}}LoggerAdapter$1.default=LoggerAdapter;var VoiceFocusTransformDevice$1={},__awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VoiceFocusTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1=__importDefault$1(DefaultBrowserBehavior$1);class VoiceFocusTransformDevice{constructor(e,t,i,n,r=!1,o=undefined,a=new DefaultBrowserBehavior_1.default,s=new Map,d=undefined,l=undefined){this.device=e,this.voiceFocus=t,this.delegate=i,this.nodeOptions=n,this.failed=r,this.node=o,this.browserBehavior=a,this.farEndStreamToAudioSourceNode=s,this.mixDestNode=d,this.mixSourceNode=l}getInnerDevice(){return this.device}mute(e){return __awaiter$1(this,void 0,void 0,(function*(){this.node&&(e?yield this.node.disable():yield this.node.enable())}))}stop(){return __awaiter$1(this,void 0,void 0,(function*(){this.node&&(this.node.disconnect(),yield this.node.stop())}))}chooseNewInnerDevice(e){return __awaiter$1(this,void 0,void 0,(function*(){return this.device!==e||isDefaultDevice(e)?new VoiceFocusTransformDevice(e,this.voiceFocus,this.delegate,this.nodeOptions,this.failed,this.node,this.browserBehavior,this.farEndStreamToAudioSourceNode,this.mixDestNode,this.mixSourceNode):this}))}intrinsicDevice(){return __awaiter$1(this,void 0,void 0,(function*(){if(this.failed)return this.device;const e=this.nodeOptions.es,t={echoCancellation:!e,googEchoCancellation:!e,googEchoCancellation2:!e,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googNoiseSuppression2:!1};let i;return i=!this.nodeOptions||void 0===this.nodeOptions.agc||this.nodeOptions.agc.useBuiltInAGC,t.autoGainControl=i,t.googAutoGainControl=i,t.googAutoGainControl2=i,this.device?"string"==typeof this.device?(this.browserBehavior.requiresNoExactMediaStreamConstraints()?t.deviceId=this.device:t.deviceId={exact:this.device},t):this.device.id?this.device:Object.assign(Object.assign({},this.device),t):t}))}createAudioNode(e){var t,i;return __awaiter$1(this,void 0,void 0,(function*(){if((null===(t=this.node)||void 0===t?void 0:t.context)===e)return{start:this.node,end:this.node};const n=Object.assign({enabled:!0,agc:{useVoiceFocusAGC:!1}},this.nodeOptions);try{if(null===(i=this.node)||void 0===i||i.disconnect(),this.node=yield this.voiceFocus.createNode(e,n),this.nodeOptions.es){this.mixDestNode=new MediaStreamAudioDestinationNode(e,{channelCount:1,channelCountMode:"explicit"});for(const e of this.farEndStreamToAudioSourceNode.keys())this.assignFarEndStreamToAudioSourceNode(e);this.createMixSourceNode()}const t=this.node;return{start:t,end:this.node}}catch(e){throw this.failed=!0,this.delegate.onFallback(this,e),e}}))}observeMeetingAudio(e){return __awaiter$1(this,void 0,void 0,(function*(){if(!this.nodeOptions.es)return;e.addAudioMixObserver(this);const t=yield e.getCurrentMeetingAudioStream();t&&this.addFarEndStream(t)}))}unObserveMeetingAudio(e){return __awaiter$1(this,void 0,void 0,(function*(){if(!this.nodeOptions.es)return;e.removeAudioMixObserver(this);const t=yield e.getCurrentMeetingAudioStream();t&&this.removeFarendStream(t)}))}addObserver(e){this.delegate.addObserver(e)}removeObserver(e){this.delegate.removeObserver(e)}addFarEndStream(e){return __awaiter$1(this,void 0,void 0,(function*(){this.nodeOptions.es&&e&&!this.farEndStreamToAudioSourceNode.has(e)&&(this.node?this.assignFarEndStreamToAudioSourceNode(e):this.farEndStreamToAudioSourceNode.set(e,null))}))}removeFarendStream(e){var t;return __awaiter$1(this,void 0,void 0,(function*(){null===(t=this.farEndStreamToAudioSourceNode.get(e))||void 0===t||t.disconnect(),this.farEndStreamToAudioSourceNode.delete(e)}))}meetingAudioStreamBecameActive(e){return __awaiter$1(this,void 0,void 0,(function*(){this.addFarEndStream(e)}))}meetingAudioStreamBecameInactive(e){return __awaiter$1(this,void 0,void 0,(function*(){this.removeFarendStream(e)}))}assignFarEndStreamToAudioSourceNode(e){const t=this.node.context.createMediaStreamSource(e);t.channelCount=1,t.channelCountMode="explicit",this.farEndStreamToAudioSourceNode.set(e,t),t.connect(this.mixDestNode,0)}createMixSourceNode(){this.mixSourceNode=this.node.context.createMediaStreamSource(this.mixDestNode.stream),this.mixSourceNode.channelCount=1,this.mixSourceNode.channelCountMode="explicit",this.mixSourceNode.connect(this.node,0,1)}}function isDefaultDevice(e){return"default"===e||!(!e||"object"!=typeof e)&&("deviceId"in e&&"default"===e.deviceId||"id"in e&&"default"===e.id)}VoiceFocusTransformDevice$1.default=VoiceFocusTransformDevice;var VoiceFocusTransformDeviceDelegate$1={};Object.defineProperty(VoiceFocusTransformDeviceDelegate$1,"__esModule",{value:!0});class VoiceFocusTransformDeviceDelegate{constructor(){this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}onFallback(e,t){var i;for(const n of this.observers)null===(i=n.voiceFocusFellBackToInnerStream)||void 0===i||i.call(n,e,t)}onCPUWarning(){var e;for(const t of this.observers)null===(e=t.voiceFocusInsufficientResources)||void 0===e||e.call(t)}}VoiceFocusTransformDeviceDelegate$1.default=VoiceFocusTransformDeviceDelegate;var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(a,s)}d((n=n.apply(e,t||[])).next())}))},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(VoiceFocusDeviceTransformer$1,"__esModule",{value:!0}),VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=void 0;const voicefocus_1=voicefocus,Utils_1=Utils$1,Versioning_1=__importDefault(Versioning$1),LoggerAdapter_1=__importDefault(LoggerAdapter$1),VoiceFocusTransformDevice_1=__importDefault(VoiceFocusTransformDevice$1),VoiceFocusTransformDeviceDelegate_1=__importDefault(VoiceFocusTransformDeviceDelegate$1);class VoiceFocusDeviceTransformer{constructor(e,{preload:t=!0,logger:i,fetchBehavior:n=VoiceFocusDeviceTransformer.defaultFetchBehavior()},r){this.spec=e,this.supported=!0,this.logger=i,this.vfLogger=i?new LoggerAdapter_1.default(i):void 0,this.preload=t,this.fetchBehavior=n,this.spec=VoiceFocusDeviceTransformer.augmentSpec(this.spec),r&&(this.configuration=Promise.resolve(r))}static isSupported(e,t){var i,n;const r={fetchBehavior:VoiceFocusDeviceTransformer.defaultFetchBehavior(),logger:(null==t?void 0:t.logger)?new LoggerAdapter_1.default(t.logger):void 0};if(Utils_1.isIFramed()){if(!1===(null==t?void 0:t.allowIFrame))return null===(i=null==t?void 0:t.logger)||void 0===i||i.error("Amazon Voice Focus support check inside iframe: not supported."),Promise.resolve(!1);null===(n=null==t?void 0:t.logger)||void 0===n||n.warn("Amazon Voice Focus support check inside iframe: not recommended.")}return voicefocus_1.VoiceFocus.isSupported(VoiceFocusDeviceTransformer.augmentSpec(e),r)}static create(e={},t={},i,n,r){var o,a,s;return __awaiter(this,void 0,void 0,(function*(){n&&n.Meeting.Meeting&&(n=n.Meeting);const r="AVAILABLE"===(null===(s=null===(a=null===(o=null==n?void 0:n.Meeting)||void 0===o?void 0:o.MeetingFeatures)||void 0===a?void 0:a.Audio)||void 0===s?void 0:s.EchoReduction),d=i&&!0===i.supported&&"ns_es"===i.model.name&&!r,l="ns_es"===e.name&&!r;if(d||l)throw new Error("Echo Reduction requested but not enabled.");const c=new VoiceFocusDeviceTransformer(e,t,i);return yield c.init(),c}))}static configure(e={},t={}){return __awaiter(this,void 0,void 0,(function*(){return new VoiceFocusDeviceTransformer(e,t,void 0).configure(!0)}))}getConfiguration(){return this.configuration}isSupported(){return this.supported}createTransformDevice(e,t){return __awaiter(this,void 0,void 0,(function*(){if(this.supported)try{const i=!0,[n,r]=yield this.allocateVoiceFocus(i),o=Object.assign(Object.assign({},t),{es:"ns_es"===this.spec.name});return new VoiceFocusTransformDevice_1.default(e,n,r,o)}catch(e){return}}))}static destroyVoiceFocus(e){var t;return __awaiter(this,void 0,void 0,(function*(){null===(t=null==e?void 0:e.vf)||void 0===t||t.destroy()}))}static augmentSpec(e){return e&&(e.assetGroup||e.revisionID)?e:Object.assign(Object.assign({},e),{assetGroup:VoiceFocusDeviceTransformer.currentSDKAssetGroup()})}configure(e=!1){return __awaiter(this,void 0,void 0,(function*(){const t={fetchBehavior:this.fetchBehavior,preResolve:e,logger:this.vfLogger};return voicefocus_1.VoiceFocus.configure(this.spec,t)}))}init(){var e;return __awaiter(this,void 0,void 0,(function*(){this.configuration||(this.configuration=this.configure());const t=yield this.configuration;if(t.supported){this.pendingVoiceFocus=this.createVoiceFocus(t,this.preload);try{yield this.pendingVoiceFocus}catch(t){null===(e=this.logger)||void 0===e||e.error(`Unable to initialize Amazon Voice Focus: ${t}`),this.supported=!1}}else this.supported=!1}))}createVoiceFocus(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=new VoiceFocusTransformDeviceDelegate_1.default;return this.vf=yield voicefocus_1.VoiceFocus.init(e,{delegate:i,preload:t,logger:this.vfLogger}),[this.vf,i]}))}allocateVoiceFocus(e){return __awaiter(this,void 0,void 0,(function*(){if(!this.supported)throw new Error("Not supported.");if(this.pendingVoiceFocus){const e=this.pendingVoiceFocus;return this.pendingVoiceFocus=void 0,e}return this.createVoiceFocus(yield this.configuration,e)}))}static majorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|[1-9][0-9]*)/)[0]}static majorMinorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|(?:[1-9][0-9]*))\.(?:0|[1-9][0-9]*)/)[0]}static currentSDKAssetGroup(){const e=this.majorVersion();return e?`sdk-${e}`:"stable-v1"}static defaultFetchBehavior(){const e=VoiceFocusDeviceTransformer.majorMinorVersion()||"unknown",t=Versioning_1.default.sdkUserAgentLowResolution;return{escapedQueryString:`sdk=${encodeURIComponent(e)}&ua=${encodeURIComponent(t)}`}}}var hasRequiredBuild;function requireBuild(){return hasRequiredBuild||(hasRequiredBuild=1,function(e){var t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultEventController=e.DefaultDevicePixelRatioMonitor=e.DefaultDeviceController=e.DefaultContentShareController=e.DefaultBrowserBehavior=e.DefaultAudioVideoFacade=e.DefaultAudioVideoController=e.DefaultAudioMixController=e.DefaultActiveSpeakerPolicy=e.DefaultActiveSpeakerDetector=e.DataMessage=e.CreateSDPTask=e.CreatePeerConnectionTask=e.ContentShareMediaStreamBroker=e.ContentShareConstants=e.ConsoleLogger=e.ConnectionHealthPolicyConfiguration=e.ConnectionHealthData=e.ClientVideoStreamReceivingReport=e.ClientMetricReportMediaType=e.ClientMetricReportDirection=e.ClientMetricReport=e.CleanStoppedSessionTask=e.CleanRestartedSessionTask=e.CheckVideoInputFeedback=e.CheckVideoConnectivityFeedback=e.CheckNetworkUDPConnectivityFeedback=e.CheckNetworkTCPConnectivityFeedback=e.CheckContentShareConnectivityFeedback=e.CheckCameraResolutionFeedback=e.CheckAudioOutputFeedback=e.CheckAudioInputFeedback=e.CheckAudioConnectivityFeedback=e.CanvasVideoFrameBuffer=e.CSPMonitor=e.BitrateParameters=e.BaseTask=e.BaseConnectionHealthPolicy=e.BackgroundReplacementVideoFrameProcessor=e.BackgroundFilterVideoFrameProcessor=e.BackgroundBlurVideoFrameProcessor=e.BackgroundBlurStrength=e.AudioVideoControllerState=e.AudioProfile=e.AudioLogEvent=e.Attendee=e.AttachMediaInputTask=e.AsyncScheduler=e.ApplicationMetadata=e.AllHighestVideoBandwidthPolicy=void 0,e.MeetingReadinessCheckerConfiguration=e.MeetingFeatures=e.MeetingEventsClientConfiguration=e.MediaDeviceProxyHandler=e.Maybe=e.LogLevel=e.Log=e.ListenForVolumeIndicatorsTask=e.LeaveAndReceiveLeaveAckTask=e.JoinAndReceiveIndexTask=e.IntervalScheduler=e.InMemoryJSONEventBuffer=e.GlobalMetricReport=e.GetUserMediaError=e.FullJitterLimitedBackoff=e.FullJitterBackoffFactory=e.FullJitterBackoff=e.FinishGatheringICECandidatesTask=e.EventIngestionConfiguration=e.EventBufferConfiguration=e.DeviceSelection=e.DevicePixelRatioWindowSource=e.DefaultWebSocketAdapter=e.DefaultVolumeIndicatorAdapter=e.DefaultVideoTransformDevice=e.DefaultVideoTileFactory=e.DefaultVideoTileController=e.DefaultVideoTile=e.DefaultVideoStreamIndex=e.DefaultVideoStreamIdSet=e.DefaultVideoFrameProcessorTimer=e.DefaultVideoFrameProcessorPipeline=e.DefaultVideoCaptureAndEncodeParameter=e.DefaultUserAgentParser=e.DefaultTranscriptionController=e.DefaultTransceiverController=e.DefaultSimulcastUplinkPolicyForContentShare=e.DefaultSimulcastUplinkPolicy=e.DefaultSignalingClient=e.DefaultSigV4=e.DefaultSessionStateController=e.DefaultReconnectController=e.DefaultRealtimeController=e.DefaultPingPong=e.DefaultModality=e.DefaultMessagingSession=e.DefaultMeetingSession=e.DefaultMeetingReadinessChecker=e.DefaultMeetingEventReporter=e.DefaultMediaDeviceFactory=void 0,e.RedundantAudioEncoder=e.ReconnectionHealthPolicy=e.ReceiveVideoStreamIndexTask=e.ReceiveVideoInputTask=e.ReceiveTURNCredentialsTask=e.ReceiveRemoteVideoPauseResumeTask=e.ReceiveAudioInputTask=e.RealtimeVolumeIndicator=e.RealtimeState=e.RealtimeAttendeePositionInFrame=e.PromoteToPrimaryMeetingTask=e.PromiseQueue=e.PrefetchSortBy=e.PrefetchOn=e.PermissionDeniedError=e.ParallelGroupTask=e.POSTLogger=e.OverconstrainedError=e.OpenSignalingConnectionTask=e.OnceTask=e.NotReadableError=e.NotFoundError=e.None=e.NoVideoUplinkBandwidthPolicy=e.NoVideoDownlinkBandwidthPolicy=e.NoOpVideoFrameProcessor=e.NoOpVideoElementFactory=e.NoOpTask=e.NoOpMediaStreamBroker=e.NoOpLogger=e.NoOpEventReporter=e.NoOpDeviceController=e.NoOpDebugLogger=e.NoOpAudioVideoController=e.NScaleVideoUplinkBandwidthPolicy=e.MutableVideoPreferences=e.MultiLogger=e.MonitorTask=e.ModelSpecBuilder=e.MessagingSessionConfiguration=e.Message=e.MeetingSessionVideoAvailability=e.MeetingSessionURLs=e.MeetingSessionTURNCredentials=e.MeetingSessionStatusCode=e.MeetingSessionStatus=e.MeetingSessionLifecycleEventCondition=e.MeetingSessionLifecycleEvent=e.MeetingSessionCredentials=e.MeetingSessionConfiguration=void 0,e.VideoFxProcessor=e.VideoCodecCapability=e.VideoAdaptiveProbePolicy=e.Versioning=e.UnusableAudioWarningConnectionHealthPolicy=e.TypeError=e.TranscriptionStatusType=e.TranscriptionStatus=e.TranscriptResult=e.TranscriptLanguageWithScore=e.TranscriptItemType=e.TranscriptItem=e.TranscriptEntity=e.TranscriptAlternative=e.Transcript=e.TimeoutTask=e.TimeoutScheduler=e.TaskStatus=e.TargetDisplaySize=e.SubscribeAndReceiveSubscribeAckTask=e.StreamMetricReport=e.Some=e.SingleNodeAudioTransformDevice=e.SimulcastVideoStreamIndex=e.SimulcastTransceiverController=e.SimulcastLayers=e.SimulcastContentShareTransceiverController=e.SignalingClientVideoSubscriptionConfiguration=e.SignalingClientSubscribe=e.SignalingClientJoin=e.SignalingClientEventType=e.SignalingClientEvent=e.SignalingClientConnectionRequest=e.SignalingAndMetricsConnectionMonitor=e.SetRemoteDescriptionTask=e.SetLocalDescriptionTask=e.SessionStateControllerTransitionResult=e.SessionStateControllerState=e.SessionStateControllerDeferPriority=e.SessionStateControllerAction=e.ServerSideNetworkAdaption=e.SerialGroupTask=e.SendingAudioFailureConnectionHealthPolicy=e.SendAndReceiveDataMessagesTask=e.SDPMediaSection=e.SDPCandidateType=e.SDP=e.RunnableTask=e.RedundantAudioRecoveryMetricReport=e.RedundantAudioEncoderWorkerCode=void 0,e.isVideoTransformDevice=e.isDestroyable=e.isAudioTransformDevice=e.ZLIBTextCompressor=e.WebSocketReadyState=e.WaitForAttendeePresenceTask=e.VoiceFocusTransformDevice=e.VoiceFocusDeviceTransformer=e.VideoTileState=e.VideoStreamDescription=e.VideoSource=e.VideoQualitySettings=e.VideoQualityAdaptationPreference=e.VideoPriorityBasedPolicyConfig=e.VideoPriorityBasedPolicy=e.VideoPreferences=e.VideoPreference=e.VideoOnlyTransceiverController=e.VideoLogEvent=void 0;const i=t(AllHighestVideoBandwidthPolicy$1);e.AllHighestVideoBandwidthPolicy=i.default;const n=t(ApplicationMetadata$1);e.ApplicationMetadata=n.default;const r=t(AsyncScheduler$1);e.AsyncScheduler=r.default;const o=t(AttachMediaInputTask$1);e.AttachMediaInputTask=o.default;const a=t(Attendee$1);e.Attendee=a.default;const s=t(AudioLogEvent);e.AudioLogEvent=s.default;const d=t(AudioProfile$1);e.AudioProfile=d.default;const l=t(AudioVideoControllerState);e.AudioVideoControllerState=l.default;const c=t(BackgroundBlurStrength);e.BackgroundBlurStrength=c.default;const u=t(BackgroundBlurVideoFrameProcessor$1);e.BackgroundBlurVideoFrameProcessor=u.default;const h=t(BackgroundFilterVideoFrameProcessor$1);e.BackgroundFilterVideoFrameProcessor=h.default;const p=t(BackgroundReplacementVideoFrameProcessor$1);e.BackgroundReplacementVideoFrameProcessor=p.default;const m=t(BaseConnectionHealthPolicy$1);e.BaseConnectionHealthPolicy=m.default;const f=t(BaseTask$1);e.BaseTask=f.default;const g=t(BitrateParameters$1);e.BitrateParameters=g.default;const S=t(CSPMonitor$1);e.CSPMonitor=S.default;const v=t(CanvasVideoFrameBuffer$1);e.CanvasVideoFrameBuffer=v.default;const b=t(CheckAudioConnectivityFeedback);e.CheckAudioConnectivityFeedback=b.default;const _=t(CheckAudioInputFeedback);e.CheckAudioInputFeedback=_.default;const y=t(CheckAudioOutputFeedback);e.CheckAudioOutputFeedback=y.default;const C=t(CheckCameraResolutionFeedback);e.CheckCameraResolutionFeedback=C.default;const w=t(CheckContentShareConnectivityFeedback);e.CheckContentShareConnectivityFeedback=w.default;const E=t(CheckNetworkTCPConnectivityFeedback);e.CheckNetworkTCPConnectivityFeedback=E.default;const T=t(CheckNetworkUDPConnectivityFeedback);e.CheckNetworkUDPConnectivityFeedback=T.default;const k=t(CheckVideoConnectivityFeedback);e.CheckVideoConnectivityFeedback=k.default;const M=t(CheckVideoInputFeedback);e.CheckVideoInputFeedback=M.default;const R=t(CleanRestartedSessionTask$1);e.CleanRestartedSessionTask=R.default;const A=t(CleanStoppedSessionTask$1);e.CleanStoppedSessionTask=A.default;const P=t(ClientMetricReport$1);e.ClientMetricReport=P.default;const I=t(ClientMetricReportDirection);e.ClientMetricReportDirection=I.default;const $=t(ClientMetricReportMediaType);e.ClientMetricReportMediaType=$.default;const D=t(ClientVideoStreamReceivingReport$1);e.ClientVideoStreamReceivingReport=D.default;const x=t(ConnectionHealthData$1);e.ConnectionHealthData=x.default;const O=t(ConnectionHealthPolicyConfiguration$1);e.ConnectionHealthPolicyConfiguration=O.default;const F=t(ConsoleLogger$1);e.ConsoleLogger=F.default;const B=t(ContentShareConstants$1);e.ContentShareConstants=B.default;const N=t(ContentShareMediaStreamBroker$1);e.ContentShareMediaStreamBroker=N.default;const L=t(CreatePeerConnectionTask$1);e.CreatePeerConnectionTask=L.default;const V=t(CreateSDPTask$1);e.CreateSDPTask=V.default;const U=t(DataMessage$1);e.DataMessage=U.default;const j=t(DefaultActiveSpeakerDetector$1);e.DefaultActiveSpeakerDetector=j.default;const z=t(DefaultActiveSpeakerPolicy$1);e.DefaultActiveSpeakerPolicy=z.default;const H=t(DefaultAudioMixController$1);e.DefaultAudioMixController=H.default;const G=t(requireDefaultAudioVideoController());e.DefaultAudioVideoController=G.default;const W=t(DefaultAudioVideoFacade$1);e.DefaultAudioVideoFacade=W.default;const q=t(DefaultBrowserBehavior$1);e.DefaultBrowserBehavior=q.default;const K=t(DefaultContentShareController$1);e.DefaultContentShareController=K.default;const J=t(DefaultDeviceController$1);e.DefaultDeviceController=J.default;const Z=t(DefaultDevicePixelRatioMonitor$1);e.DefaultDevicePixelRatioMonitor=Z.default;const Q=t(DefaultEventController$1);e.DefaultEventController=Q.default;const X=t(DefaultMediaDeviceFactory$1);e.DefaultMediaDeviceFactory=X.default;const Y=t(DefaultMeetingEventReporter$1);e.DefaultMeetingEventReporter=Y.default;const ee=t(DefaultMeetingReadinessChecker$1);e.DefaultMeetingReadinessChecker=ee.default;const te=t(requireDefaultMeetingSession());e.DefaultMeetingSession=te.default;const ie=t(DefaultMessagingSession$1);e.DefaultMessagingSession=ie.default;const ne=t(DefaultModality$1);e.DefaultModality=ne.default;const re=t(DefaultPingPong$1);e.DefaultPingPong=re.default;const oe=t(DefaultRealtimeController$1);e.DefaultRealtimeController=oe.default;const ae=t(DefaultReconnectController$1);e.DefaultReconnectController=ae.default;const se=t(DefaultSessionStateController$1);e.DefaultSessionStateController=se.default;const de=t(DefaultSigV4$1);e.DefaultSigV4=de.default;const le=t(DefaultSignalingClient$1);e.DefaultSignalingClient=le.default;const ce=t(DefaultSimulcastUplinkPolicy$1);e.DefaultSimulcastUplinkPolicy=ce.default;const ue=t(DefaultSimulcastUplinkPolicyForContentShare$1);e.DefaultSimulcastUplinkPolicyForContentShare=ue.default;const he=t(DefaultTransceiverController$1);e.DefaultTransceiverController=he.default;const pe=t(DefaultTranscriptionController);e.DefaultTranscriptionController=pe.default;const me=t(DefaultUserAgentParser$1);e.DefaultUserAgentParser=me.default;const fe=t(DefaultVideoCaptureAndEncodeParameter$1);e.DefaultVideoCaptureAndEncodeParameter=fe.default;const ge=t(DefaultVideoFrameProcessorPipeline$1);e.DefaultVideoFrameProcessorPipeline=ge.default;const Se=t(DefaultVideoFrameProcessorTimer$1);e.DefaultVideoFrameProcessorTimer=Se.default;const ve=t(DefaultVideoStreamIdSet$1);e.DefaultVideoStreamIdSet=ve.default;const be=t(DefaultVideoStreamIndex$1);e.DefaultVideoStreamIndex=be.default;const _e=t(DefaultVideoTile$1);e.DefaultVideoTile=_e.default;const ye=t(DefaultVideoTileController$1);e.DefaultVideoTileController=ye.default;const Ce=t(DefaultVideoTileFactory$1);e.DefaultVideoTileFactory=Ce.default;const we=t(DefaultVideoTransformDevice$1);e.DefaultVideoTransformDevice=we.default;const Ee=t(DefaultVolumeIndicatorAdapter$1);e.DefaultVolumeIndicatorAdapter=Ee.default;const Te=t(DefaultWebSocketAdapter$1);e.DefaultWebSocketAdapter=Te.default;const ke=t(DevicePixelRatioWindowSource$1);e.DevicePixelRatioWindowSource=ke.default;const Me=t(DeviceSelection$1);e.DeviceSelection=Me.default;const Re=t(EventBufferConfiguration$1);e.EventBufferConfiguration=Re.default;const Ae=t(EventIngestionConfiguration$1);e.EventIngestionConfiguration=Ae.default;const Pe=t(FinishGatheringICECandidatesTask$1);e.FinishGatheringICECandidatesTask=Pe.default;const Ie=t(FullJitterBackoff$1);e.FullJitterBackoff=Ie.default;const $e=t(FullJitterBackoffFactory$1);e.FullJitterBackoffFactory=$e.default;const De=t(FullJitterLimitedBackoff$1);e.FullJitterLimitedBackoff=De.default;const xe=t(GetUserMediaError$1);e.GetUserMediaError=xe.default;const Oe=t(GlobalMetricReport$1);e.GlobalMetricReport=Oe.default;const Fe=t(InMemoryJSONEventBuffer$1);e.InMemoryJSONEventBuffer=Fe.default;const Be=t(IntervalScheduler$1);e.IntervalScheduler=Be.default;const Ne=t(JoinAndReceiveIndexTask$1);e.JoinAndReceiveIndexTask=Ne.default;const Le=t(LeaveAndReceiveLeaveAckTask$1);e.LeaveAndReceiveLeaveAckTask=Le.default;const Ve=t(ListenForVolumeIndicatorsTask$1);e.ListenForVolumeIndicatorsTask=Ve.default;const Ue=t(Log$1);e.Log=Ue.default;const je=t(LogLevel);e.LogLevel=je.default;const ze=t(MediaDeviceProxyHandler$1);e.MediaDeviceProxyHandler=ze.default;const He=t(MeetingEventsClientConfiguration$1);e.MeetingEventsClientConfiguration=He.default;const Ge=t(MeetingFeatures$1);e.MeetingFeatures=Ge.default;const We=t(MeetingReadinessCheckerConfiguration$1);e.MeetingReadinessCheckerConfiguration=We.default;const qe=t(MeetingSessionConfiguration$1);e.MeetingSessionConfiguration=qe.default;const Ke=t(MeetingSessionCredentials$1);e.MeetingSessionCredentials=Ke.default;const Je=t(MeetingSessionLifecycleEvent);e.MeetingSessionLifecycleEvent=Je.default;const Ze=t(MeetingSessionLifecycleEventCondition);e.MeetingSessionLifecycleEventCondition=Ze.default;const Qe=t(MeetingSessionStatus$1);e.MeetingSessionStatus=Qe.default;const Xe=t(MeetingSessionStatusCode);e.MeetingSessionStatusCode=Xe.default;const Ye=t(MeetingSessionTURNCredentials$1);e.MeetingSessionTURNCredentials=Ye.default;const et=t(MeetingSessionURLs$1);e.MeetingSessionURLs=et.default;const tt=t(MeetingSessionVideoAvailability$1);e.MeetingSessionVideoAvailability=tt.default;const it=t(Message$1);e.Message=it.default;const nt=t(MessagingSessionConfiguration$1);e.MessagingSessionConfiguration=nt.default;const rt=t(ModelSpecBuilder$1);e.ModelSpecBuilder=rt.default;const ot=t(MonitorTask$1);e.MonitorTask=ot.default;const at=t(MultiLogger$1);e.MultiLogger=at.default;const st=t(NScaleVideoUplinkBandwidthPolicy$1);e.NScaleVideoUplinkBandwidthPolicy=st.default;const dt=t(requireNoOpAudioVideoController());e.NoOpAudioVideoController=dt.default;const lt=t(NoOpDebugLogger$1);e.NoOpDebugLogger=lt.default;const ct=t(NoOpDeviceController$1);e.NoOpDeviceController=ct.default;const ut=t(NoOpEventReporter$1);e.NoOpEventReporter=ut.default;const ht=t(NoOpLogger$1);e.NoOpLogger=ht.default;const pt=t(NoOpMediaStreamBroker$1);e.NoOpMediaStreamBroker=pt.default;const mt=t(NoOpTask$1);e.NoOpTask=mt.default;const ft=t(NoOpVideoElementFactory$1);e.NoOpVideoElementFactory=ft.default;const gt=t(NoOpVideoFrameProcessor$1);e.NoOpVideoFrameProcessor=gt.default;const St=t(NoVideoDownlinkBandwidthPolicy$1);e.NoVideoDownlinkBandwidthPolicy=St.default;const vt=t(NoVideoUplinkBandwidthPolicy$1);e.NoVideoUplinkBandwidthPolicy=vt.default;const bt=t(NotFoundError$1);e.NotFoundError=bt.default;const _t=t(NotReadableError$1);e.NotReadableError=_t.default;const yt=t(OnceTask$1);e.OnceTask=yt.default;const Ct=t(OpenSignalingConnectionTask$1);e.OpenSignalingConnectionTask=Ct.default;const wt=t(OverconstrainedError$1);e.OverconstrainedError=wt.default;const Et=t(POSTLogger$1);e.POSTLogger=Et.default;const Tt=t(ParallelGroupTask$1);e.ParallelGroupTask=Tt.default;const kt=t(PermissionDeniedError$1);e.PermissionDeniedError=kt.default;const Mt=t(PrefetchOn$1);e.PrefetchOn=Mt.default;const Rt=t(PrefetchSortBy$1);e.PrefetchSortBy=Rt.default;const At=t(PromiseQueue$1);e.PromiseQueue=At.default;const Pt=t(requirePromoteToPrimaryMeetingTask());e.PromoteToPrimaryMeetingTask=Pt.default;const It=t(RealtimeAttendeePositionInFrame$1);e.RealtimeAttendeePositionInFrame=It.default;const $t=t(RealtimeState$1);e.RealtimeState=$t.default;const Dt=t(RealtimeVolumeIndicator$1);e.RealtimeVolumeIndicator=Dt.default;const xt=t(ReceiveAudioInputTask$1);e.ReceiveAudioInputTask=xt.default;const Ot=t(ReceiveRemoteVideoPauseResumeTask);e.ReceiveRemoteVideoPauseResumeTask=Ot.default;const Ft=t(ReceiveTURNCredentialsTask$1);e.ReceiveTURNCredentialsTask=Ft.default;const Bt=t(ReceiveVideoInputTask$1);e.ReceiveVideoInputTask=Bt.default;const Nt=t(ReceiveVideoStreamIndexTask$1);e.ReceiveVideoStreamIndexTask=Nt.default;const Lt=t(ReconnectionHealthPolicy$1);e.ReconnectionHealthPolicy=Lt.default;const Vt=t(RedundantAudioEncoder$1);e.RedundantAudioEncoder=Vt.default;const Ut=t(RedundantAudioEncoderWorkerCode$1);e.RedundantAudioEncoderWorkerCode=Ut.default;const jt=t(RedundantAudioRecoveryMetricReport$1);e.RedundantAudioRecoveryMetricReport=jt.default;const zt=t(RunnableTask$1);e.RunnableTask=zt.default;const Ht=t(SDP$1);e.SDP=Ht.default;const Gt=t(SDPCandidateType);e.SDPCandidateType=Gt.default;const Wt=t(SDPMediaSection$1);e.SDPMediaSection=Wt.default;const qt=t(SendAndReceiveDataMessagesTask$1);e.SendAndReceiveDataMessagesTask=qt.default;const Kt=t(SendingAudioFailureConnectionHealthPolicy$1);e.SendingAudioFailureConnectionHealthPolicy=Kt.default;const Jt=t(SerialGroupTask$1);e.SerialGroupTask=Jt.default;const Zt=t(ServerSideNetworkAdaption);e.ServerSideNetworkAdaption=Zt.default;const Qt=t(SessionStateControllerAction);e.SessionStateControllerAction=Qt.default;const Xt=t(SessionStateControllerDeferPriority);e.SessionStateControllerDeferPriority=Xt.default;const Yt=t(SessionStateControllerState);e.SessionStateControllerState=Yt.default;const ei=t(SessionStateControllerTransitionResult);e.SessionStateControllerTransitionResult=ei.default;const ti=t(SetLocalDescriptionTask$1);e.SetLocalDescriptionTask=ti.default;const ii=t(SetRemoteDescriptionTask$1);e.SetRemoteDescriptionTask=ii.default;const ni=t(SignalingAndMetricsConnectionMonitor$1);e.SignalingAndMetricsConnectionMonitor=ni.default;const ri=t(SignalingClientConnectionRequest$1);e.SignalingClientConnectionRequest=ri.default;const oi=t(SignalingClientEvent$1);e.SignalingClientEvent=oi.default;const ai=t(SignalingClientEventType);e.SignalingClientEventType=ai.default;const si=t(SignalingClientJoin$1);e.SignalingClientJoin=si.default;const di=t(SignalingClientSubscribe$1);e.SignalingClientSubscribe=di.default;const li=t(SignalingClientVideoSubscriptionConfiguration$1);e.SignalingClientVideoSubscriptionConfiguration=li.default;const ci=t(SimulcastContentShareTransceiverController$1);e.SimulcastContentShareTransceiverController=ci.default;const ui=t(SimulcastLayers);e.SimulcastLayers=ui.default;const hi=t(SimulcastTransceiverController$1);e.SimulcastTransceiverController=hi.default;const pi=t(SimulcastVideoStreamIndex$1);e.SimulcastVideoStreamIndex=pi.default;const mi=t(SingleNodeAudioTransformDevice$1);e.SingleNodeAudioTransformDevice=mi.default;const fi=t(StreamMetricReport$1);e.StreamMetricReport=fi.default;const gi=t(SubscribeAndReceiveSubscribeAckTask$1);e.SubscribeAndReceiveSubscribeAckTask=gi.default;const Si=t(TargetDisplaySize);e.TargetDisplaySize=Si.default;const vi=t(TaskStatus$1);e.TaskStatus=vi.default;const bi=t(TimeoutScheduler$1);e.TimeoutScheduler=bi.default;const _i=t(TimeoutTask$1);e.TimeoutTask=_i.default;const yi=t(Transcript$1);e.Transcript=yi.default;const Ci=t(TranscriptAlternative$1);e.TranscriptAlternative=Ci.default;const wi=t(TranscriptEntity$1);e.TranscriptEntity=wi.default;const Ei=t(TranscriptItem$1);e.TranscriptItem=Ei.default;const Ti=t(TranscriptItemType$1);e.TranscriptItemType=Ti.default;const ki=t(TranscriptLanguageWithScore$1);e.TranscriptLanguageWithScore=ki.default;const Mi=t(TranscriptResult$1);e.TranscriptResult=Mi.default;const Ri=t(TranscriptionStatus$1);e.TranscriptionStatus=Ri.default;const Ai=t(TranscriptionStatusType$1);e.TranscriptionStatusType=Ai.default;const Pi=t(_TypeError);e.TypeError=Pi.default;const Ii=t(UnusableAudioWarningConnectionHealthPolicy$1);e.UnusableAudioWarningConnectionHealthPolicy=Ii.default;const $i=t(Versioning$1);e.Versioning=$i.default;const Di=t(VideoAdaptiveProbePolicy$1);e.VideoAdaptiveProbePolicy=Di.default;const xi=t(VideoCodecCapability$1);e.VideoCodecCapability=xi.default;const Oi=t(VideoFxProcessor$1);e.VideoFxProcessor=Oi.default;const Fi=t(VideoLogEvent);e.VideoLogEvent=Fi.default;const Bi=t(VideoOnlyTransceiverController$1);e.VideoOnlyTransceiverController=Bi.default;const Ni=t(VideoPreference$1);e.VideoPreference=Ni.default;const Li=t(VideoPreferences$1);e.VideoPreferences=Li.default;const Vi=t(VideoPriorityBasedPolicy$1);e.VideoPriorityBasedPolicy=Vi.default;const Ui=t(VideoPriorityBasedPolicyConfig$1);e.VideoPriorityBasedPolicyConfig=Ui.default;const ji=t(VideoQualityAdaptationPreference);e.VideoQualityAdaptationPreference=ji.default;const zi=t(VideoQualitySettings$1);e.VideoQualitySettings=zi.default;const Hi=t(VideoSource$1);e.VideoSource=Hi.default;const Gi=t(VideoStreamDescription$1);e.VideoStreamDescription=Gi.default;const Wi=t(VideoTileState$1);e.VideoTileState=Wi.default;const qi=t(VoiceFocusDeviceTransformer$1);e.VoiceFocusDeviceTransformer=qi.default;const Ki=t(VoiceFocusTransformDevice$1);e.VoiceFocusTransformDevice=Ki.default;const Ji=t(WaitForAttendeePresenceTask$1);e.WaitForAttendeePresenceTask=Ji.default;const Zi=t(WebSocketReadyState);e.WebSocketReadyState=Zi.default;const Qi=t(ZLIBTextCompressor$1);e.ZLIBTextCompressor=Qi.default;const Xi=VideoPreferences$1;Object.defineProperty(e,"MutableVideoPreferences",{enumerable:!0,get:function(){return Xi.MutableVideoPreferences}});const Yi=Types;Object.defineProperty(e,"Some",{enumerable:!0,get:function(){return Yi.Some}}),Object.defineProperty(e,"None",{enumerable:!0,get:function(){return Yi.None}}),Object.defineProperty(e,"Maybe",{enumerable:!0,get:function(){return Yi.Maybe}});const en=AudioTransformDevice;Object.defineProperty(e,"isAudioTransformDevice",{enumerable:!0,get:function(){return en.isAudioTransformDevice}});const tn=Destroyable;Object.defineProperty(e,"isDestroyable",{enumerable:!0,get:function(){return tn.isDestroyable}});const nn=VideoTransformDevice;Object.defineProperty(e,"isVideoTransformDevice",{enumerable:!0,get:function(){return nn.isVideoTransformDevice}})}(build$9)),build$9}VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=VoiceFocusDeviceTransformer,VoiceFocusDeviceTransformer$1.default=VoiceFocusDeviceTransformer;var buildExports=requireBuild(),index=getDefaultExportFromCjs(buildExports),index$1=_mergeNamespaces({__proto__:null,default:index},[buildExports]);return index$1}));
//# sourceMappingURL=amazon-chime-sdk.min.js.map
